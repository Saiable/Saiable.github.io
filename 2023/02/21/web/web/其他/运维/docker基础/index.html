<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>docker基础与进阶 | 吕小布の博客</title><meta name="keywords" content="docker"><meta name="author" content="Sai"><meta name="copyright" content="Sai"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="来源：https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1gr4y1U7CY Docker简介为什么会有docker出现？假定您在开发一个尚硅谷的谷粒商城，您使用的是一台笔记本电脑而且您的开发环境具有特定的配置。其他开发人员身处的环境配置也各有不同。您正在开发的应用依赖于您当前的配置且还要依赖于某些配置文件。此外，您的企业还拥有标准化的测试和生产环境，且具有自身的配置和一系列支持文">
<meta property="og:type" content="article">
<meta property="og:title" content="docker基础与进阶">
<meta property="og:url" content="https://mindcons.cn/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/index.html">
<meta property="og:site_name" content="吕小布の博客">
<meta property="og:description" content="来源：https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1gr4y1U7CY Docker简介为什么会有docker出现？假定您在开发一个尚硅谷的谷粒商城，您使用的是一台笔记本电脑而且您的开发环境具有特定的配置。其他开发人员身处的环境配置也各有不同。您正在开发的应用依赖于您当前的配置且还要依赖于某些配置文件。此外，您的企业还拥有标准化的测试和生产环境，且具有自身的配置和一系列支持文">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://bu.dusays.com/2023/02/10/63e583843360e.webp">
<meta property="article:published_time" content="2023-02-20T23:15:24.000Z">
<meta property="article:modified_time" content="2023-10-30T22:13:48.314Z">
<meta property="article:author" content="Sai">
<meta property="article:tag" content="docker">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://bu.dusays.com/2023/02/10/63e583843360e.webp"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://mindcons.cn/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"61301LMFP2","apiKey":"a7627d15f4af23df7fbc3e2922471858","indexName":"mindcons","hits":{"per_page":10},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: {"limitDay":500,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":350},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: Sai","link":"链接: ","source":"来源: 吕小布の博客","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'docker基础与进阶',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-10-31 06:13:48'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/custom/css/custom.min.css"><meta name="generator" content="Hexo 6.2.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://bu.dusays.com/2023/02/10/63e583843360e.webp" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">152</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">53</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">36</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fas fa-book"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 娱乐</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fa-sharp fa-solid fa-photo-film"></i><span> 相册</span></a></li><li><a class="site-page child" href="/bangumis/"><i class="fa-fw fas fa-video"></i><span> 番剧</span></a></li><li><a class="site-page child" href="/booklist/"><i class="fa-fw fa-solid fa-book"></i><span> 书单</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/sponsorWall/"><i class="fa-fw fas fa-money-check-alt"></i><span> 赞助墙</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fas fa-comments"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">吕小布の博客</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fas fa-book"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 娱乐</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fa-sharp fa-solid fa-photo-film"></i><span> 相册</span></a></li><li><a class="site-page child" href="/bangumis/"><i class="fa-fw fas fa-video"></i><span> 番剧</span></a></li><li><a class="site-page child" href="/booklist/"><i class="fa-fw fa-solid fa-book"></i><span> 书单</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/sponsorWall/"><i class="fa-fw fas fa-money-check-alt"></i><span> 赞助墙</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fas fa-comments"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">docker基础与进阶</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-02-20T23:15:24.000Z" title="发表于 2023-02-21 07:15:24">2023-02-21</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-10-30T22:13:48.314Z" title="更新于 2023-10-31 06:13:48">2023-10-31</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/docker/">docker</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="docker基础与进阶"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>来源：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1gr4y1U7CY">https://www.bilibili.com/video/BV1gr4y1U7CY</a></p>
<h1 id="Docker简介"><a href="#Docker简介" class="headerlink" title="Docker简介"></a>Docker简介</h1><h2 id="为什么会有docker出现？"><a href="#为什么会有docker出现？" class="headerlink" title="为什么会有docker出现？"></a>为什么会有docker出现？</h2><p>假定您在开发一个尚硅谷的谷粒商城，您使用的是一台笔记本电脑而且您的开发环境具有特定的配置。其他开发人员身处的环境配置也各有不同。您正在开发的应用依赖于您当前的配置且还要依赖于某些配置文件。此外，您的企业还拥有标准化的测试和生产环境，且具有自身的配置和一系列支持文件。您希望尽可能多在本地模拟这些环境而不产生重新创建服务器环境的开销。请问？</p>
<p>您要如何确保应用能够在这些环境中运行和通过质量检测？并且在部署过程中不出现令人头疼的版本、配置问题，也无需重新编写代码和进行故障修复？</p>
<p>答案就是使用容器。Docker之所以发展如此迅速，也是因为它对此给出了一个标准化的解决方案—–<strong>系统平滑移植，容器虚拟化技术</strong>。</p>
<p>环境配置相当麻烦，换一台机器，就要重来一次，费力费时。很多人想到，能不能从根本上解决问题，<strong>软件可以带环境安装？</strong>也就是说，<strong>安装的时候，把原始环境一模一样地复制过来。开发人员利用 Docker 可以消除协作编码时“在我的机器上可正常工作”的问题。</strong></p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221122145627095.png" alt="image-20221122145627095"></p>
<p>之前在服务器配置一个应用的运行环境，要安装各种软件，就拿尚硅谷电商项目的环境来说，Java&#x2F;RabbitMQ&#x2F;MySQL&#x2F;JDBC驱动包等。安装和配置这些东西有多麻烦就不说了，它还不能跨平台。假如我们是在 Windows 上安装的这些环境，到了 Linux 又得重新装。况且就算不跨操作系统，换另一台同样操作系统的服务器，要****移植****应用也是非常麻烦的。</p>
<p>传统上认为，软件编码开发&#x2F;测试结束后，所产出的成果即是程序或是能够编译执行的二进制字节码等(java为例)。而为了让这些程序可以顺利执行，开发团队也得准备完整的部署文件，让维运团队得以部署应用程式，开发需要清楚的告诉运维部署团队，用的全部配置文件+所有软件环境。不过，即便如此，仍然常常发生部署失败的状况。Docker的出现使得Docker得以打破过去「程序即应用」的观念。透过镜像(images)将作业系统核心除外，运作应用程式所需要的系统环境，由下而上打包，达到应用程式跨平台间的无缝接轨运作。</p>
<h2 id="docker理念"><a href="#docker理念" class="headerlink" title="docker理念"></a>docker理念</h2><p>Docker是基于Go语言实现的云开源项目。</p>
<p>Docker的主要目标是“Build，Ship and Run Any App,Anywhere”，也就是通过对应用组件的封装、分发、部署、运行等生命周期的管理，使用户的APP（可以是一个WEB应用或数据库应用等等）及其运行环境能够做到“一次镜像，处处运行”。</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221122150504495.png" alt="image-20221122150504495"></p>
<p>Linux容器技术的出现就解决了这样一个问题，而 Docker 就是在它的基础上发展过来的。将应用打成镜像，通过镜像成为运行在Docker容器上面的实例，而 Docker容器在任何操作系统上都是一致的，这就实现了跨平台、跨服务器。只需要一次配置好环境，换到别的机子上就可以一键部署好，大大简化了操作。</p>
<p>一句话：</p>
<p><strong>解决了运行环境和配置问题的软件容器， 方便做持续集成并有助于整体发布的容器虚拟化技术。</strong></p>
<h2 id="容器与虚拟机比较"><a href="#容器与虚拟机比较" class="headerlink" title="容器与虚拟机比较"></a>容器与虚拟机比较</h2><p><strong>容器发展简史</strong></p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221202091946245.png" alt="image-20221202091946245"></p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221202092001376.png" alt="image-20221202092001376"></p>
<p><strong>传统虚拟机技术</strong></p>
<p>虚拟机（virtual machine）就是带环境安装的一种解决方案。</p>
<p>它可以在一种操作系统里面运行另一种操作系统，比如在Windows10系统里面运行Linux系统CentOS7。应用程序对此毫无感知，因为虚拟机看上去跟真实系统一模一样，而对于底层系统来说，虚拟机就是一个普通文件，不需要了就删掉，对其他部分毫无影响。这类虚拟机完美的运行了另一套系统，能够使应用程序，操作系统和硬件三者之间的逻辑不变。 </p>
<table>
<thead>
<tr>
<th>Win10</th>
<th>VMWare</th>
<th>Centos7</th>
<th>各种cpu、内存网络额配置+各种软件</th>
<th>虚拟机实例</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221202092832933.png" alt="image-20221202092832933"></p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221202092930763.png" alt="image-20221202092930763"></p>
<p>虚拟机的缺点：</p>
<ul>
<li>资源占用多</li>
<li>冗余步骤多 </li>
<li>启动慢</li>
</ul>
<p><strong>容器虚拟化技术</strong></p>
<p>由于前面虚拟机存在某些缺点，Linux发展出了另一种虚拟化技术：</p>
<p>Linux容器(Linux Containers，缩写为 LXC)</p>
<p>Linux容器是与系统其他部分隔离开的一系列进程，从另一个镜像运行，并由该镜像提供支持进程所需的全部文件。容器提供的镜像包含了应用的所有依赖项，因而在从开发到测试再到生产的整个过程中，它都具有可移植性和一致性。</p>
<p><strong>Linux 容器不是模拟一个完整的操作系统而是对进程进行隔离。</strong>有了容器，就可以将软件运行所需的所有资源打包到一个隔离的容器中。容器与虚拟机不同，不需要捆绑一整套操作系统，只需要软件工作所需的库资源和设置。系统因此而变得高效轻量并保证部署在任何环境中的软件都能始终如一地运行。</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221202093203114.png" alt="image-20221202093203114"></p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221202093303220.png" alt="image-20221202093303220"></p>
<p>对比</p>
<p>比较了 Docker 和传统虚拟化方式的不同之处：</p>
<ul>
<li><p>传统虚拟机技术是虚拟出一套硬件后，在其上运行一个完整操作系统，在该系统上再运行所需应用进程；</p>
</li>
<li><p>容器内的应用进程直接运行于宿主的内核，容器内没有自己的内核且也没有进行硬件虚拟。因此容器要比传统虚拟机更为轻便。</p>
</li>
<li><p>每个容器之间互相隔离，每个容器有自己的文件系统 ，容器之间进程不会相互影响，能区分计算资源。</p>
</li>
</ul>
<p>更多虚拟化介绍，可以，看《现代操作系统》的<code>1.7.5</code>小节：虚拟机，及第7章 虚拟化和云</p>
<h2 id="能干嘛"><a href="#能干嘛" class="headerlink" title="能干嘛"></a>能干嘛</h2><ul>
<li><p>技术职级变化</p>
<ul>
<li><code>coder</code></li>
<li><code>programmer</code></li>
<li><code>software engineer</code></li>
<li><code>DevOps engineer</code></li>
</ul>
</li>
<li><p>开发&#x2F;运维（DevOps）新一代开发工程师</p>
<ul>
<li><p>一次构建、随处运行</p>
</li>
<li><p>更快速的应用交付和部署</p>
<p>传统的应用开发完成后，需要提供一堆安装程序和配置说明文档，安装部署后需根据配置文档进行繁杂的配置才能正常运行。Docker化之后只需要交付少量容器镜像文件，在正式生产环境加载镜像并运行即可，应用安装配置在镜像里已经内置好，大大节省部署配置和测试验证时间。</p>
</li>
<li><p>更便捷的升级和扩缩容</p>
<p>随着微服务架构和Docker的发展，大量的应用会通过微服务方式架构，应用的开发构建将变成搭乐高积木一样，每个Docker容器将变成一块“积木”，应用的升级将变得非常容易。当现有的容器不足以支撑业务处理时，可通过镜像运行新的容器进行快速扩容，使应用系统的扩容从原先的天级变成分钟级甚至秒级。</p>
</li>
<li><p>更简单的系统运维</p>
<p>应用容器化运行后，生产环境运行的应用可与开发、测试环境的应用高度一致，容器会将应用程序相关的环境和状态完全封装起来，不会因为底层基础架构和操作系统的不一致性给应用带来影响，产生新的BUG。当出现程序异常时，也可以通过测试环境的相同容器进行快速定位和修复。</p>
</li>
<li><p>更高效的计算资源利用</p>
<p>Docker是内核级虚拟化，其不像传统的虚拟化技术一样需要额外的Hypervisor支持，所以在一台物理机上可以运行很多个容器实例，可大大提升物理服务器的CPU和内存的利用率。</p>
</li>
<li><p>Docker应用场景</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221202095722156.png" alt="image-20221202095722156"></p>
</li>
</ul>
</li>
<li><p>哪些企业在使用</p>
<ul>
<li><p>新浪</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221202095748759.png" alt="image-20221202095748759"></p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221202095805971.png" alt="image-20221202095805971"></p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221202095837041.png" alt="image-20221202095837041"></p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221202095845893.png" alt="image-20221202095845893"></p>
</li>
<li><p>美团</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221202095920387.png" alt="image-20221202095920387"></p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221202095939707.png" alt="image-20221202095939707"></p>
</li>
<li><p>蘑菇街</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221202100019526.png" alt="image-20221202100019526"></p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221202100027578.png" alt="image-20221202100027578"></p>
</li>
</ul>
</li>
</ul>
<h2 id="去哪下"><a href="#去哪下" class="headerlink" title="去哪下"></a>去哪下</h2><ul>
<li>官网<ul>
<li>docker官网：<a target="_blank" rel="noopener" href="http://www.docker.com/">http://www.docker.com</a></li>
</ul>
</li>
<li>仓库<ul>
<li>Docker Hub官网: <a target="_blank" rel="noopener" href="https://hub.docker.com/">https://hub.docker.com/</a></li>
</ul>
</li>
</ul>
<h1 id="Docker安装"><a href="#Docker安装" class="headerlink" title="Docker安装"></a>Docker安装</h1><h2 id="前提说明"><a href="#前提说明" class="headerlink" title="前提说明"></a>前提说明</h2><h3 id="CentOS-Docker-安装"><a href="#CentOS-Docker-安装" class="headerlink" title="CentOS Docker 安装"></a>CentOS Docker 安装</h3><p><strong>前提条件</strong><br>目前，CentOS 仅发行版本中的内核支持 Docker。Docker 运行在CentOS 7 (64-bit)上，要求系统为64位、Linux系统内核版本为 3.8以上，这里选用Centos7.x</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221202102610244.png" alt="image-20221202102610244"></p>
<p><strong>查看自己的内核</strong><br><code>uname</code>命令用于打印当前系统相关信息（内核版本号、硬件架构、主机名称和操作系统类型等）。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /etc/redhat-release</span><br></pre></td></tr></table></figure>

<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221202102745743.png" alt="image-20221202102745743"></p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221202102849433.png" alt="image-20221202102849433"></p>
<h2 id="Docker的基本组成"><a href="#Docker的基本组成" class="headerlink" title="Docker的基本组成"></a>Docker的基本组成</h2><h3 id="镜像-image"><a href="#镜像-image" class="headerlink" title="镜像(image)"></a>镜像(image)</h3><p>Docker 镜像（Image）就是一个<strong>只读</strong>的模板。镜像可以用来创建 Docker 容器，<strong>一个镜像可以创建很多容器</strong>。<br>它也相当于是一个root文件系统。比如官方镜像 centos:7 就包含了完整的一套 centos:7 最小系统的 root 文件系统。<br>相当于容器的“源代码”，docker镜像文件类似于Java的类模板，而docker容器实例类似于java中new出来的实例对象。</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221202103040538.png" alt="image-20221202103040538"></p>
<h3 id="容器-container"><a href="#容器-container" class="headerlink" title="容器(container)"></a>容器(container)</h3><ul>
<li><p>从面向对象角度</p>
<p>Docker 利用容器（Container）独立运行的一个或一组应用，应用程序或服务运行在容器里面，容器就类似于一个虚拟化的运行环境，容器是用镜像创建的运行实例。就像是Java中的类和实例对象一样，镜像是静态的定义，容器是镜像运行时的实体。容器为镜像提供了一个标准的和隔离的运行环境，它可以被启动、开始、停止、删除。每个容器都是相互隔离的、保证安全的平台</p>
</li>
<li><p>从镜像容器角度</p>
<p>可以把容器看做是一个简易版的 Linux 环境（包括root用户权限、进程空间、用户空间和网络空间等）和运行在其中的应用程序。</p>
</li>
<li><p>仓库(repository)</p>
<p>仓库（Repository）是集中存放镜像文件的场所。</p>
<p>类似于Maven仓库，存放各种jar包的地方；<br>github仓库，存放各种git项目的地方；<br>Docker公司提供的官方registry被称为Docker Hub，存放各种镜像模板的地方。</p>
<p>仓库分为公开仓库（Public）和私有仓库（Private）两种形式。<br>最大的公开仓库是 Docker Hub(<a target="_blank" rel="noopener" href="https://hub.docker.com/)%EF%BC%8C">https://hub.docker.com/)，</a><br>存放了数量庞大的镜像供用户下载。国内的公开仓库包括阿里云 、网易云等</p>
</li>
</ul>
<h3 id="小总结"><a href="#小总结" class="headerlink" title="小总结"></a>小总结</h3><p>需要正确的理解仓库&#x2F;镜像&#x2F;容器这几个概念:<br>Docker 本身是一个容器运行载体或称之为管理引擎。我们把应用程序和配置依赖打包好形成一个可交付的运行环境，这个打包好的运行环境就是image镜像文件。只有通过这个镜像文件才能生成Docker容器实例(类似Java中new出来一个对象)。</p>
<p>image文件可以看作是容器的模板。Docker 根据 image 文件生成容器的实例。同一个 image 文件，可以生成多个同时运行的容器实例。</p>
<ul>
<li><p>镜像文件</p>
<p>image 文件生成容器实例，本身也是一个文件，称为镜像文件。</p>
</li>
<li><p>容器实例</p>
<p>一个容器运行一种服务，当我们需要的时候，就可以通过docker客户端创建一个对应的运行实例，也就是我们的容器</p>
</li>
<li><p>仓库</p>
<p>就是放一堆镜像的地方，我们可以把镜像发布到仓库中，需要的时候再从仓库中拉下来就可以了。</p>
</li>
</ul>
<h2 id="Docker平台架构图解-架构版"><a href="#Docker平台架构图解-架构版" class="headerlink" title="Docker平台架构图解(架构版)"></a>Docker平台架构图解(架构版)</h2><p>首次懵逼正常，后续深入，先有大概轮廓，混个眼熟</p>
<p>整体架构及底层通信原理简述</p>
<p>Docker 是一个 C&#x2F;S 模式的架构，后端是一个松耦合架构，众多模块各司其职。 </p>
<p><code>Docker</code>运行的基本流程为：</p>
<p>1.用户是使用<code>Docker Client</code>与<code>Docker Daemon</code>建立通信，并发送请求给后者</p>
<p>2.<code>Docker Daemon</code>作为<code>Docker</code>架构中的主体部分，首先提供<code>Docker Server</code>的使其可以接受<code>Docker Client</code>的请求</p>
<p>3.<code>Docer Engine</code>执行<code>Docker</code>内部的一系列工作，每一项工作都是以一个<code>Job</code>的形式存在</p>
<p>4.<code>Job</code>的运行过程中，当需要容器镜像时，则从<code>Docker Registry</code>中下载镜像，并通过镜像管理驱动<code>Graph Driver</code>将下载镜像以<code>Graph</code>的形式存储</p>
<p>5.当需要为<code>Docker</code>创建网络环境时，通过网络管理驱动<code>Network Driver</code>创建配置<code>Docker</code>容器网络环境</p>
<p>6.当需要限制<code>Docker</code>容器运行资源或执行用户指令等操作时，则通过<code>Exec Driver</code>来完成</p>
<p>7.<code>LibContainer</code>是一项独立容器管理包，<code>Network Driver</code>以及<code>Exec Driver</code>都是通过<code>LibContainer</code>来实现具体对容器的操作</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230222174553134.png" alt="image-20230222174553134"></p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230222174637828.png" alt="image-20230222174637828"></p>
<p>为什么Docker会比VM虚拟机快</p>
<ul>
<li><p>docker有着比虚拟机更少的抽象层</p>
<p>由于docker不需要Hypervisor(虚拟机)实现硬件资源虚拟化,运行在docker容器上的程序直接使用的都是实际物理机的硬件资源。因此在CPU、内存利用率上docker将会在效率上有明显优势。</p>
</li>
<li><p>docker利用的是宿主机的内核,而不需要加载操作系统OS内核</p>
<p>当新建一个容器时,docker不需要和虚拟机一样重新加载一个操作系统内核。进而避免引寻、加载操作系统内核返回等比较费时费资源的过程,当新建一个虚拟机时,虚拟机软件需要加载OS,返回新建过程是分钟级别的。而docker由于直接利用宿主机的操作系统,则省略了返回过程,因此新建一个docker容器只需要几秒钟。</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221202142222182.png" alt="image-20221202142222182"></p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221202142231744.png" alt="image-20221202142231744"></p>
</li>
</ul>
<h2 id="安装步骤"><a href="#安装步骤" class="headerlink" title="安装步骤"></a>安装步骤</h2><p>CentOS7安装Docker</p>
<p>官网安装手册：<a target="_blank" rel="noopener" href="https://docs.docker.com/engine/install/centos/">https://docs.docker.com/engine/install/centos/</a></p>
<p>如果之前安装过</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo yum remove docker \</span><br><span class="line">                  docker-client \</span><br><span class="line">                  docker-client-latest \</span><br><span class="line">                  docker-common \</span><br><span class="line">                  docker-latest \</span><br><span class="line">                  docker-latest-logrotate \</span><br><span class="line">                  docker-logrotate \</span><br><span class="line">                  docker-engine</span><br></pre></td></tr></table></figure>

<p>It’s OK if <code>yum</code> reports that none of these packages are installed.</p>
<p>The contents of <code>/var/lib/docker/</code>, including images, containers, volumes, and networks, are preserved. The Docker Engine package is now called <code>docker-ce</code>.</p>
<p><code>Install using the repository</code></p>
<ul>
<li><p>yum安装gcc相关</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install -y gcc</span><br><span class="line"></span><br><span class="line">yum install -y gcc-c++</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装需要的软件包，<code>Set up the repository</code></p>
<p>Install the <code>yum-utils</code> package (which provides the <code>yum-config-manager</code> utility) and set up the repository.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y yum-utils</span><br><span class="line"></span><br><span class="line">sudo yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://download.docker.com/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure>

<p>官网上的第二条命令是可选的，注意这个仓库在国外，后面下载会很慢，会报各种网络错误。使用阿里云的库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="http://mirrors.aliyun.com/docker-ce/linux/centos/">docker-ce-linux-centos安装包下载_开源镜像站-阿里云 (aliyun.com)</a></p>
</li>
<li><p>更新<code>yum</code>软件包索引（重建yum安装的索引）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// centos 7</span><br><span class="line">yum makecache fast</span><br><span class="line"></span><br><span class="line">// centos 8</span><br><span class="line">yum makecache</span><br></pre></td></tr></table></figure>

<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221202111016744.png" alt="image-20221202111016744"></p>
</li>
<li><p>正式安装<code>Docker Engine</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install docker-ce docker-ce-cli containerd.io docker-compose-plugin</span><br></pre></td></tr></table></figure>

<p>If prompted to accept the GPG key, verify that the fingerprint matches <code>060A 61C5 1B55 8A7F 742B 77AA C52F EB6B 621E 9F35</code>, and if so, accept it.</p>
<p>This command installs Docker, but it doesn’t start Docker. It also creates a <code>docker</code> group, however, it doesn’t add any users to the group by default.</p>
</li>
<li><p>启动<code>dokcer</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start docker</span><br><span class="line"></span><br><span class="line">ps -ef | grep docker</span><br></pre></td></tr></table></figure>

<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221202111611481.png" alt="image-20221202111611481"></p>
<p>查看<code>docker</code>的客户端和服务端版本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker version</span><br></pre></td></tr></table></figure>

<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221202111747663.png" alt="image-20221202111747663"></p>
</li>
</ul>
<p>卸载<code>Docker Engine</code></p>
<p>停止<code>doker</code>服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop docker</span><br></pre></td></tr></table></figure>

<p>卸载</p>
<p>1.Uninstall the Docker Engine, CLI, Containerd, and Docker Compose packages:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum remove docker-ce docker-ce-cli containerd.io docker-compose-plugin</span><br></pre></td></tr></table></figure>

<p>2.Images, containers, volumes, or customized configuration files on your host are not automatically removed. To delete all images, containers, and volumes:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">rm</span> -rf /var/lib/docker</span><br><span class="line">sudo <span class="built_in">rm</span> -rf /var/lib/containerd</span><br></pre></td></tr></table></figure>

<p>You must delete any edited configuration files manually.</p>
<p>运行<code>helo world</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run hello-world</span><br></pre></td></tr></table></figure>



<p><img src="/image-20221202112346004.png" alt="image-20221202112346004"></p>
<p>To generate this message, Docker took the following steps:</p>
<ol>
<li>The Docker client contacted the Docker daemon.</li>
<li>The Docker daemon pulled the “hello-world” image from the Docker Hub.(amd64)</li>
<li>The Docker daemon created a new container from that image which runs the executable that produces the output you are currently reading.</li>
<li>The Docker daemon streamed that output to the Docker client, which sent it to your terminal.</li>
</ol>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221202142012966.png" alt="image-20221202142012966"></p>
<h2 id="阿里云镜像加速"><a href="#阿里云镜像加速" class="headerlink" title="阿里云镜像加速"></a>阿里云镜像加速</h2><p><a target="_blank" rel="noopener" href="https://promotion.aliyun.com/ntms/act/kubernetes.html">https://promotion.aliyun.com/ntms/act/kubernetes.html</a></p>
<ul>
<li><p>注册一个属于自己的阿里云账户(可复用淘宝账号)</p>
</li>
<li><p>获得加速器地址连接</p>
<ul>
<li>登陆阿里云开发者平台</li>
<li>点击控制台</li>
<li>选择容器镜像服务</li>
<li>镜像工具–镜像加速器</li>
</ul>
</li>
<li><p>执行脚本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">mkdir</span> -p /etc/docker</span><br><span class="line"></span><br><span class="line">sudo <span class="built_in">tee</span> /etc/docker/daemon.json &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://ydav5e1h.mirror.aliyuncs.com&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line"></span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="Docker常用命令"><a href="#Docker常用命令" class="headerlink" title="Docker常用命令"></a>Docker常用命令</h1><h2 id="帮助启动类命令"><a href="#帮助启动类命令" class="headerlink" title="帮助启动类命令"></a>帮助启动类命令</h2><ul>
<li><p>启动docker： <code>systemctl start docker</code></p>
</li>
<li><p>停止docker： <code>systemctl stop docker</code></p>
</li>
<li><p>重启docker：<code>systemctl restart docker</code></p>
</li>
<li><p>查看docker状态： <code>systemctl status docker</code></p>
</li>
<li><p>开机启动： <code>systemctl enable docker</code></p>
</li>
<li><p>查看docker概要信息： <code>docker info</code></p>
</li>
<li><p>查看docker总体帮助文档： <code>docker --help</code></p>
</li>
<li><p>查看docker命令帮助文档：<code> docker 具体命令 --help</code></p>
</li>
</ul>
<h2 id="镜像命令"><a href="#镜像命令" class="headerlink" title="镜像命令"></a>镜像命令</h2><h3 id="docker-images"><a href="#docker-images" class="headerlink" title="docker images"></a><code>docker images</code></h3><p>列出本地主机上的镜像</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221122151039507.png" alt="image-20221122151039507"></p>
<p>各个选项说明：</p>
<ul>
<li><p><code>REPOSITORY</code>：表示镜像的仓库源</p>
</li>
<li><p><code>TAG</code>：镜像的标签版本号</p>
<ul>
<li><p>一仓库源可以有多个 TAG版本，代表这个仓库源的不同个版本，我们使用 &#96;&#96;REPOSITORY:TAG&#96; 来定义不同的镜像。</p>
</li>
<li><p>如果你不指定一个镜像的版本标签，例如你只使用 <code>ubuntu</code>，docker 将默认使用 <code>ubuntu:latest</code> 镜像</p>
</li>
</ul>
</li>
<li><p><code>IMAGE ID</code>：镜像ID</p>
</li>
<li><p><code>CREATED</code>：镜像创建时间</p>
</li>
<li><p><code>SIZE</code>：镜像大小</p>
</li>
</ul>
<p><code>docker images [OPTIONS]</code></p>
<ul>
<li><code>OPTIONS</code>说明：<ul>
<li><code>-a</code> :列出本地所有的镜像（含历史映像层）<ul>
<li>镜像是有层层堆叠的，后面讲容器卷的时候再详细讲</li>
</ul>
</li>
<li><code>-q</code> :只显示镜像ID。</li>
</ul>
</li>
</ul>
<h3 id="docker-search"><a href="#docker-search" class="headerlink" title="docker search "></a><code>docker search </code></h3><p>在<code>https://hub.docker.com</code>网站上，搜索某个XXX镜像名字</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221122152334757.png" alt="image-20221122152334757"></p>
<p>各个选项说明：</p>
<ul>
<li><code>NAME</code>：镜像名称</li>
<li><code>DESCRIPTION</code>：描述</li>
<li><code>STARTS</code>：点赞数</li>
<li><code>OFFICIAL</code>：是否为官方认证</li>
<li><code>AUTOMATED</code>：是否为自动构建编译的</li>
</ul>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221122152446782.png" alt="image-20221122152446782"></p>
<p>一般选官方认证的</p>
<p><code>docker search [OPTIONS] 镜像名称</code></p>
<ul>
<li><p><code>OPTIONS</code>说明：</p>
<ul>
<li><p><code>--limit</code> : 只列出N个镜像，默认25个：<code>docker search --limit 5 redis</code></p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221122152713323.png" alt="image-20221122152713323"></p>
</li>
</ul>
</li>
</ul>
<h3 id="docker-pull"><a href="#docker-pull" class="headerlink" title="docker pull"></a><code>docker pull</code></h3><p>拉取（下载）某个XXX镜像</p>
<ul>
<li><p><code>docker pull 镜像名字[:TAG]</code></p>
</li>
<li><p><code>docker pull 镜像名字</code></p>
<ul>
<li>没有<code>TAG</code>就是最新版</li>
<li>等价于<code>docker pull 镜像名字:latest</code></li>
</ul>
</li>
<li><p>建议指定版本号，不然今年下一次，隔了段时间人家镜像更新了，再<code>docker images</code>查看时，显示的版本是<code>latest</code>，但实际上应该不是最新了</p>
</li>
</ul>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221122153236173.png" alt="image-20221122153236173"></p>
<h3 id="docker-system-df"><a href="#docker-system-df" class="headerlink" title="docker system df"></a><code>docker system df</code></h3><p>查看镜像&#x2F;容器&#x2F;数据卷所占的空间</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221122153606402.png" alt="image-20221122153606402"></p>
<h3 id="docker-rmi"><a href="#docker-rmi" class="headerlink" title="docker rmi"></a><code>docker rmi</code></h3><p><code>docker rmi </code>，删除镜像</p>
<ul>
<li><p>删除单个</p>
<ul>
<li><p><code>docker rmi 某个XXX镜像名字</code></p>
</li>
<li><p><code>docker rmi -f 某个XXX镜像名字ID</code>，强制删除</p>
</li>
</ul>
</li>
<li><p>删除多个</p>
<ul>
<li><code>docker rmi -f 镜像名1:TAG 镜像名2:TAG</code></li>
</ul>
</li>
<li><p>删除全部</p>
<ul>
<li><code>docker rmi -f $(docker images -qa)</code></li>
</ul>
</li>
</ul>
<p>面试题：谈谈docker虚悬镜像是什么？</p>
<ul>
<li>是什么<ul>
<li>仓库名、标签都是<code>&lt;none&gt;</code>的镜像，俗称虚悬镜像<code>dangling image</code></li>
<li>建议删除，有时候<code>docker</code>在构建时会出问题</li>
</ul>
</li>
</ul>
<h2 id="容器命令"><a href="#容器命令" class="headerlink" title="容器命令"></a>容器命令</h2><blockquote>
<p>每一个容器实例，都是一个简易版的Linux环境 + 运行在其中的应用程序</p>
<p>其中的Linux环境，包括root用户权限、进程空间、用户空间和网络空间</p>
</blockquote>
<p>有镜像才能创建容器， 这是根本前提(下载一个CentOS或者ubuntu镜像演示)</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221202142558870.png" alt="image-20221202142558870"></p>
<h3 id="docker-run"><a href="#docker-run" class="headerlink" title="docker run"></a><code>docker run</code></h3><p><code>docker run [OPTIONS] IMAGE [COMMAND] [ARG...]</code></p>
<p><code>OPTIONS</code>说明（常用）：有些是一个减号，有些是两个减号</p>
<ul>
<li><p>–name&#x3D;”容器新名字”，为容器指定一个名称；</p>
</li>
<li><p>-d: 后台运行容器并返回容器ID，也即启动守护式容器(后台运行)；</p>
</li>
<li><p>-i：以交互模式运行容器，通常与 -t 同时使用；</p>
</li>
<li><p>-t：为容器重新分配一个伪输入终端，通常与 -i 同时使用；也即启动交互式容器(前台有伪终端，等待交互)；</p>
</li>
<li><p>-P: 随机端口映射，大写P</p>
</li>
<li><p>-p: 指定端口映射，小写p</p>
</li>
<li><p>–rm：容器退出时就能够自动清理容器内部的文件系统。</p>
<p>运行带有<code>--rm</code>标志的容器对于那些只用于很短时间而仅用于完成某事的容器是有好处的，例如，在容器内编译应用程序，或者只是测试它可以工作的事物，然后您就会知道它是一个短暂的容器，告诉您的Docker守护程序，一旦运行完毕，请清除与其相关的所有内容并节省磁盘空间。</p>
</li>
</ul>
<p>使用镜像centos:latest以交互模式启动一个容器,在容器内执行&#x2F;bin&#x2F;bash命令。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker pull centos</span><br><span class="line"></span><br><span class="line">docker run -it centos /bin/bash </span><br></pre></td></tr></table></figure>



<h3 id="docker-ps"><a href="#docker-ps" class="headerlink" title="docker ps"></a><code>docker ps</code></h3><p><code>docker ps [OPTIONS]</code></p>
<p>OPTIONS说明（常用）：</p>
<ul>
<li>-a :列出当前所有正在运行的容器+历史上运行过的</li>
<li>-l :显示最近创建的容器。</li>
<li>-n：显示最近n个创建的容器。</li>
<li>-q :静默模式，只显示容器编号。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps -a</span><br></pre></td></tr></table></figure>

<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221202143636295.png" alt="image-20221202143636295"></p>
<h3 id="退出容器"><a href="#退出容器" class="headerlink" title="退出容器"></a>退出容器</h3><ul>
<li>run进去容器，exit退出，容器停止</li>
<li>run进去容器，<code>ctrl+p+q</code>退出，容器不停止</li>
</ul>
<h3 id="启停容器"><a href="#启停容器" class="headerlink" title="启停容器"></a>启停容器</h3><ul>
<li><p>启动已停止运行的容器</p>
<ul>
<li>docker start 容器ID或者容器名</li>
</ul>
</li>
<li><p>重启容器</p>
<ul>
<li>docker restart 容器ID或者容器名</li>
</ul>
</li>
<li><p>停止容器</p>
<ul>
<li>docker stop 容器ID或者容器名</li>
</ul>
</li>
<li><p>强制停止容器</p>
<ul>
<li>docker kill 容器ID或容器名</li>
</ul>
</li>
<li><p>删除已停止的容器</p>
<ul>
<li>docker rm 容器ID</li>
</ul>
</li>
<li><p>一次性删除多个容器实例</p>
<ul>
<li><p><code>docker rm -f $(docker ps -aq)</code></p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221202160308745.png" alt="image-20221202160308745"></p>
</li>
<li><p><code>docker ps -a -q | xargs docker rm</code></p>
</li>
</ul>
</li>
</ul>
<p><strong>重要</strong></p>
<p>有镜像才能创建容器，这是根本前提(下载一个Redis6.0.8镜像演示)</p>
<p>启动守护式容器(后台服务器)</p>
<p>在大部分的场景下，我们希望 docker 的服务是在后台运行的， 我们可以过 -d 指定容器的后台运行模式。</p>
<p><code>docker run -d 容器名</code></p>
<p>使用镜像centos:latest以后台模式启动一个容器</p>
<p><code>docker run -d centos</code></p>
<p> 问题：然后docker ps -a 进行查看, 会发现容器已经退出</p>
<p>很重要的要说明的一点: Docker容器后台运行,就必须有一个前台进程.</p>
<p>容器运行的命令如果不是那些一直挂起的命令（比如运行top，tail），就是会自动退出的。</p>
<p>这个是docker的机制问题,比如你的web容器,我们以nginx为例，正常情况下,我们配置启动服务只需要启动响应的service即可。例如<code>service nginx start</code>。但是，这样做，nginx为后台进程模式运行，就导致docker前台没有运行的应用，这样的容器后台启动后,会立即自杀因为他觉得他没事可做了.</p>
<p>所以，最佳的解决方案是,将你要运行的程序以前台进程的形式运行，常见就是命令行模式，表示我还有交互操作</p>
<p>redis 前后台启动演示</p>
<ul>
<li><p>前台交互式启动</p>
<ul>
<li><p><code>docker run -it redis:6.0.8</code></p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221202150428060.png" alt="image-20221202150428060"></p>
</li>
</ul>
</li>
<li><p>后台守护式启动</p>
<ul>
<li><p><code>docker run -d redis:6.0.8</code></p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221202150455979.png" alt="image-20221202150455979"></p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221202150525275.png" alt="image-20221202150525275"></p>
</li>
</ul>
</li>
</ul>
<h3 id="查看容器"><a href="#查看容器" class="headerlink" title="查看容器"></a>查看容器</h3><blockquote>
<p>现代开发机制</p>
<ul>
<li>编码开发微服务</li>
<li>上线部署容器化</li>
<li>时时刻刻要监控</li>
</ul>
</blockquote>
<p>查看容器日志</p>
<ul>
<li><p><code>docker logs 容器ID</code></p>
<p><img src="/image-20221202150929709.png" alt="image-20221202150929709"></p>
</li>
</ul>
<p>查看容器内运行的进程</p>
<ul>
<li><p><code>docker top 容器ID</code></p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221202151401425.png" alt="image-20221202151401425"></p>
</li>
</ul>
<p>查看容器内部细节</p>
<ul>
<li><p><code>docker inspect 容器ID</code></p>
<p>高级篇会经常用到</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect dd80d0e5ddb5</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;Id&quot;</span>: <span class="string">&quot;dd80d0e5ddb53e17f3dd17d31f757be4c0857a4e02f4916403e6d53c28132e15&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Created&quot;</span>: <span class="string">&quot;2022-12-02T07:04:41.211659046Z&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Path&quot;</span>: <span class="string">&quot;docker-entrypoint.sh&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Args&quot;</span>: [</span><br><span class="line">            <span class="string">&quot;redis-server&quot;</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;State&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Status&quot;</span>: <span class="string">&quot;running&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Running&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="string">&quot;Paused&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;Restarting&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;OOMKilled&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;Dead&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;Pid&quot;</span>: 3370746,</span><br><span class="line">            <span class="string">&quot;ExitCode&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;Error&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;StartedAt&quot;</span>: <span class="string">&quot;2022-12-02T07:04:41.66243713Z&quot;</span>,</span><br><span class="line">            <span class="string">&quot;FinishedAt&quot;</span>: <span class="string">&quot;0001-01-01T00:00:00Z&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;Image&quot;</span>: <span class="string">&quot;sha256:7614ae9453d1d87e740a2056257a6de7135c84037c367e1fffa92ae922784631&quot;</span>,</span><br><span class="line">        <span class="string">&quot;ResolvConfPath&quot;</span>: <span class="string">&quot;/var/lib/docker/containers/dd80d0e5ddb53e17f3dd17d31f757be4c0857a4e02f4916403e6d53c28132e15/resolv.conf&quot;</span>,</span><br><span class="line">        <span class="string">&quot;HostnamePath&quot;</span>: <span class="string">&quot;/var/lib/docker/containers/dd80d0e5ddb53e17f3dd17d31f757be4c0857a4e02f4916403e6d53c28132e15/hostname&quot;</span>,</span><br><span class="line">        <span class="string">&quot;HostsPath&quot;</span>: <span class="string">&quot;/var/lib/docker/containers/dd80d0e5ddb53e17f3dd17d31f757be4c0857a4e02f4916403e6d53c28132e15/hosts&quot;</span>,</span><br><span class="line">        <span class="string">&quot;LogPath&quot;</span>: <span class="string">&quot;/var/lib/docker/containers/dd80d0e5ddb53e17f3dd17d31f757be4c0857a4e02f4916403e6d53c28132e15/dd80d0e5ddb53e17f3dd17d31f757be4c0857a4e02f4916403e6d53c28132e15-json.log&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;/hardcore_yonath&quot;</span>,</span><br><span class="line">        <span class="string">&quot;RestartCount&quot;</span>: 0,</span><br><span class="line">        <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;overlay2&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Platform&quot;</span>: <span class="string">&quot;linux&quot;</span>,</span><br><span class="line">        <span class="string">&quot;MountLabel&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;ProcessLabel&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;AppArmorProfile&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;ExecIDs&quot;</span>: null,</span><br><span class="line">        <span class="string">&quot;HostConfig&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Binds&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;ContainerIDFile&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;LogConfig&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;Type&quot;</span>: <span class="string">&quot;json-file&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Config&quot;</span>: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;NetworkMode&quot;</span>: <span class="string">&quot;default&quot;</span>,</span><br><span class="line">            <span class="string">&quot;PortBindings&quot;</span>: &#123;&#125;,</span><br><span class="line">            <span class="string">&quot;RestartPolicy&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;no&quot;</span>,</span><br><span class="line">                <span class="string">&quot;MaximumRetryCount&quot;</span>: 0</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;AutoRemove&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;VolumeDriver&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;VolumesFrom&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;CapAdd&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;CapDrop&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;CgroupnsMode&quot;</span>: <span class="string">&quot;host&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Dns&quot;</span>: [],</span><br><span class="line">            <span class="string">&quot;DnsOptions&quot;</span>: [],</span><br><span class="line">            <span class="string">&quot;DnsSearch&quot;</span>: [],</span><br><span class="line">            <span class="string">&quot;ExtraHosts&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;GroupAdd&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;IpcMode&quot;</span>: <span class="string">&quot;private&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Cgroup&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Links&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;OomScoreAdj&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;PidMode&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Privileged&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;PublishAllPorts&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;ReadonlyRootfs&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;SecurityOpt&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;UTSMode&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;UsernsMode&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;ShmSize&quot;</span>: 67108864,</span><br><span class="line">            <span class="string">&quot;Runtime&quot;</span>: <span class="string">&quot;runc&quot;</span>,</span><br><span class="line">            <span class="string">&quot;ConsoleSize&quot;</span>: [</span><br><span class="line">                0,</span><br><span class="line">                0</span><br><span class="line">            ],</span><br><span class="line">            <span class="string">&quot;Isolation&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;CpuShares&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;Memory&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;NanoCpus&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;CgroupParent&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;BlkioWeight&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;BlkioWeightDevice&quot;</span>: [],</span><br><span class="line">            <span class="string">&quot;BlkioDeviceReadBps&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;BlkioDeviceWriteBps&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;BlkioDeviceReadIOps&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;BlkioDeviceWriteIOps&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;CpuPeriod&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;CpuQuota&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;CpuRealtimePeriod&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;CpuRealtimeRuntime&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;CpusetCpus&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;CpusetMems&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Devices&quot;</span>: [],</span><br><span class="line">            <span class="string">&quot;DeviceCgroupRules&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;DeviceRequests&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;KernelMemory&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;KernelMemoryTCP&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;MemoryReservation&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;MemorySwap&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;MemorySwappiness&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;OomKillDisable&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;PidsLimit&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;Ulimits&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;CpuCount&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;CpuPercent&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;IOMaximumIOps&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;IOMaximumBandwidth&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;MaskedPaths&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;/proc/asound&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/acpi&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/kcore&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/keys&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/latency_stats&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/timer_list&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/timer_stats&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/sched_debug&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/scsi&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/sys/firmware&quot;</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">&quot;ReadonlyPaths&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;/proc/bus&quot;</span>,docker run -d \</span><br><span class="line">	-p 15432:15432 \</span><br><span class="line">	-v /data/data01/hh/desktop/software/postgresql/data:/data/postgres/pgdata \</span><br><span class="line">	--name pgsql \</span><br><span class="line">        -e POSTGRES_PASSWORD=123456 \</span><br><span class="line">	postgres</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                <span class="string">&quot;/proc/fs&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/irq&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/sys&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/sysrq-trigger&quot;</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;GraphDriver&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Data&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;LowerDir&quot;</span>: <span class="string">&quot;/var/lib/docker/overlay2/f0dd8d56846af6f1e9e903e1bb2ad527f78bf9966b52c1b6ba77fbabecc4899e-init/diff:/var/lib/docker/overlay2/c70822f2ac680e33dcdocker run -d \</span></span><br><span class="line"><span class="string">	-p 15432:15432 \</span></span><br><span class="line"><span class="string">	-v /data/data01/hh/desktop/software/postgresql/data:/data/postgres/pgdata \</span></span><br><span class="line"><span class="string">	--name pgsql \</span></span><br><span class="line"><span class="string">        -e POSTGRES_PASSWORD=123456 \</span></span><br><span class="line"><span class="string">	postgres</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">4081970b5df5a9f355d29d0d510547569c0b27c45418f9/diff:/var/lib/docker/overlay2/59ed6759fd2016b86a531e3f903d270242c064f7dce1a07abcef6e8132ebb2f7/diff:/var/lib/docker/overlay2/c2deb9acfb98c8e4fe4f658d6449aa9dfa13af154c915364f8d4a550b6a6f2fe/diff:/var/lib/docker/overlay2/fbb54e593e420265a153f51e39882bc066092c63342cbebd1f3ef22ea2c59e8f/diff:/var/lib/docker/overlay2/9860676cd7d185d3ea3472a7b1d5d03776659149cb5725875bc4a98651a75e5c/diff:/var/lib/docker/overlay2/002472f7da6df42c266b40d5bf3b36280b8c35c0e39c40d63618b5a48f3e632c/diff&quot;</span>,</span><br><span class="line">                <span class="string">&quot;MergedDir&quot;</span>: <span class="string">&quot;/var/lib/docker/overlay2/f0dd8d56846af6f1e9e903e1bb2ad527f78bf9966b52c1b6ba77fbabecc4899e/merged&quot;</span>,</span><br><span class="line">                <span class="string">&quot;UpperDir&quot;</span>: <span class="string">&quot;/var/lib/docker/overlay2/f0dd8d56846af6f1e9e903e1bb2ad527f78bf9966b52c1b6ba77fbabecc4899e/diff&quot;</span>,</span><br><span class="line">                <span class="string">&quot;WorkDir&quot;</span>: <span class="string">&quot;/var/lib/docker/overlay2/f0dd8d56846af6f1e9e903e1bb2ad527f78bf9966b52c1b6ba77fbabecc4899e/work&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;overlay2&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;Mounts&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;Type&quot;</span>: <span class="string">&quot;volume&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;2f5dc33229b460514ddc4e0fd1c6639c35e7b27726239ec68677a73b1fd3c128&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Source&quot;</span>: <span class="string">&quot;/var/lib/docker/volumes/2f5dc33229b460514ddc4e0fd1c6639c35e7b27726239ec68677a73b1fd3c128/_data&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Destination&quot;</span>: <span class="string">&quot;/data&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;local&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Mode&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">                <span class="string">&quot;RW&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="string">&quot;Propagation&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;Config&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Hostname&quot;</span>: <span class="string">&quot;dd80d0e5ddb5&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Domainname&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;User&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;AttachStdin&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;AttachStdout&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;AttachStderr&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;ExposedPorts&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;6379/tcp&quot;</span>: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;Tty&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;OpenStdin&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;StdinOnce&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;Env&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span>,</span><br><span class="line">                <span class="string">&quot;GOSU_VERSION=1.12&quot;</span>,</span><br><span class="line">                <span class="string">&quot;REDIS_VERSION=6.2.6&quot;</span>,</span><br><span class="line">                <span class="string">&quot;REDIS_DOWNLOAD_URL=http://download.redis.io/releases/redis-6.2.6.tar.gz&quot;</span>,</span><br><span class="line">                <span class="string">&quot;REDIS_DOWNLOAD_SHA=5b2b8b7a50111ef395bf1c1d5be11e6e167ac018125055daa8b5c2317ae131ab&quot;</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">&quot;Cmd&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;redis-server&quot;</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">&quot;Image&quot;</span>: <span class="string">&quot;redis&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Volumes&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;/data&quot;</span>: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;WorkingDir&quot;</span>: <span class="string">&quot;/data&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Entrypoint&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;docker-entrypoint.sh&quot;</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">&quot;OnBuild&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;Labels&quot;</span>: &#123;&#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;NetworkSettings&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Bridge&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;SandboxID&quot;</span>: <span class="string">&quot;540012be4f1e21b45c9de1d84a9dfa19bf4ab68ed081cec5f63a77a44655193e&quot;</span>,</span><br><span class="line">            <span class="string">&quot;HairpinMode&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;LinkLocalIPv6Address&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;LinkLocalIPv6PrefixLen&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;Ports&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;6379/tcp&quot;</span>: null</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;SandboxKey&quot;</span>: <span class="string">&quot;/var/run/docker/netns/540012be4f1e&quot;</span>,</span><br><span class="line">            <span class="string">&quot;SecondaryIPAddresses&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;SecondaryIPv6Addresses&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;EndpointID&quot;</span>: <span class="string">&quot;36b386081d51afe1b4600c10f8e7278d6f5f97f2e3347270da975d049f73c1c5&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Gateway&quot;</span>: <span class="string">&quot;172.17.0.1&quot;</span>,</span><br><span class="line">            <span class="string">&quot;GlobalIPv6Address&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;GlobalIPv6PrefixLen&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;IPAddress&quot;</span>: <span class="string">&quot;172.17.0.2&quot;</span>,</span><br><span class="line">            <span class="string">&quot;IPPrefixLen&quot;</span>: 16,</span><br><span class="line">            <span class="string">&quot;IPv6Gateway&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;MacAddress&quot;</span>: <span class="string">&quot;02:42:ac:11:00:02&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Networks&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;bridge&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;IPAMConfig&quot;</span>: null,</span><br><span class="line">                    <span class="string">&quot;Links&quot;</span>: null,</span><br><span class="line">                    <span class="string">&quot;Aliases&quot;</span>: null,</span><br><span class="line">                    <span class="string">&quot;NetworkID&quot;</span>: <span class="string">&quot;206a95977e775861ab70848d41370db1feb303bdfed0337ad0403c5835691668&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;EndpointID&quot;</span>: <span class="string">&quot;36b386081d51afe1b4600c10f8e7278d6f5f97f2e3347270da975d049f73c1c5&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;Gateway&quot;</span>: <span class="string">&quot;172.17.0.1&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;IPAddress&quot;</span>: <span class="string">&quot;172.17.0.2&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;IPPrefixLen&quot;</span>: 16,</span><br><span class="line">                    <span class="string">&quot;IPv6Gateway&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;GlobalIPv6Address&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;GlobalIPv6PrefixLen&quot;</span>: 0,</span><br><span class="line">                    <span class="string">&quot;MacAddress&quot;</span>: <span class="string">&quot;02:42:ac:11:00:02&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;DriverOpts&quot;</span>: null</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="进入容器"><a href="#进入容器" class="headerlink" title="进入容器"></a>进入容器</h3><p>进入正在运行的容器并以命令行交互</p>
<p>前提：容器是在运行着的，可以以后启动的形式，创建容器，或者重新启动容器</p>
<ul>
<li><p><code>docker exec -it 容器ID bashShell</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it centos /bin/bash</span><br><span class="line"></span><br><span class="line">docker <span class="built_in">exec</span> --<span class="built_in">help</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exit</span> // 退出</span><br></pre></td></tr></table></figure></li>
</ul>
<p>重新进入</p>
<ul>
<li><p><code>docker attach 容器ID</code></p>
</li>
<li><p>不推荐使用</p>
</li>
</ul>
<p>上述两个区别</p>
<ul>
<li>attach 直接进入容器启动命令的终端，不会启动新的进程，用exit退出，<strong>会导致</strong>容器的<strong>停止</strong>。</li>
<li>exec 是在容器中打开新的终端，并且可以启动新的进程 用exit退出，<strong>不会导致</strong>容器的<strong>停止</strong>。</li>
</ul>
<p>用之前的redis容器实例进入试试</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-4-12-centos ~]<span class="comment"># docker start dd80d0e5ddb5 </span></span><br><span class="line">dd80d0e5ddb5</span><br><span class="line">[root@VM-4-12-centos ~]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS         PORTS      NAMES</span><br><span class="line">dd80d0e5ddb5   redis     <span class="string">&quot;docker-entrypoint.s…&quot;</span>   26 minutes ago   Up 2 seconds   6379/tcp   hardcore_yonath</span><br><span class="line">[root@VM-4-12-centos ~]<span class="comment"># docker exec -it dd80d0e5ddb5 /bin/bash</span></span><br><span class="line">root@dd80d0e5ddb5:/data<span class="comment"># redis-cli -p 6379</span></span><br><span class="line">127.0.0.1:6379&gt; ping</span><br><span class="line">PONG</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k1 v1</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get k1</span><br><span class="line"><span class="string">&quot;v1&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; </span><br></pre></td></tr></table></figure>

<p>云原生和容器化下的入职新流程：</p>
<ul>
<li>先装个<code>docker</code></li>
<li>给个项目需要的所有镜像列表，拉一下，跑通</li>
</ul>
<h3 id="从容器内拷贝文件到主机"><a href="#从容器内拷贝文件到主机" class="headerlink" title="从容器内拷贝文件到主机"></a>从容器内拷贝文件到主机</h3><p><code>docker cp  容器ID:容器内路径 目的主机路径</code></p>
<p>在宿主机上操作</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">cp</span> 96d12932d737:/root/a.txt /home</span><br></pre></td></tr></table></figure>

<h3 id="导入-x2F-导出容器"><a href="#导入-x2F-导出容器" class="headerlink" title="导入&#x2F;导出容器"></a>导入&#x2F;导出容器</h3><ul>
<li><p><code>export</code> </p>
<ul>
<li><p>导出容器的内容留作为一个tar归档文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">export</span> dd80d0e5ddb5 &gt; docker_redis_export.tar</span><br></pre></td></tr></table></figure>

<p>导出的目录为当前目录</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221202154741037.png" alt="image-20221202154741037"></p>
</li>
</ul>
</li>
<li><p><code>import</code> </p>
<ul>
<li><p>从tar包中的内容创建一个新的文件系统再导入为<strong>镜像</strong></p>
</li>
<li><p><code>cat 文件名.tar | docker import - 镜像用户/镜像名:镜像版本号</code></p>
</li>
<li><p>测试前，可以先把redis的容器停止再删掉</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> docker_redis_export.tar | docker import - sai/my-redis:1.0.0</span><br></pre></td></tr></table></figure>

<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221202155026813.png" alt="image-20221202155026813"></p>
</li>
<li><p>再以这个镜像，恢复成容器实例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run -it 5c50e17b0f8e /bin/bash</span><br><span class="line"></span><br><span class="line">docker ps -a</span><br></pre></td></tr></table></figure>

<p>注意：这里的镜像名并不是自定义的镜像名，而是用的镜像ID</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221202155558752.png" alt="image-20221202155558752"></p>
</li>
</ul>
</li>
</ul>
<h2 id="小总结-1"><a href="#小总结-1" class="headerlink" title="小总结"></a>小总结</h2><p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221202155702051.png" alt="image-20221202155702051"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">attach    Attach to a running container                 <span class="comment"># 当前 shell 下 attach 连接指定运行镜像</span></span><br><span class="line">build     Build an image from a Dockerfile              <span class="comment"># 通过 Dockerfile 定制镜像</span></span><br><span class="line">commit    Create a new image from a container changes   <span class="comment"># 提交当前容器为新的镜像</span></span><br><span class="line"><span class="built_in">cp</span>        Copy files/folders from the containers filesystem to the host path   <span class="comment">#从容器中拷贝指定文件或者目录到宿主机中</span></span><br><span class="line">create    Create a new container                        <span class="comment"># 创建一个新的容器，同 run，但不启动容器</span></span><br><span class="line">diff      Inspect changes on a container<span class="string">&#x27;s filesystem   # 查看 docker 容器变化</span></span><br><span class="line"><span class="string">events    Get real time events from the server          # 从 docker 服务获取容器实时事件</span></span><br><span class="line"><span class="string">exec      Run a command in an existing container        # 在已存在的容器上运行命令</span></span><br><span class="line"><span class="string">export    Stream the contents of a container as a tar archive   # 导出容器的内容流作为一个 tar 归档文件[对应 import ]</span></span><br><span class="line"><span class="string">history   Show the history of an image                  # 展示一个镜像形成历史</span></span><br><span class="line"><span class="string">images    List images                                   # 列出系统当前镜像</span></span><br><span class="line"><span class="string">import    Create a new filesystem image from the contents of a tarball # 从tar包中的内容创建一个新的文件系统映像[对应export]</span></span><br><span class="line"><span class="string">info      Display system-wide information               # 显示系统相关信息</span></span><br><span class="line"><span class="string">inspect   Return low-level information on a container   # 查看容器详细信息</span></span><br><span class="line"><span class="string">kill      Kill a running container                      # kill 指定 docker 容器</span></span><br><span class="line"><span class="string">load      Load an image from a tar archive              # 从一个 tar 包中加载一个镜像[对应 save]</span></span><br><span class="line"><span class="string">login     Register or Login to the docker registry server    # 注册或者登陆一个 docker 源服务器</span></span><br><span class="line"><span class="string">logout    Log out from a Docker registry server          # 从当前 Docker registry 退出</span></span><br><span class="line"><span class="string">logs      Fetch the logs of a container                 # 输出当前容器日志信息</span></span><br><span class="line"><span class="string">port      Lookup the public-facing port which is NAT-ed to PRIVATE_PORT    # 查看映射端口对应的容器内部源端口</span></span><br><span class="line"><span class="string">pause     Pause all processes within a container        # 暂停容器</span></span><br><span class="line"><span class="string">ps        List containers                               # 列出容器列表</span></span><br><span class="line"><span class="string">pull      Pull an image or a repository from the docker registry server   # 从docker镜像源服务器拉取指定镜像或者库镜像</span></span><br><span class="line"><span class="string">push      Push an image or a repository to the docker registry server    # 推送指定镜像或者库镜像至docker源服务器</span></span><br><span class="line"><span class="string">restart   Restart a running container                   # 重启运行的容器</span></span><br><span class="line"><span class="string">rm        Remove one or more containers                 # 移除一个或者多个容器</span></span><br><span class="line"><span class="string">rmi       Remove one or more images       # 移除一个或多个镜像[无容器使用该镜像才可删除，否则需删除相关容器才可继续或 -f 强制删除]</span></span><br><span class="line"><span class="string">run       Run a command in a new container              # 创建一个新的容器并运行一个命令</span></span><br><span class="line"><span class="string">save      Save an image to a tar archive                # 保存一个镜像为一个 tar 包[对应 load]</span></span><br><span class="line"><span class="string">search    Search for an image on the Docker Hub         # 在 docker hub 中搜索镜像</span></span><br><span class="line"><span class="string">start     Start a stopped containers                    # 启动容器</span></span><br><span class="line"><span class="string">stop      Stop a running containers                     # 停止容器</span></span><br><span class="line"><span class="string">tag       Tag an image into a repository                # 给源中镜像打标签</span></span><br><span class="line"><span class="string">top       Lookup the running processes of a container   # 查看容器中运行的进程信息</span></span><br><span class="line"><span class="string">unpause   Unpause a paused container                    # 取消暂停容器</span></span><br><span class="line"><span class="string">version   Show the docker version information           # 查看 docker 版本号</span></span><br><span class="line"><span class="string">wait      Block until a container stops, then print its exit code   # 截取容器停止时的退出状态值</span></span><br></pre></td></tr></table></figure>



<h1 id="Docker镜像"><a href="#Docker镜像" class="headerlink" title="Docker镜像"></a><code>Docker</code>镜像</h1><h2 id="镜像"><a href="#镜像" class="headerlink" title="镜像"></a>镜像</h2><p>是一种轻量级、可执行的独立软件包，它包含运行某个软件所需的所有内容，我们把应用程序和配置依赖打包好形成一个可交付的运行环境(包括代码、运行时需要的库、环境变量和配置文件等)，这个打包好的运行环境就是image镜像文件。</p>
<p>只有通过这个镜像文件才能生成Docker容器实例(类似Java中new出来一个对象)。</p>
<h2 id="分层的镜像"><a href="#分层的镜像" class="headerlink" title="分层的镜像"></a>分层的镜像</h2><p>以我们的pull为例，在下载的过程中我们可以看到docker的镜像好像是在一层一层的在下载</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221203110710682.png" alt="image-20221203110710682"></p>
<h2 id="UnionFS（联合文件系统）"><a href="#UnionFS（联合文件系统）" class="headerlink" title="UnionFS（联合文件系统）"></a>UnionFS（联合文件系统）</h2><blockquote>
<p>可以看下《现代操作系统》的第四章，了解下文件系统</p>
</blockquote>
<p>UnionFS（联合文件系统）：Union文件系统（UnionFS）是一种分层、轻量级并且高性能的文件系统，它支持对文件系统的修改作为一次提交来一层层的叠加，同时可以将不同目录挂载到同一个虚拟文件系统下(unite several directories into a single virtual filesystem)。Union 文件系统是 Docker 镜像的基础。镜像可以通过分层来进行继承，基于基础镜像（没有父镜像），可以制作各种具体的应用镜像。</p>
<p>特性：一次同时加载多个文件系统，但从外面看起来，只能看到一个文件系统，联合加载会把各层文件系统叠加起来，这样最终的文件系统会包含所有底层的文件和目录</p>
<h2 id="Docker镜像加载原理"><a href="#Docker镜像加载原理" class="headerlink" title="Docker镜像加载原理"></a>Docker镜像加载原理</h2><p>docker的镜像实际上由一层一层的文件系统组成，这种层级的文件系统UnionFS。</p>
<p>bootfs(boot file system)主要包含bootloader和kernel，bootloader主要是引导加载kernel，Linux刚启动时会加载bootfs文件系统，在Docker镜像的最底层是引导文件系统bootfs。这一层与我们典型的Linux&#x2F;Unix系统是一样的，包含boot加载器和内核。当boot加载完成之后整个内核就都在内存中了，此时内存的使用权已由bootfs转交给内核，此时系统也会卸载bootfs。</p>
<p>rootfs (root file system) ，在bootfs之上。包含的就是典型 Linux 系统中的 &#x2F;dev, &#x2F;proc, &#x2F;bin, &#x2F;etc 等标准目录和文件。rootfs就是各种不同的操作系统发行版，比如Ubuntu，Centos等等。 </p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221203111530786.png" alt="image-20221203111530786"></p>
<p> 平时我们安装进虚拟机的CentOS都是好几个G，为什么docker这里才200多M？？</p>
<p><img src="/image-20221203111859992.png" alt="image-20221203111859992"></p>
<p>对于一个精简的OS，rootfs可以很小，只需要包括最基本的命令、工具和程序库就可以了，因为底层直接用Host宿主机的kernel，自己只需要提供 rootfs 就行了。由此可见对于不同的linux发行版, bootfs基本是一致的, rootfs会有差别, 因此不同的发行版可以公用bootfs。</p>
<p><strong>为什么 Docker 镜像要采用这种分层结构呢</strong></p>
<p>镜像分层最大的一个好处就是共享资源，方便复制迁移，就是为了复用。</p>
<p>比如说有多个镜像都从相同的 base 镜像构建而来，那么 Docker Host 只需在磁盘上保存一份 base 镜像；</p>
<p>同时内存中也只需加载一份 base 镜像，就可以为所有容器服务了。而且镜像的每一层都可以被共享。</p>
<p><strong>重点理解</strong></p>
<p>Docker镜像层都是只读的，容器层是可写的</p>
<p>当容器启动时，一个新的可写层被加载到镜像的顶部。这一层通常被称作“容器层”，“容器层”之下的都叫“镜像层”。</p>
<p>所有对容器的改动 - 无论添加、删除、还是修改文件都只会发生在容器层中。只有容器层是可写的，容器层下面的所有镜像层都是只读的。</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221203112434225.png" alt="image-20221203112434225"></p>
<h2 id="commit命令"><a href="#commit命令" class="headerlink" title="commit命令"></a><code>commit</code>命令</h2><blockquote>
<p>docker commit提交容器副本使之成为一个新的镜像</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker commit -m=<span class="string">&quot;提交的描述信息&quot;</span> -a=<span class="string">&quot;作者&quot;</span> 容器ID 要创建的目标镜像名:[标签名]</span><br></pre></td></tr></table></figure>

<p>案例演示ubuntu安装vim</p>
<ul>
<li><p>从Hub上下载ubuntu镜像到本地并成功运行</p>
</li>
<li><p>原始的默认Ubuntu镜像是不带着vim命令的</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221203113245284.png" alt="image-20221203113245284"></p>
</li>
<li><p>外网连通的情况下，安装vim</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 先更新包管理工具</span></span><br><span class="line">apt-get update</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装vim</span></span><br><span class="line">apt-get -y install vim</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装完成后，commit我们自己的新镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker commit -m=<span class="string">&quot;提交的描述信息&quot;</span> -a=<span class="string">&quot;作者&quot;</span> 容器ID 要创建的目标镜像名:[标签名]</span><br><span class="line"></span><br><span class="line">docker commit -m=<span class="string">&quot;ubuntu-with-vim&quot;</span> -a=<span class="string">&quot;author&quot;</span> ce4f0c9dd8f2 sai/ubuntu-with-vim:1.3</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动我们的新镜像并和原来的对比</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221203115023524.png" alt="image-20221203115023524"></p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221203114523128.png" alt="image-20221203114523128"></p>
</li>
<li><p>将镜像打包成本地文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 指令：docker save 镜像id &gt; 文件名.tar</span></span><br><span class="line">docker save 172825a55619 &gt; ./watch_ocr.tar<span class="comment"># watch_ocr.tar为打包的文件</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在另一台主机加载本地文件到镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 指令：docker load &lt; 文件名.tar</span></span><br><span class="line">docker load &lt; watch_ocr.tar		  <span class="comment"># watch_ocr.tar 为文件名称</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>镜像重命名</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/2022081910544660.png" alt="img"></p>
<p>执行完上述语句后，查看本地镜像，会看到新加载的镜像名字和标签都是none，利用该镜像的id对名字和标签重新命名即可：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker tag 172825a55619 watch_ocr:1.2</span><br></pre></td></tr></table></figure>

<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/2022081910544661.png" alt="2022081910544661.png"></p>
</li>
<li><p>创建容器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --name watch_ocr_contain 172825a55619 /bin/bash</span><br></pre></td></tr></table></figure>
</li>
<li><p>docker批量导出导入本地镜像</p>
<ul>
<li><p>导出脚本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># 获取到 &quot;image:tag&quot; 格式的镜像名</span></span><br><span class="line">IMG_NAME=`docker images | grep -v TAG | awk <span class="string">&#x27;&#123;print $1&quot;:&quot;$2&#125;&#x27;</span>`</span><br><span class="line"><span class="comment"># echo $IMG_NAME | awk &#x27;&#123;gsub(/ /,&quot;\n&quot;,$0)&#125; &#123;print $0&#125;&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 如果原本镜像名中存在 &quot;/&quot; 是需要去掉的</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 定义镜像存放目录</span></span><br><span class="line">DIR=<span class="string">&quot;/data/docker/image_tar&quot;</span></span><br><span class="line"><span class="keyword">if</span> [ ! -d <span class="string">&quot;<span class="variable">$DIR</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> -e <span class="string">&quot;\033[34m<span class="variable">$&#123;DIR&#125;</span>\033[0m 不存在&quot;</span></span><br><span class="line">  <span class="built_in">mkdir</span> -p <span class="string">&quot;<span class="variable">$DIR</span>&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> -e <span class="string">&quot;\033[34m<span class="variable">$&#123;DIR&#125;</span>\033[0m 已创建&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> -e <span class="string">&quot;\033[34m<span class="variable">$&#123;DIR&#125;</span>\033[0m 已存在&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> IMAGE <span class="keyword">in</span> <span class="variable">$IMG_NAME</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> -e <span class="string">&quot;正在保存 \033[33m<span class="variable">$&#123;IMAGE&#125;</span>\033[0m&quot;</span></span><br><span class="line">  SAVE_NAME=`<span class="built_in">echo</span> <span class="variable">$IMAGE</span> | awk -F: <span class="string">&#x27;&#123;print $1&quot;_&quot;$2&#125;&#x27;</span> | sed <span class="string">&#x27;s/\//_/g&#x27;</span>`</span><br><span class="line">  docker save <span class="variable">$IMAGE</span> -o <span class="variable">$&#123;DIR&#125;</span>/<span class="variable">$&#123;SAVE_NAME&#125;</span>.tar</span><br><span class="line">  <span class="built_in">echo</span> -e <span class="string">&quot;已保存到 \033[34m<span class="variable">$&#123;DIR&#125;</span>/\033[31m<span class="variable">$&#123;SAVE_NAME&#125;</span>.tar\033[0m&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>导入脚本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 在此处填写镜像文件的保存目录</span></span><br><span class="line">IMAGE_DIR=<span class="string">&quot;/data/docker/image_tar&quot;</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> IMAGE <span class="keyword">in</span> `<span class="built_in">ls</span> <span class="variable">$IMAGE_DIR</span>`</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> -e <span class="string">&quot;正在导入镜像 \033[33m<span class="variable">$IMAGE</span>\033[0m&quot;</span></span><br><span class="line">  docker load -i <span class="variable">$&#123;IMAGE_DIR&#125;</span>/<span class="variable">$&#123;IMAGE&#125;</span></span><br><span class="line">  <span class="built_in">echo</span> -e <span class="string">&quot;已成功导入镜像 \033[33m<span class="variable">$IMAGE</span>\033[0m&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h2 id="小总结-2"><a href="#小总结-2" class="headerlink" title="小总结"></a>小总结</h2><p>Docker中的镜像分层，支持通过扩展现有镜像，创建新的镜像。类似Java继承于一个Base基础类，自己再按需扩展。<br>新镜像是从 base 镜像一层一层叠加生成的。每安装一个软件，就在现有镜像的基础上增加一层</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221203153504212.png" alt="image-20221203153504212"></p>
<h2 id="本地镜像发布到阿里云"><a href="#本地镜像发布到阿里云" class="headerlink" title="本地镜像发布到阿里云"></a>本地镜像发布到阿里云</h2><h3 id="本地镜像发布到阿里云流程"><a href="#本地镜像发布到阿里云流程" class="headerlink" title="本地镜像发布到阿里云流程"></a>本地镜像发布到阿里云流程</h3><p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221203153745123.png" alt="image-20221203153745123"></p>
<h3 id="镜像的生成方法"><a href="#镜像的生成方法" class="headerlink" title="镜像的生成方法"></a>镜像的生成方法</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 基于当前容器创建一个新的镜像，新功能增强 </span></span><br><span class="line"></span><br><span class="line">docker commit [OPTIONS] 容器ID [REPOSITORY[:TAG]]</span><br></pre></td></tr></table></figure>

<p>OPTIONS说明：</p>
<ul>
<li><p>a :提交的镜像作者；</p>
</li>
<li><p>m :提交时的说明文字；</p>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://cr.console.aliyun.com/cn-hangzhou/instance/namespaces">容器镜像服务 (aliyun.com)</a></p>
<ul>
<li><p>开通个人版（个人免费版，试用，不建议用在生产环境）</p>
</li>
<li><p>创建命名空间</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221203155248684.png" alt="image-20221203155248684"></p>
</li>
<li><p>选择命名空间，创建镜像仓库</p>
<img src="image-20221203155336645.png" alt="image-20221203155336645" style="zoom:80%;" />



<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221203155447256.png" alt="image-20221203155447256"></p>
</li>
<li><p>此时阿里云会生成一系列的脚本命名，执行第三条的，将镜像推送到仓库的命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker login --username=17*****21 registry.cn-hangzhou.aliyuncs.com</span><br><span class="line">$ docker tag [ImageId] registry.cn-hangzhou.aliyuncs.com/mindcons/ubuntu:[镜像版本号]</span><br><span class="line">$ docker push registry.cn-hangzhou.aliyuncs.com/mindcons/ubuntu:[镜像版本号]</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker login --username=17*****21 registry.cn-hangzhou.aliyuncs.com</span><br><span class="line"></span><br><span class="line">docker tag f109f4e4ab55 registry.cn-hangzhou.aliyuncs.com/mindcons/ubuntu:1.3</span><br><span class="line"></span><br><span class="line">docker push registry.cn-hangzhou.aliyuncs.com/mindcons/ubuntu:1.3</span><br></pre></td></tr></table></figure>

<p>刚好有两层</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221203160359005.png" alt="image-20221203160359005"></p>
</li>
</ul>
<p>将阿里云上的镜像拉取下来使用</p>
<ul>
<li><p>先把本地对应的容器和镜像删除，复合镜像需强制删除</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221203161015231.png" alt="image-20221203161015231"></p>
</li>
<li><p>从阿里云上拉取镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker pull registry.cn-hangzhou.aliyuncs.com/mindcons/ubuntu:[镜像版本号]</span><br><span class="line"></span><br><span class="line">docker pull registry.cn-hangzhou.aliyuncs.com/mindcons/ubuntu:1.3</span><br></pre></td></tr></table></figure></li>
</ul>
<p>后面的DockerFile章节，是第2种方法</p>
<h2 id="本地镜像发布到私有库"><a href="#本地镜像发布到私有库" class="headerlink" title="本地镜像发布到私有库"></a>本地镜像发布到私有库</h2><p>1.官方Docker Hub地址：<a target="_blank" rel="noopener" href="https://hub.docker.com/%EF%BC%8C%E4%B8%AD%E5%9B%BD%E5%A4%A7%E9%99%86%E8%AE%BF%E9%97%AE%E5%A4%AA%E6%85%A2%E4%BA%86%E4%B8%94%E5%87%86%E5%A4%87%E8%A2%AB%E9%98%BF%E9%87%8C%E4%BA%91%E5%8F%96%E4%BB%A3%E7%9A%84%E8%B6%8B%E5%8A%BF%EF%BC%8C%E4%B8%8D%E5%A4%AA%E4%B8%BB%E6%B5%81%E3%80%82">https://hub.docker.com/，中国大陆访问太慢了且准备被阿里云取代的趋势，不太主流。</a></p>
<p>2.Dockerhub、阿里云这样的公共镜像仓库可能不太方便，涉及机密的公司不可能提供镜像给公网，所以需要创建一个本地私人仓库供给团队使用，基于公司内部项目构建镜像。</p>
<p>Docker Registry是官方提供的工具，可以用于构建私有镜像仓库</p>
<ul>
<li><p>下载镜像Docker Registry</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull registry</span><br></pre></td></tr></table></figure>
</li>
<li><p>运行私有库Registry，相当于本地有个私有Docker hub</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 5000:5000 -v /data/registry/:/tmp/registry --privileged=<span class="literal">true</span> registry</span><br><span class="line"></span><br><span class="line"><span class="comment"># 默认情况，仓库被创建在容器的/var/lib/registry目录下，建议自行用容器卷映射，方便于宿主机联调</span></span><br><span class="line"><span class="comment"># 如果报端口号错误，最好手敲一遍</span></span><br><span class="line"><span class="comment"># 端口号别自己改</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>案例演示创建一个新镜像，ubuntu安装ifconfig命令</p>
<ul>
<li><p>从Hub上下载ubuntu镜像到本地并成功运行</p>
</li>
<li><p>原始的Ubuntu镜像是不带着ifconfig命令的</p>
</li>
<li><p>外网连通的情况下，安装ifconfig命令并测试通过</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">docker pull ubuntu</span><br><span class="line">docker run -it ubuntu /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># docker容器内执行上述两条命令：</span></span><br><span class="line">apt-get update</span><br><span class="line"> <span class="comment">#安装ifconfig命令工具</span></span><br><span class="line">apt-get install net-tools</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">root@88495d96990a:/<span class="comment"># ifconfig</span></span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.17.0.4  netmask 255.255.0.0  broadcast 172.17.255.255</span><br><span class="line">        ether 02:42:ac:11:00:04  txqueuelen 0  (Ethernet)</span><br><span class="line">        RX packets 6197  bytes 25261154 (25.2 MB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 3887  bytes 336314 (336.3 KB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        loop  txqueuelen 1000  (Local Loopback)</span><br><span class="line">        RX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line">        </span><br><span class="line"><span class="comment"># 容器外执行commit命令</span></span><br><span class="line"> docker commit -m=<span class="string">&quot;ubuntu-with-ifconfig&quot;</span> -a=<span class="string">&quot;mindcons&quot;</span> 88495d96990a sai/ubuntu-with-ifconfig:1.3</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 关闭之前的容器</span></span><br><span class="line">docker stop 88495d96990a</span><br><span class="line"></span><br><span class="line"><span class="comment"># curl验证私服库上有什么镜像</span></span><br><span class="line">curl -XGET http://ip:5000/v2/_catalog</span><br><span class="line"><span class="comment"># &#123;&quot;repositories&quot;:[]&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将新镜像修改符合私服规范的Tag</span></span><br><span class="line">按照公式： docker   tag   镜像:Tag   Host:Port/Repository:Tag</span><br><span class="line"><span class="comment"># ip地址填自己的</span></span><br><span class="line">docker tag  zzyyubuntu:1.2  192.168.111.162:5000/zzyyubuntu:1.2</span><br><span class="line">docker tag sai/ubuntu-with-ifconfig:1.3 192.168.111.162:5000/sai/ubuntu-with-ifconfig:1.3</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改配置文件使之支持http</span></span><br><span class="line">vim /etc/docker/daemon.json</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://aa25jngu.mirror.aliyuncs.com&quot;</span>],</span><br><span class="line">  <span class="string">&quot;insecure-registries&quot;</span>: [<span class="string">&quot;192.168.111.162:5000&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#docker默认不允许http方式推送镜像，通过配置选项来取消这个限制。====&gt; 修改完后如果不生效，建议重启docker（实际生产环境慎用）</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://aa25jngu.mirror.aliyuncs.com&quot;</span>],</span><br><span class="line">  <span class="string">&quot;insecure-registries&quot;</span>: [<span class="string">&quot;192.168.111.162:5000&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 重启下之前关掉的容器</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># push推送到私服库</span></span><br><span class="line">docker push 192.168.111.162:5000/zzyyubuntu:1.2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 再次 curl验证私服库上有什么镜像</span></span><br><span class="line">curl -XGET http://ip:5000/v2/_catalog</span><br><span class="line">&#123;<span class="string">&quot;repositories&quot;</span>:[<span class="string">&quot;sai/ubuntu-with-ifconfig&quot;</span>]&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除正在运行的测试容器和镜像，然后从私服库上拉取镜像，注意要带上版本号</span></span><br><span class="line">docker pull 192.168.111.162:5000/zzyyubuntu:1.2</span><br><span class="line"> </span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h1 id="Docker容器数据卷"><a href="#Docker容器数据卷" class="headerlink" title="Docker容器数据卷"></a><code>Docker</code>容器数据卷</h1><h2 id="坑：容器卷记得加入"><a href="#坑：容器卷记得加入" class="headerlink" title="坑：容器卷记得加入"></a>坑：容器卷记得加入</h2><p><code>--privileged=true</code></p>
<p>Docker挂载主机目录访问如果出现<code>cannot open directory .: Permission denied</code></p>
<p>解决办法：在挂载目录后多加一个<code>--privileged=true</code>参数即可</p>
<p>如果是CentOS7，安全模块会比之前系统版本加强，不安全的会先禁止，目录挂载的情况被默认为不安全的行为，</p>
<p>在SELinux里面挂载目录被禁止掉了，如果要开启，我们一般使用<code>--privileged=true</code>命令，扩大容器的权限解决挂载目录没有权限的问题，也即使用该参数，container内的root拥有真正的root权限，否则，container内的root只是外部的一个普通用户权限。</p>
<h2 id="回顾下上一讲的知识点，参数V"><a href="#回顾下上一讲的知识点，参数V" class="headerlink" title="回顾下上一讲的知识点，参数V"></a>回顾下上一讲的知识点，参数V</h2><p>实际工作中，如果遇到没用过的，别卡着，先用，走通了再说！！！</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 5000:5000 -v /data/registry/:/tmp/registry --privileged=<span class="literal">true</span> registry</span><br></pre></td></tr></table></figure>

<p>-v参数，冒号左边表示宿主机的路径，冒号右边表示容器内的路径</p>
<p>卷就是目录或文件，存在于一个或多个容器中，由docker挂载到容器，但不属于联合文件系统，因此能够绕过<code>Union File System</code>提供一些用于持续存储或共享数据的特性：</p>
<p>卷的设计<strong>目的就是数据的持久化</strong>，完全独立于容器的生存周期，因此Docker不会在容器删除时删除其挂载的数据卷</p>
<p>有点类似Redis里面的rdb和aof文件</p>
<p>将docker容器内的数据保存进宿主机的磁盘中</p>
<p>运行一个带有容器卷存储功能的容器实例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --privileged=<span class="literal">true</span> -v /宿主机绝对路径目录:/容器内目录  镜像名</span><br></pre></td></tr></table></figure>



<p>能干嘛</p>
<ul>
<li><p>将应用与运行的环境打包镜像，run后形成容器实例运行 ，但是我们对数据的要求希望是持久化的</p>
</li>
<li><p>Docker容器产生的数据，如果不备份，那么当容器实例删除后，容器内的数据自然也就没有了。</p>
<p>为了能保存数据在docker中我们使用卷。</p>
</li>
</ul>
<p>特点：</p>
<p>1：数据卷可在容器之间共享或重用数据</p>
<p>2：卷中的更改可以直接实时生效，爽</p>
<p>3：数据卷中的更改不会包含在镜像的更新中</p>
<p>4：数据卷的生命周期一直持续到没有容器使用它为止 </p>
<h2 id="容器卷案例"><a href="#容器卷案例" class="headerlink" title="容器卷案例"></a>容器卷案例</h2><h3 id="宿主vs容器之间映射添加容器卷"><a href="#宿主vs容器之间映射添加容器卷" class="headerlink" title="宿主vs容器之间映射添加容器卷"></a>宿主vs容器之间映射添加容器卷</h3><p>直接命令添加</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">公式：docker run -it -v /宿主机目录:/容器内目录 ubuntu /bin/bash</span><br><span class="line"></span><br><span class="line">docker run -it --name myu3 --privileged=<span class="literal">true</span> -v /tmp/myHostData:/tmp/myDockerData ubuntu /bin/bash</span><br></pre></td></tr></table></figure>



<p>查看数据卷是否挂载成功</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect 容器ID</span><br></pre></td></tr></table></figure>

<img src="image-20221204170845088.png" alt="image-20221204170845088" style="zoom:80%;" />





<p> <strong>容器和宿主机之间数据共享</strong></p>
<p>1 docker修改，主机同步获得 </p>
<p>2 主机修改，docker同步获得</p>
<p>3 docker容器stop，主机修改，docker容器重启看数据是否同步。</p>
<ul>
<li>同步的</li>
</ul>
<h3 id="读写规则映射添加说明"><a href="#读写规则映射添加说明" class="headerlink" title="读写规则映射添加说明"></a>读写规则映射添加说明</h3><ul>
<li><p>读写（默认），<code>:rw</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --name myu3 --privileged=<span class="literal">true</span> -v /tmp/myHostData:/tmp/myDockerData:rw ubuntu /bin/bash</span><br></pre></td></tr></table></figure>
</li>
<li><p>只读（容器内部被限制，只能读取，不能写），<code>ro</code>(<code>read only</code>)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --name myu3 --privileged=<span class="literal">true</span> -v /tmp/myHostData:/tmp/myDockerData:ro ubuntu /bin/bash</span><br></pre></td></tr></table></figure>

<p>此时如果宿主机写入内容，可以同步给容器内，容器可以读取到。</p>
</li>
</ul>
<h3 id="卷的继承和共享"><a href="#卷的继承和共享" class="headerlink" title="卷的继承和共享"></a>卷的继承和共享</h3><ul>
<li><p>容器1完成和宿主机的映射</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it  --privileged=<span class="literal">true</span> -v /mydocker/u:/tmp --name u1 ubuntu</span><br></pre></td></tr></table></figure>
</li>
<li><p>容器2继承容器1的卷规则</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker run -it  --privileged=true --volumes-from 父类  --name u2 ubuntu</span></span><br><span class="line"></span><br><span class="line">docker run -it  --privileged=<span class="literal">true</span> --volumes-from u1  --name u2 ubuntu</span><br></pre></td></tr></table></figure>

<p>继承的只是容器卷挂载的规则，父类挂了不影响子类</p>
</li>
</ul>
<h1 id="Docker常规安装简介"><a href="#Docker常规安装简介" class="headerlink" title="Docker常规安装简介"></a>Docker常规安装简介</h1><p>云原生的基础</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221204172952013.png" alt="image-20221204172952013"></p>
<p><strong>总体步骤</strong></p>
<p>搜索镜像</p>
<p>拉取镜像</p>
<p>查看镜像</p>
<p>启动镜像</p>
<p>服务端口映射</p>
<p>停止容器</p>
<p>移除容器</p>
<h2 id="安装tomcat"><a href="#安装tomcat" class="headerlink" title="安装tomcat"></a>安装<code>tomcat</code></h2><ul>
<li><p>docker hub上面查找tomcat镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker search tomcat</span><br></pre></td></tr></table></figure>
</li>
<li><p>从docker hub上拉取tomcat镜像到本地</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull tomcat</span><br></pre></td></tr></table></figure>
</li>
<li><p>docker images查看是否有拉取到的tomcat</p>
</li>
<li><p>使用tomcat镜像创建容器实例(也叫运行镜像)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -p 8080:8080 tomcat</span><br></pre></td></tr></table></figure>
</li>
<li><p>访问tomcat首页</p>
<ul>
<li><p>问题</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230221110155571.png" alt="image-20230221110155571"></p>
</li>
<li><p>解决</p>
<ul>
<li><p>可能没有映射端口或者没有关闭防火墙、云服务器可能需要开放安全组</p>
</li>
<li><p>把webapps.dist目录换成webapps</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 拿到容器ID</span></span><br><span class="line">docker ps</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入容器</span></span><br><span class="line">docker <span class="built_in">exec</span> -it 92be0dabefc5 /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># 把空目录webapps删除，将webapps.dist目录重命名为webapps</span></span><br><span class="line"><span class="comment"># 或者直接复制</span></span><br><span class="line"><span class="built_in">cp</span> -r webapps.dist/* webapps</span><br></pre></td></tr></table></figure>
</li>
<li><p>可成功访问</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230221111709178.png" alt="image-20230221111709178"></p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>免修改版说明</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker pull billygoo/tomcat8-jdk8</span><br><span class="line"></span><br><span class="line">docker run -d -p 8080:8080 --name mytomcat8 billygoo/tomcat8-jdk8</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="安装redis"><a href="#安装redis" class="headerlink" title="安装redis"></a>安装<code>redis</code></h2><p>从docker hub上(阿里云加速器)拉取redis镜像到本地标签为6.0.8</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">新建目录</span><br><span class="line"><span class="built_in">mkdir</span> -p /app/redis</span><br><span class="line">将一个redis.conf文件模板拷贝进/app/redis目录下（要到装过redis的机器上拷贝），注意版本</span><br></pre></td></tr></table></figure>

<p>修改redis.conf文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">1 开启redis验证    可选</span><br><span class="line">requirepass 123</span><br><span class="line"></span><br><span class="line">2 允许redis外地连接  必须</span><br><span class="line">注释掉 <span class="comment"># bind 127.0.0.1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3   daemonize no</span><br><span class="line">将daemonize <span class="built_in">yes</span>注释起来或者 daemonize no设置，因为该配置和docker run中-d参数冲突，会导致容器一直启动失败</span><br><span class="line"></span><br><span class="line">4 开启redis数据持久化  appendonly <span class="built_in">yes</span>  可选</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>使用redis6.0.8镜像创建容器(也叫运行镜像)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run  -p 6379:6379 --name myredis3 --privileged=<span class="literal">true</span> -v /app/redis/redis.conf:/etc/redis/redis.conf -v /app/redis/data:/data -d redis:6.0.8 redis-server /etc/redis/redis.conf</span><br></pre></td></tr></table></figure>

<p>测试redis-cli连接上来</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230221153733078.png" alt="image-20230221153733078"></p>
<h2 id="安装vscode"><a href="#安装vscode" class="headerlink" title="安装vscode"></a>安装<code>vscode</code></h2><p>拉取镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull codercom/code-server</span><br></pre></td></tr></table></figure>

<p>创建并启动容器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker run -<span class="built_in">id</span> \</span><br><span class="line">-u root \</span><br><span class="line">-p 5500:5500 \</span><br><span class="line">-p 8443:8080 \</span><br><span class="line">--name=code_server \</span><br><span class="line">-e PASSWORD=...... \</span><br><span class="line">-h code_server \</span><br><span class="line">-v <span class="variable">$PWD</span>/coder:/home/coder \</span><br><span class="line">codercom/code-server</span><br></pre></td></tr></table></figure>

<p>参数说明:</p>
<ul>
<li><strong>-u root 表示启用root用户权限 这一步很关键 不然很多文件无法操作</strong></li>
<li><strong>-p 8443：8080 将容器的8080端口映射到主机的8443端口 用于浏览器访问</strong><ul>
<li>左边表示宿主机的端口</li>
<li>右边表示容器的端口</li>
<li>需要开启端口，放开防火墙</li>
</ul>
</li>
<li><strong>-p 5500:5500 将容器的5500端口映射到主机的5500端口 用于开发过程中代码修改后实时更新查看</strong><ul>
<li><code>vscode</code>的<code>live serve</code>插件，默认的是5500端口</li>
</ul>
</li>
<li><strong>-e PASSWORD&#x3D;…… 设置远程登录密码</strong><ul>
<li>密码可以自定义</li>
</ul>
</li>
<li><strong>-v $PWD&#x2F;coder:&#x2F;home&#x2F;coder将主机中当前目录挂载到容器</strong><ul>
<li>到需要开发的目录下执行命令</li>
<li>也可以指定绝对路径</li>
</ul>
</li>
<li><strong>-h 设置容器的hostname</strong></li>
<li><strong>–name&#x3D;code_server 给容器取个名称</strong></li>
<li><strong>$PWD表示当前所在目录</strong></li>
</ul>
<p>创建容器后，访问<code>ip:8443</code></p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221202161426682.png" alt="image-20221202161426682"></p>
<p>安装<code>liveServe</code>插件，会有点慢，稍作等待即可</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221202162033203.png" alt="image-20221202162033203"></p>
<p>其他插件，看情况安装</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_44848480/article/details/126504394">https://blog.csdn.net/qq_44848480/article/details/126504394</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/u011262253/article/details/113879997">https://blog.csdn.net/u011262253/article/details/113879997</a></p>
</li>
</ul>
<h2 id="安装mysql"><a href="#安装mysql" class="headerlink" title="安装mysql"></a>安装<code>mysql</code></h2><p><a target="_blank" rel="noopener" href="https://hub.docker.com/_/mysql">mysql - Official Image | Docker Hub</a></p>
<h3 id="方案一"><a href="#方案一" class="headerlink" title="方案一"></a>方案一</h3><ul>
<li><p>docker hub上面查找mysql镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker search mysql</span><br></pre></td></tr></table></figure>
</li>
<li><p>从docker hub上(阿里云加速器)拉取mysql镜像到本地标签为5.7</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull mysql:5.7</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用mysql5.7镜像创建容器(也叫运行镜像)</p>
<ul>
<li><p>简单版</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 3306:3306 -e MYSQL_ROOT_PASSWORD=123456 -d mysql:5.7</span><br><span class="line">docker ps</span><br><span class="line">docker <span class="built_in">exec</span> -it 容器ID /bin/bash</span><br><span class="line">mysql -uroot -p</span><br></pre></td></tr></table></figure>

<p><strong>问题</strong></p>
<p>docker上默认字符集编码隐患，docker里面的mysql容器实例查看，内容如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;character%&#x27;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230221135331069.png" alt="image-20230221135331069"></p>
<p>注意不要用连接工具查看，连接工具会在客户端更改字符显示，但服务器上的字符编码不是utf-8。</p>
<p>新版本的mysql不存在这个问题（mysql8默认编码是utf-8）</p>
<p>删除容器后，里面的mysql数据怎么办？</p>
</li>
<li><p>实战版</p>
<p>新建mysql容器实例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -e 表示环境变量</span></span><br><span class="line"><span class="comment"># 挂三个卷，分别放日志、数据、配置</span></span><br><span class="line"><span class="comment"># /zzyyuse 换成自己的工作目录</span></span><br><span class="line"><span class="comment"># 注意端口号占用情况、--name是否重名</span></span><br><span class="line">docker run -d -p 3306:3306 --privileged=<span class="literal">true</span> -v /zzyyuse/mysql/log:/var/log/mysql -v /zzyyuse/mysql/data:/var/lib/mysql -v /zzyyuse/mysql/conf:/etc/mysql/conf.d -e MYSQL_ROOT_PASSWORD=123456  --name mysql mysql:5.7</span><br></pre></td></tr></table></figure>

<p>新建my.cnf，通过容器卷同步给mysql容器实例</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230221141908284.png" alt="image-20230221141908284"></p>
<p>复制如下配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[client]</span><br><span class="line">default_character_set=utf8</span><br><span class="line">[mysqld]</span><br><span class="line">collation_server = utf8_general_ci</span><br><span class="line">character_set_server = utf8</span><br></pre></td></tr></table></figure>

<p>重新启动mysql容器实例再重新进入并查看字符编码</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230221142314124.png" alt="image-20230221142314124"></p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230221142322916.png" alt="image-20230221142322916"></p>
<p>这时进去输入密码，会报1045错，见方案二</p>
<p>docker安装完MySQL并run出容器后，建议请先修改完字符集编码后再新建mysql库-表-插数据</p>
<p>如果不小心把容器删除了，用相同的挂载路径新建容器，数据都还是在的</p>
</li>
</ul>
</li>
</ul>
<h3 id="方案二"><a href="#方案二" class="headerlink" title="方案二"></a>方案二</h3><p>1.docker拉取mysql版本：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker pull mysql:5.7</span><br></pre></td></tr></table></figure>

<p>2.创建挂载目录：</p>
<p>可以看看是否已经存在了</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /usr/local/mysql</span><br></pre></td></tr></table></figure>

<p>用于挂载mysql数据文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /usr/local/mysql/data</span><br></pre></td></tr></table></figure>

<p>用于挂载mysql配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /usr/local/mysql/conf.d</span><br></pre></td></tr></table></figure>

<p>3 启动容器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name mysql5.7 -p 3306:3306 -v /usr/local/mysql/data:/var/lib/mysql -v /usr/local/mysql/conf.d:/etc/mysql/conf.d -e MYSQL_ROOT_PASSWORD=jkjk@qaz12 -d mysql:5.7</span><br></pre></td></tr></table></figure>



<p>处理mysql 1045报错</p>
<p>1 在 &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;conf.d目录下增加文件： my.cnf</p>
<p>文件内容为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">skip-grant-tables</span><br></pre></td></tr></table></figure>

<p>2 重启mysql：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker restart mysql</span><br></pre></td></tr></table></figure>

<p>3进入docker的bash：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it mysql bash</span><br></pre></td></tr></table></figure>

<p>4登录mysql：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p</span><br></pre></td></tr></table></figure>

<p>复制粘贴之前设置的密码</p>
<p>5设置root密码为空，注意root密码是加密的，设置其它值不好找到对应的明文。</p>
<p>命令是分开的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">use mysql;</span><br><span class="line"></span><br><span class="line">select user,authentication_string,host from user;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>&#x2F;&#x2F;更新为空</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">update user set authentication_string=&#x27;&#x27; where user=&#x27;root&#x27;;</span><br><span class="line"></span><br><span class="line">flush privileges;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>6 退出mysql，把第一步的skip-grant-tables注释。再重启mysql</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exit</span><br></pre></td></tr></table></figure>

<p>7 使用 root用户，密码 回车键登录；</p>
<p>直接回车</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p</span><br></pre></td></tr></table></figure>

<p>8 修改root密码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">alter user &#x27;root&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;jkjk@qaz12&#x27;;</span><br><span class="line"></span><br><span class="line">alter user &#x27;root&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;jkjk@qaz12&#x27;;</span><br><span class="line"></span><br><span class="line">flush privileges;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>修改root密码完成。</p>
<p>9 可附加一步授权：</p>
<p>（报语法错误，跳过）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GRANT all ON . TO &#x27;root&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;jkjk@qaz12&#x27; ;</span><br><span class="line"></span><br><span class="line">flush privileges;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>至此，可以用数据库连接工具连接</p>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run -d -p 3306:3306 -v /usr/local/mysql/conf:/etc/mysql/conf.d -v /usr/local/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=jkjk@qaz12 --name  mysql mysql:5.7</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">配置端口映射：</span><br><span class="line">-p 3306:3306 --name mysql</span><br><span class="line">将容器的3306端口映射到主机的3306端口</span><br><span class="line">配置mysql数据卷挂载</span><br><span class="line">1.-v /mydata/mysql/log:/var/log/mysql(日志文件挂载)</span><br><span class="line">将容器中的日志文件夹挂载到主机对应的/var/log/mysql文件夹中</span><br><span class="line">2.-v /mydata/mysql/data:/var/lib/mysql(数据文件挂载)</span><br><span class="line">将容器中的数据文件夹挂载到主机对应的/var/lib/mysql文件夹中</span><br><span class="line">3.-v /mydata/mysql/conf:/etc/mysql(配置文件挂载)</span><br><span class="line">将容器的配置文件夹挂载到主机对应的/etc/mysql文件夹中</span><br><span class="line">注(这里所提的主机指的是当前的linux主机)</span><br><span class="line">配置用户</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=root</span><br><span class="line">设置初始化root用户的密码</span><br><span class="line">指定镜像资源</span><br><span class="line">-d mysql:5.7</span><br><span class="line">-d：以后台方式运行实例</span><br><span class="line">mysql:5.7：指定用这个镜像来创建运行实例</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>测试</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it mysql bash</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -h localhost -u root -p</span><br></pre></td></tr></table></figure>

<h2 id="安装doccano"><a href="#安装doccano" class="headerlink" title="安装doccano"></a>安装<code>doccano</code></h2><h2 id="安装Label-Studio"><a href="#安装Label-Studio" class="headerlink" title="安装Label Studio"></a>安装<code>Label Studio</code></h2><p>拉取镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull heartexlabs/label-studio:latest</span><br></pre></td></tr></table></figure>

<p>新建一个目录并进入</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /data/labelstudio</span><br><span class="line"></span><br><span class="line">docker run -it -p 8083:8080 -v `<span class="built_in">pwd</span>`/mydata:/label-studio/data heartexlabs/label-studio:latest</span><br></pre></td></tr></table></figure>

<h2 id="安装vnc（废弃）"><a href="#安装vnc（废弃）" class="headerlink" title="安装vnc（废弃）"></a>安装<code>vnc</code>（废弃）</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/u014062332/article/details/95333615">(11条消息) 用docker启动ubuntu的桌面环境_菜鸟怕怕的博客-CSDN博客_docker ubuntu桌面</a></p>
<p>拉取镜像：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull dorowu/ubuntu-desktop-lxde-vnc</span><br></pre></td></tr></table></figure>

<p>运行容器：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 6080:80 -p 5900:5900 -e RESOLUTION=1920x1080 -e VNC_PASSWORD=VNC登录的密码 -v /dev/shm:/dev/shm dorowu/ubuntu-desktop-lxde-vnc</span><br></pre></td></tr></table></figure>

<p>更新源：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41296187/article/details/123723093">https://blog.csdn.net/qq_41296187/article/details/123723093</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get upgrade</span><br><span class="line">sudo apt-get install aptitude</span><br><span class="line"></span><br><span class="line">sudo aptitude install xxxxx</span><br></pre></td></tr></table></figure>

<p>安装vscode：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_50840738/article/details/126060563">https://blog.csdn.net/qq_50840738/article/details/126060563</a></p>
<p>安装中文包（未成功）：</p>
<p><a target="_blank" rel="noopener" href="https://www.lijiejie.com/ubuntu-vps-config-lxde-vnc/">https://www.lijiejie.com/ubuntu-vps-config-lxde-vnc/</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bbsmax.com/A/GBJr7y7q50/">https://www.bbsmax.com/A/GBJr7y7q50/</a></p>
<h2 id="安装vnc2"><a href="#安装vnc2" class="headerlink" title="安装vnc2"></a>安装vnc2</h2><p>基于新建dockerfile配置sudo，具体参考《Docker-Ubuntu环境搭建playwright环境》</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### https://hub.docker.com/r/kasmweb/ubuntu-focal-desktop</span></span><br><span class="line"><span class="comment">### docker build -t zzh/ubuntu-focal-desktop:1.12.0 .</span></span><br><span class="line"><span class="comment">### 启动镜像的命令：sudo docker run  -it --name=zzh_ubuntu-focal-desktop --shm-size=512m -p 26901:6901 -e VNC_PW=password zzh/ubuntu-focal-desktop:1.12.0</span></span><br><span class="line"><span class="comment">### 访问地址： https://IP_OF_SERVER:6901</span></span><br><span class="line"><span class="comment">### User : kasm_user</span></span><br><span class="line"><span class="comment">### Password: password</span></span><br><span class="line"></span><br><span class="line">FROM kasmweb/ubuntu-focal-desktop:1.12.0</span><br><span class="line"></span><br><span class="line">USER root</span><br><span class="line">RUN sed -i <span class="string">&quot;s/archive.ubuntu.com/mirrors.aliyun.com/g&quot;</span> /etc/apt/sources.list </span><br><span class="line"></span><br><span class="line">RUN apt-get update \</span><br><span class="line">    &amp;&amp; apt-get install -y sudo \</span><br><span class="line">    &amp;&amp; <span class="built_in">echo</span> <span class="string">&#x27;kasm-user ALL=(ALL) NOPASSWD: ALL&#x27;</span> &gt;&gt; /etc/sudoers \</span><br><span class="line">    &amp;&amp; <span class="built_in">rm</span> -rf /var/lib/apt/list/*</span><br><span class="line"></span><br><span class="line">USER 1000</span><br></pre></td></tr></table></figure>

<p>重新打包成镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run  -it --name=ubuntu-focal-desktop-origin --shm-size=512m -p 8086:6901  -p 8087:9878 -p 8088:9879 -p 29880:9880 -e VNC_PW=password -v /data/data01/hh/ubuntu-focal-desktop:/app kasmweb/ubuntu-focal-desktop:1.12.0</span><br></pre></td></tr></table></figure>

<ul>
<li><p>vscode中无法新建文件</p>
<ul>
<li>更改挂载目录的用户和用户组，可以用portainer看下status中进程是哪个用户的</li>
</ul>
</li>
<li><p>安装edge：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_49689323/article/details/124253429">https://blog.csdn.net/weixin_49689323/article/details/124253429</a></p>
<ul>
<li><p>官网下载deb文件，进入到文件目录</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo dpkg -i 下载的文件名.deb</span><br><span class="line">sudo apt-get install -f</span><br><span class="line"></span><br><span class="line">补充：</span><br><span class="line">sudo dpkg -r package <span class="comment"># 删除包  -r: remove</span></span><br><span class="line">此方法的默认安装目录为:  /opt</span><br></pre></td></tr></table></figure>

<p>这时候在<strong>应用程序&gt;Internet</strong>中就可以可以发现我们的<strong>Edge</strong>了</p>
</li>
<li><p>但此时无法打开，需要修改</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/bin/microsoft-edge</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在最后一行 添加两个参数</span></span><br><span class="line"><span class="built_in">exec</span> -a <span class="string">&quot;<span class="variable">$0</span>&quot;</span> <span class="string">&quot;<span class="variable">$HERE</span>/msedge&quot;</span> <span class="string">&quot;<span class="variable">$@</span>&quot;</span>  --user-data-dir --no-sandbox</span><br></pre></td></tr></table></figure>

<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230228192237151.png" alt="image-20230228192237151"></p>
</li>
</ul>
</li>
<li><p>更新默认浏览器，以便vscode登录</p>
<p>ubuntu软件安装在哪里&#x2F;安装位置：<a target="_blank" rel="noopener" href="https://blog.csdn.net/universe_R/article/details/122113798">https://blog.csdn.net/universe_R/article/details/122113798</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加sudoers PATH https://blog.csdn.net/hello_1995/article/details/109222650 </span></span><br><span class="line"><span class="comment"># 或者直接进入已配置号的secure_path，如/usr/bin中，执行</span></span><br><span class="line">sudo apt install firefox</span><br><span class="line"></span><br><span class="line"><span class="comment"># 若安装失败，需要更新下</span></span><br><span class="line">sudo apt-get update</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者可以选择已安装的edge浏览器，在/opt目录下 </span></span><br></pre></td></tr></table></figure>
</li>
<li><p>宿主机配置访问github，<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_51368339/article/details/127889467">https://blog.csdn.net/qq_51368339/article/details/127889467</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用ssh -v命令，打出详细日志。</span></span><br><span class="line">ssh -vT git@github.com</span><br><span class="line"><span class="comment"># 可能就是单纯的慢</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>安装中文输入法</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_40660130/article/details/120775817">ubuntu language support 点击没反应</a></p>
<p>首先查看是否安装了中文语言包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">locale -a</span><br></pre></td></tr></table></figure>

<p>查看是否有：<code>zh_CN.utf8</code><br>如果没有，首先需要安装中文语言包，输入以下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install language-pack-zh-hans</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后添加中文支持</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo locale-gen zh_CN.UTF-8</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>修改locale文件配置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/default/locale</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">LANG=<span class="string">&quot;zh_CN.UTF-8&quot;</span></span><br><span class="line">LANGUAGE=<span class="string">&quot;zh_CN:zh:en_US:en&quot;</span></span><br><span class="line">LC_NUMERIC=<span class="string">&quot;zh_CN.UTF-8&quot;</span></span><br><span class="line">LC_TIME=<span class="string">&quot;zh_CN.UTF-8&quot;</span></span><br><span class="line">LC_MONETARY=<span class="string">&quot;zh_CN.UTF-8&quot;</span></span><br><span class="line">LC_PAPER=<span class="string">&quot;zh_CN.UTF-8&quot;</span></span><br><span class="line">LC_IDENTIFICATION=<span class="string">&quot;zh_CN.UTF-8&quot;</span></span><br><span class="line">LC_NAME=<span class="string">&quot;zh_CN.UTF-8&quot;</span></span><br><span class="line">LC_ADDRESS=<span class="string">&quot;zh_CN.UTF-8&quot;</span></span><br><span class="line">LC_TELEPHONE=<span class="string">&quot;zh_CN.UTF-8&quot;</span></span><br><span class="line">LC_MEASUREMENT=<span class="string">&quot;zh_CN.UTF-8&quot;</span></span><br><span class="line">LC_ALL=zh_CN.UTF-8</span><br></pre></td></tr></table></figure>

<p>重启容器</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/manong_1/article/details/128323888"> WSL2 Ubuntu20.04 打开language support闪退解决办法</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install dbus</span><br><span class="line">sudo /etc/init.d/dbus start</span><br></pre></td></tr></table></figure>



<p>想要打开language support设置汉语，结果一直闪退</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/7b71cfa313b8403dbaed8c68c49bf80e.png" alt="在这里插入图片描述"></p>
<p>Ubuntu 22.04 同时安装ibus和fcitx会冲突，导致系统卡死。但是操作完上述步骤后，会自动安装fcitx，所以需要先卸载fcitx：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudot apt-get remove fcitx*</span><br><span class="line"></span><br><span class="line">sudo apt-get purge fcitx*</span><br><span class="line"></span><br><span class="line">sudo apt-get autoremove</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install dbus</span><br><span class="line"></span><br><span class="line">sudo /etc/init.d/dbus start</span><br><span class="line"></span><br><span class="line">sudo apt install ibus-libpinyin </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>之后</strong>在<code>settings——&gt;IBus Preferences——&gt;Input Method——&gt;选择中文智能拼音</code></p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/2ae1bc7efbe447509a8f14eba8694570.png" alt="在这里插入图片描述"></p>
<p>若出现如下提示</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230302092051312.png" alt="image-20230302092051312"></p>
<p>按要求修改即可</p>
</li>
<li><p>问题：IBus不能自动启动<br>解决方法：<br>点击菜单<code>System &gt;&gt; Preferences &gt;&gt; Startup Applications</code><br>如果通过这种方式找不到，则直接在控制台运行：<code>gnome-session-properties</code><br>点击后会出现startup application窗口：<br>Click the button: Add</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Name: IBus daemon</span><br><span class="line">Command: /usr/bin/ibus-daemon -d</span><br><span class="line">Comment: start IBus daemon when Gnome starts</span><br></pre></td></tr></table></figure>
</li>
<li><p>如果点击一个地方并输入时，ibus的框框没有消失，可以再装一下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install ibus-pinyin</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装wps</p>
</li>
<li><p>修改文件最大监测数</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/lxyoucan/article/details/116736501">https://blog.csdn.net/lxyoucan/article/details/116736501</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_42375768/article/details/118637237">https://blog.csdn.net/weixin_42375768/article/details/118637237</a></p>
<p>在宿主机中配置，不是在容器内</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/sysctl.conf</span><br><span class="line"><span class="comment"># 在底部添加一行</span></span><br><span class="line"></span><br><span class="line">fs.inotify.max_user_watches=524288</span><br><span class="line"></span><br><span class="line"><span class="comment"># 保存退出然后执行</span></span><br><span class="line">sudo sysctl -p</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="安装postgres"><a href="#安装postgres" class="headerlink" title="安装postgres"></a>安装postgres</h2><p>注意最好指定版本号，不能拉取最新的镜像，否则用<code>navicat</code>链接，可能会报<code>datlastsysoid</code>字段不存在，因为的确新版本的psql删除了这个字段<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44127299/article/details/127883966">https://blog.csdn.net/weixin_44127299/article/details/127883966</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull postgres:12.3</span><br></pre></td></tr></table></figure>

<p>如果-v 宿主机目录，之前是已经创建过了的，要把目录删掉<br>另外，容器内的端口，就设置为默认的5432，不要自己改</p>
<p>下面的唯一要改的就是自己的主机的路径</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --name postgres01 --restart always -e TZ=&#x27;Asia/Shanghai&#x27; -e POSTGRES_PASSWORD=&#x27;postgres&#x27; -e ALLOW_IP_PANGE=0.0.0.0/0 -p 15432:5432 -v /data/data01/hh/software/postgres/data:/var/lib/postgresql/data -d postgres:12.3</span><br></pre></td></tr></table></figure>

<p>上述命令执行完之后，如果没有公网端口，配置本地隧道后，用<code>navicat</code>测试，直接是通的</p>
<p>注意，如果宿主机路径是在<code>ubuntu-docker</code>管理下，并且误操作修改了用户用户组，再次连接时，会报错。虽然说重启下容器就可以了，但最好还是把宿主机放在一个单独的路径下。</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230530151905663.png" alt="image-20230530151905663"></p>
<p>下面内容可以跳过</p>
<blockquote>
<p>把容器内文件复制出来，修改pg_hba.conf</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">cp</span> 867b74c8c53f:/var/lib/postgresql/data/pg_hba.conf /data/data01/hh/desktop/software/</span><br><span class="line">docker <span class="built_in">cp</span> /data/data01/hh/desktop/software/pg_hba.conf  867b74c8c53f:/var/lib/postgresql/data/</span><br><span class="line"></span><br><span class="line">docker <span class="built_in">cp</span> 867b74c8c53f:/var/lib/postgresql/data/postgresql.conf /data/data01/hh/desktop/software/</span><br></pre></td></tr></table></figure>
</blockquote>
<p>在导入<code>sql</code>数据时，要手动建库名和模式名，库名可以自定义，模式名和给定的<code>sql</code>文件中，保持一致即可</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230530152529636.png" alt="image-20230530152529636"></p>
<h2 id="安装不同版本的chrome"><a href="#安装不同版本的chrome" class="headerlink" title="安装不同版本的chrome"></a>安装不同版本的<code>chrome</code></h2><h2 id="安装centos"><a href="#安装centos" class="headerlink" title="安装centos"></a>安装<code>centos</code></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run -itd -p 17094:22 -p 17095:8080 -p 17096:17096 --privileged --name centos7_server_2 centos:7 /usr/sbin/init</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://www.jb51.cc/docker/1039837.html">《docker安装nginx、安装tomcat、安装Centos7、容器导入导出、镜像上传到仓库》</a></p>
<h2 id="安装ubuntu"><a href="#安装ubuntu" class="headerlink" title="安装ubuntu"></a><code>安装ubuntu</code></h2><h3 id="开启容器"><a href="#开启容器" class="headerlink" title="开启容器"></a>开启容器</h3><ol>
<li><p>安装Docker：确保您的CentOS系统已安装Docker。您可以按照Docker官方文档提供的说明进行安装。</p>
</li>
<li><p>拉取Ubuntu 18镜像：使用以下命令从Docker Hub上拉取Ubuntu 18的镜像：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">docker pull ubuntu:18.04</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建并启动Ubuntu容器：运行以下命令创建一个新的Ubuntu容器并启动它，</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -v /data/data03/ubuntu-server:/app -p 28015:28015/udp -p 28016:28016/tcp --name ubuntu-server ubuntu:18.04 /bin/bash</span><br></pre></td></tr></table></figure>

<p>这将创建一个名为<code>my_ubuntu</code>的容器，将本地主机的<code>/data/data03/ubuntu-server</code>目录映射到容器内的<code>/app</code>目录，并将主机的UDP端口28015映射到容器的UDP端口28015，TCP端口28016映射到容器的TCP端口28016。</p>
</li>
<li><p>进入Ubuntu容器：容器启动后，使用以下命令进入Ubuntu容器：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it ubuntu-server /bin/bash</span><br></pre></td></tr></table></figure>
</li>
<li><p>现在，您可以在Ubuntu容器中进行任何必要的配置或安装其他软件。</p>
</li>
</ol>
<h3 id="更新源"><a href="#更新源" class="headerlink" title="更新源"></a>更新源</h3><p>在已经安装了Ubuntu 18的Docker容器中，您可以按照以下步骤来更新软件源：</p>
<ol>
<li><p>进入Ubuntu容器：首先，确保您已经进入正在运行的Ubuntu容器的交互式Shell。如果您尚未进入容器，请使用以下命令进入容器：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it my_ubuntu /bin/bash</span><br></pre></td></tr></table></figure>
</li>
<li><p>执行源更新：在Ubuntu容器内，使用以下命令更新软件源：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get update</span><br></pre></td></tr></table></figure>

<p>这将从Ubuntu的软件源服务器上获取最新的软件包列表。</p>
</li>
<li><p>执行软件包升级：完成软件源更新后，您可以执行以下命令升级已安装的软件包：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get upgrade</span><br></pre></td></tr></table></figure>

<p>这将升级容器内的所有已安装软件包到最新可用版本。</p>
</li>
<li><p>（<strong>可选</strong>）清理不需要的软件包：您可以使用以下命令删除已升级软件包后不再需要的依赖关系和文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get autoremove</span><br></pre></td></tr></table></figure>

<p>这将自动删除不再需要的软件包和相关文件</p>
</li>
</ol>
<h3 id="安装常见的软件"><a href="#安装常见的软件" class="headerlink" title="安装常见的软件"></a>安装常见的软件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装vim编辑器</span></span><br><span class="line">apt-get install vim</span><br><span class="line"><span class="comment"># 安装sudo</span></span><br><span class="line">apt-get install sudo</span><br></pre></td></tr></table></figure>

<h3 id="配置githbub正常访问"><a href="#配置githbub正常访问" class="headerlink" title="配置githbub正常访问"></a>配置githbub正常访问</h3><p>首先我们编辑<code>/etc/hosts</code>文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vi /etc/hosts</span><br></pre></td></tr></table></figure>

<p>复制</p>
<p>然后把原始文件中的与<code>github.com</code>相关的内容先删除，再将如下内容放到文件的末尾：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">140.82.114.25                 alive.github.com</span><br><span class="line">140.82.112.25                 live.github.com</span><br><span class="line">185.199.108.154               github.githubassets.com</span><br><span class="line">140.82.112.22                 central.github.com</span><br><span class="line">185.199.108.133               desktop.githubusercontent.com</span><br><span class="line">185.199.108.153               assets-cdn.github.com</span><br><span class="line">185.199.108.133               camo.githubusercontent.com</span><br><span class="line">185.199.108.133               github.map.fastly.net</span><br><span class="line">199.232.69.194                github.global.ssl.fastly.net</span><br><span class="line">140.82.112.4                  gist.github.com</span><br><span class="line">185.199.108.153               github.io</span><br><span class="line">140.82.114.4                  github.com</span><br><span class="line">192.0.66.2                    github.blog</span><br><span class="line">140.82.112.6                  api.github.com</span><br><span class="line">185.199.108.133               raw.githubusercontent.com</span><br><span class="line">185.199.108.133               user-images.githubusercontent.com</span><br><span class="line">185.199.108.133               favicons.githubusercontent.com</span><br><span class="line">185.199.108.133               avatars5.githubusercontent.com</span><br><span class="line">185.199.108.133               avatars4.githubusercontent.com</span><br><span class="line">185.199.108.133               avatars3.githubusercontent.com</span><br><span class="line">185.199.108.133               avatars2.githubusercontent.com</span><br><span class="line">185.199.108.133               avatars1.githubusercontent.com</span><br><span class="line">185.199.108.133               avatars0.githubusercontent.com</span><br><span class="line">185.199.108.133               avatars.githubusercontent.com</span><br><span class="line">140.82.112.10                 codeload.github.com</span><br><span class="line">52.217.223.17                 github-cloud.s3.amazonaws.com</span><br><span class="line">52.217.199.41                 github-com.s3.amazonaws.com</span><br><span class="line">52.217.93.164                 github-production-release-asset-2e65be.s3.amazonaws.com</span><br><span class="line">52.217.174.129                github-production-user-asset-6210df.s3.amazonaws.com</span><br><span class="line">52.217.129.153                github-production-repository-file-5c1aeb.s3.amazonaws.com</span><br><span class="line">185.199.108.153               githubstatus.com</span><br><span class="line">64.71.144.202                 github.community</span><br><span class="line">23.100.27.125                 github.dev</span><br><span class="line">185.199.108.133               media.githubusercontent.com</span><br></pre></td></tr></table></figure>

<p>复制</p>
<p>修改完成后<code>esc+:wq</code>退出，然后安装一个nscd：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt install nscd</span><br><span class="line">正在读取软件包列表... 完成</span><br><span class="line">正在分析软件包的依赖关系树       </span><br><span class="line">正在读取状态信息... 完成       </span><br><span class="line">下列软件包是自动安装的并且现在不需要了：</span><br><span class="line">  libfwupdplugin1 libice6:i386 libsm6:i386 libxt6:i386 linux-headers-5.14.0-1048-oem</span><br><span class="line">  linux-image-5.14.0-1048-oem linux-modules-5.14.0-1048-oem</span><br><span class="line">  linux-oem-5.14-headers-5.14.0-1048</span><br><span class="line">使用&#x27;sudo apt autoremove&#x27;来卸载它(它们)。</span><br><span class="line">下列【新】软件包将被安装：</span><br><span class="line">  nscd</span><br><span class="line">升级了 0 个软件包，新安装了 1 个软件包，要卸载 0 个软件包，有 151 个软件包未被升级。</span><br><span class="line">需要下载 74.5 kB 的归档。</span><br><span class="line">解压缩后会消耗 463 kB 的额外空间。</span><br><span class="line">获取:1 https://mirrors.tuna.tsinghua.edu.cn/ubuntu focal-updates/universe amd64 nscd amd64 2.31-0ubuntu9.9 [74.5 kB]</span><br><span class="line">已下载 74.5 kB，耗时 1秒 (83.4 kB/s)</span><br><span class="line">正在选中未选择的软件包 nscd。</span><br><span class="line">(正在读取数据库 ... 系统当前共安装有 480631 个文件和目录。)</span><br><span class="line">准备解压 .../nscd_2.31-0ubuntu9.9_amd64.deb  ...</span><br><span class="line">正在解压 nscd (2.31-0ubuntu9.9) ...</span><br><span class="line">正在设置 nscd (2.31-0ubuntu9.9) ...</span><br><span class="line">Created symlink /etc/systemd/system/multi-user.target.wants/nscd.service → /lib/systemd/system</span><br><span class="line">/nscd.service.</span><br><span class="line">正在处理用于 man-db (2.9.1-1) 的触发器 ...</span><br><span class="line">正在处理用于 systemd (245.4-4ubuntu3.17) 的触发器 ...</span><br></pre></td></tr></table></figure>

<p>复制</p>
<p>最后再重启一下nscd服务即可：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo /etc/init.d/nscd restart</span><br><span class="line">Restarting nscd (via systemctl): nscd.service.</span><br></pre></td></tr></table></figure>

<p>复制</p>
<p>这样一波操作之后，Github就可以快速访问了</p>
<p><strong>总结概要</strong></p>
<p>在国内一些局域网下访问github.com可能会存在一些问题，甚至可能直接就无法访问。但是我们可以通过对指定的<a target="_blank" rel="noopener" href="https://cloud.tencent.com/act/pro/domain-sales?from=20065&from_column=20065">域名</a>配置一个ip地址，这样在解析的时候就会自动跳转到我们手动选取的那个可访问的节点上。虽然该方法下还是偶尔有可能出现无法访问的情况，但是总体来说还是很大程度上的改善了github.com的访问体验。</p>
<h3 id="新建用户并配置sudoers"><a href="#新建用户并配置sudoers" class="headerlink" title="新建用户并配置sudoers"></a>新建用户并配置<code>sudoers</code></h3><ol>
<li><p>进入Ubuntu容器：首先，请确保您已经进入正在运行的Ubuntu容器的交互式Shell。如果您尚未进入容器，请使用以下命令进入容器：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it my_ubuntu /bin/bash</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建rustserver用户：在Ubuntu容器内，使用以下命令创建一个名为rustserver的用户：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adduser rustserver</span><br></pre></td></tr></table></figure>

<p>您将会被提示设置rustserver用户的密码和其他相关信息。</p>
<p>输入密码后，含<code>[]</code>的可以直接空格</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230708104050272.png" alt="image-20230708104050272"></p>
</li>
<li><p>赋予sudoers权限：要赋予rustserver用户sudoers权限，您可以执行以下步骤：</p>
<p>a. 安装sudo软件包（如果尚未安装）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install sudo</span><br></pre></td></tr></table></figure>

<p>b. 编辑sudoers文件以允许rustserver用户具有sudo权限：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">visudo</span><br></pre></td></tr></table></figure>

<p>这将打开一个文本编辑器，显示sudoers文件的内容。</p>
<p>c. 在文件中找到以下行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root    ALL=(ALL:ALL) ALL</span><br></pre></td></tr></table></figure>

<p>d. 在该行下方添加以下内容，以授权rustserver用户具有sudo权限：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rustserver    ALL=(ALL:ALL) ALL</span><br></pre></td></tr></table></figure>

<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230708104253883.png" alt="image-20230708104253883"></p>
<p>e. <code>Esc :wq</code>保存并关闭文件。</p>
</li>
</ol>
<h3 id="安装lgsm"><a href="#安装lgsm" class="headerlink" title="安装lgsm"></a>安装<code>lgsm</code></h3><p>详细请参考官网：<a target="_blank" rel="noopener" href="https://linuxgsm.com/servers/rustserver/">https://linuxgsm.com/servers/rustserver/</a></p>
<p>视频教程：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1VU4y1W7sn/">https://www.bilibili.com/video/BV1VU4y1W7sn/</a></p>
<p><strong>依赖安装：</strong></p>
<p><code>Ubuntu &lt; 20.04</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dpkg --add-architecture i386; sudo apt update; sudo apt install curl wget file tar bzip2 gzip unzip bsdmainutils python3 util-linux ca-certificates binutils bc jq tmux netcat lib32gcc1 lib32stdc++6 libsdl2-2.0-0:i386 steamcmd lib32z1</span><br></pre></td></tr></table></figure>

<p>安装过程中，需要<code>tab</code>选中或者<code>enter</code>选中同意条款</p>
<p><strong>切换到<code>rustserver</code>用户操作</strong></p>
<p>备注：已配置<code>sudoers</code>权限，避免上述依赖安装不全，可自行安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 切换到rustserver用户</span></span><br><span class="line">su - rustserver</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载linuxgsm.sh，</span></span><br><span class="line">wget -O linuxgsm.sh https://linuxgsm.sh</span><br><span class="line"><span class="comment"># 如果一直的等待响应，可以`Ctrl+C`取消，然后重试几次</span></span><br><span class="line"><span class="comment"># 如果下载失败，可以用浏览器器手动下载：。若在docker容器，可以使用docker cp命令从宿主机中拷贝至容器内，并更改用户和用户组为rustserver</span></span><br></pre></td></tr></table></figure>

<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230708105813952.png" alt="image-20230708105813952"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 赋予可执行权限，并执行安装lgsm</span></span><br><span class="line"><span class="built_in">chmod</span> +x linuxgsm.sh &amp;&amp; bash linuxgsm.sh rustserver</span><br></pre></td></tr></table></figure>

<p>安装好<code>lgsm</code>后，再安装<code>rustserver</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./rustserver install</span><br></pre></td></tr></table></figure>

<p>这一步需要去<code>github</code>上拉取资源，由于国内网络原因，如果失败了，多试几次：</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230708110856950.png" alt="image-20230708110856950"></p>
<p>如果的确缺少依赖的话，使用<code>rustserver</code>安装，会提示输入下密码</p>
<p>成功界面：</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230708135600355.png" alt="image-20230708135600355"></p>
<p>最后一个协议，可以不用同意</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230708140339610.png" alt="image-20230708140339610"></p>
<p>先不着急，根据自己的实际情况，配置下服务器参数文件：</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230708141057676.png" alt="image-20230708141057676"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /home/rustserver/serverfiles/server/rustserver/cfg/server.cfg</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 可以修改服务器描述，头图，介绍网址</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  A text description of your server. For a new line add:  \n</span></span><br><span class="line">server.description <span class="string">&quot;The command-line tool for quick, simple deployment and management of Linux dedicated game servers.&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># A URL to the image which shows up on the server details screen (dimensions are 512x256).</span></span><br><span class="line">server.headerimage <span class="string">&quot;https://git.io/JYdmK&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The URL to your servers website.</span></span><br><span class="line">server.url <span class="string">&quot;https://linuxgsm.com/&quot;</span></span><br></pre></td></tr></table></figure>

<p>再进入<code>lsgm</code>的配置文件夹：</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230708141657743.png" alt="image-20230708141657743"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /home/rustserver/lgsm/config-lgsm/rustserver</span><br></pre></td></tr></table></figure>

<p>查看配置文件，里面是没有内容的</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230708141809881.png" alt="image-20230708141809881"></p>
<p>将模板文件内容写入</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> _default.cfg rustserver.cfg </span><br></pre></td></tr></table></figure>

<p>然后可以修改下内容：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#### Game Server Settings ####</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## Predefined Parameters | https://docs.linuxgsm.com/configuration/start-parameters</span></span><br><span class="line">ip=<span class="string">&quot;0.0.0.0&quot;</span></span><br><span class="line">port=<span class="string">&quot;28015&quot;</span></span><br><span class="line">rconport=<span class="string">&quot;28016&quot;</span></span><br><span class="line">appport=<span class="string">&quot;28082&quot;</span></span><br><span class="line">queryport=<span class="string">&quot;28017&quot;</span></span><br><span class="line">rconpassword=<span class="string">&quot;CHANGE_ME&quot;</span></span><br><span class="line">rconweb=<span class="string">&quot;1&quot;</span> <span class="comment"># Value is: 1 for the Facepunch web panel, Rustadmin desktop and Rustadmin Online; 0 for RCON tools like Rusty.</span></span><br><span class="line">servername=<span class="string">&quot;Rust&quot;</span></span><br><span class="line">gamemode=<span class="string">&quot;vanilla&quot;</span>           <span class="comment"># Values: vanilla, softcore ( Doc: https://wiki.facepunch.com/rust/server-gamemodes )</span></span><br><span class="line">serverlevel=<span class="string">&quot;Procedural Map&quot;</span> <span class="comment"># Values: Procedural Map, Barren, HapisIsland, SavasIsland</span></span><br><span class="line">customlevelurl=<span class="string">&quot;&quot;</span>            <span class="comment"># Custom level url. +server.levelurl \&quot;$&#123;customlevelurl&#125;\&quot;</span></span><br><span class="line">seed=<span class="string">&quot;&quot;</span>                      <span class="comment"># range: 1-2147483647, used to reproduce a procedural map.</span></span><br><span class="line">salt=<span class="string">&quot;&quot;</span>                      <span class="comment"># range: unknown, used to recover a known setting from an existing map.</span></span><br><span class="line">maxplayers=<span class="string">&quot;50&quot;</span></span><br><span class="line">worldsize=<span class="string">&quot;3000&quot;</span>   <span class="comment"># default: 3000, range: 1000-6000, map size in meters.</span></span><br><span class="line">saveinterval=<span class="string">&quot;300&quot;</span> <span class="comment"># Auto-save in seconds.</span></span><br><span class="line">tickrate=<span class="string">&quot;30&quot;</span>      <span class="comment"># default: 30, range: 15-100.</span></span><br></pre></td></tr></table></figure>

<p>可以修改下<code>rconpassword</code></p>
<p>保存退出后，<code>cd</code>直接返回根目录</p>
<h3 id="安装oxide插件"><a href="#安装oxide插件" class="headerlink" title="安装oxide插件"></a>安装<code>oxide</code>插件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /home/rustserver</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装oxide插件</span></span><br><span class="line">./rustserver mods-install</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输入rustoxide，回车</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230708144620720.png" alt="image-20230708144620720"></p>
<p>等待下载完毕，就可以启动服务器了</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.rustserver start</span><br></pre></td></tr></table></figure>



<h1 id="Docker复杂安装详说"><a href="#Docker复杂安装详说" class="headerlink" title="Docker复杂安装详说"></a><code>Docker</code>复杂安装详说</h1><h2 id="安装mysql主从复制"><a href="#安装mysql主从复制" class="headerlink" title="安装mysql主从复制"></a>安装mysql主从复制</h2><p>主从复制原理：默认你懂</p>
<p><strong>新建主服务器容器实例3307</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 3307:3306 --name mysql-master \</span><br><span class="line">-v /mydata/mysql-master/log:/var/log/mysql \</span><br><span class="line">-v /mydata/mysql-master/data:/var/lib/mysql \</span><br><span class="line">-v /mydata/mysql-master/conf:/etc/mysql \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=root  \</span><br><span class="line">-d mysql:5.7</span><br></pre></td></tr></table></figure>

<p>进入<code>/mydata/mysql-master/conf</code>目录下新建my.cnf</p>
<p><code>vim my.cnf</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line"><span class="comment">## 设置server_id，同一局域网中需要唯一</span></span><br><span class="line">server_id=101 </span><br><span class="line"><span class="comment">## 指定不需要同步的数据库名称</span></span><br><span class="line">binlog-ignore-db=mysql  </span><br><span class="line"><span class="comment">## 开启二进制日志功能</span></span><br><span class="line">log-bin=mall-mysql-bin  </span><br><span class="line"><span class="comment">## 设置二进制日志使用内存大小（事务）</span></span><br><span class="line">binlog_cache_size=1M  </span><br><span class="line"><span class="comment">## 设置使用的二进制日志格式（mixed,statement,row）</span></span><br><span class="line">binlog_format=mixed  </span><br><span class="line"><span class="comment">## 二进制日志过期清理时间。默认值为0，表示不自动清理。</span></span><br><span class="line">expire_logs_days=7  </span><br><span class="line"><span class="comment">## 跳过主从复制中遇到的所有错误或指定类型的错误，避免slave端复制中断。</span></span><br><span class="line"><span class="comment">## 如：1062错误是指一些主键重复，1032错误是因为主从数据库数据不一致</span></span><br><span class="line">slave_skip_errors=1062</span><br></pre></td></tr></table></figure>

<p>修改完配置后重启master实例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker restart mysql-master</span><br></pre></td></tr></table></figure>

<p>进入mysql-master容器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it mysql-master /bin/bash</span><br><span class="line"></span><br><span class="line">mysql -uroot -proot</span><br></pre></td></tr></table></figure>

<p>master容器实例内创建数据同步用户</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;slave&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">GRANT</span> REPLICATION SLAVE, REPLICATION CLIENT <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;slave&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br></pre></td></tr></table></figure>



<p><strong>新建从服务器容器实例3308</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 3308:3306 --name mysql-slave \</span><br><span class="line">-v /mydata/mysql-slave/log:/var/log/mysql \</span><br><span class="line">-v /mydata/mysql-slave/data:/var/lib/mysql \</span><br><span class="line">-v /mydata/mysql-slave/conf:/etc/mysql \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=root  \</span><br><span class="line">-d mysql:5.7</span><br></pre></td></tr></table></figure>

<p>进入<code>/mydata/mysql-slave/conf</code>目录下新建my.cnf</p>
<p>vim my.cnf</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line"><span class="comment">## 设置server_id，同一局域网中需要唯一</span></span><br><span class="line">server_id=102</span><br><span class="line"><span class="comment">## 指定不需要同步的数据库名称</span></span><br><span class="line">binlog-ignore-db=mysql  </span><br><span class="line"><span class="comment">## 开启二进制日志功能，以备Slave作为其它数据库实例的Master时使用</span></span><br><span class="line">log-bin=mall-mysql-slave1-bin  </span><br><span class="line"><span class="comment">## 设置二进制日志使用内存大小（事务）</span></span><br><span class="line">binlog_cache_size=1M  </span><br><span class="line"><span class="comment">## 设置使用的二进制日志格式（mixed,statement,row）</span></span><br><span class="line">binlog_format=mixed  </span><br><span class="line"><span class="comment">## 二进制日志过期清理时间。默认值为0，表示不自动清理。</span></span><br><span class="line">expire_logs_days=7  </span><br><span class="line"><span class="comment">## 跳过主从复制中遇到的所有错误或指定类型的错误，避免slave端复制中断。</span></span><br><span class="line"><span class="comment">## 如：1062错误是指一些主键重复，1032错误是因为主从数据库数据不一致</span></span><br><span class="line">slave_skip_errors=1062  </span><br><span class="line"><span class="comment">## relay_log配置中继日志</span></span><br><span class="line">relay_log=mall-mysql-relay-bin  </span><br><span class="line"><span class="comment">## log_slave_updates表示slave将复制事件写进自己的二进制日志</span></span><br><span class="line">log_slave_updates=1  </span><br><span class="line"><span class="comment">## slave设置为只读（具有super权限的用户除外）</span></span><br><span class="line">read_only=1</span><br></pre></td></tr></table></figure>

<p>修改完配置后重启slave实例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker restart mysql-slave</span><br></pre></td></tr></table></figure>

<p>在主数据库中查看主从同步状态</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> master status;</span><br></pre></td></tr></table></figure>

<p>进入mysql-slave容器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it mysql-slave /bin/bash</span><br><span class="line">mysql -uroot -proot</span><br></pre></td></tr></table></figure>

<p>在从数据库中配置主从复制</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">change master <span class="keyword">to</span> master_host<span class="operator">=</span><span class="string">&#x27;宿主机ip&#x27;</span>, master_user<span class="operator">=</span><span class="string">&#x27;slave&#x27;</span>, master_password<span class="operator">=</span><span class="string">&#x27;123456&#x27;</span>, master_port<span class="operator">=</span><span class="number">3307</span>, master_log_file<span class="operator">=</span><span class="string">&#x27;mall-mysql-bin.000001&#x27;</span>, master_log_pos<span class="operator">=</span><span class="number">617</span>, master_connect_retry<span class="operator">=</span><span class="number">30</span>;</span><br></pre></td></tr></table></figure>

<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230221163200529.png" alt="image-20230221163200529"></p>
<p>主从复制命令参数说明</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">master_host：主数据库的IP地址；</span><br><span class="line">master_port：主数据库的运行端口；</span><br><span class="line">master_user：在主数据库创建的用于同步数据的用户账号；</span><br><span class="line">master_password：在主数据库创建的用于同步数据的用户密码；</span><br><span class="line">master_log_file：指定从数据库要复制数据的日志文件，通过查看主数据的状态，获取File参数；</span><br><span class="line">master_log_pos：指定从数据库从哪个位置开始复制数据，通过查看主数据的状态，获取Position参数；</span><br><span class="line">master_connect_retry：连接失败重试的时间间隔，单位为秒。</span><br></pre></td></tr></table></figure>

<p>在从数据库中查看主从同步状态</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> slave status \G;</span><br></pre></td></tr></table></figure>

<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230221163107367.png" alt="image-20230221163107367"></p>
<p>在从数据库中开启主从同步</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230221163504285.png" alt="image-20230221163504285"></p>
<p>查看从数据库状态发现已经同步</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230221165041005.png" alt="image-20230221165041005"></p>
<p>主从复制测试</p>
<ul>
<li><p>主机新建库-使用库-新建表-插入数据，ok</p>
</li>
<li><p>从机使用库-查看记录，ok</p>
</li>
</ul>
<h2 id="安装redis集群"><a href="#安装redis集群" class="headerlink" title="安装redis集群"></a>安装redis集群</h2><p>大厂面试题第4季-分布式存储案例真题</p>
<p>cluster(集群)模式-docker版 哈希槽分区进行亿级数据存储</p>
<ul>
<li><p>面试题</p>
<p>1~2亿条数据需要缓存，请问如何设计这个存储案例</p>
</li>
<li><p>回答</p>
<p>单机单台100%不可能，肯定是分布式存储，用redis如何落地？</p>
</li>
</ul>
<p>上述问题阿里P6~P7工程案例和场景设计类必考题目， 一般业界有3种解决方案</p>
<h3 id="哈希取余分区"><a href="#哈希取余分区" class="headerlink" title="哈希取余分区"></a>哈希取余分区</h3><p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230222101151726.png" alt="image-20230222101151726"></p>
<p>2亿条记录就是2亿个k,v，我们单机不行必须要分布式多机，假设有3台机器构成一个集群，用户每次读写操作都是根据公式：</p>
<p>hash(key) % N个机器台数，计算出哈希值，用来决定数据映射到哪一个节点上。</p>
<p><strong>优点</strong>：</p>
<p>简单粗暴，直接有效，只需要预估好数据规划好节点，例如3台、8台、10台，就能保证一段时间的数据支撑。使用Hash算法让固定的一部分请求落到同一台服务器上，这样每台服务器固定处理一部分请求（并维护这些请求的信息），起到负载均衡+分而治之的作用。</p>
<p><strong>缺点</strong>：</p>
<p>原来规划好的节点，进行扩容或者缩容就比较麻烦了额，不管扩缩，每次数据变动导致节点有变动，映射关系需要重新进行计算，在服务器个数固定不变时没有问题，如果需要弹性扩容或故障停机的情况下，原来的取模公式就会发生变化：Hash(key)&#x2F;3会变成Hash(key) &#x2F;?。此时地址经过取余运算的结果将发生很大变化，根据公式获取的服务器也会变得不可控。</p>
<p>某个redis机器宕机了，由于台数数量变化，会导致hash取余全部数据重新洗牌。</p>
<h3 id="一致性哈希算法分区"><a href="#一致性哈希算法分区" class="headerlink" title="一致性哈希算法分区"></a>一致性哈希算法分区</h3><p>一致性Hash算法背景：一致性哈希算法在1997年由麻省理工学院中提出的，设计目标是为了解决<strong>分布式缓存数据变动和映射问题，某个机器宕机了，分母数量改变了，自然取余数不OK了。</strong></p>
<p>能干嘛：提出一致性Hash解决方案。 目的是当服务器个数发生变动时， 尽量减少影响客户端到服务器的映射关系</p>
<p>算法构建一致性哈希环</p>
<p>一致性哈希环</p>
<p>一致性哈希算法必然有个hash函数并按照算法产生hash值，这个算法的所有可能哈希值会构成一个全量集，这个集合可以成为一个hash空间[0,2^32-1]，这个是一个线性空间，但是在算法中，我们通过适当的逻辑控制将它首尾相连(0 &#x3D; 2^32),这样让它逻辑上形成了一个环形空间。</p>
<p>它也是按照使用取模的方法，前面笔记介绍的节点取模法是对节点（服务器）的数量进行取模。而一致性Hash算法是对2^32取模，简单来说，一致性Hash算法将整个哈希值空间组织成一个虚拟的圆环，如假设某哈希函数H的值空间为0-2^32-1（即哈希值是一个32位无符号整型），整个哈希环如下图：整个空间按顺时针方向组织，圆环的正上方的点代表0，0点右侧的第一个点代表1，以此类推，2、3、4、……直到2^32-1，也就是说0点左侧的第一个点代表2^32-1， 0和2^32-1在零点中方向重合，我们把这个由2^32个点组成的圆环称为Hash环。</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230222102401843.png" alt="image-20230222102401843"></p>
<p>服务器IP节点映射</p>
<p>节点映射</p>
<p> 将集群中各个IP节点映射到环上的某一个位置。</p>
<p>将各个服务器使用Hash进行一个哈希，具体可以选择服务器的IP或主机名作为关键字进行哈希，这样每台机器就能确定其在哈希环上的位置。假如4个节点NodeA、B、C、D，经过IP地址的哈希函数计算(hash(ip))，使用IP地址哈希后在环空间的位置如下：</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230222102521821.png" alt="image-20230222102521821"></p>
<p>key落到服务器的落键规则</p>
<p>当我们需要存储一个kv键值对时，首先计算key的hash值，hash(key)，将这个key使用相同的函数Hash计算出哈希值并确定此数据在环上的位置，<strong>从此位置沿环顺时针行走</strong>，第一台遇到的服务器就是其应该定位到的服务器，并将该键值对存储在该节点上。</p>
<p>如我们有Object A、Object B、Object C、Object D四个数据对象，经过哈希计算后，在环空间上的位置如下：根据一致性Hash算法，数据A会被定为到Node A上，B被定为到Node B上，C被定为到Node C上，D被定为到Node D上。</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230222102643831.png" alt="image-20230222102643831"></p>
<p><strong>优点</strong></p>
<p>一致性哈希算法的<strong>容错性</strong></p>
<p>容错性</p>
<p>假设Node C宕机，可以看到此时对象A、B、D不会受到影响，只有C对象被重定位到Node D。一般的，在一致性Hash算法中，如果一台服务器不可用，则受影响的数据仅仅是此服务器到其环空间中前一台服务器（即沿着逆时针方向行走遇到的第一台服务器）之间数据，其它不会受到影响。简单说，就是C挂了，受到影响的只是B、C之间的数据，并且这些数据会转移到D进行存储。</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230222102807097.png" alt="image-20230222102807097"></p>
<p>一致性哈希算法的<strong>扩展性</strong></p>
<p>扩展性</p>
<p>数据量增加了，需要增加一台节点NodeX，X的位置在A和B之间，那收到影响的也就是A到X之间的数据，重新把A到X的数据录入到X上即可，</p>
<p>不会导致hash取余全部数据重新洗牌。</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230222102839637.png" alt="image-20230222102839637"></p>
<p><strong>缺点</strong></p>
<p>一致性哈希算法的数据倾斜问题</p>
<p>Hash环的数据倾斜问题</p>
<p>一致性Hash算法在服务<strong>节点太少</strong>时，容易因为节点分布不均匀而造成数据倾斜（被缓存的对象大部分集中缓存在某一台服务器上）问题</p>
<p>例如系统中只有两台服务器：</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230222103240873.png" alt="image-20230222103240873"></p>
<p><strong>小总结</strong></p>
<p>为了在节点数目发生改变时尽可能少的迁移数据</p>
<p>将所有的存储节点排列在收尾相接的Hash环上，每个key在计算Hash后会顺时针找到临近的存储节点存放。</p>
<p>而当有节点加入或退出时仅影响该节点在Hash环上顺时针相邻的后续节点。 </p>
<p>优点</p>
<p>加入和删除节点只影响哈希环中顺时针方向的相邻的节点，对其他节点无影响。</p>
<p>缺点 </p>
<p>数据的分布和节点的位置有关，因为这些节点不是均匀的分布在哈希环上的，所以数据在进行存储时达不到均匀分布的效果。</p>
<h3 id="哈希槽分区"><a href="#哈希槽分区" class="headerlink" title="哈希槽分区"></a>哈希槽分区</h3><p><strong>为什么出现</strong>：解决一致性哈希算法的数据倾斜问题</p>
<p>哈希槽实质就是一个数组，数组[0,2^14 -1]形成hash slot空间。</p>
<p><strong>能干什么</strong>：解决均匀分配的问题，在数据和节点之间又加入了一层，把这层称为哈希槽（slot），用于管理数据和节点之间的关系，现在就相当于节点上放的是槽，槽里放的是数据。</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230222103538878.png" alt="image-20230222103538878"></p>
<p>槽解决的是粒度问题，相当于把粒度变大了，这样便于数据移动。</p>
<p>哈希解决的是映射问题，使用key的哈希值来计算所在的槽，便于数据分配。</p>
<p><strong>多少个hash槽</strong>：一个集群只能有16384个槽，编号0-16383（0-2^14-1）。这些槽会分配给集群中的所有主节点，分配策略没有要求。可以指定哪些编号的槽分配给哪个主节点。集群会记录节点和槽的对应关系。解决了节点和槽的关系后，接下来就需要对key求哈希值，然后对16384取余，余数是几key就落入对应的槽里。slot &#x3D; CRC16(key) % 16384。以槽为单位移动数据，因为槽的数目是固定的，处理起来比较容易，这样数据移动问题就解决了。</p>
<p>哈希槽计算</p>
<p>Redis 集群中内置了 16384 个哈希槽，redis 会根据节点数量大致均等的将哈希槽映射到不同的节点。当需要在 Redis 集群中放置一个 key-value时，redis 先对 key 使用 crc16 算法算出一个结果，然后把结果对 16384 求余数，这样每个 key 都会对应一个编号在 0-16383 之间的哈希槽，也就是映射到某个节点上。如下代码，key之A 、B在Node2， key之C落在Node3上</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230222103747768.png" alt="image-20230222103747768"></p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230222103759159.png" alt="image-20230222103759159"></p>
<h3 id="3主3从redis集群搭建"><a href="#3主3从redis集群搭建" class="headerlink" title="3主3从redis集群搭建"></a>3主3从redis集群搭建</h3><p>关闭防火墙+启动docker后台服务</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start docker</span><br></pre></td></tr></table></figure>

<p>新建6个docker容器redis实例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name redis-node-1 --net host --privileged=<span class="literal">true</span> -v /data/redis/share/redis-node-1:/data redis:6.0.8 --cluster-enabled <span class="built_in">yes</span> --appendonly <span class="built_in">yes</span> --port 6381</span><br><span class="line"> </span><br><span class="line">docker run -d --name redis-node-2 --net host --privileged=<span class="literal">true</span> -v /data/redis/share/redis-node-2:/data redis:6.0.8 --cluster-enabled <span class="built_in">yes</span> --appendonly <span class="built_in">yes</span> --port 6382</span><br><span class="line"> </span><br><span class="line">docker run -d --name redis-node-3 --net host --privileged=<span class="literal">true</span> -v /data/redis/share/redis-node-3:/data redis:6.0.8 --cluster-enabled <span class="built_in">yes</span> --appendonly <span class="built_in">yes</span> --port 6383</span><br><span class="line"> </span><br><span class="line">docker run -d --name redis-node-4 --net host --privileged=<span class="literal">true</span> -v /data/redis/share/redis-node-4:/data redis:6.0.8 --cluster-enabled <span class="built_in">yes</span> --appendonly <span class="built_in">yes</span> --port 6384</span><br><span class="line"> </span><br><span class="line">docker run -d --name redis-node-5 --net host --privileged=<span class="literal">true</span> -v /data/redis/share/redis-node-5:/data redis:6.0.8 --cluster-enabled <span class="built_in">yes</span> --appendonly <span class="built_in">yes</span> --port 6385</span><br><span class="line"> </span><br><span class="line">docker run -d --name redis-node-6 --net host --privileged=<span class="literal">true</span> -v /data/redis/share/redis-node-6:/data redis:6.0.8 --cluster-enabled <span class="built_in">yes</span> --appendonly <span class="built_in">yes</span> --port 6386</span><br></pre></td></tr></table></figure>

<p>参数解释</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">docker run</span><br><span class="line">创建并运行docker容器实例</span><br><span class="line"></span><br><span class="line">--name redis-node-6</span><br><span class="line">容器名字</span><br><span class="line"></span><br><span class="line">--net host</span><br><span class="line">使用宿主机的IP和端口，默认</span><br><span class="line"></span><br><span class="line">--privileged=true</span><br><span class="line">获取宿主机root用户权限</span><br><span class="line"></span><br><span class="line">-v /data/redis/share/redis-node-6:/data</span><br><span class="line">容器卷，宿主机地址:docker内部地址</span><br><span class="line"></span><br><span class="line">redis:6.0.8</span><br><span class="line">redis镜像和版本号</span><br><span class="line"></span><br><span class="line">--cluster-enabled yes</span><br><span class="line">开启redis集群</span><br><span class="line"></span><br><span class="line">--appendonly yes</span><br><span class="line">开启持久化</span><br><span class="line"></span><br><span class="line">--port 6386</span><br><span class="line">redis端口号</span><br></pre></td></tr></table></figure>

<p>进入容器redis-node-1并为6台机器构建集群关系</p>
<p>进入容器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it redis-node-1 /bin/bash</span><br></pre></td></tr></table></figure>

<p>构建主从关系</p>
<p>注意，进入docker容器后才能执行一下命令，且注意自己的真实IP地址</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli --cluster create 192.168.111.147:6381 192.168.111.147:6382 192.168.111.147:6383 192.168.111.147:6384 192.168.111.147:6385 192.168.111.147:6386 --cluster-replicas 1</span><br></pre></td></tr></table></figure>

<p>参数解释</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--cluster-replicas 1 表示为每个master创建一个slave节点</span><br></pre></td></tr></table></figure>

<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230222141815584.png" alt="image-20230222141815584"></p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230222141652168.png" alt="image-20230222141652168"></p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230222141826705.png" alt="image-20230222141826705"></p>
<p>一切OK的话，3主3从搞定</p>
<p>链接进入6381作为切入点，查看集群状态</p>
<p>链接进入6381作为切入点，查看节点状态</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230222142253071.png" alt="image-20230222142253071"></p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230222142601848.png" alt="image-20230222142601848"></p>
<h3 id="数据读写存储"><a href="#数据读写存储" class="headerlink" title="数据读写存储"></a>数据读写存储</h3><p>启动6机构成的集群并通过exec进入</p>
<p>对6381新增两个key</p>
<p>防止路由失效加参数-c并新增两个key</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230222143754833.png" alt="image-20230222143754833"></p>
<p>集群环境，加入参数-c，优化路由</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230222143935764.png" alt="image-20230222143935764"></p>
<h3 id="查看集群信息"><a href="#查看集群信息" class="headerlink" title="查看集群信息"></a>查看集群信息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli --cluster check 192.168.111.147:6381</span><br></pre></td></tr></table></figure>

<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230222144414260.png" alt="image-20230222144414260"></p>
<h3 id="容错切换迁移"><a href="#容错切换迁移" class="headerlink" title="容错切换迁移"></a>容错切换迁移</h3><p>主6381和从机切换，先停止主机6381<br>6381主机停了，对应的真实从机上位<br>6381作为1号主机分配的从机以实际情况为准，具体是几号机器就是几号<br>再次查看集群信息</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230222145518421.png" alt="image-20230222145518421"></p>
<p>6381宕机了，6385上位成为了新的master。</p>
<p>每次案例下面挂的从机以实际情况为准，具体是几号机器就是几号</p>
<p>还原之前的3主3从</p>
<p>先启6381</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker start redis-node-1</span><br></pre></td></tr></table></figure>

<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230222150107424.png" alt="image-20230222150107424"></p>
<p>redis-node-1启动后，不会变成master</p>
<h3 id="主从扩容案例"><a href="#主从扩容案例" class="headerlink" title="主从扩容案例"></a>主从扩容案例</h3><p>新建6387、6388两个节点+新建后启动+查看是否8节点</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name redis-node-7 --net host --privileged=<span class="literal">true</span> -v /data/redis/share/redis-node-7:/data redis:6.0.8 --cluster-enabled <span class="built_in">yes</span> --appendonly <span class="built_in">yes</span> --port 6387</span><br><span class="line"></span><br><span class="line">docker run -d --name redis-node-8 --net host --privileged=<span class="literal">true</span> -v /data/redis/share/redis-node-8:/data redis:6.0.8 --cluster-enabled <span class="built_in">yes</span> --appendonly <span class="built_in">yes</span> --port 6388</span><br><span class="line"></span><br><span class="line">docker ps</span><br></pre></td></tr></table></figure>

<p>进入6387容器实例内部</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it redis-node-7 /bin/bash</span><br></pre></td></tr></table></figure>

<p>将新增的6387节点(空槽号)作为master节点加入原集群</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">redis-cli --cluster add-node 自己实际IP地址:6387 自己实际IP地址:6381</span><br><span class="line"></span><br><span class="line">6387 就是将要作为master新增节点</span><br><span class="line"></span><br><span class="line">6381 就是原来集群节点里面的领路人，相当于6387拜拜6381的码头从而找到组织加入集群</span><br></pre></td></tr></table></figure>

<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230222150819980.png" alt="image-20230222150819980"></p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230222150846256.png" alt="image-20230222150846256"></p>
<p>检查集群情况第1次</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli --cluster check 真实ip地址:6381</span><br></pre></td></tr></table></figure>

<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230222151016577.png" alt="image-20230222151016577"></p>
<p>重新分派槽号</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">命令:redis-cli --cluster reshard IP地址:端口号</span><br><span class="line"></span><br><span class="line">redis-cli --cluster reshard 192.168.111.147:6381</span><br></pre></td></tr></table></figure>

<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230222151327617.png" alt="image-20230222151327617"></p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230222151405413.png" alt="image-20230222151405413"></p>
<p>检查集群情况第2次</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli --cluster check 真实ip地址:6381</span><br></pre></td></tr></table></figure>

<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230222151605365.png" alt="image-20230222151605365"></p>
<p>槽号分派说明</p>
<p>为什么6387是3个新的区间，以前的还是连续？</p>
<p>重新分配成本太高，所以前3家各自匀出来一部分，从6381&#x2F;6382&#x2F;6383三个旧节点分别匀出1364个坑位给新节点6387</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230222151637168.png" alt="image-20230222151637168"></p>
<p>为主节点6387分配从节点6388</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">命令：redis-cli --cluster add-node ip:新slave端口 ip:新master端口 --cluster-slave --cluster-master-id 新主机节点ID</span><br><span class="line"> </span><br><span class="line">redis-cli --cluster add-node 192.168.111.147:6388 192.168.111.147:6387 --cluster-slave --cluster-master-id e4781f644d4a4e4d4b4d107157b9ba8144631451-------这个是6387的编号，按照自己实际情况</span><br></pre></td></tr></table></figure>

<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230222151717708.png" alt="image-20230222151717708"></p>
<p>检查集群情况第3次</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli --cluster check 192.168.111.147:6382</span><br></pre></td></tr></table></figure>

<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230222151756856.png" alt="image-20230222151756856"></p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230222151804498.png" alt="image-20230222151804498"></p>
<h3 id="主从缩容案例"><a href="#主从缩容案例" class="headerlink" title="主从缩容案例"></a>主从缩容案例</h3><p>6387和6388下线</p>
<p>检查集群情况1获得6388的节点ID</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli --cluster check 192.168.111.147:6382</span><br></pre></td></tr></table></figure>

<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230222152356564.png" alt="image-20230222152356564"></p>
<p>将6388删除 从集群中将4号从节点6388删除</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">命令：redis-cli --cluster del-node ip:从机端口 从机6388节点ID</span><br><span class="line"> </span><br><span class="line">redis-cli --cluster del-node 192.168.111.147:6388 5d149074b7e57b802287d1797a874ed7a1a284a8</span><br></pre></td></tr></table></figure>

<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230222152507876.png" alt="image-20230222152507876"></p>
<p>检查一下发现，6388被删除了，只剩下7台机器了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli --cluster check 192.168.111.147:6382</span><br></pre></td></tr></table></figure>

<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230222152603117.png" alt="image-20230222152603117"></p>
<p>将6387的槽号清空，重新分配，本例将清出来的槽号都给6381</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli --cluster reshard 192.168.111.147:6381</span><br></pre></td></tr></table></figure>

<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230222152823738.png" alt="image-20230222152823738"></p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230222152837071.png" alt="image-20230222152837071"></p>
<p>检查集群情况第二次</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redis-cli --cluster check 192.168.111.147:6381</span><br><span class="line"> </span><br><span class="line">4096个槽位都指给6381，它变成了8192个槽位，相当于全部都给6381了，不然要输入3次，一锅端</span><br></pre></td></tr></table></figure>

<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230222153047950.png" alt="image-20230222153047950"></p>
<p>将6387删除</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">命令：redis-cli --cluster del-node ip:端口 6387节点ID</span><br><span class="line"> </span><br><span class="line">redis-cli --cluster del-node 192.168.111.147:6387 e4781f644d4a4e4d4b4d107157b9ba8144631451</span><br></pre></td></tr></table></figure>

<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230222153350496.png" alt="image-20230222153350496"></p>
<p>检查集群情况第三次</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli --cluster check 192.168.111.147:6381</span><br></pre></td></tr></table></figure>

<p><img src="/image-20230222153420448.png" alt="image-20230222153420448"></p>
<h1 id="DockerFile解析"><a href="#DockerFile解析" class="headerlink" title="DockerFile解析"></a><code>DockerFile</code>解析</h1><h2 id="是什么"><a href="#是什么" class="headerlink" title="是什么"></a>是什么</h2><p>Dockerfile是用来构建Docker镜像的文本文件，是由<strong>一条条</strong>构建镜像所需的指令和参数构成的脚本。</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230222153532295.png" alt="image-20230222153532295"></p>
<p><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/builder/">https://docs.docker.com/engine/reference/builder/</a></p>
<p>构建三步骤</p>
<ul>
<li>编写Dockerfile文件</li>
<li><code>docker build</code>命令构建镜像</li>
<li><code>docker run</code>依镜像运行容器实例</li>
</ul>
<h2 id="DockerFile构建过程解析"><a href="#DockerFile构建过程解析" class="headerlink" title="DockerFile构建过程解析"></a>DockerFile构建过程解析</h2><p>Dockerfile内容基础知识</p>
<p>1：每条保留字指令都必须为大写字母且后面要跟随至少一个参数</p>
<p>2：指令按照从上到下，顺序执行</p>
<p>3：#表示注释</p>
<p>4：每条指令都会创建一个新的镜像层并对镜像进行提交</p>
<p>Docker执行Dockerfile的大致流程</p>
<p>（1）docker从基础镜像运行一个容器</p>
<p>（2）执行一条指令并对容器作出修改</p>
<p>（3）执行类似docker commit的操作提交一个新的镜像层</p>
<p>（4）docker再基于刚提交的镜像运行一个新容器</p>
<p>（5）执行dockerfile中的下一条指令直到所有指令都执行完成</p>
<p>小总结</p>
<p>从应用软件的角度来看，Dockerfile、Docker镜像与Docker容器分别代表软件的三个不同阶段，</p>
<ul>
<li>Dockerfile是软件的原材料</li>
<li>Docker镜像是软件的交付品</li>
<li>Docker容器则可以认为是软件镜像的运行态，也即依照镜像运行的容器实例<br>  Dockerfile面向开发，Docker镜像成为交付标准，Docker容器则涉及部署与运维，三者缺一不可，合力充当Docker体系的基石。</li>
</ul>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230222160912490.png" alt="image-20230222160912490"></p>
<p>1 Dockerfile，需要定义一个Dockerfile，Dockerfile定义了进程需要的一切东西。Dockerfile涉及的内容包括执行代码或者是文件、环境变量、依赖包、运行时环境、动态链接库、操作系统的发行版、服务进程和内核进程(当应用进程需要和系统服务和内核进程打交道，这时需要考虑如何设计namespace的权限控制)等等;</p>
<p>2 Docker镜像，在用Dockerfile定义一个文件之后，docker build时会产生一个Docker镜像，当运行 Docker镜像时会真正开始提供服务;</p>
<p>3 Docker容器，容器是直接提供服务的。</p>
<h2 id="DockerFile常用保留字指令"><a href="#DockerFile常用保留字指令" class="headerlink" title="DockerFile常用保留字指令"></a>DockerFile常用保留字指令</h2><ul>
<li><p>参考tomcat8的dockerfile入门</p>
<p><a target="_blank" rel="noopener" href="https://github.com/docker-library/tomcat">https://github.com/docker-library/tomcat</a></p>
</li>
<li><p>FROM</p>
<p>基础镜像，当前新镜像是基于哪个镜像的，指定一个已经存在的镜像作为模板，第一条必须是from</p>
</li>
<li><p>MAINTAINER</p>
<p>镜像维护者的姓名和邮箱地址</p>
</li>
<li><p>RUN</p>
<p>容器构建时需要运行的命令</p>
<p>两种格式</p>
<ul>
<li><p>shell格式</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230222161149757.png" alt="image-20230222161149757"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RUN yum -y install vim</span><br></pre></td></tr></table></figure>
</li>
<li><p>exec格式</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230222162024964.png" alt="image-20230222162024964"></p>
</li>
</ul>
<p>RUN是在 docker build时运行</p>
</li>
<li><p>EXPOSE</p>
<p>当前容器对外暴露出的端口</p>
</li>
<li><p>WORKDIR</p>
<p>指定在创建容器后，终端默认登陆的进来工作目录，一个落脚点</p>
</li>
<li><p>USER</p>
<p>指定该镜像以什么样的用户去执行，如果都不指定，默认是root</p>
</li>
<li><p>ENV</p>
<p>用来在构建镜像过程中设置环境变量</p>
<p><code>ENV MY_PATH /usr/mytest</code></p>
<p>这个环境变量可以在后续的任何RUN指令中使用，这就如同在命令前面指定了环境变量前缀一样；</p>
<p>也可以在其它指令中直接使用这些环境变量，</p>
<p>比如：<code>WORKDIR $MY_PATH</code></p>
</li>
<li><p>ADD</p>
<p>将宿主机目录下的文件拷贝进镜像且会自动处理URL和解压tar压缩包</p>
</li>
<li><p>COPY</p>
<p>类似ADD，拷贝文件和目录到镜像中。 将从构建上下文目录中 &lt;源路径&gt; 的文件&#x2F;目录复制到新的一层的镜像内的 &lt;目标路径&gt; 位置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">COPY src dest</span><br><span class="line"></span><br><span class="line">COPY [&quot;src&quot;, &quot;dest&quot;]</span><br></pre></td></tr></table></figure>

<p><code>&lt;src源路径&gt;</code>：源文件或者源目录</p>
<p><code>&lt;dest目标路径&gt;</code>：容器内的指定路径，该路径不用事先建好，路径不存在的话，会自动创建。</p>
</li>
<li><p>VOLUME</p>
<p>容器数据卷，用于数据保存和持久化工作</p>
</li>
<li><p>CMD<br>指定容器启动后的要干的事情</p>
<p><img src="/image-20230222163447354.png" alt="image-20230222163447354"></p>
<p>注意</p>
<p>Dockerfile 中可以有多个 CMD 指令，但只有最后一个生效，CMD 会被 <code>docker run</code> 之后的参数替换</p>
<p>参考官网Tomcat的dockerfile演示讲解</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230222163239331.png" alt="image-20230222163239331"></p>
<p>演示自己的覆盖操作，覆盖了启动命令</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230222170406526.png" alt="image-20230222170406526"></p>
<p>它和前面RUN命令的区别</p>
<p>CMD是在docker run 时运行。</p>
<p>RUN是在 docker build时运行。</p>
</li>
<li><p>ENTRYPOINT</p>
<p>也是用来指定一个容器启动时要运行的命令</p>
<p>类似于 CMD 指令，但是ENTRYPOINT不会被docker run后面的命令覆盖， 而且这些命令行参数会被当作参数送给 ENTRYPOINT 指</p>
<p>令指定的程序</p>
<p>命令格式和案例说明</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230222170952503.png" alt="image-20230222170952503"></p>
<p>ENTRYPOINT可以和CMD一起用，一般是变参才会使用 CMD ，这里的 CMD 等于是在给 ENTRYPOINT 传参。</p>
<p>当指定了ENTRYPOINT后，CMD的含义就发生了变化，不再是直接运行其命令而是将CMD的内容作为参数传递给ENTRYPOINT指令，他两个组合会变成<code>&lt;ENTRYPOINT&gt; &quot;&lt;CMD&gt;&quot;</code></p>
<p>案例如下：假设已通过 Dockerfile 构建了 nginx:test 镜像：</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230222171105673.png" alt="image-20230222171105673"></p>
<table>
<thead>
<tr>
<th>是否传参</th>
<th>按照dockerfile编写执行</th>
<th>传参运行</th>
</tr>
</thead>
<tbody><tr>
<td>Docker命令</td>
<td><code>docker run nginx:test</code></td>
<td><code>docker run nginx:test -c /etc/nginx/new.conf</code></td>
</tr>
<tr>
<td>衍生出的实际命令</td>
<td><code>nginx -c /etc/nginx/nginx.conf</code></td>
<td><code>nginx -c /etc/nginx/new.conf</code></td>
</tr>
</tbody></table>
<p>优点：在执行docker run的时候可以指定 ENTRYPOINT 运行所需的参数。</p>
<p>注意：如果 Dockerfile 中如果存在多个 ENTRYPOINT 指令，仅最后一个生效。</p>
</li>
</ul>
<h2 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h2><h3 id="要求"><a href="#要求" class="headerlink" title="要求"></a>要求</h3><p>Centos7镜像具备<code>vim+ifconfig+jdk8</code></p>
<p>JDK的下载镜像地址，官网下载地址：</p>
<p><a target="_blank" rel="noopener" href="https://www.oracle.com/java/technologies/downloads/#java8">https://www.oracle.com/java/technologies/downloads/#java8</a></p>
<p><a target="_blank" rel="noopener" href="https://mirrors.yangxingzhen.com/jdk/">https://mirrors.yangxingzhen.com/jdk/</a></p>
<h3 id="编写"><a href="#编写" class="headerlink" title="编写"></a>编写</h3><p>准备编写Dockerfile文件（大写）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">FROM centos</span><br><span class="line">MAINTAINER zzyy&lt;zzyybs@126.com&gt;</span><br><span class="line"> </span><br><span class="line">ENV MYPATH /usr/local</span><br><span class="line">WORKDIR $MYPATH</span><br><span class="line"> </span><br><span class="line">#安装vim编辑器</span><br><span class="line">RUN yum -y install vim</span><br><span class="line"></span><br><span class="line">#安装ifconfig命令查看网络IP</span><br><span class="line">RUN yum -y install net-tools</span><br><span class="line"></span><br><span class="line">#安装java8及lib库</span><br><span class="line">RUN yum -y install glibc.i686</span><br><span class="line">RUN mkdir /usr/local/java</span><br><span class="line"></span><br><span class="line">#ADD 是相对路径jar,把jdk-8u171-linux-x64.tar.gz添加到容器中,安装包必须要和Dockerfile文件在同一位置</span><br><span class="line">ADD jdk-8u171-linux-x64.tar.gz /usr/local/java/</span><br><span class="line"></span><br><span class="line">#配置java环境变量</span><br><span class="line">ENV JAVA_HOME /usr/local/java/jdk1.8.0_171</span><br><span class="line">ENV JRE_HOME $JAVA_HOME/jre</span><br><span class="line">ENV CLASSPATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar:$JRE_HOME/lib:$CLASSPATH</span><br><span class="line">ENV PATH $JAVA_HOME/bin:$PATH</span><br><span class="line"> </span><br><span class="line">EXPOSE 80</span><br><span class="line"> </span><br><span class="line">CMD echo $MYPATH</span><br><span class="line">CMD echo &quot;success--------------ok&quot;</span><br><span class="line">CMD /bin/bash</span><br></pre></td></tr></table></figure>



<h3 id="构建"><a href="#构建" class="headerlink" title="构建"></a>构建</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker build -t 新镜像名字:TAG .</span><br><span class="line"></span><br><span class="line">docker build -t centosjava8:1.5 .</span><br></pre></td></tr></table></figure>

<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230222172737674.png" alt="image-20230222172737674"></p>
<p>注意，上面TAG后面有个空格，有个点</p>
<h3 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run -it 新镜像名字:TAG</span><br><span class="line"></span><br><span class="line">docker run -it centosjava8:1.5 /bin/bash</span><br></pre></td></tr></table></figure>

<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230222173253387.png" alt="image-20230222173253387"></p>
<p>再体会下UnionFS（联合文件系统）</p>
<p>Union文件系统（UnionFS）是一种分层、轻量级并且高性能的文件系统，它支持对文件系统的修改作为一次提交来一层层的叠加，同时</p>
<p>可以将不同目录挂载到同一个虚拟文件系统下(unite several directories into a single virtual filesystem)。Union 文件系统是 Docker 镜</p>
<p>像的基础。镜像可以通过分层来进行继承，基于基础镜像（没有父镜像），可以制作各种具体的应用镜像。</p>
<h2 id="虚悬镜像"><a href="#虚悬镜像" class="headerlink" title="虚悬镜像"></a>虚悬镜像</h2><p>仓库名、标签都是<code>&lt;none&gt;</code>的镜像，俗称dangling image</p>
<p>Dockerfile</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">from ubuntu</span><br><span class="line">CMD <span class="built_in">echo</span> <span class="string">&#x27;action is success&#x27;</span></span><br></pre></td></tr></table></figure>

<p>构建</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build .</span><br></pre></td></tr></table></figure>

<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230222173709301.png" alt="image-20230222173709301"></p>
<p>查看</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image <span class="built_in">ls</span> -f dangling=<span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>删除</p>
<p>虚悬镜像已经失去存在价值，可以删除</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image prune</span><br></pre></td></tr></table></figure>

<h2 id="Docker微服务实践"><a href="#Docker微服务实践" class="headerlink" title="Docker微服务实践"></a><code>Docker</code>微服务实践</h2><p>略</p>
<h1 id="Docker网络"><a href="#Docker网络" class="headerlink" title="Docker网络"></a><code>Docker</code>网络</h1><p>先去回顾下<code>Docker</code>平台架构图</p>
<h2 id="是什么-1"><a href="#是什么-1" class="headerlink" title="是什么"></a>是什么</h2><p><strong>docker不启动，默认网络情况</strong></p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230223094726014.png" alt="image-20230223094726014"></p>
<ul>
<li><p><code>ens33</code></p>
</li>
<li><p><code>lo</code></p>
</li>
<li><p><code>virbr0</code></p>
<p>在CentOS7的安装过程中如果有选择相关虚拟化的的服务安装系统后，启动网卡时会发现有一个以网桥连接的私网地址的virbr0网卡</p>
<p>(virbr0网卡：它还有一个固定的默认IP地址192.168.122.1)，是做虚拟机网桥的使用的，其作用是为连接其上的虚机网卡提供 NAT访</p>
<p>问外网的功能。</p>
<p>我们之前学习Linux安装，勾选安装系统的时候附带了libvirt服务才会生成的一个东西，如果不需要可以直接将libvirtd服务卸载，</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum remove libvirt-libs.x86_64</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>docker启动后，网络情况</strong></p>
<p>会产生一个名为<code>docker0</code>的虚拟网桥</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230223094958339.png" alt="image-20230223094958339"></p>
<p><strong>查看docker网络模式命令</strong></p>
<p>默认创建3大网络模式</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230223095026123.png" alt="image-20230223095026123"></p>
<h2 id="常用基本命令"><a href="#常用基本命令" class="headerlink" title="常用基本命令"></a>常用基本命令</h2><ul>
<li><p>All命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network --<span class="built_in">help</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>查看网络</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network <span class="built_in">ls</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>查看网络源数据</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network inspect  XXX网络名字</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除网络</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network <span class="built_in">rm</span> XXX网络名字</span><br></pre></td></tr></table></figure>
</li>
<li><p>案例</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230223095238512.png" alt="image-20230223095238512"></p>
</li>
</ul>
<h2 id="能干嘛-1"><a href="#能干嘛-1" class="headerlink" title="能干嘛"></a>能干嘛</h2><p>容器间的互联和通信以及端口映射</p>
<p>容器IP变动时候可以通过服务名直接网络通信而不受到影响</p>
<h2 id="网络模式"><a href="#网络模式" class="headerlink" title="网络模式"></a>网络模式</h2><h3 id="总体介绍"><a href="#总体介绍" class="headerlink" title="总体介绍"></a>总体介绍</h3><p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230223095655998.png" alt="image-20230223095655998"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">bridge模式：使用--network  bridge指定，默认使用docker0</span><br><span class="line"></span><br><span class="line">host模式：使用--network host指定</span><br><span class="line"></span><br><span class="line">none模式：使用--network none指定</span><br><span class="line"></span><br><span class="line">container模式：使用--network container:NAME或者容器ID指定</span><br></pre></td></tr></table></figure>

<h3 id="容器实例内默认网络IP生产规则"><a href="#容器实例内默认网络IP生产规则" class="headerlink" title="容器实例内默认网络IP生产规则"></a>容器实例内默认网络IP生产规则</h3><p>说明</p>
<p>1 先启动两个ubuntu容器实例</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230223100032730.png" alt="image-20230223100032730"></p>
<p>2 docker inspect 容器ID or 容器名字</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230223100755882.png" alt="image-20230223100755882"></p>
<p>3 关闭u2实例，新建u3，查看ip变化</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230223100823717.png" alt="image-20230223100823717"></p>
<p>结论</p>
<p>docker容器内部的ip是有可能会发生改变的</p>
<h3 id="bridge"><a href="#bridge" class="headerlink" title="bridge"></a>bridge</h3><p>Docker 服务默认会创建一个 <code>docker0</code> 网桥（其上有一个<code> docker0</code> 内部接口），该<a target="_blank" rel="noopener" href="https://www.cnblogs.com/anyamaze/articles/16934489.html">桥接网络</a>的名称为<code>docker0</code>，它在内核层连通了其他的物理或虚拟网卡，这就将所有容器和本地主机都放到同一个物理网络。<code>Docker</code> 默认指定了 <code>docker0</code> 接口 的 IP 地址和子网掩码，让主机</p>
<p>和容器之间可以通过网桥相互通信。</p>
<p>查看 bridge 网络的详细信息，并通过 grep 获取名称项</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network inspect bridge | grep name</span><br></pre></td></tr></table></figure>

<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230223101049609.png" alt="image-20230223101049609"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig</span><br></pre></td></tr></table></figure>

<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230223104601068.png" alt="image-20230223104601068"></p>
<ul>
<li><p>Docker使用Linux桥接，在宿主机虚拟一个Docker容器网桥(docker0)，Docker启动一个容器时会根据Docker网桥的网段分配给容器</p>
<p>一个IP地址，称为Container-IP，同时Docker网桥是每个容器的默认网关。因为在同一宿主机内的容器都接入同一个网桥，这样容器</p>
<p>之间就能够通过容器的Container-IP直接通信。</p>
</li>
<li><p>docker run 的时候，没有指定network的话默认使用的网桥模式就是bridge，使用的就是docker0。在宿主机ifconfig,就可以看到</p>
<p>docker0和自己create的network(后面讲)eth0，eth1，eth2……代表网卡一，网卡二，网卡三……，lo代表127.0.0.1，即localhost，</p>
<p>inet addr用来表示网卡的IP地址</p>
</li>
<li><p>网桥docker0创建一对对等虚拟设备接口一个叫veth，另一个叫eth0，成对匹配。</p>
<ul>
<li><p>整个宿主机的网桥模式都是docker0，类似一个交换机有一堆接口，每个接口叫veth，在本地主机和容器内分别创建一个虚拟接</p>
<p>口，并让他们彼此联通（这样一对接口叫veth pair）；</p>
</li>
<li><p>每个容器实例内部也有一块网卡，每个接口叫eth0；</p>
</li>
<li><p>docker0上面的每个veth匹配某个容器实例内部的eth0，两两配对，一一匹配。</p>
</li>
</ul>
</li>
<li><p>通过上述，将宿主机上的所有容器都连接到这个内部网络上，两个容器在同一个网络下,会从这个网关下各自拿到分配的ip，此时两个</p>
<p>容器的网络是互通的。</p>
</li>
</ul>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230223105647499.png" alt="image-20230223105647499"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 8081:8080   --name tomcat81 billygoo/tomcat8-jdk8</span><br><span class="line">docker run -d -p 8082:8080   --name tomcat82 billygoo/tomcat8-jdk8</span><br></pre></td></tr></table></figure>

<p>两两匹配验证</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230223110521707.png" alt="image-20230223110521707"></p>
<h3 id="host"><a href="#host" class="headerlink" title="host"></a>host</h3><p>直接使用宿主机的 IP 地址与外界进行通信，不再需要额外进行NAT 转换。</p>
<p>容器将不会获得一个独立的Network Namespace， 而是和宿主机共用一个Network Namespace。容器将不会虚拟出自己的网卡而是使用宿主机的IP和端口。</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230223110057112.png" alt="image-20230223110057112"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 8083:8080 --network host --name tomcat83 billygoo/tomcat8-jdk8</span><br></pre></td></tr></table></figure>

<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230223110718339.png" alt="image-20230223110718339"></p>
<p>问题：docker启动时总是遇见标题中的警告</p>
<p>原因：docker启动时指定–network&#x3D;host或-net&#x3D;host，如果还指定了-p映射端口，那这个时候就会有此警告，</p>
<p>并且通过-p设置的参数将不会起到任何作用，端口号会以主机端口号为主，重复时则递增。</p>
<p>解决：解决的办法就是使用docker的其他网络模式，例如–network&#x3D;bridge，这样就可以解决问题，或者直接无视</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --network host --name tomcat83 billygoo/tomcat8-jdk8</span><br></pre></td></tr></table></figure>

<p>无之前的配对显示了，看容器实例内部</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230223111015985.png" alt="image-20230223111015985"></p>
<p>没有设置-p的端口映射了，如何访问启动的tomcat83？？</p>
<p><code>http://宿主机IP:8080/</code></p>
<p>在CentOS里面用默认的火狐浏览器访问容器内的tomcat83看到访问成功，因为此时容器的IP借用主机的，</p>
<p>所以容器共享宿主机网络IP，这样的好处是外部主机与容器可以直接通信。</p>
<h3 id="none"><a href="#none" class="headerlink" title="none"></a>none</h3><p>在none模式下，并不为Docker容器进行任何网络配置。 </p>
<p>也就是说，这个Docker容器没有网卡、IP、路由等信息，只有一个lo</p>
<p>需要我们自己为Docker容器添加网卡、配置IP等。</p>
<p>禁用网络功能，只有lo标识(就是127.0.0.1表示本地回环)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 8084:8080 --network none --name tomcat84 billygoo/tomcat8-jdk8</span><br></pre></td></tr></table></figure>

<p>进入容器内部查看</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230223111701437.png" alt="image-20230223111701437"></p>
<p>在容器外部查看</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230223111734270.png" alt="image-20230223111734270"></p>
<h3 id="container"><a href="#container" class="headerlink" title="container"></a>container</h3><p>container⽹络模式 </p>
<p>新建的容器和已经存在的一个容器共享一个网络ip配置而不是和宿主机共享。新创建的容器不会创建自己的网卡，配置自己的IP，而是和一个指定的容器共享IP、端口范围等。同样，两个容器除了网络方面，其他的如文件系统、进程列表等还是隔离的。</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230223111928999.png" alt="image-20230223111928999"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 8085:8080 --name tomcat85 billygoo/tomcat8-jdk8</span><br><span class="line">docker run -d -p 8086:8080 --network container:tomcat85 --name tomcat86 billygoo/tomcat8-jdk8</span><br></pre></td></tr></table></figure>

<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230223112439395.png" alt="image-20230223112439395"></p>
<p>相当于tomcat86和tomcat85公用同一个ip同一个端口，导致端口冲突。本案例用tomcat演示不合适。。。演示坑</p>
<p>换一个镜像给大家演示</p>
<p>Alpine操作系统是一个面向安全的轻型 Linux发行版</p>
<p>Alpine Linux 是一款独立的、非商业的通用 Linux 发行版，专为追求安全性、简单性和资源效率的用户而设计。 可能很多人没听说过这个 Linux 发行版本，但是经常用 Docker 的朋友可能都用过，因为他小，简单，安全而著称，所以作为基础镜像是非常好的一个选择，可谓是麻雀虽小但五脏俱全，镜像非常小巧，不到 6M的大小，所以特别适合容器打包。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --name alpine1  alpine /bin/sh</span><br><span class="line">docker run -it --network container:alpine1 --name alpine2  alpine /bin/sh</span><br></pre></td></tr></table></figure>

<p>运行结果，验证共用搭桥</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230223112750215.png" alt="image-20230223112750215"></p>
<p>假如此时关闭alpine1，再看看alpine2</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230223112900653.png" alt="image-20230223112900653"></p>
<p><code>15: eth0@if16: </code>消失了。关闭alpine1，再看看alpine2</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230223112935994.png" alt="image-20230223112935994"></p>
<h3 id="自定义网络"><a href="#自定义网络" class="headerlink" title="自定义网络"></a>自定义网络</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 8081:8080   --name tomcat81 billygoo/tomcat8-jdk8</span><br><span class="line">docker run -d -p 8082:8080   --name tomcat82 billygoo/tomcat8-jdk8</span><br></pre></td></tr></table></figure>

<p>上述成功启动并用docker exec进入各自容器实例内部</p>
<p>按照IP地址ping是OK的</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230223114108700.png" alt="image-20230223114108700"></p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230223114125860.png" alt="image-20230223114125860"></p>
<p>按照服务名ping结果???</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230223114146530.png" alt="image-20230223114146530"></p>
<p>自定义桥接网络，自定义网络默认使用的是桥接网络bridge</p>
<p>新建自定义网络</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230223114233323.png" alt="image-20230223114233323"></p>
<p>新建容器加入上一步新建的自定义网络</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 8081:8080 --network zzyy_network  --name tomcat81 billygoo/tomcat8-jdk8</span><br><span class="line">docker run -d -p 8082:8080 --network zzyy_network  --name tomcat82 billygoo/tomcat8-jdk8</span><br></pre></td></tr></table></figure>

<p>互相ping测试</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230223114322388.png" alt="image-20230223114322388"></p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230223114340521.png" alt="image-20230223114340521"></p>
<p>自定义网络本身就维护好了主机名和ip的对应关系（ip和域名都能通）</p>
<h3 id="如何将两个已经运行的容器服务，实现网络互通"><a href="#如何将两个已经运行的容器服务，实现网络互通" class="headerlink" title="如何将两个已经运行的容器服务，实现网络互通"></a>如何将两个已经运行的容器服务，实现网络互通</h3><p>要实现两个已经运行的容器服务之间的网络互通，可以通过以下方法进行配置：</p>
<ol>
<li>创建共享网络：首先，创建一个共享的Docker网络，以便两个容器可以连接到同一个网络。如果你已经有一个共享网络，可以跳过此步骤。在宿主机上执行以下命令：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network create mynetwork</span><br></pre></td></tr></table></figure>

<ol>
<li>连接容器到共享网络：将两个已经运行的容器连接到共享网络。使用以下命令分别连接每个容器，将容器名和共享网络名称替换为实际的值：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker network connect mynetwork container1</span><br><span class="line">docker network connect mynetwork container2</span><br></pre></td></tr></table></figure>

<p>这将把两个容器连接到同一个共享网络。</p>
<ol>
<li>测试网络互通：现在，两个容器已经连接到共享网络，你可以在它们之间进行网络互通测试。你可以使用容器名称或IP地址来访问容器的服务。例如，在容器1中可以使用容器2的名称或IP地址访问容器2的服务，反之亦然。</li>
</ol>
<p>请注意，确保容器的服务端口在容器之间是可访问的，例如在运行容器时使用 <code>-p</code> 参数将容器的端口映射到宿主机的端口上。</p>
<p>通过上述步骤，你可以将两个已经运行的容器服务实现网络互通。这样，它们可以相互通信和访问对方的服务。</p>
<p>实操：</p>
<p>以下一个是<code>ubuntu</code>容器，一个是<code>postgres</code>服务</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230714154035545.png" alt="image-20230714154035545"></p>
<p>配置后在<code>ubuntu</code>容器中访问<code>postgres</code>服务：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">psql -h 705b31330448 -U postgres -d data_tag</span><br></pre></td></tr></table></figure>

<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230714154141821.png" alt="image-20230714154141821"></p>
<h3 id="ubuntu容器访问宿主机中另一个容器的postgers服务"><a href="#ubuntu容器访问宿主机中另一个容器的postgers服务" class="headerlink" title="ubuntu容器访问宿主机中另一个容器的postgers服务"></a>ubuntu容器访问宿主机中另一个容器的postgers服务</h3><p>要在Ubuntu容器中访问宿主机中的另一个容器的PostgreSQL服务，可以按照以下步骤进行配置：</p>
<ol>
<li>创建Docker网络：首先，在宿主机上创建一个Docker网络，以便容器之间可以相互通信。执行以下命令：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network create mynetwork</span><br></pre></td></tr></table></figure>

<ol>
<li>运行PostgreSQL容器：在宿主机上运行PostgreSQL容器，并将其连接到刚创建的Docker网络。使用适当的PostgreSQL容器映像和配置，运行以下命令：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name postgres-container --network=mynetwork -e POSTGRES_PASSWORD=your_password postgres:latest</span><br></pre></td></tr></table></figure>

<p>这将创建一个名为”postgres-container”的PostgreSQL容器，并将其连接到”mynetwork”网络中。</p>
<ol>
<li>运行Ubuntu容器：现在，在宿主机上运行另一个Ubuntu容器，并连接到同一Docker网络。使用适当的Ubuntu容器映像和配置，运行以下命令：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --name ubuntu-container --network=mynetwork ubuntu:latest</span><br></pre></td></tr></table></figure>

<ol>
<li>在Ubuntu容器中安装PostgreSQL客户端：在Ubuntu容器中，安装PostgreSQL客户端，以便与PostgreSQL服务器进行通信。在Ubuntu容器中执行以下命令：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-get update</span><br><span class="line">apt-get install postgresql-client -y</span><br></pre></td></tr></table></figure>

<ol>
<li>连接到PostgreSQL容器：在Ubuntu容器中，使用PostgreSQL客户端连接到PostgreSQL容器。执行以下命令，并替换<code>postgres-container</code>、<code>your_password</code> 和 <code>database_name</code> 为实际的值：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">psql -h postgres-container -U postgres -d database_name</span><br></pre></td></tr></table></figure>

<p>然后，输入PostgreSQL的密码进行连接。</p>
<p>现在，你可以在Ubuntu容器中访问宿主机中的PostgreSQL容器的服务了。你可以执行SQL查询、管理数据库等操作。</p>
<p>请注意，这里的示例假设你正在使用默认的PostgreSQL容器映像和配置。根据实际情况，你可能需要根据你的PostgreSQL容器设置进行适当的修改，例如指定自定义的数据库名称、用户名和密码等。</p>
<p>另外，确保在安全性方面采取适当的措施，例如设置强密码和限制访问权限，以保护PostgreSQL服务器免受未经授权的访问。</p>
<h1 id="Docker-compose容器编排"><a href="#Docker-compose容器编排" class="headerlink" title="Docker-compose容器编排"></a><code>Docker-compose</code>容器编排</h1><h2 id="是什么-2"><a href="#是什么-2" class="headerlink" title="是什么"></a>是什么</h2><p>Compose 是 Docker 公司推出的一个工具软件，可以管理多个 Docker 容器组成一个应用。你需要定义一个 YAML 格式的配置文件</p>
<p>docker-compose.yml，写好多个容器之间的调用关系。然后，只要一个命令，就能同时启动&#x2F;关闭这些容器</p>
<p>Docker-Compose是Docker官方的开源项目， 负责实现对Docker容器集群的快速编排。</p>
<h2 id="能干嘛-2"><a href="#能干嘛-2" class="headerlink" title="能干嘛"></a>能干嘛</h2><p>docker建议我们每一个容器中只运行一个服务,因为docker容器本身占用资源极少,所以最好是将每个服务单独的分割开来但是这样我们又</p>
<p>面临了一个问题？</p>
<p>如果我需要同时部署好多个服务,难道要每个服务单独写Dockerfile然后在构建镜像,构建容器,这样累都累死了,所以docker官方给我们提供</p>
<p>了docker-compose多服务部署的工具</p>
<p>例如要实现一个Web微服务项目，除了Web服务容器本身，往往还需要再加上后端的数据库mysql服务容器，redis服务器，注册中心</p>
<p>eureka，甚至还包括负载均衡容器等等。。。。。。</p>
<p>Compose允许用户通过一个单独的docker-compose.yml模板文件（YAML 格式）来定义一组相关联的应用容器为一个项目</p>
<p>（project）。</p>
<p>可以很容易地用一个配置文件定义一个多容器的应用，然后使用一条指令安装这个应用的所有依赖，完成构建。Docker-Compose 解决</p>
<p>了容器与容器之间如何管理编排的问题。</p>
<h2 id="去哪下-1"><a href="#去哪下-1" class="headerlink" title="去哪下"></a>去哪下</h2><p>官网：<a target="_blank" rel="noopener" href="https://docs.docker.com/compose/compose-file/compose-file-v3/">https://docs.docker.com/compose/compose-file/compose-file-v3/</a></p>
<p>官网下载：<a target="_blank" rel="noopener" href="https://docs.docker.com/compose/install/">https://docs.docker.com/compose/install/</a></p>
<p>安装步骤(建议使用新版本)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">curl -SL https://github.com/docker/compose/releases/download/v2.16.0/docker-compose-linux-x86_64 -o /usr/local/bin/docker-compose</span><br><span class="line"></span><br><span class="line"><span class="built_in">chmod</span> +x /usr/local/bin/docker-compose</span><br><span class="line"></span><br><span class="line">docker-compose --version</span><br></pre></td></tr></table></figure>

<p>If the command <code>docker-compose</code> fails after installation, check your path. You can also create a symbolic link to <code>/usr/bin</code> or any other directory in your path. For example:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">ln</span> -s /usr/local/bin/docker-compose /usr/bin/docker-compose</span><br></pre></td></tr></table></figure>



<p>卸载步骤</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230223134735256.png" alt="image-20230223134735256"></p>
<h2 id="Compose核心概念"><a href="#Compose核心概念" class="headerlink" title="Compose核心概念"></a>Compose核心概念</h2><ul>
<li><p>一文件</p>
<ul>
<li><code>docker-compose.yml</code></li>
</ul>
</li>
<li><p>两要素</p>
<ul>
<li><p>服务（service）</p>
<p>一个个应用容器实例，比如订单微服务、库存微服务、mysql容器、nginx容器或者redis容器</p>
</li>
<li><p>工程（project）</p>
<p>由一组关联的应用容器组成的一个完整业务单元，在 <code>docker-compose.yml</code> 文件中定义。</p>
</li>
</ul>
</li>
</ul>
<h2 id="Compose使用的三个步骤"><a href="#Compose使用的三个步骤" class="headerlink" title="Compose使用的三个步骤"></a>Compose使用的三个步骤</h2><p>编写Dockerfile定义各个微服务应用并构建出对应的镜像文件</p>
<p>使用 docker-compose.yml 定义一个完整业务单元，安排好整体应用中的各个容器服务。</p>
<p>最后，执行docker-compose up命令 来启动并运行整个应用程序，完成一键部署上线</p>
<h2 id="Compose常用命令"><a href="#Compose常用命令" class="headerlink" title="Compose常用命令"></a>Compose常用命令</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">docker-compose -h                           <span class="comment"># 查看帮助</span></span><br><span class="line">docker-compose up                           <span class="comment"># 启动所有docker-compose服务</span></span><br><span class="line">docker-compose up -d                        <span class="comment"># 启动所有docker-compose服务并后台运行</span></span><br><span class="line">docker-compose down                         <span class="comment"># 停止并删除容器、网络、卷、镜像。</span></span><br><span class="line">docker-compose <span class="built_in">exec</span>  yml里面的服务<span class="built_in">id</span>                 <span class="comment"># 进入容器实例内部  docker-compose exec docker-compose.yml文件中写的服务id /bin/bash</span></span><br><span class="line">docker-compose ps                      <span class="comment"># 展示当前docker-compose编排过的运行的所有容器</span></span><br><span class="line">docker-compose top                     <span class="comment"># 展示当前docker-compose编排过的容器进程</span></span><br><span class="line"> </span><br><span class="line">docker-compose logs  yml里面的服务<span class="built_in">id</span>     <span class="comment"># 查看容器输出日志</span></span><br><span class="line">docker-compose config     <span class="comment"># 检查配置</span></span><br><span class="line">docker-compose config -q  <span class="comment"># 检查配置，有问题才有输出</span></span><br><span class="line">docker-compose restart   <span class="comment"># 重启服务</span></span><br><span class="line">docker-compose start     <span class="comment"># 启动服务</span></span><br><span class="line">docker-compose stop      <span class="comment"># 停止服务</span></span><br></pre></td></tr></table></figure>

<h2 id="案例-1"><a href="#案例-1" class="headerlink" title="案例"></a>案例</h2><h3 id="不用Compose"><a href="#不用Compose" class="headerlink" title="不用Compose"></a>不用Compose</h3><p>单独的mysql容器实例</p>
<p>新建mysql容器实例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 3306:3306 --name mysql57 --privileged=<span class="literal">true</span> -v /zzyyuse/mysql/conf:/etc/mysql/conf.d -v /zzyyuse/mysql/logs:/logs -v /zzyyuse/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 -d mysql:5.7</span><br></pre></td></tr></table></figure>

<p>进入mysql容器实例并新建库db2021+新建表t_user</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it mysql57 /bin/bash</span><br><span class="line">mysql -uroot -p</span><br><span class="line">create database db2021;</span><br><span class="line">use db2021;</span><br><span class="line">CREATE TABLE `t_user` (</span><br><span class="line">  `<span class="built_in">id</span>` INT(10) UNSIGNED NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `username` VARCHAR(50) NOT NULL DEFAULT <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;用户名&#x27;</span>,</span><br><span class="line">  `password` VARCHAR(50) NOT NULL DEFAULT <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;密码&#x27;</span>,</span><br><span class="line">  `sex` TINYINT(4) NOT NULL DEFAULT <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;性别 0=女 1=男 &#x27;</span>,</span><br><span class="line">  `deleted` TINYINT(4) UNSIGNED NOT NULL DEFAULT <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;删除标志，默认0不删除，1删除&#x27;</span>,</span><br><span class="line">  `update_time` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT <span class="string">&#x27;更新时间&#x27;</span>,</span><br><span class="line">  `create_time` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">  PRIMARY KEY (`<span class="built_in">id</span>`)</span><br><span class="line">) ENGINE=INNODB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8mb4 COMMENT=<span class="string">&#x27;用户表&#x27;</span>;</span><br></pre></td></tr></table></figure>



<p>单独的redis容器实例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run  -p 6379:6379 --name redis608 --privileged=<span class="literal">true</span> -v /app/redis/redis.conf:/etc/redis/redis.conf -v /app/redis/data:/data -d redis:6.0.8 redis-server /etc/redis/redis.conf</span><br></pre></td></tr></table></figure>



<p>容器实例依次顺序启动成功</p>
<p>有哪些问题?</p>
<p>先后顺序要求固定，先mysql+redis才能微服务访问成功</p>
<p>多个run命令……</p>
<p>容器间的启停或宕机，有可能导致IP地址对应的容器实例变化，映射出错， 要么生产IP写死(可以但是不推荐)，要么通过服务调用</p>
<h3 id="使用Compose"><a href="#使用Compose" class="headerlink" title="使用Compose"></a>使用Compose</h3><p>服务编排，一套带走，安排</p>
<p>编写docker-compose.yml文件</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line"> </span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">microService:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">zzyy_docker:1.6</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">ms01</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;6001:6001&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/app/microService:/data</span></span><br><span class="line">    <span class="attr">networks:</span> </span><br><span class="line">      <span class="bullet">-</span> <span class="string">atguigu_net</span> </span><br><span class="line">    <span class="attr">depends_on:</span> </span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">mysql</span></span><br><span class="line"> </span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis:6.0.8</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;6379:6379&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/app/redis/redis.conf:/etc/redis/redis.conf</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/app/redis/data:/data</span></span><br><span class="line">    <span class="attr">networks:</span> </span><br><span class="line">      <span class="bullet">-</span> <span class="string">atguigu_net</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">redis-server</span> <span class="string">/etc/redis/redis.conf</span></span><br><span class="line"> </span><br><span class="line">  <span class="attr">mysql:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql:5.7</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">MYSQL_ROOT_PASSWORD:</span> <span class="string">&#x27;123456&#x27;</span></span><br><span class="line">      <span class="attr">MYSQL_ALLOW_EMPTY_PASSWORD:</span> <span class="string">&#x27;no&#x27;</span></span><br><span class="line">      <span class="attr">MYSQL_DATABASE:</span> <span class="string">&#x27;db2021&#x27;</span></span><br><span class="line">      <span class="attr">MYSQL_USER:</span> <span class="string">&#x27;zzyy&#x27;</span></span><br><span class="line">      <span class="attr">MYSQL_PASSWORD:</span> <span class="string">&#x27;zzyy123&#x27;</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">       <span class="bullet">-</span> <span class="string">&quot;3306:3306&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">       <span class="bullet">-</span> <span class="string">/app/mysql/db:/var/lib/mysql</span></span><br><span class="line">       <span class="bullet">-</span> <span class="string">/app/mysql/conf/my.cnf:/etc/my.cnf</span></span><br><span class="line">       <span class="bullet">-</span> <span class="string">/app/mysql/init:/docker-entrypoint-initdb.d</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">atguigu_net</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">--default-authentication-plugin=mysql_native_password</span> <span class="comment">#解决外部无法访问</span></span><br><span class="line"> </span><br><span class="line"><span class="attr">networks:</span> </span><br><span class="line">   <span class="attr">atguigu_net:</span> </span><br></pre></td></tr></table></figure>

<p>如果没指定容器名，会自己加上路径前缀及索引后缀</p>
<p>执行 <code>docker-compose up</code> 或者 执行 <code>docker-compose up -d</code></p>
<p>进入mysql容器实例并新建库db2021+新建表t_user</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it 容器实例<span class="built_in">id</span> /bin/bash</span><br><span class="line">mysql -uroot -p</span><br><span class="line">create database db2021;</span><br><span class="line">use db2021;</span><br><span class="line">CREATE TABLE `t_user` (</span><br><span class="line">  `<span class="built_in">id</span>` INT(10) UNSIGNED NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `username` VARCHAR(50) NOT NULL DEFAULT <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;用户名&#x27;</span>,</span><br><span class="line">  `password` VARCHAR(50) NOT NULL DEFAULT <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;密码&#x27;</span>,</span><br><span class="line">  `sex` TINYINT(4) NOT NULL DEFAULT <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;性别 0=女 1=男 &#x27;</span>,</span><br><span class="line">  `deleted` TINYINT(4) UNSIGNED NOT NULL DEFAULT <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;删除标志，默认0不删除，1删除&#x27;</span>,</span><br><span class="line">  `update_time` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT <span class="string">&#x27;更新时间&#x27;</span>,</span><br><span class="line">  `create_time` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">  PRIMARY KEY (`<span class="built_in">id</span>`)</span><br><span class="line">) ENGINE=INNODB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8mb4 COMMENT=<span class="string">&#x27;用户表&#x27;</span>;</span><br></pre></td></tr></table></figure>





<h1 id="Docker轻量级可视化工具Portainer"><a href="#Docker轻量级可视化工具Portainer" class="headerlink" title="Docker轻量级可视化工具Portainer"></a><code>Docker</code>轻量级可视化工具<code>Portainer</code></h1><p>Portainer 是一款轻量级的应用，它提供了图形化界面，用于方便地管理Docker环境，包括单机环境和集群环境（建议k8s）。</p>
<p>官网</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.portainer.io/">https://www.portainer.io/</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.portainer.io/v/ce-2.9/start/install/server/docker/linux">https://docs.portainer.io/v/ce-2.9/start/install/server/docker/linux</a></li>
</ul>
<p>步骤</p>
<ul>
<li><p><code>docker</code>命令安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 5001:8000 -p 5002:9000 --name portainer \</span><br><span class="line">--restart=always \</span><br><span class="line">-v /var/run/docker.sock:/var/run/docker.sock \</span><br><span class="line">-v portainer_data:/data \</span><br><span class="line">portainer/portainer-ce</span><br></pre></td></tr></table></figure>
</li>
<li><p>第一次登录需创建admin，访问地址：<code>xxx.xxx.xxx.xxx:5002</code>（容器内9000对应的宿主机端口）</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20221204174843511.png" alt="image-20221204174843511"></p>
</li>
</ul>
<h1 id="Docker容器监控之CAdvisor-InfluxDB-Granfana"><a href="#Docker容器监控之CAdvisor-InfluxDB-Granfana" class="headerlink" title="Docker容器监控之CAdvisor + InfluxDB + Granfana"></a><code>Docker</code>容器监控之<code>CAdvisor + InfluxDB + Granfana</code></h1><h2 id="原生命令"><a href="#原生命令" class="headerlink" title="原生命令"></a>原生命令</h2><p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230224085414009.png" alt="image-20230224085414009"></p>
<p><code>docker stats</code>命令的结果</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230224085450597.png" alt="image-20230224085450597"></p>
<p>问题</p>
<p>通过<code>docker stats</code>命令可以很方便的看到当前宿主机上所有容器的CPU,内存以及网络流量等数据，一般小公司够用了。</p>
<p>但是，<code>docker stats</code>统计结果只能是当前宿主机的全部容器，数据资料是实时的，没有地方存储、没有健康指标过线预警等功能</p>
<h2 id="容器监控3剑客"><a href="#容器监控3剑客" class="headerlink" title="容器监控3剑客"></a>容器监控3剑客</h2><p><code>CAdvisor</code>监控收集+<code>InfluxDB</code>存储数据+<code>Granfana</code>展示图表</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230224085736630.png" alt="image-20230224085736630"></p>
<h3 id="CAdvisor"><a href="#CAdvisor" class="headerlink" title="CAdvisor"></a>CAdvisor</h3><p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230224085844395.png" alt="image-20230224085844395"></p>
<h3 id="InfluxDB"><a href="#InfluxDB" class="headerlink" title="InfluxDB"></a>InfluxDB</h3><p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230224090007097.png" alt="image-20230224090007097"></p>
<h3 id="Granfana"><a href="#Granfana" class="headerlink" title="Granfana"></a>Granfana</h3><p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230224090055946.png" alt="image-20230224090055946"></p>
<h2 id="compose容器编排"><a href="#compose容器编排" class="headerlink" title="compose容器编排"></a>compose容器编排</h2><ul>
<li><p>新建目录</p>
</li>
<li><p>新建3件套组合的 <code>docker-compose.yml</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.1&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">grafana_data:</span> &#123;&#125;</span><br><span class="line"> </span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"> <span class="attr">influxdb:</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">tutum/influxdb:0.9</span></span><br><span class="line">  <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">  <span class="attr">environment:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">PRE_CREATE_DB=cadvisor</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;8083:8083&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;8086:8086&quot;</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">./data/influxdb:/data</span></span><br><span class="line"> </span><br><span class="line"> <span class="attr">cadvisor:</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">google/cadvisor</span></span><br><span class="line">  <span class="attr">links:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">influxdb:influxsrv</span></span><br><span class="line">  <span class="attr">command:</span> <span class="string">-storage_driver=influxdb</span> <span class="string">-storage_driver_db=cadvisor</span> <span class="string">-storage_driver_host=influxsrv:8086</span></span><br><span class="line">  <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;8080:8080&quot;</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/:/rootfs:ro</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/var/run:/var/run:rw</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/sys:/sys:ro</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/var/lib/docker/:/var/lib/docker:ro</span></span><br><span class="line"> </span><br><span class="line"> <span class="attr">grafana:</span></span><br><span class="line">  <span class="attr">user:</span> <span class="string">&quot;104&quot;</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">grafana/grafana</span></span><br><span class="line">  <span class="attr">user:</span> <span class="string">&quot;104&quot;</span></span><br><span class="line">  <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">  <span class="attr">links:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">influxdb:influxsrv</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;3000:3000&quot;</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">grafana_data:/var/lib/grafana</span></span><br><span class="line">  <span class="attr">environment:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">HTTP_USER=admin</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">HTTP_PASS=admin</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">INFLUXDB_HOST=influxsrv</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">INFLUXDB_PORT=8086</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">INFLUXDB_NAME=cadvisor</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">INFLUXDB_USER=root</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">INFLUXDB_PASS=root</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><h1 id="问题解决"><a href="#问题解决" class="headerlink" title="问题解决"></a>问题解决</h1><h2 id="Docker-x2F-var-x2F-lib-x2F-docker-x2F-overlay2占用过大问题"><a href="#Docker-x2F-var-x2F-lib-x2F-docker-x2F-overlay2占用过大问题" class="headerlink" title="Docker &#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2占用过大问题"></a>Docker &#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2占用过大问题</h2><p>背景：<code>df -h</code>发现的</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_39080216/article/details/123921353">(11条消息) Docker &#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2占用过大问题解决_overlay2过大_Amx Just Run的博客-CSDN博客</a></p>
<p>选择方案二：更换RootDir的分区</p>
<p>停止docker服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># 若失败：Warning: Stopping docker.service, but it can still be activated by: docker.socket</span></span><br><span class="line">systemctl stop docker.socket</span><br><span class="line"></span><br><span class="line"><span class="comment"># 后续启动弄</span></span><br><span class="line">systemctl start docker.socket</span><br><span class="line">systemctl start docker</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>创建新的RootDir目录</p>
<p>由于目前home分区最大6.6T，所以暂定放在home目录下（根据实际情况选择）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /home/docker-rootdir/</span><br></pre></td></tr></table></figure>

<p>同步数据（需要等一段事件），设置为后台运行：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/e19d3af28edf">https://www.jianshu.com/p/e19d3af28edf</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cp命令或者mv命令也可以，rsync更安全</span></span><br><span class="line">rsync -avz /var/lib/docker/ /data/data02/docker-rootdir</span><br><span class="line"></span><br><span class="line"><span class="comment"># 拷贝数据成功</span></span><br><span class="line">sent 9,175,353,829 bytes  received 7,639,191 bytes  7,355,220.68 bytes/sec</span><br><span class="line">total size is 22,701,214,458  speedup is 2.47</span><br></pre></td></tr></table></figure>

<p>配置Docker的root_dir</p>
<p>修改<code>etc/docker/daemon.json</code>,添加如下内容，记得加逗号</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;graph&quot;</span>: <span class="string">&quot;/data/data02/docker-rootdir&quot;</span></span><br></pre></td></tr></table></figure>

<p>此处还有好多种方式，比如<code>dokcer.service</code>启动命令添加启动项等等，但是个人觉得使用配置文件的方式更安全，也方面其他运维人员可以方面的看到配置。</p>
<p>更新配置,重启docker</p>
<p>重新加载配置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br></pre></td></tr></table></figure>

<p>重启docker</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart docker</span><br><span class="line"></span><br><span class="line">systemctl start docker.socket</span><br></pre></td></tr></table></figure>

<p>查看是否配置成功</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker info | grep <span class="string">&quot;Root Dir&quot;</span></span><br></pre></td></tr></table></figure>

<p>如果显示的已经是更换后的目录则说明切换成功。 </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Docker Root Dir: /data/data02/docker-rootdir</span><br></pre></td></tr></table></figure>

<p>测试 ，查看镜像是否完整，容器是否能够正常启动. 启动后<code>df -h</code>查看</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Filesystem                 Size  Used Avail Use% Mounted on</span><br><span class="line"></span><br><span class="line">overlay                    1.9T   93G  1.8T   5% /data/data02/docker-rootdir/overlay2/3e9586b57561be3a58f1188d9ce44f8498951cf1e49623aedd3828accecd6edb/merged</span><br></pre></td></tr></table></figure>



<h2 id="修改容器映射信息"><a href="#修改容器映射信息" class="headerlink" title="修改容器映射信息"></a>修改容器映射信息</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_23934063/article/details/122316058">https://blog.csdn.net/qq_23934063/article/details/122316058</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/poloyy/p/13993832.html">https://www.cnblogs.com/poloyy/p/13993832.html</a></p>
<p>暂停 Docker 服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop docker</span><br><span class="line">或者</span><br><span class="line">systemctl stop docker.socket</span><br></pre></td></tr></table></figure>

<p>进入 Docker 容器配置文件目录下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /var/lib/docker/containers/ls</span><br></pre></td></tr></table></figure>

<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230323162600968.png" alt="image-20230323162600968"></p>
<blockquote>
<p>注意，如果之前更改了docker的rootdir，则进入自定的rootdir</p>
</blockquote>
<p>进入某个容器的配置文件目录下</p>
<p>容器ID 就是文件夹名称，可通过 docker ps -aq 来查看，不过这是缩写，对照起来看就行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> c614b6db4aed0c8d0c742baa09ff4e2c24761703586460b68633d7b66e62c633ls</span><br></pre></td></tr></table></figure>

<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230323162701168.png" alt="image-20230323162701168"></p>
<p>修改 config.v2.json</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim config.v2.json</span><br></pre></td></tr></table></figure>

<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230323162736649.png" alt="image-20230323162736649"></p>
<ul>
<li>输入 &#x2F; ，搜索映射的目录（webapps）</li>
<li>也可以找到 MountPoints </li>
<li>若需要重新指定<strong>主机上</strong>的映射目录，则改<strong>绿圈</strong>的两个地方</li>
<li>若需要重新指定<strong>容器上</strong>的映射目录，则改<strong>蓝圈</strong>的两个地方</li>
</ul>
<p>MountPoints 节点</p>
<p>其实是一个 json 结构的数据，下图</p>
<p><img src="/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/image-20230323162854773.png" alt="image-20230323162854773"></p>
<p>重新启动 Docker 服务</p>
<p>注意</p>
<ul>
<li>如果想修改 Docker 容器随着 Docker 服务启动而自启动，可看：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/poloyy/p/13985567.html">https://www.cnblogs.com/poloyy/p/13985567.html</a></li>
<li>如果想修改 Docker 的映射端口，可看：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/poloyy/p/13940554.html">https://www.cnblogs.com/poloyy/p/13940554.html</a></li>
<li>改 hostconfig.json 并不会成功哦</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="https://github.com/Saiable">Sai</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://mindcons.cn/2023/02/21/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/docker%E5%9F%BA%E7%A1%80/">https://mindcons.cn/2023/02/21/web/web/其他/运维/docker基础/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://mindcons.cn" target="_blank">吕小布の博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/docker/">docker</a></div><div class="post_share"><div class="social-share" data-image="https://bu.dusays.com/2023/02/10/63e583843360e.webp" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://bu.dusays.com/2023/02/10/63e580229ee01.webp" target="_blank"><img class="post-qr-code-img" src="https://bu.dusays.com/2023/02/10/63e580229ee01.webp" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="https://bu.dusays.com/2023/02/09/63e48775d4f42.webp" target="_blank"><img class="post-qr-code-img" src="https://bu.dusays.com/2023/02/09/63e48775d4f42.webp" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/02/22/web/data/%E6%A0%87%E6%B3%A8/brat%E5%AE%89%E8%A3%85%E6%AD%A5%E9%AA%A4/"><img class="prev-cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">brat安装步骤及注意事项</div></div></a></div><div class="next-post pull-right"><a href="/2023/02/16/web/data/%E6%95%B0%E6%8D%AE%E5%BC%95%E8%A8%80/"><img class="next-cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">数据引言</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2023/01/13/web/web/%E5%85%B6%E4%BB%96/%E8%BF%90%E7%BB%B4/Docker-Ubuntu%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BAplaywright%E7%8E%AF%E5%A2%83/" title="Docker-Ubuntu环境搭建playwright环境"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-01-13</div><div class="title">Docker-Ubuntu环境搭建playwright环境</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://bu.dusays.com/2023/02/10/63e583843360e.webp" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Sai</div><div class="author-info__description">天可补,海可填,南山可移。日月既往,不可复追。</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">152</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">53</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">36</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Saiable"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://bu.dusays.com/2023/02/10/63e57e822f198.webp" target="_blank" title="QQ"><i class="fa-brands fa-qq"></i></a><a class="social-icon" href="https://bu.dusays.com/2023/02/10/63e57f8ac9fae.webp" target="_blank" title="WeChat"><i class="fa-brands fa-weixin"></i></a><a class="social-icon" href="https://github.com/Saiable" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:mindcons@foxmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">日月既往,不可复追。</div></div><div class="xpand" style="height:200px;"><canvas class="illo" width="800" height="800" style="max-width: 200px; max-height: 200px; touch-action: none; width: 640px; height: 640px;"></canvas></div><script src="https://npm.elemecdn.com/ethan4116-blog/lib/js/other/two-people/twopeople1.js"></script><script src="https://npm.elemecdn.com/ethan4116-blog/lib/js/other/two-people/zdog.dist.js"></script><script id="rendered-js" src="https://npm.elemecdn.com/ethan4116-blog/lib/js/other/two-people/twopeople.js"></script><style>.card-widget.card-announcement {
margin: 0;
align-items: center;
justify-content: center;
text-align: center;
}
canvas {
display: block;
margin: 0 auto;
cursor: move;
}</style><div class="card-widget tzy-right-widget" id="card-wechat"><div id="flip-wrapper"><div id="flip-content"><div class="face"></div><div class="back face"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text">Docker简介</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E6%9C%89docker%E5%87%BA%E7%8E%B0%EF%BC%9F"><span class="toc-number">1.1.</span> <span class="toc-text">为什么会有docker出现？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker%E7%90%86%E5%BF%B5"><span class="toc-number">1.2.</span> <span class="toc-text">docker理念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E4%B8%8E%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%AF%94%E8%BE%83"><span class="toc-number">1.3.</span> <span class="toc-text">容器与虚拟机比较</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%83%BD%E5%B9%B2%E5%98%9B"><span class="toc-number">1.4.</span> <span class="toc-text">能干嘛</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%BB%E5%93%AA%E4%B8%8B"><span class="toc-number">1.5.</span> <span class="toc-text">去哪下</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker%E5%AE%89%E8%A3%85"><span class="toc-number">2.</span> <span class="toc-text">Docker安装</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E6%8F%90%E8%AF%B4%E6%98%8E"><span class="toc-number">2.1.</span> <span class="toc-text">前提说明</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CentOS-Docker-%E5%AE%89%E8%A3%85"><span class="toc-number">2.1.1.</span> <span class="toc-text">CentOS Docker 安装</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%BB%84%E6%88%90"><span class="toc-number">2.2.</span> <span class="toc-text">Docker的基本组成</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%95%9C%E5%83%8F-image"><span class="toc-number">2.2.1.</span> <span class="toc-text">镜像(image)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8-container"><span class="toc-number">2.2.2.</span> <span class="toc-text">容器(container)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F%E6%80%BB%E7%BB%93"><span class="toc-number">2.2.3.</span> <span class="toc-text">小总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker%E5%B9%B3%E5%8F%B0%E6%9E%B6%E6%9E%84%E5%9B%BE%E8%A7%A3-%E6%9E%B6%E6%9E%84%E7%89%88"><span class="toc-number">2.3.</span> <span class="toc-text">Docker平台架构图解(架构版)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E6%AD%A5%E9%AA%A4"><span class="toc-number">2.4.</span> <span class="toc-text">安装步骤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%98%BF%E9%87%8C%E4%BA%91%E9%95%9C%E5%83%8F%E5%8A%A0%E9%80%9F"><span class="toc-number">2.5.</span> <span class="toc-text">阿里云镜像加速</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">3.</span> <span class="toc-text">Docker常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%AE%E5%8A%A9%E5%90%AF%E5%8A%A8%E7%B1%BB%E5%91%BD%E4%BB%A4"><span class="toc-number">3.1.</span> <span class="toc-text">帮助启动类命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%95%9C%E5%83%8F%E5%91%BD%E4%BB%A4"><span class="toc-number">3.2.</span> <span class="toc-text">镜像命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#docker-images"><span class="toc-number">3.2.1.</span> <span class="toc-text">docker images</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#docker-search"><span class="toc-number">3.2.2.</span> <span class="toc-text">docker search </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#docker-pull"><span class="toc-number">3.2.3.</span> <span class="toc-text">docker pull</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#docker-system-df"><span class="toc-number">3.2.4.</span> <span class="toc-text">docker system df</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#docker-rmi"><span class="toc-number">3.2.5.</span> <span class="toc-text">docker rmi</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">3.3.</span> <span class="toc-text">容器命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#docker-run"><span class="toc-number">3.3.1.</span> <span class="toc-text">docker run</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#docker-ps"><span class="toc-number">3.3.2.</span> <span class="toc-text">docker ps</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%80%E5%87%BA%E5%AE%B9%E5%99%A8"><span class="toc-number">3.3.3.</span> <span class="toc-text">退出容器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E5%81%9C%E5%AE%B9%E5%99%A8"><span class="toc-number">3.3.4.</span> <span class="toc-text">启停容器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%AE%B9%E5%99%A8"><span class="toc-number">3.3.5.</span> <span class="toc-text">查看容器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9B%E5%85%A5%E5%AE%B9%E5%99%A8"><span class="toc-number">3.3.6.</span> <span class="toc-text">进入容器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E5%AE%B9%E5%99%A8%E5%86%85%E6%8B%B7%E8%B4%9D%E6%96%87%E4%BB%B6%E5%88%B0%E4%B8%BB%E6%9C%BA"><span class="toc-number">3.3.7.</span> <span class="toc-text">从容器内拷贝文件到主机</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5-x2F-%E5%AF%BC%E5%87%BA%E5%AE%B9%E5%99%A8"><span class="toc-number">3.3.8.</span> <span class="toc-text">导入&#x2F;导出容器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E6%80%BB%E7%BB%93-1"><span class="toc-number">3.4.</span> <span class="toc-text">小总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker%E9%95%9C%E5%83%8F"><span class="toc-number">4.</span> <span class="toc-text">Docker镜像</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%95%9C%E5%83%8F"><span class="toc-number">4.1.</span> <span class="toc-text">镜像</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E5%B1%82%E7%9A%84%E9%95%9C%E5%83%8F"><span class="toc-number">4.2.</span> <span class="toc-text">分层的镜像</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UnionFS%EF%BC%88%E8%81%94%E5%90%88%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%EF%BC%89"><span class="toc-number">4.3.</span> <span class="toc-text">UnionFS（联合文件系统）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker%E9%95%9C%E5%83%8F%E5%8A%A0%E8%BD%BD%E5%8E%9F%E7%90%86"><span class="toc-number">4.4.</span> <span class="toc-text">Docker镜像加载原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#commit%E5%91%BD%E4%BB%A4"><span class="toc-number">4.5.</span> <span class="toc-text">commit命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E6%80%BB%E7%BB%93-2"><span class="toc-number">4.6.</span> <span class="toc-text">小总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%AC%E5%9C%B0%E9%95%9C%E5%83%8F%E5%8F%91%E5%B8%83%E5%88%B0%E9%98%BF%E9%87%8C%E4%BA%91"><span class="toc-number">4.7.</span> <span class="toc-text">本地镜像发布到阿里云</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AC%E5%9C%B0%E9%95%9C%E5%83%8F%E5%8F%91%E5%B8%83%E5%88%B0%E9%98%BF%E9%87%8C%E4%BA%91%E6%B5%81%E7%A8%8B"><span class="toc-number">4.7.1.</span> <span class="toc-text">本地镜像发布到阿里云流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%95%9C%E5%83%8F%E7%9A%84%E7%94%9F%E6%88%90%E6%96%B9%E6%B3%95"><span class="toc-number">4.7.2.</span> <span class="toc-text">镜像的生成方法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%AC%E5%9C%B0%E9%95%9C%E5%83%8F%E5%8F%91%E5%B8%83%E5%88%B0%E7%A7%81%E6%9C%89%E5%BA%93"><span class="toc-number">4.8.</span> <span class="toc-text">本地镜像发布到私有库</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker%E5%AE%B9%E5%99%A8%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="toc-number">5.</span> <span class="toc-text">Docker容器数据卷</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9D%91%EF%BC%9A%E5%AE%B9%E5%99%A8%E5%8D%B7%E8%AE%B0%E5%BE%97%E5%8A%A0%E5%85%A5"><span class="toc-number">5.1.</span> <span class="toc-text">坑：容器卷记得加入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9E%E9%A1%BE%E4%B8%8B%E4%B8%8A%E4%B8%80%E8%AE%B2%E7%9A%84%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%8C%E5%8F%82%E6%95%B0V"><span class="toc-number">5.2.</span> <span class="toc-text">回顾下上一讲的知识点，参数V</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E5%8D%B7%E6%A1%88%E4%BE%8B"><span class="toc-number">5.3.</span> <span class="toc-text">容器卷案例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%BF%E4%B8%BBvs%E5%AE%B9%E5%99%A8%E4%B9%8B%E9%97%B4%E6%98%A0%E5%B0%84%E6%B7%BB%E5%8A%A0%E5%AE%B9%E5%99%A8%E5%8D%B7"><span class="toc-number">5.3.1.</span> <span class="toc-text">宿主vs容器之间映射添加容器卷</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BB%E5%86%99%E8%A7%84%E5%88%99%E6%98%A0%E5%B0%84%E6%B7%BB%E5%8A%A0%E8%AF%B4%E6%98%8E"><span class="toc-number">5.3.2.</span> <span class="toc-text">读写规则映射添加说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%B7%E7%9A%84%E7%BB%A7%E6%89%BF%E5%92%8C%E5%85%B1%E4%BA%AB"><span class="toc-number">5.3.3.</span> <span class="toc-text">卷的继承和共享</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker%E5%B8%B8%E8%A7%84%E5%AE%89%E8%A3%85%E7%AE%80%E4%BB%8B"><span class="toc-number">6.</span> <span class="toc-text">Docker常规安装简介</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85tomcat"><span class="toc-number">6.1.</span> <span class="toc-text">安装tomcat</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85redis"><span class="toc-number">6.2.</span> <span class="toc-text">安装redis</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85vscode"><span class="toc-number">6.3.</span> <span class="toc-text">安装vscode</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85mysql"><span class="toc-number">6.4.</span> <span class="toc-text">安装mysql</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%A1%88%E4%B8%80"><span class="toc-number">6.4.1.</span> <span class="toc-text">方案一</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%A1%88%E4%BA%8C"><span class="toc-number">6.4.2.</span> <span class="toc-text">方案二</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E4%BB%96"><span class="toc-number">6.4.3.</span> <span class="toc-text">其他</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85doccano"><span class="toc-number">6.5.</span> <span class="toc-text">安装doccano</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85Label-Studio"><span class="toc-number">6.6.</span> <span class="toc-text">安装Label Studio</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85vnc%EF%BC%88%E5%BA%9F%E5%BC%83%EF%BC%89"><span class="toc-number">6.7.</span> <span class="toc-text">安装vnc（废弃）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85vnc2"><span class="toc-number">6.8.</span> <span class="toc-text">安装vnc2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85postgres"><span class="toc-number">6.9.</span> <span class="toc-text">安装postgres</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E4%B8%8D%E5%90%8C%E7%89%88%E6%9C%AC%E7%9A%84chrome"><span class="toc-number">6.10.</span> <span class="toc-text">安装不同版本的chrome</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85centos"><span class="toc-number">6.11.</span> <span class="toc-text">安装centos</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85ubuntu"><span class="toc-number">6.12.</span> <span class="toc-text">安装ubuntu</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E5%90%AF%E5%AE%B9%E5%99%A8"><span class="toc-number">6.12.1.</span> <span class="toc-text">开启容器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E6%BA%90"><span class="toc-number">6.12.2.</span> <span class="toc-text">更新源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E5%B8%B8%E8%A7%81%E7%9A%84%E8%BD%AF%E4%BB%B6"><span class="toc-number">6.12.3.</span> <span class="toc-text">安装常见的软件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEgithbub%E6%AD%A3%E5%B8%B8%E8%AE%BF%E9%97%AE"><span class="toc-number">6.12.4.</span> <span class="toc-text">配置githbub正常访问</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E5%BB%BA%E7%94%A8%E6%88%B7%E5%B9%B6%E9%85%8D%E7%BD%AEsudoers"><span class="toc-number">6.12.5.</span> <span class="toc-text">新建用户并配置sudoers</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85lgsm"><span class="toc-number">6.12.6.</span> <span class="toc-text">安装lgsm</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85oxide%E6%8F%92%E4%BB%B6"><span class="toc-number">6.12.7.</span> <span class="toc-text">安装oxide插件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker%E5%A4%8D%E6%9D%82%E5%AE%89%E8%A3%85%E8%AF%A6%E8%AF%B4"><span class="toc-number">7.</span> <span class="toc-text">Docker复杂安装详说</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85mysql%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6"><span class="toc-number">7.1.</span> <span class="toc-text">安装mysql主从复制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85redis%E9%9B%86%E7%BE%A4"><span class="toc-number">7.2.</span> <span class="toc-text">安装redis集群</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%93%88%E5%B8%8C%E5%8F%96%E4%BD%99%E5%88%86%E5%8C%BA"><span class="toc-number">7.2.1.</span> <span class="toc-text">哈希取余分区</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95%E5%88%86%E5%8C%BA"><span class="toc-number">7.2.2.</span> <span class="toc-text">一致性哈希算法分区</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%93%88%E5%B8%8C%E6%A7%BD%E5%88%86%E5%8C%BA"><span class="toc-number">7.2.3.</span> <span class="toc-text">哈希槽分区</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E4%B8%BB3%E4%BB%8Eredis%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA"><span class="toc-number">7.2.4.</span> <span class="toc-text">3主3从redis集群搭建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E8%AF%BB%E5%86%99%E5%AD%98%E5%82%A8"><span class="toc-number">7.2.5.</span> <span class="toc-text">数据读写存储</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E9%9B%86%E7%BE%A4%E4%BF%A1%E6%81%AF"><span class="toc-number">7.2.6.</span> <span class="toc-text">查看集群信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%B9%E9%94%99%E5%88%87%E6%8D%A2%E8%BF%81%E7%A7%BB"><span class="toc-number">7.2.7.</span> <span class="toc-text">容错切换迁移</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E4%BB%8E%E6%89%A9%E5%AE%B9%E6%A1%88%E4%BE%8B"><span class="toc-number">7.2.8.</span> <span class="toc-text">主从扩容案例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E4%BB%8E%E7%BC%A9%E5%AE%B9%E6%A1%88%E4%BE%8B"><span class="toc-number">7.2.9.</span> <span class="toc-text">主从缩容案例</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#DockerFile%E8%A7%A3%E6%9E%90"><span class="toc-number">8.</span> <span class="toc-text">DockerFile解析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">8.1.</span> <span class="toc-text">是什么</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DockerFile%E6%9E%84%E5%BB%BA%E8%BF%87%E7%A8%8B%E8%A7%A3%E6%9E%90"><span class="toc-number">8.2.</span> <span class="toc-text">DockerFile构建过程解析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DockerFile%E5%B8%B8%E7%94%A8%E4%BF%9D%E7%95%99%E5%AD%97%E6%8C%87%E4%BB%A4"><span class="toc-number">8.3.</span> <span class="toc-text">DockerFile常用保留字指令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B"><span class="toc-number">8.4.</span> <span class="toc-text">案例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A6%81%E6%B1%82"><span class="toc-number">8.4.1.</span> <span class="toc-text">要求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E5%86%99"><span class="toc-number">8.4.2.</span> <span class="toc-text">编写</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA"><span class="toc-number">8.4.3.</span> <span class="toc-text">构建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C"><span class="toc-number">8.4.4.</span> <span class="toc-text">运行</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%99%9A%E6%82%AC%E9%95%9C%E5%83%8F"><span class="toc-number">8.5.</span> <span class="toc-text">虚悬镜像</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5"><span class="toc-number">8.6.</span> <span class="toc-text">Docker微服务实践</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker%E7%BD%91%E7%BB%9C"><span class="toc-number">9.</span> <span class="toc-text">Docker网络</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%98%AF%E4%BB%80%E4%B9%88-1"><span class="toc-number">9.1.</span> <span class="toc-text">是什么</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4"><span class="toc-number">9.2.</span> <span class="toc-text">常用基本命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%83%BD%E5%B9%B2%E5%98%9B-1"><span class="toc-number">9.3.</span> <span class="toc-text">能干嘛</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%BC%8F"><span class="toc-number">9.4.</span> <span class="toc-text">网络模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E4%BD%93%E4%BB%8B%E7%BB%8D"><span class="toc-number">9.4.1.</span> <span class="toc-text">总体介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E5%AE%9E%E4%BE%8B%E5%86%85%E9%BB%98%E8%AE%A4%E7%BD%91%E7%BB%9CIP%E7%94%9F%E4%BA%A7%E8%A7%84%E5%88%99"><span class="toc-number">9.4.2.</span> <span class="toc-text">容器实例内默认网络IP生产规则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bridge"><span class="toc-number">9.4.3.</span> <span class="toc-text">bridge</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#host"><span class="toc-number">9.4.4.</span> <span class="toc-text">host</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#none"><span class="toc-number">9.4.5.</span> <span class="toc-text">none</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#container"><span class="toc-number">9.4.6.</span> <span class="toc-text">container</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BD%91%E7%BB%9C"><span class="toc-number">9.4.7.</span> <span class="toc-text">自定义网络</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%B0%86%E4%B8%A4%E4%B8%AA%E5%B7%B2%E7%BB%8F%E8%BF%90%E8%A1%8C%E7%9A%84%E5%AE%B9%E5%99%A8%E6%9C%8D%E5%8A%A1%EF%BC%8C%E5%AE%9E%E7%8E%B0%E7%BD%91%E7%BB%9C%E4%BA%92%E9%80%9A"><span class="toc-number">9.4.8.</span> <span class="toc-text">如何将两个已经运行的容器服务，实现网络互通</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ubuntu%E5%AE%B9%E5%99%A8%E8%AE%BF%E9%97%AE%E5%AE%BF%E4%B8%BB%E6%9C%BA%E4%B8%AD%E5%8F%A6%E4%B8%80%E4%B8%AA%E5%AE%B9%E5%99%A8%E7%9A%84postgers%E6%9C%8D%E5%8A%A1"><span class="toc-number">9.4.9.</span> <span class="toc-text">ubuntu容器访问宿主机中另一个容器的postgers服务</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker-compose%E5%AE%B9%E5%99%A8%E7%BC%96%E6%8E%92"><span class="toc-number">10.</span> <span class="toc-text">Docker-compose容器编排</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%98%AF%E4%BB%80%E4%B9%88-2"><span class="toc-number">10.1.</span> <span class="toc-text">是什么</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%83%BD%E5%B9%B2%E5%98%9B-2"><span class="toc-number">10.2.</span> <span class="toc-text">能干嘛</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%BB%E5%93%AA%E4%B8%8B-1"><span class="toc-number">10.3.</span> <span class="toc-text">去哪下</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Compose%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="toc-number">10.4.</span> <span class="toc-text">Compose核心概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Compose%E4%BD%BF%E7%94%A8%E7%9A%84%E4%B8%89%E4%B8%AA%E6%AD%A5%E9%AA%A4"><span class="toc-number">10.5.</span> <span class="toc-text">Compose使用的三个步骤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Compose%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">10.6.</span> <span class="toc-text">Compose常用命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B-1"><span class="toc-number">10.7.</span> <span class="toc-text">案例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8D%E7%94%A8Compose"><span class="toc-number">10.7.1.</span> <span class="toc-text">不用Compose</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Compose"><span class="toc-number">10.7.2.</span> <span class="toc-text">使用Compose</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker%E8%BD%BB%E9%87%8F%E7%BA%A7%E5%8F%AF%E8%A7%86%E5%8C%96%E5%B7%A5%E5%85%B7Portainer"><span class="toc-number">11.</span> <span class="toc-text">Docker轻量级可视化工具Portainer</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker%E5%AE%B9%E5%99%A8%E7%9B%91%E6%8E%A7%E4%B9%8BCAdvisor-InfluxDB-Granfana"><span class="toc-number">12.</span> <span class="toc-text">Docker容器监控之CAdvisor + InfluxDB + Granfana</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E7%94%9F%E5%91%BD%E4%BB%A4"><span class="toc-number">12.1.</span> <span class="toc-text">原生命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E7%9B%91%E6%8E%A73%E5%89%91%E5%AE%A2"><span class="toc-number">12.2.</span> <span class="toc-text">容器监控3剑客</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CAdvisor"><span class="toc-number">12.2.1.</span> <span class="toc-text">CAdvisor</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#InfluxDB"><span class="toc-number">12.2.2.</span> <span class="toc-text">InfluxDB</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Granfana"><span class="toc-number">12.2.3.</span> <span class="toc-text">Granfana</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#compose%E5%AE%B9%E5%99%A8%E7%BC%96%E6%8E%92"><span class="toc-number">12.3.</span> <span class="toc-text">compose容器编排</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">13.</span> <span class="toc-text">总结</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3"><span class="toc-number">14.</span> <span class="toc-text">问题解决</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker-x2F-var-x2F-lib-x2F-docker-x2F-overlay2%E5%8D%A0%E7%94%A8%E8%BF%87%E5%A4%A7%E9%97%AE%E9%A2%98"><span class="toc-number">14.1.</span> <span class="toc-text">Docker &#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2占用过大问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%AE%B9%E5%99%A8%E6%98%A0%E5%B0%84%E4%BF%A1%E6%81%AF"><span class="toc-number">14.2.</span> <span class="toc-text">修改容器映射信息</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/10/16/web/web/Books/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6%E5%AF%BC%E8%AE%BA%E3%80%8B/" title="《计算机科学导论》">《计算机科学导论》</a><time datetime="2023-10-15T23:31:58.000Z" title="发表于 2023-10-16 07:31:58">2023-10-16</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/09/11/web/web/%E5%B7%A5%E7%A8%8B%E5%8C%96%E5%BC%80%E5%8F%91%E5%92%8C%E9%83%A8%E7%BD%B2/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/" title="前端开发流程">前端开发流程</a><time datetime="2023-09-11T01:03:02.000Z" title="发表于 2023-09-11 09:03:02">2023-09-11</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/07/13/web/data/%E8%BD%AF%E4%BB%B6%E4%BD%BF%E7%94%A8/Django/" title="Django">Django</a><time datetime="2023-07-13T01:03:02.000Z" title="发表于 2023-07-13 09:03:02">2023-07-13</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/07/12/web/web/%E5%85%B6%E4%BB%96/%E7%94%B5%E8%84%91%E7%A1%AC%E4%BB%B6/" title="电脑硬件">电脑硬件</a><time datetime="2023-07-12T01:03:02.000Z" title="发表于 2023-07-12 09:03:02">2023-07-12</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/05/04/web/data/%E6%95%B0%E6%8D%AE%E7%BB%9F%E8%AE%A1%E4%B8%8E%E5%88%86%E6%9E%90/Excel%E6%B2%BB%E7%90%86%E4%B8%8E%E5%85%A5%E5%BA%93/" title="Excel治理与入库">Excel治理与入库</a><time datetime="2023-05-04T01:03:02.000Z" title="发表于 2023-05-04 09:03:02">2023-05-04</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://bu.dusays.com/2023/02/10/63e57cef87293.webp')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 <i id="heartbeat" class="fa fas fa-heartbeat"></i> Sai</div><a href="https://icp.gov.moe/?keyword=20230203" target="_blank">萌ICP备20230203号</a><div class="footer_custom_text"><p><a target="_blank" href="https://hexo.io/"><img src="https://bu.dusays.com/2023/02/09/63e488a78b827.webp" title="博客框架为Hexo"></a>&nbsp;<a target="_blank" href="https://butterfly.js.org/"><img src="https://bu.dusays.com/2023/02/10/63e57f321880a.webp" title="主题采用butterfly"></a></p></div></div><link rel="stylesheet" href="/custom/css/heartbeat.min.css" ></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="聊天"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="fa-solid fa-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="fa-solid fa-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="fa-solid fa-arrow-rotate-right"></i></div><div class="rightMenu-item" id="menu-home"><i class="fa-solid fa-house"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" href="/archives/"><i class="fa-solid fa-archive"></i><span>文章归档</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="fa-solid fa-folder-open"></i><span>文章分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="fa-solid fa-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuNormal"><div class="rightMenu-item" id="menu-translate"><i class="fa-solid fa-earth-asia"></i><span>繁简切换</span></div><div class="rightMenu-item" id="menu-darkmode"><i class="fa-solid fa-moon"></i><span>切换模式</span></div><div class="rightMenu-item" id="menu-print"><i class="fa-solid fa-print fa-fw"></i><span>打印页面</span></div></div></div><div id="rightmenu-mask"></div><div id="myscoll"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/algoliasearch/dist/algoliasearch-lite.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instantsearch.js/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo.mindcons.cn/',
      region: '',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo.mindcons.cn/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      countELement.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    GLOBAL_CONFIG_SITE.isPost && getCount()
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><canvas id="universe"></canvas><script defer src="/custom/js/universe.js"></script><script defer src="https://npm.elemecdn.com/jquery@latest/dist/jquery.min.js"></script><script defer data-pjax src="/custom/js/rightMenu.js"></script><script defer data-pjax src="/custom/js/cat.js"></script><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="true"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="false"></script><script>window.$crisp = [];
window.CRISP_WEBSITE_ID = "717070d8-e449-4d60-b9b6-c1421478f42c";
(function () {
  d = document;
  s = d.createElement("script");
  s.src = "https://client.crisp.chat/l.js";
  s.async = 1;
  d.getElementsByTagName("head")[0].appendChild(s);
})();
$crisp.push(["safe", true])

if (true) {
  $crisp.push(["do", "chat:hide"])
  $crisp.push(["on", "chat:closed", function() {
    $crisp.push(["do", "chat:hide"])
  }])
  var chatBtnFn = () => {
    var chatBtn = document.getElementById("chat_btn")
    chatBtn.addEventListener("click", function(){
      $crisp.push(["do", "chat:show"])
      $crisp.push(["do", "chat:open"])

    });
  }
  chatBtnFn()
} else {
  if (true) {
    function chatBtnHide () {
      $crisp.push(["do", "chat:hide"])
    }
    function chatBtnShow () {
      $crisp.push(["do", "chat:show"])
    }
  }
}</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>