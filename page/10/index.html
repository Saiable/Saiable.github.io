<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="https://mindcons.cn/page/10/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://mindcons.cn"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-web/框架/Vue/Vue3.0/Vue3基本使用" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/07/25/web/%E6%A1%86%E6%9E%B6/Vue/Vue3.0/Vue3%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/" class="article-date">
  <time class="dt-published" datetime="2022-07-25T12:30:40.000Z" itemprop="datePublished">2022-07-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Vue/">Vue</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/07/25/web/%E6%A1%86%E6%9E%B6/Vue/Vue3.0/Vue3%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/">Vue3基本使用</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <blockquote>
<p>本文承接《Vue2基本使用》</p>
</blockquote>
<h1 id="8-Vue3"><a href="#8-Vue3" class="headerlink" title="8.Vue3"></a>8.<code>Vue3</code></h1><h2 id="8-1-Vue3快速上手"><a href="#8-1-Vue3快速上手" class="headerlink" title="8.1.Vue3快速上手"></a>8.1.<code>Vue3</code>快速上手</h2><h3 id="8-1-1-Vue3简介"><a href="#8-1-1-Vue3简介" class="headerlink" title="8.1.1.Vue3简介"></a>8.1.1.<code>Vue3</code>简介</h3><ul>
<li>2020年9月18日，<code>Vue.js</code>发布3.0版本，代号：<code>One Piece</code>（海贼王）</li>
<li>耗时2年多，<span style="color:red">2600+次提交、<a target="_blank" rel="noopener" href="https://github.com/vuejs/rfcs">30+个RFC</a>、600+次PR、99位贡献者</span></li>
<li><code>github</code>上的<code>tags</code>地址：<a target="_blank" rel="noopener" href="https://github.com/vuejs/core/tree/v3.2.36">https://github.com/vuejs/core/tree/v3.2.36</a></li>
</ul>
<h3 id="8-1-2-Vue3带来了什么"><a href="#8-1-2-Vue3带来了什么" class="headerlink" title="8.1.2.Vue3带来了什么"></a>8.1.2.<code>Vue3</code>带来了什么</h3><h4 id="8-1-2-1-性能的提升"><a href="#8-1-2-1-性能的提升" class="headerlink" title="8.1.2.1.性能的提升"></a>8.1.2.1.性能的提升</h4><ul>
<li>打包大小减少<code>41%</code></li>
<li>初次渲染快<code>55%</code>，更新渲染快<code>133%</code></li>
<li>内存减少<code>54%</code></li>
<li>…</li>
</ul>
<h4 id="8-1-2-2-源码的升级"><a href="#8-1-2-2-源码的升级" class="headerlink" title="8.1.2.2.源码的升级"></a>8.1.2.2.源码的升级</h4><ul>
<li>使用<code>Proxy</code>代替<code>defineProperty</code>实现响应式</li>
<li>重写虚拟<code>dom</code>的实现和<code>tree-shaking</code></li>
<li>…</li>
</ul>
<h4 id="8-1-2-3-拥抱TypeScript"><a href="#8-1-2-3-拥抱TypeScript" class="headerlink" title="8.1.2.3.拥抱TypeScript"></a>8.1.2.3.拥抱<code>TypeScript</code></h4><ul>
<li><code>Vue3</code>可以更好的支持<code>tree-shaking</code></li>
</ul>
<h4 id="8-1-2-4-新特性"><a href="#8-1-2-4-新特性" class="headerlink" title="8.1.2.4.新特性"></a>8.1.2.4.新特性</h4><ul>
<li><code>Composition API</code>（组合式<code>API</code>）<ul>
<li><code>setup</code>配置</li>
<li><code>ref</code>和<code>reactive</code></li>
<li><code>watch</code>和<code>watchEffect</code></li>
<li><code>provide</code>和<code>inject</code></li>
<li>…</li>
</ul>
</li>
<li>新的内置组件<ul>
<li><code>Fragment</code></li>
<li><code>Teleport</code></li>
<li><code>Suspense</code></li>
</ul>
</li>
<li>其他改变<ul>
<li>新的生命周期钩子</li>
<li><code>data</code>选项应始终被声明为一个函数</li>
<li>移除<code>keyCode</code>支持作为<code>v-on</code>的修饰符</li>
<li>…</li>
</ul>
</li>
</ul>
<h2 id="8-2-创建Vue3工程"><a href="#8-2-创建Vue3工程" class="headerlink" title="8.2.创建Vue3工程"></a>8.2.创建<code>Vue3</code>工程</h2><h3 id="8-2-1-使用vue-cli创建"><a href="#8-2-1-使用vue-cli创建" class="headerlink" title="8.2.1.使用vue-cli创建"></a>8.2.1.使用<code>vue-cli</code>创建</h3><p>官方文档：<a target="_blank" rel="noopener" href="https://cli.vuejs.org/zh/guide/creating-a-project.html#vue-create">https://cli.vuejs.org/zh/guide/creating-a-project.html#vue-create</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 查看@vue/cli版本，确保@vue/cli版本在4.5.0以上</span></span><br><span class="line">vue --version</span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">vue -V</span><br><span class="line"></span><br><span class="line"><span class="comment">## 安装或升级@vue/cli</span></span><br><span class="line">npm install @vue/cli -g</span><br><span class="line"><span class="comment">## 或者</span></span><br><span class="line">npm install @vue/cli -D</span><br><span class="line"></span><br><span class="line"><span class="comment">## 创建</span></span><br><span class="line">vue create vue3_project</span><br><span class="line"><span class="comment">## 或者</span></span><br><span class="line">npx vue create vue3_project</span><br><span class="line"></span><br><span class="line"><span class="comment">## 启动</span></span><br><span class="line"><span class="built_in">cd</span> vue_project3</span><br><span class="line">npm run serve</span><br></pre></td></tr></table></figure>



<h3 id="8-2-2-使用vite创建"><a href="#8-2-2-使用vite创建" class="headerlink" title="8.2.2.使用vite创建"></a>8.2.2.使用<code>vite</code>创建</h3><p>官方文档：<a target="_blank" rel="noopener" href="https://v3.cn.vuejs.org/guide/installation.html#vite">https://v3.cn.vuejs.org/guide/installation.html#vite</a></p>
<p>什么是<code>vite</code>？新一代前端构建工具</p>
<p>优势：</p>
<ul>
<li><p>开发环境中，无需打包操作，可快速的冷启动</p>
</li>
<li><p>轻量快速的热重载（<code>HMR</code>）</p>
</li>
<li><p>真正的按需编译，不再等待整个应用编译完成</p>
</li>
<li><p>传统构建与<code>vite</code>构建对比图</p>
<img src="bundler.37740380.png" alt="基于打包器的开发服务器" style="zoom:30%;" />

<img src="esm.3070012d.png" alt="基于 ESM 的开发服务器" style="zoom:35%;" /></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># npm 6.x</span></span><br><span class="line">npm init vite@latest my-vue-app --template vue</span><br><span class="line"></span><br><span class="line"><span class="comment"># npm 7+, 需要额外的双横线：</span></span><br><span class="line">npm init vite@latest my-vue-app -- --template vue</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> my-vue-app</span><br><span class="line">npm install</span><br><span class="line">npm run dev</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="8-2-3-分析工程结构"><a href="#8-2-3-分析工程结构" class="headerlink" title="8.2.3.分析工程结构"></a>8.2.3.分析工程结构</h3><p>分析的是<code>vue-cli</code>方式创建的目录结构</p>
<h4 id="src-main-js"><a href="#src-main-js" class="headerlink" title="src/main.js"></a><code>src/main.js</code></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">createApp</span>(<span class="title class_">App</span>).<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><p><code>import &#123; createApp &#125; from &#39;vue&#39;</code></p>
<ul>
<li>引入的不再是<code>Vue</code>构造函数了，而是一个名为<code>createApp</code>的工厂函数（无需通过<code>new</code>关键字调用）</li>
</ul>
</li>
<li><p><code>createApp(App).mount(&#39;#app&#39;)</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="title class_">App</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(app)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li><p>创建应用实例对象，<code>app</code>类似于<code>vue2</code>中的<code>vm</code>，但<code>app</code>比<code>vm</code>更轻</p>
<p><img src="/2022/07/25/web/%E6%A1%86%E6%9E%B6/Vue/Vue3.0/Vue3%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/image-20220607054736154.png" alt="image-20220607054736154"></p>
</li>
<li><p>注意，并不兼容之前的<code>new Vue</code>的写法，<code>import Vue from &#39;vue&#39;</code>时，<code>Vue</code>时<code>undefined</code></p>
</li>
</ul>
</li>
</ul>
<h4 id="App-vue"><a href="#App-vue" class="headerlink" title="App.vue"></a><code>App.vue</code></h4><ul>
<li><code>template</code>中可以没有根标签</li>
</ul>
<h3 id="8-2-4-安装vue3对应的开发者工具"><a href="#8-2-4-安装vue3对应的开发者工具" class="headerlink" title="8.2.4.安装vue3对应的开发者工具"></a>8.2.4.安装<code>vue3</code>对应的开发者工具</h3><p>直接去官网：<a target="_blank" rel="noopener" href="https://devtools.vuejs.org/guide/installation.html">https://devtools.vuejs.org/guide/installation.html</a></p>
<h2 id="8-3-常用Composition-API"><a href="#8-3-常用Composition-API" class="headerlink" title="8.3.常用Composition API"></a>8.3.常用<code>Composition API</code></h2><p>官方文档：</p>
<h3 id="8-3-1-拉开序幕的setup"><a href="#8-3-1-拉开序幕的setup" class="headerlink" title="8.3.1.拉开序幕的setup"></a>8.3.1.拉开序幕的<code>setup</code></h3><ul>
<li><p>理解：<code>Vue3</code>中的一个新的配置项，值为一个函数</p>
</li>
<li><p><code>setup</code>是所有<code>Composition API</code>（组合<code>API</code>）表演的舞台</p>
</li>
<li><p>组件中所用到的：数据，方法等等，均要配置在<code>setup</code>中</p>
</li>
<li><p><code>setup</code>函数的两种返回值</p>
<ul>
<li><p>若返回一个对象，则对象中的属性、方法，在模板中均可以直接使用。（重点关注）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	<span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>我是App组件<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">	<span class="language-xml"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>姓名： &#123;&#123;name&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line">	<span class="language-xml"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>姓名： &#123;&#123;age&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line">	<span class="language-xml"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;sayHello&quot;</span>&gt;</span>click<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">	<span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">		<span class="attr">name</span>: <span class="string">&#x27;App&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">		<span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">			<span class="keyword">let</span> name = <span class="string">&#x27;sai&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">			<span class="keyword">let</span> age = <span class="number">18</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">			</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">			<span class="keyword">function</span> <span class="title function_">sayHello</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">				<span class="title function_">alert</span>(<span class="string">`你好呀，<span class="subst">$&#123;name&#125;</span>,今年我<span class="subst">$&#123;age&#125;</span>岁了`</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">			&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">			</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">			<span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">				name,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">				age,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">				sayHello</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">			&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">		&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">	&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/2022/07/25/web/%E6%A1%86%E6%9E%B6/Vue/Vue3.0/Vue3%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/image-20220607064823164.png" alt="image-20220607064823164"></p>
</li>
<li><p>若返回一个渲染函数，则可以自定义渲染内容（了解）</p>
<ul>
<li>模板里的内容会被渲染函数的返回内容覆盖</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;!-- 内容会被覆盖 --&gt;</span><br><span class="line">	&lt;h1&gt;我是App组件&lt;/h1&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">	import &#123;h&#125; from &#x27;vue&#x27;</span><br><span class="line">	export default &#123;</span><br><span class="line">		name: &#x27;App&#x27;,</span><br><span class="line">		setup() &#123;</span><br><span class="line">			// return () =&gt; &#123;</span><br><span class="line">			// 	return h(&#x27;h1&#x27;, &#x27;sai&#x27;)</span><br><span class="line">			// &#125;</span><br><span class="line"></span><br><span class="line">			// 简写</span><br><span class="line">			return () =&gt; h(&#x27;h1&#x27;, &#x27;sai&#x27;)</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>注意点：</p>
<ul>
<li>尽量不要和<code>vue2.x</code>配置混用<ul>
<li><code>vue2.x</code>配置（<code>data</code>、<code>methods</code>、<code>computed</code>…）中可以访问到<code>setup</code>中的属性和方法</li>
<li>但在<code>setup</code>中不能访问到<code>vue2.x</code>配置（<code>data</code>、<code>methods</code>、<code>computed</code>…）</li>
<li>如果有重名，<code>setup</code>优先</li>
</ul>
</li>
<li><code>setup</code>不能是一个<code>async</code>函数，因为返回值不再是<code>return</code>的对象，而是<code>promise</code>，模板中看不到对象中的属性（后期学到了<code>Suspence</code>，其实是可以的）</li>
</ul>
</li>
</ul>
<h3 id="8-3-2-ref函数"><a href="#8-3-2-ref函数" class="headerlink" title="8.3.2.ref函数"></a>8.3.2.<code>ref</code>函数</h3><p><code>vue2</code>中的<code>ref</code>是一个标签属性，<code>vue3</code>中多了一个同名的函数</p>
<h4 id="8-3-2-1ref函数处理基本数据类型"><a href="#8-3-2-1ref函数处理基本数据类型" class="headerlink" title="8.3.2.1ref函数处理基本数据类型"></a>8.3.2.1<code>ref</code>函数处理基本数据类型</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;h1&gt;我是App组件&lt;/h1&gt;</span><br><span class="line">  &lt;h2&gt;姓名：&#123;&#123;name&#125;&#125;&lt;/h2&gt;</span><br><span class="line">  &lt;h2&gt;年龄：&#123;&#123;age&#125;&#125;&lt;/h2&gt;</span><br><span class="line">  &lt;button @click=&quot;modifyInfo&quot;&gt;修改信息&lt;/button&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;App&#x27;,</span><br><span class="line">  setup() &#123;</span><br><span class="line">    let name = &#x27;sai&#x27;</span><br><span class="line">    let age = 18</span><br><span class="line"></span><br><span class="line">    function modifyInfo() &#123;</span><br><span class="line">      name = &#x27;sai_change&#x27;</span><br><span class="line">      age = 19</span><br><span class="line">      console.log(name, age)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return &#123;</span><br><span class="line">      name,</span><br><span class="line">      age,</span><br><span class="line">      modifyInfo</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这个案例中，我们修改了数据，但是页面上并没有更新</p>
<p><img src="/2022/07/25/web/%E6%A1%86%E6%9E%B6/Vue/Vue3.0/Vue3%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/image-20220607090829602.png" alt="image-20220607090829602"></p>
<p>因为<code>vue</code>并没有监视到数据的变化，上述方式定义的数据并不是响应式数据</p>
<p>如何把普通的数据，变成一个能被<code>vue</code>监测到的响应式数据呢？</p>
<p>借助<code>ref</code>函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">import &#123;ref&#125; from &#x27;vue&#x27;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;App&#x27;,</span><br><span class="line">  setup() &#123;</span><br><span class="line">    let name = ref(&#x27;sai&#x27;)</span><br><span class="line">    let age = ref(18)</span><br><span class="line"></span><br><span class="line">    function modifyInfo() &#123;</span><br><span class="line">      name = &#x27;sai_change&#x27;</span><br><span class="line">      age = 19</span><br><span class="line">      console.log(name, age)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return &#123;</span><br><span class="line">      name,</span><br><span class="line">      age,</span><br><span class="line">      modifyInfo</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>那么直接能这样改吗？不能！！！上述代码执行后，点击修改按钮页面仍然没有变化</p>
<p>为啥咧？因为我们改的地方不对！！</p>
<p>我们先注释掉修改的两行代码，直接打印被<code>ref</code>包裹的<code>name</code>和<code>age</code></p>
<p><img src="/2022/07/25/web/%E6%A1%86%E6%9E%B6/Vue/Vue3.0/Vue3%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/image-20220607092144979.png" alt="image-20220607092144979"></p>
<ul>
<li><p><code>RefImpl</code>：<code>Refenrence Implement</code>（引用的实现），表示一个引用实现对象</p>
</li>
<li><p><code>RefImpl</code>对象也是通过<code>Object.defineProperty</code>实现数据响应式的</p>
<ul>
<li>类比于<code>vue2</code>的<code>_data</code>身上的属性，为了便于读写，给了<code>vm</code>一份属性</li>
<li><code>RefImpl</code>对象的原型对象上定义着<code>getter</code>和<code>setter</code>，然后又给了<code>RefImpl</code>对象一份属性</li>
</ul>
</li>
<li><p>读写数据会根据原型链查找<code>getter</code>和<code>setter</code></p>
<ul>
<li><p>读数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;h2&gt;姓名：&#123;&#123;name&#125;&#125;&lt;/h2&gt;</span><br><span class="line">&lt;h2&gt;年龄：&#123;&#123;age&#125;&#125;&lt;/h2&gt;</span><br></pre></td></tr></table></figure>

<p>插值语法中，不用写成<code>name.value</code>和<code>age.value</code>，<code>vue</code>在解析模板读取数据时，如果变量是一个<code>RefImpl</code>引用实现对象，则会自动读取其<code>value</code>的属性值</p>
<ul>
<li>读数据，会调用引用实现对象的原型对象的<code>getter</code></li>
</ul>
</li>
<li><p>写数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">import &#123;ref&#125; from &#x27;vue&#x27;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;App&#x27;,</span><br><span class="line">  setup() &#123;</span><br><span class="line">    let name = ref(&#x27;sai&#x27;)</span><br><span class="line">    let age = ref(18)</span><br><span class="line"></span><br><span class="line">    function modifyInfo() &#123;</span><br><span class="line">      name.value = &#x27;sai_change&#x27;</span><br><span class="line">      age.value = 19</span><br><span class="line">      console.log(name, age)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return &#123;</span><br><span class="line">      name,</span><br><span class="line">      age,</span><br><span class="line">      modifyInfo</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>写数据，会调用引用实现对象的原型对象的<code>setter</code></p>
</li>
<li><p><code>setter</code>内部封装更新页面的逻辑</p>
</li>
<li><p>此时页面更新了</p>
<p><img src="/2022/07/25/web/%E6%A1%86%E6%9E%B6/Vue/Vue3.0/Vue3%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/image-20220607094215557.png" alt="image-20220607094215557"></p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="8-3-2-2-ref函数处理对象数据类型"><a href="#8-3-2-2-ref函数处理对象数据类型" class="headerlink" title="8.3.2.2.ref函数处理对象数据类型"></a>8.3.2.2.<code>ref</code>函数处理对象数据类型</h4><p>先梳理一下<code>ref</code>函数处理基本数据类型的逻辑</p>
<ul>
<li>通过<code>ref</code>函数包裹基本数据类型，返回一个引用实现对象，可以通过<code>value</code>属性，取得包裹的数据的值</li>
<li>响应式实现方式，通过<code>Object.defineProperty</code>在其原型对象上定义<code>getter</code>和<code>setter</code></li>
</ul>
<p>按照类似的逻辑，<code>ref</code>函数处理对象类型的数据，也应该是这样的</p>
<ul>
<li><p>使用<code>ref</code>包裹对象类型的数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;h1&gt;我是App组件&lt;/h1&gt;</span><br><span class="line">  &lt;h2&gt;姓名： &#123;&#123;person.name&#125;&#125;&lt;/h2&gt;</span><br><span class="line">  &lt;h2&gt;年龄： &#123;&#123;person.age&#125;&#125;&lt;/h2&gt;</span><br><span class="line">  &lt;button @click=&quot;modifyInfo&quot;&gt;修改信息&lt;/button&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123;ref&#125; from &#x27;vue&#x27;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;App&#x27;,</span><br><span class="line">  setup() &#123;</span><br><span class="line"></span><br><span class="line">    let person = ref(&#123;</span><br><span class="line">      name: &#x27;sai&#x27;,</span><br><span class="line">      age: 18</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    function modifyInfo() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return &#123;</span><br><span class="line">      person,</span><br><span class="line">      modifyInfo</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/07/25/web/%E6%A1%86%E6%9E%B6/Vue/Vue3.0/Vue3%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/image-20220607100950658.png" alt="image-20220607100950658"></p>
</li>
<li><p>根据<code>vue2</code>的经验，<code>vue3</code>应该会对对象的每个属性，都设置<code>getter</code>和<code>setter</code>，所以我们修改<code>age</code>属性时，应该是<code>person.value.age.value=19</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;h1&gt;我是App组件&lt;/h1&gt;</span><br><span class="line">  &lt;h2&gt;姓名： &#123;&#123;person.name&#125;&#125;&lt;/h2&gt;</span><br><span class="line">  &lt;h2&gt;年龄： &#123;&#123;person.age&#125;&#125;&lt;/h2&gt;</span><br><span class="line">  &lt;button @click=&quot;modifyInfo&quot;&gt;修改信息&lt;/button&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123;ref&#125; from &#x27;vue&#x27;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;App&#x27;,</span><br><span class="line">  setup() &#123;</span><br><span class="line"></span><br><span class="line">    let person = ref(&#123;</span><br><span class="line">      name: &#x27;sai&#x27;,</span><br><span class="line">      age: 18</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    function modifyInfo() &#123;</span><br><span class="line">        // 修改数据</span><br><span class="line">        person.value.name.value = &#x27;sai_modify&#x27;</span><br><span class="line">        person.value.age.value = 19</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return &#123;</span><br><span class="line">      person,</span><br><span class="line">      modifyInfo</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>但是，此时修改不了</p>
<p><img src="/2022/07/25/web/%E6%A1%86%E6%9E%B6/Vue/Vue3.0/Vue3%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/image-20220607101141197.png" alt="image-20220607101141197"></p>
</li>
<li><p>为啥咧</p>
<ul>
<li><p>打印下<code>person</code>引用实现对象，以及<code>value</code>属性</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">modifyInfo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 修改数据</span></span><br><span class="line">  <span class="comment">// person.value.name.value = &#x27;sai_modify&#x27;</span></span><br><span class="line">  <span class="comment">// person.value.age.value = 19</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(person)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(person.<span class="property">value</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/07/25/web/%E6%A1%86%E6%9E%B6/Vue/Vue3.0/Vue3%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/image-20220607101407849.png" alt="image-20220607101407849"></p>
</li>
<li><p>可以看到，<code>ref</code>函数处理对象数据类型，用的是<code>ES6</code>中的<code>Proxy</code>，关于<code>Proxy</code>下一小节详细讲解</p>
</li>
</ul>
</li>
</ul>
<h4 id="8-3-2-3-小结：ref函数"><a href="#8-3-2-3-小结：ref函数" class="headerlink" title="8.3.2.3.小结：ref函数"></a>8.3.2.3.小结：<code>ref</code>函数</h4><ul>
<li>作用：定义一个响应式的数据</li>
<li>语法：<code>const xxx = ref(initValue)</code><ul>
<li>创建一个包含响应式数据的引用对象（<code>reference</code>对象）</li>
<li><code>JS</code>中操作数据：<code>xxx.value</code></li>
<li>模板中读取数据，不需要<code>.value</code>，直接<code>&lt;div&gt;&#123;&#123;xxx&#125;&#125;&lt;/div&gt;</code></li>
</ul>
</li>
<li>备注：<ul>
<li>接收的数据可以是基本数据类型，也可以是对象数据类型</li>
<li>基本数据类型：响应式依然靠的是<code>Object.defineProperty</code>的<code>get</code>与<code>set</code></li>
<li>对象数据类型：内部<code>求助</code>了<code>Vue3</code>中的一个新函数——<code>reactive</code>函数</li>
</ul>
</li>
</ul>
<h3 id="8-3-3-reactive函数"><a href="#8-3-3-reactive函数" class="headerlink" title="8.3.3.reactive函数"></a>8.3.3.<code>reactive</code>函数</h3><p>将源对象交给<code>reactive</code>处理，返回的是一个代理对象</p>
<h4 id="8-3-3-1-返回的是Proxy对象"><a href="#8-3-3-1-返回的是Proxy对象" class="headerlink" title="8.3.3.1.返回的是Proxy对象"></a>8.3.3.1.返回的是<code>Proxy</code>对象</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;h1&gt;我是App组件&lt;/h1&gt;</span><br><span class="line">  &lt;h2&gt;姓名： &#123;&#123;person.name&#125;&#125;&lt;/h2&gt;</span><br><span class="line">  &lt;h2&gt;年龄： &#123;&#123;person.age&#125;&#125;&lt;/h2&gt;</span><br><span class="line">  &lt;button @click=&quot;modifyInfo&quot;&gt;修改信息&lt;/button&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123;reactive&#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;App&#x27;,</span><br><span class="line">  setup() &#123;</span><br><span class="line">    let person = reactive(&#123;</span><br><span class="line">      name: &#x27;sai&#x27;,</span><br><span class="line">      age: 18</span><br><span class="line">    &#125;)</span><br><span class="line">    function modifyInfo() &#123;</span><br><span class="line">      console.log(person) // 这里不用.value，直接使用即可</span><br><span class="line">    &#125;</span><br><span class="line">    return &#123;</span><br><span class="line">      person,</span><br><span class="line">      modifyInfo</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/2022/07/25/web/%E6%A1%86%E6%9E%B6/Vue/Vue3.0/Vue3%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/image-20220607110312006.png" alt="image-20220607110312006"></p>
<p>将源数据改成了<code>Proxy</code>类型的对象</p>
<h4 id="8-3-3-2-修改对象数据类型"><a href="#8-3-3-2-修改对象数据类型" class="headerlink" title="8.3.3.2.修改对象数据类型"></a>8.3.3.2.修改对象数据类型</h4><p>此时可以直接修改对象类型的数据了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;h1&gt;我是App组件&lt;/h1&gt;</span><br><span class="line">  &lt;h2&gt;姓名： &#123;&#123;person.name&#125;&#125;&lt;/h2&gt;</span><br><span class="line">  &lt;h2&gt;年龄： &#123;&#123;person.age&#125;&#125;&lt;/h2&gt;</span><br><span class="line">  &lt;button @click=&quot;modifyInfo&quot;&gt;修改信息&lt;/button&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123;reactive&#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;App&#x27;,</span><br><span class="line">  setup() &#123;</span><br><span class="line">    let person = reactive(&#123;</span><br><span class="line">      name: &#x27;sai&#x27;,</span><br><span class="line">      age: 18</span><br><span class="line">    &#125;)</span><br><span class="line">    function modifyInfo() &#123;</span><br><span class="line">      // 修改数据</span><br><span class="line">      person.name = &#x27;sai_modify&#x27;</span><br><span class="line">      person.age = 19</span><br><span class="line">      console.log(person)</span><br><span class="line">    &#125;</span><br><span class="line">    return &#123;</span><br><span class="line">      person,</span><br><span class="line">      modifyInfo</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/2022/07/25/web/%E6%A1%86%E6%9E%B6/Vue/Vue3.0/Vue3%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/image-20220607111003887.png" alt="image-20220607111003887"></p>
<h4 id="8-3-3-3-修改嵌套的对象数据"><a href="#8-3-3-3-修改嵌套的对象数据" class="headerlink" title="8.3.3.3.修改嵌套的对象数据"></a>8.3.3.3.修改嵌套的对象数据</h4><p>即使对象嵌套的很深，<code>reactive</code>函数也可以监测到其变化：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;h1&gt;我是App组件&lt;/h1&gt;</span><br><span class="line">  &lt;h2&gt;姓名： &#123;&#123;person.name&#125;&#125;&lt;/h2&gt;</span><br><span class="line">  &lt;h2&gt;年龄： &#123;&#123;person.age&#125;&#125;&lt;/h2&gt;</span><br><span class="line">  &lt;h2&gt;测试数据： &#123;&#123;person.a.b.c&#125;&#125;&lt;/h2&gt;</span><br><span class="line">  &lt;button @click=&quot;modifyInfo&quot;&gt;修改信息&lt;/button&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123;reactive&#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;App&#x27;,</span><br><span class="line">  setup() &#123;</span><br><span class="line">    let person = reactive(&#123;</span><br><span class="line">      name: &#x27;sai&#x27;,</span><br><span class="line">      age: 18,</span><br><span class="line">      a: &#123;</span><br><span class="line">        b: &#123;</span><br><span class="line">          c: &#x27;test&#x27;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    function modifyInfo() &#123;</span><br><span class="line">      person.name = &#x27;sai_modify&#x27;</span><br><span class="line">      person.age = 19</span><br><span class="line">      person.a.b.c = &#x27;test_modify&#x27;</span><br><span class="line">      console.log(person)</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    return &#123;</span><br><span class="line">      person,</span><br><span class="line">      modifyInfo</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/07/25/web/%E6%A1%86%E6%9E%B6/Vue/Vue3.0/Vue3%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/image-20220607111533470.png" alt="image-20220607111533470"></p>
<h4 id="8-3-3-4-修改数组数据类型"><a href="#8-3-3-4-修改数组数据类型" class="headerlink" title="8.3.3.4.修改数组数据类型"></a>8.3.3.4.修改数组数据类型</h4><p>被<code>reactive</code>包裹的数组，可以直接通过索引来修改数组类型的数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;h1&gt;我是App组件&lt;/h1&gt;</span><br><span class="line">  &lt;h2&gt;爱好：&#123;&#123;hobby&#125;&#125;&lt;/h2&gt;</span><br><span class="line">  &lt;button @click=&quot;modifyInfo&quot;&gt;修改信息&lt;/button&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    import &#123;reactive&#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">    export default &#123;</span><br><span class="line">        name: &#x27;App&#x27;,</span><br><span class="line">        setup() &#123;</span><br><span class="line">            let hobby = reactive([&#x27;eat&#x27;,&#x27;drink&#x27;])</span><br><span class="line"></span><br><span class="line">            function modifyInfo() &#123;</span><br><span class="line">                hobby[0] = &#x27;sleep&#x27;</span><br><span class="line">                console.log(hobby)</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            return &#123;</span><br><span class="line">                hobby,</span><br><span class="line">                modifyInfo</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>修改后的效果：</p>
<p><img src="/2022/07/25/web/%E6%A1%86%E6%9E%B6/Vue/Vue3.0/Vue3%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/image-20220617065538228.png" alt="image-20220617065538228"></p>
<h4 id="小结：reactive函数"><a href="#小结：reactive函数" class="headerlink" title="小结：reactive函数"></a>小结：<code>reactive</code>函数</h4><ul>
<li>作用：定义一个对象类型的响应式数据（基本数据类型不要用它，要用<code>ref</code>函数）</li>
<li>语法：<code>const 代理对象 =  reactive(源对象)</code>，接收一个对象（或数组），返回一个代理对象（<code>Proxy</code>的实例对象，简称<code>Proxy</code>对象）</li>
<li><code>reactive</code>定义的响应式数据是<code>深层次的</code></li>
<li>内部基于<code>ES6</code>的<code>Proxy</code>实现，通过代理对象操作源对象的内部数据</li>
</ul>
<h3 id="8-3-4-Vue3中的响应式原理"><a href="#8-3-4-Vue3中的响应式原理" class="headerlink" title="8.3.4.Vue3中的响应式原理"></a>8.3.4.<code>Vue3</code>中的响应式原理</h3><h4 id="8-3-4-1-Vue2的响应式"><a href="#8-3-4-1-Vue2的响应式" class="headerlink" title="8.3.4.1.Vue2的响应式"></a>8.3.4.1.<code>Vue2</code>的响应式</h4><ul>
<li><p>实现原理：</p>
<ul>
<li><p>对象类型：通过<code>Object.defineProperty()</code>对属性的读取、修改进行拦截（数据劫持）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(data, <span class="string">&#x27;count&#x27;</span>, &#123;</span><br><span class="line">  <span class="title function_">get</span>(<span class="params"></span>) &#123;&#125;,</span><br><span class="line">  <span class="title function_">set</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>数组类型：通过重写更新数组的一系列方法来进行拦截。（对数组的变更方法进行了包裹）</p>
</li>
</ul>
</li>
<li><p>存在问题：</p>
<ul>
<li><p>对象类型：新增属性、删除属性，界面不会更新</p>
<ul>
<li><p>新增的属性，要通过<code>this.$set</code>或<code>Vue.set</code>才会变成响应式的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.$set(<span class="variable language_">this</span>.<span class="property">person</span>, <span class="string">&#x27;sex&#x27;</span>, <span class="string">&#x27;女&#x27;</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除的属性，要通过<code>this.$delete</code>或<code>Vue.delete</code>才会变成响应式的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.$delete(<span class="variable language_">this</span>.<span class="property">person</span>, <span class="string">&#x27;name&#x27;</span>)</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>数组类型：直接通过下标修改数组，界面不会自动更新</p>
<ul>
<li><p>要通过<code>this.$set</code>或<code>Vue.set</code>才会变成响应式的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.$set(<span class="variable language_">this</span>.<span class="property">person</span>.<span class="property">hobby</span>, <span class="number">0</span>, <span class="string">&#x27;逛街&#x27;</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>或者调用<code>splice</code>方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">person</span>.<span class="property">hobby</span>.<span class="title function_">splice</span>(<span class="number">0</span>, <span class="number">1</span>, <span class="string">&#x27;逛街&#x27;</span>)</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="8-3-4-2-Vue3的响应式"><a href="#8-3-4-2-Vue3的响应式" class="headerlink" title="8.3.4.2.Vue3的响应式"></a>8.3.4.2.<code>Vue3</code>的响应式</h4><ul>
<li>实现原理：<ul>
<li>通过<code>Proxy</code>（代理）：拦截对象中任意属性的变化，包括：属性值的读写、属性的添加、删除等</li>
<li>通过<code>Reflect</code>（反射）：对被代理对象的属性进行操作</li>
<li><code>MDN</code>文档中描述的<code>Proxy</code>和<code>Reflect</code><ul>
<li><code>Proxy</code>：<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy/Proxy">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy/Proxy</a></li>
<li><code>Refelct</code>：<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect</a></li>
</ul>
</li>
</ul>
</li>
<li>验证对象的操作</li>
<li>验证数组的操作</li>
<li>模拟<code>Vue2</code>的响应式</li>
<li>模拟<code>Vue3</code>的响应式<ul>
<li>验证<code>Proxy</code>基本语法<ul>
<li>读取：<code>get</code></li>
<li>修改和新增：<code>set</code></li>
<li>删除：<code>deleteProperty</code></li>
</ul>
</li>
<li>验证<code>Reflect</code>基本语法<ul>
<li>获取属性值</li>
<li>修改属性值</li>
<li>删除属性</li>
<li><code>ECMA</code>正在尝试把<code>Object</code>上的方法，移植到<code>Reflect</code>身上<ul>
<li><code>Obeject.defineProperty</code><ul>
<li>基本使用</li>
<li>一旦有异常就会挂掉，除非用<code>try catch</code>捕获到</li>
</ul>
</li>
<li><code>Reflect.defineProperty</code><ul>
<li>基本使用</li>
<li>会有布尔类型的返回值，异常处理比较方便</li>
<li>对于框架封装来说，使用<code>Reflect</code>相对会好一点</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>使用<code>Reflect</code>配合<code>Proxy</code></li>
</ul>
</li>
</ul>
<h3 id="8-3-5-reactive对比ref"><a href="#8-3-5-reactive对比ref" class="headerlink" title="8.3.5.reactive对比ref"></a>8.3.5.<code>reactive</code>对比<code>ref</code></h3><ul>
<li>从定义数据角度对比<ul>
<li><code>ref</code>用来定义：基本数据类型</li>
<li><code>reactive</code>用来定义：对象（或数组）类型数据</li>
<li>备注：<code>ref</code>也可以用来定义对象（或数组）类型数据，它内部会自动通过<code>reactive</code>转为代理对象</li>
</ul>
</li>
<li>从原理角度对比<ul>
<li><code>ref</code>通过<code>Object.defineProperty()</code>的<code>get</code>与<code>set</code>来实现响应式（数据劫持）</li>
<li><code>reactive</code>通过使用<code>Proxy</code>来实现响应式（数据劫持），并通过<code>Reflect</code>操作源对象内部的数据</li>
</ul>
</li>
<li>从使用角度对比<ul>
<li><code>ref</code>定义的数据：操作数据需要<code>.value</code>，读取数据时模板中直接读取不需要<code>.value</code></li>
</ul>
</li>
</ul>
<h3 id="8-3-6-setup的两个注意点"><a href="#8-3-6-setup的两个注意点" class="headerlink" title="8.3.6.setup的两个注意点"></a>8.3.6.<code>setup</code>的两个注意点</h3><h4 id="8-3-6-1-setup执行的时机"><a href="#8-3-6-1-setup执行的时机" class="headerlink" title="8.3.6.1.setup执行的时机"></a>8.3.6.1.<code>setup</code>执行的时机</h4><ul>
<li>在<code>beforeCreate</code>之前执行一次，<code>this</code>是<code>undefined</code></li>
</ul>
<h4 id="8-3-6-2-setup的参数"><a href="#8-3-6-2-setup的参数" class="headerlink" title="8.3.6.2.setup的参数"></a>8.3.6.2.<code>setup</code>的参数</h4><h5 id="参数验证"><a href="#参数验证" class="headerlink" title="参数验证"></a>参数验证</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">set</span>(<span class="params">a, b, c</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(a, b, c)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>图片</p>
<h5 id="props参数"><a href="#props参数" class="headerlink" title="props参数"></a><code>props</code>参数</h5><p>值为对象，包含：组件外部传递过来，且在组件内部声明接收了的属性</p>
<ul>
<li><p><code>vue2</code>中的<code>props</code></p>
<ul>
<li><p>如果使用<code>props</code>接收了，传的数据挂载在<code>vc</code>实例上</p>
</li>
<li><p>如果没有使用<code>props</code>接收，传的数据挂载在<code>$attrs</code>上</p>
</li>
</ul>
</li>
<li><p><code>vue3</code>中的<code>props</code></p>
<p><code>App.vue</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;Demo msg=&#x27;hello&#x27; addredd=&#x27;beijing&#x27;/&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">	import Demo from &#x27;./components/Demo&#x27;</span><br><span class="line">    export default &#123;</span><br><span class="line">        name: &#x27;App&#x27;,</span><br><span class="line">        components: &#123;</span><br><span class="line">            Demo</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>



<p><code>Demo.vue</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">props</span>: [<span class="string">&#x27;msg&#x27;</span>, <span class="string">&#x27;address&#x27;</span>],</span><br><span class="line">    <span class="title function_">set</span>(<span class="params">props</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(props)<span class="comment">// 会把接收到的所有props的值，整理成`Proxy`类型的对象</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="context参数"><a href="#context参数" class="headerlink" title="context参数"></a><code>context</code>参数</h5><ul>
<li><p>上下文对象，身上有三个属性使我们关心的</p>
</li>
<li><p><code>attrs</code></p>
<ul>
<li><code>vue2</code>的<code>$attrs</code><ul>
<li>父组件给子组件传了数据，子组件如果没有使用<code>props</code>接收，则会放在<code>this.$attrs</code>对象上</li>
</ul>
</li>
<li><code>vue3</code>的<code>attrs</code><ul>
<li>如果没有使用<code>props</code>接收到的数据，会放在<code>attrs</code>属性上，相当于<code>vue2</code>的<code>this.$attrs</code></li>
</ul>
</li>
</ul>
</li>
<li><p><code>emit</code></p>
<ul>
<li>如果给子组件绑定了自定义事件，<code>vue3</code>中需要使用<code>emits</code>数组配置项，在子组件中来接收命名，否则控制台会有警告</li>
</ul>
</li>
<li><p><code>slots</code></p>
<ul>
<li><p><code>vue2</code>中的插槽</p>
<ul>
<li>子组件的对象标签中，写了新的标签内容，会以虚拟<code>dom</code>的形式，挂载在父组件的<code>$slot</code>属性上（不论子组件有没有使用插槽来接收）</li>
</ul>
</li>
<li><p><code>vue3</code>中的插槽</p>
<ul>
<li>子组件的对象标签中，写了新的标签内容，会以虚拟<code>dom</code>的形式，<code>slots</code>属性上（不论子组件有没有使用插槽来接收）</li>
<li><code>vue3</code>中的具名插槽的写法，请使用<code>v-slot:name</code>，不要使用<code>vue2</code>的<code>slot=&quot;name&quot;</code>这种写法</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="小结：setup的两个注意点"><a href="#小结：setup的两个注意点" class="headerlink" title="小结：setup的两个注意点"></a>小结：<code>setup</code>的两个注意点</h4><ul>
<li><p><code>setup</code>执行的时机</p>
<ul>
<li>在<code>beforeCreate</code>之前执行一次，<code>this</code>是<code>undefined</code></li>
</ul>
</li>
<li><p><code>setup</code>的参数</p>
<ul>
<li><p><code>props</code>参数：值为对象，包含：组件外部传递过来，且组件内部声明接收了的属性</p>
</li>
<li><p><code>context</code>参数：上下文对象</p>
<ul>
<li><p><code>attrs</code>：值为对象，包含：组件外部传递过来，但没有在<code>props</code>配置中声明的属性，相当于<code>this.$attrs</code></p>
</li>
<li><p><code>slot</code>：收到的插槽内容，相当于<code>this.$slots</code></p>
</li>
<li><p><code>emit</code>：分发自定义事件的函数，相当于<code>this.$emit</code></p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="8-3-7-计算属性与监视"><a href="#8-3-7-计算属性与监视" class="headerlink" title="8.3.7.计算属性与监视"></a>8.3.7.计算属性与监视</h3><h4 id="8-3-7-1-computed函数"><a href="#8-3-7-1-computed函数" class="headerlink" title="8.3.7.1.computed函数"></a>8.3.7.1.<code>computed</code>函数</h4><ul>
<li><p>与<code>vue2.x</code>中<code>computed</code>配置功能一致</p>
</li>
<li><p>写法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;h2&gt;</span><br><span class="line">        &#123;&#123;person.fullName&#125;&#125;</span><br><span class="line">    &lt;/h2&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">	import &#123;reactive, computed&#125; from &#x27;vue&#x27;</span><br><span class="line">    export default &#123;</span><br><span class="line">        setup() &#123;</span><br><span class="line">            // 数据</span><br><span class="line">            let person = reactive(&#123;</span><br><span class="line">                firstName: &#x27;张&#x27;,</span><br><span class="line">                lastName: &#x27;三&#x27;</span><br><span class="line">            &#125;)</span><br><span class="line">            </span><br><span class="line">            // 计算属性简写</span><br><span class="line">            // 注意可以直接给Proxy类型的person对象上，添加计算属性，也是响应式的</span><br><span class="line">            person.fullName1 = computed(() =&gt; &#123; </span><br><span class="line">                return person.firstName + &#x27;-&#x27; + person.lastName</span><br><span class="line">            &#125;)</span><br><span class="line"></span><br><span class="line">            // 计算属性完整写法</span><br><span class="line">            person.fullName2 = computed(&#123;</span><br><span class="line">                get() &#123;</span><br><span class="line">                    return person.firstName + &#x27;-&#x27; + person.lastName</span><br><span class="line">                &#125;,</span><br><span class="line">                set(value) &#123;</span><br><span class="line">                    const nameArr = value.split(&#x27;-&#x27;)</span><br><span class="line">                    person.firstName = nameArr[0]</span><br><span class="line">                    person.lastName = nameArr[1]</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            </span><br><span class="line">            return &#123;</span><br><span class="line">                person            &#125;</span><br><span class="line">    	&#125;  </span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="8-3-7-2-watch函数"><a href="#8-3-7-2-watch函数" class="headerlink" title="8.3.7.2.watch函数"></a>8.3.7.2.<code>watch</code>函数</h4><ul>
<li><p>与<code>vue2.x</code>中<code>watch</code>配置功能一致，接收三个参数</p>
<ul>
<li>监视的是谁</li>
<li>监视的回调</li>
<li>监视的配置</li>
</ul>
</li>
<li><p>两个注意点</p>
<ul>
<li>监视<code>reactive</code>定义的响应式数据时，<code>oldValue</code>无法正确获取、强制开启了深度监视（<code>deep</code>配置失效）</li>
<li>监视<code>reactive</code>定义的响应式数据中某个属性时，<code>deep</code>配置有效</li>
</ul>
</li>
<li><p>监视<code>ref</code>定义的响应式数据</p>
<p>写监视的对象时，监视的应该是一个结构，而不是具体的值</p>
<ul>
<li>如果是基本数据类型，不需要添加<code>.value</code>；</li>
<li>如果使用<code>ref</code>包裹了对象类型数据，监视时需要添加<code>.value</code><ul>
<li><code>RefImp</code>对象的<code>value</code>此时不再是一个具体的值，而是一个<code>Proxy</code>对象，再怎么修改这个对象里面的值，这个对象的内存地址也不会变，自然也就监视不到变化了</li>
<li>所以真正的要监视的，应该是通过<code>.value</code>获取到的<code>Proxy</code>对象</li>
<li>或者也可以不加<code>.value</code>，但是要添加深度监视配置项</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">watch</span>(sum, <span class="function">(<span class="params">newValue, oldValue</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;sum变化了&#x27;</span>, newVlaue, oldValue)</span><br><span class="line">&#125;, &#123;<span class="attr">immediate</span>: <span class="literal">true</span>&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>监视多个<code>ref</code>定义的响应式数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">watch</span>([sum, msg], <span class="function">(<span class="params">newValue, oldValue</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;sum或msg变化了&#x27;</span>, newValue, oldValue)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>输出的也是数组：</p>
<p><img src="/2022/07/25/web/%E6%A1%86%E6%9E%B6/Vue/Vue3.0/Vue3%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/image-20220618143803425.png" alt="image-20220618143803425"></p>
</li>
<li><p>监视<code>reactive</code>定义的响应式数据</p>
<ul>
<li><p>若<code>watch</code>监视的是<code>reactive</code>定义的响应式数据，则无法正确获得<code>oldValue</code>，<code>newValue</code>和<code>oldValue</code>都是<code>Proxy</code>类型的对象</p>
<p><img src="/2022/07/25/web/%E6%A1%86%E6%9E%B6/Vue/Vue3.0/Vue3%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/image-20220618144135227.png" alt="image-20220618144135227"></p>
<p>如果一定要获取<code>oldValue</code>，则用<code>ref</code>定义源数据</p>
</li>
<li><p>若<code>watch</code>监视的是<code>reactive</code>定义的响应式数据，则强制开启了深度监视（默认开启了），并且关闭不再生效</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">watch</span>(person, <span class="function">(<span class="params">newValue, oldValue</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;person变化了&#x27;</span>, newValue, oldValue)</span><br><span class="line">&#125;,&#123;<span class="attr">immediate</span>: <span class="literal">true</span>, <span class="attr">deep</span>: <span class="literal">false</span>&#125;) <span class="comment">// 此处的deep配置不再奏效</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>监视<code>reactive</code>定义的响应式数据中的某个属性，第一个参数要写成一个函数，此时的<code>deep</code>配置项是有效的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">watch</span>(<span class="function">() =&gt;</span> person.<span class="property">age</span>, <span class="function">(<span class="params">newValue, oldValue</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;preson的age变化了&#x27;</span>, newValue, oldValue)</span><br><span class="line">&#125;) </span><br></pre></td></tr></table></figure>

<p>一般监视的属性是一个对象时，才会开启深度监视（获取不到<code>oldValue</code>）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">watch</span>(<span class="function">() =&gt;</span> person.<span class="property">job</span>, <span class="function">(<span class="params">newValue, oldValue</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;preson的job变化了&#x27;</span>, newValue, oldValue)</span><br><span class="line">&#125;, &#123;<span class="attr">immediate</span>: <span class="literal">true</span>, <span class="attr">deep</span>: <span class="literal">true</span>&#125;) <span class="comment">// job中还有salary属性，可以开启深度监视</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>监视<code>reactive</code>定义的响应式数据中的某些属性</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">watch</span>([<span class="function">() =&gt;</span> person.<span class="property">job</span>, <span class="function">() =&gt;</span> person.<span class="property">name</span>], <span class="function">(<span class="params">newValue, oldValue</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;preson的job或name变化了&#x27;</span>, newValue, oldValue)</span><br><span class="line">&#125;, &#123;<span class="attr">immediate</span>: <span class="literal">true</span>, <span class="attr">deep</span>: <span class="literal">true</span>&#125;)</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="8-3-7-3-watchEffect函数"><a href="#8-3-7-3-watchEffect函数" class="headerlink" title="8.3.7.3.watchEffect函数"></a>8.3.7.3.<code>watchEffect</code>函数</h4><ul>
<li><p><code>watch</code>的套路是：既要指明监视的属性，也要指明监视的回调</p>
</li>
<li><p><code>watchEffect</code>的套路是，不用指明监视的是哪个属性，监视的回调中用到哪个属性，那就监视哪个属性</p>
</li>
<li><p><code>watchEffect</code>有点像<code>computed</code>：</p>
<ul>
<li><p>但<code>computed</code>注重计算出来的值（回调函数的返回值），所以必须要写返回值</p>
</li>
<li><p>而<code>watchEffect</code>更注重的是过程（回调函数的函数体），多以不用写返回值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// watchEffect所指定的回调中，用到的数据只要发生了变化，则直接重新执行回调</span></span><br><span class="line"><span class="title function_">watchEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> x1 = sum.<span class="property">value</span></span><br><span class="line">    <span class="keyword">const</span> x2 = person.<span class="property">age</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;watchEffect配置的回调执行了&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h3 id="8-3-8-生命周期"><a href="#8-3-8-生命周期" class="headerlink" title="8.3.8.生命周期"></a>8.3.8.生命周期</h3><ul>
<li><code>vue3</code>中可以继续使用<code>vue2</code>中的生命周期钩子，但有两个被更名：<ul>
<li><code>beforeDestroy</code>改名为<code>beforeUnmount</code></li>
<li><code>destroyed</code>改名为<code>unmounted</code></li>
</ul>
</li>
<li><code>vue3</code>中也提供了<code>Compsition API</code>形式的生命周期钩子，与<code>vue2</code>中钩子的对应关系如下：<ul>
<li><code>beforeCreate</code>&#x3D;&#x3D;&#x3D;&gt;<code>setup()</code></li>
<li><code>created</code>&#x3D;&#x3D;&#x3D;&gt;<code>setup()</code></li>
<li><code>beforeMount</code>&#x3D;&#x3D;&#x3D;&gt;<code>onBeforeMount</code></li>
<li><code>mounted</code>&#x3D;&#x3D;&#x3D;&gt;<code>onMounted</code></li>
<li><code>beforeUpdate</code>&#x3D;&#x3D;&#x3D;&gt;<code>onBeforeUpdate</code></li>
<li><code>updated</code>&#x3D;&#x3D;&#x3D;&gt;<code>onUpdated</code></li>
<li><code>beforeUnmount</code>&#x3D;&#x3D;&#x3D;&gt;<code>onBeforeUnmount</code></li>
<li><code>unmounted</code>&#x3D;&#x3D;&#x3D;&gt;<code>onUnmounted</code></li>
<li>备注：使用时需要引入</li>
</ul>
</li>
</ul>
<h3 id="8-3-9-自定义hook函数"><a href="#8-3-9-自定义hook函数" class="headerlink" title="8.3.9.自定义hook函数"></a>8.3.9.自定义<code>hook</code>函数</h3><ul>
<li>什么是<code>hook</code><ul>
<li>本质是一个函数，把<code>setup</code>函数中使用的<code>Composition API</code>进行了封装</li>
<li>类似<code>vue2</code>中的<code>mixin</code></li>
</ul>
</li>
<li>自定义<code>hook</code>的优势<ul>
<li>复用代码，让<code>setup</code>中的逻辑更清楚易懂</li>
</ul>
</li>
</ul>
<p>定义<code>hook</code></p>
<p><code>hook/usePoint.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;reactive, onMounted, onBeforeUnmount&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> point = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">        <span class="attr">x</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">y</span>: <span class="number">0</span></span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">savePoint</span>(<span class="params">event</span>) &#123;</span><br><span class="line">        point.<span class="property">x</span> = event.<span class="property">pageX</span></span><br><span class="line">        point.<span class="property">y</span> = event.<span class="property">pageY</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(event.<span class="property">pageX</span>, event.<span class="property">pageY</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, savePoint)</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">onBeforeUnmount</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;click&#x27;</span>, savePoint)</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> point</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用<code>hook</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;h2&gt;</span><br><span class="line">        当前点击鼠标时的坐标为：x：&#123;&#123;point.x&#125;&#125;，y：&#123;&#123;point.y&#125;&#125;</span><br><span class="line">    &lt;/h2&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">	import userPoint from &#x27;../hooks/usePoint&#x27;</span><br><span class="line">    export default &#123;</span><br><span class="line">        setup() &#123;</span><br><span class="line">            const point = usePoint()</span><br><span class="line">            return &#123;</span><br><span class="line">                point</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>



<h3 id="8-3-10-toRef"><a href="#8-3-10-toRef" class="headerlink" title="8.3.10.toRef"></a>8.3.10.<code>toRef</code></h3><p>使用<code>reactive</code>包裹深层次对象，在使用时需要写多个点，很麻烦，可以用<code>toRef</code>来替代这个操作</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;!-- 此时不需要person.name --&gt;</span><br><span class="line">	&lt;h2&gt;&#123;&#123;name&#125;&#125;&lt;/h2&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">	import &#123;reactive, toRef&#125; from &#x27;vue&#x27;</span><br><span class="line">    export default &#123;</span><br><span class="line">        setup() &#123;</span><br><span class="line">            let person = &#123;</span><br><span class="line">                name: &#x27;sai&#x27;,</span><br><span class="line">                age:18,</span><br><span class="line">                job: &#123;</span><br><span class="line">                    j1: &#123;</span><br><span class="line">                        salary: 30</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            const name = toRef(person, &#x27;name&#x27;) // 返回的是一个引用实现对象，其value指向person.name，如果使用ref(person, &#x27;name&#x27;)，则是复制创建了一个新的引用实现对象，不存在引用关系了</span><br><span class="line">            const salary = toRef(person.job.j1, &#x27;salary&#x27;) // 第一个参数，传递一个对象</span><br><span class="line">            return &#123;</span><br><span class="line">                person, </span><br><span class="line">                name, // 需要单独使用的属性</span><br><span class="line">                salary // 简写形式，等价于salary: toRef(person.job.j1, &#x27;salary&#x27;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>小结：</p>
<ul>
<li><p>作用，创建一个<code>ref</code>对象，其<code>value</code>值指向另一个对象中的某个属性</p>
</li>
<li><p>语法：<code>const name = toRef(person, &#39;name&#39;)</code></p>
</li>
<li><p>应用：要将响应式对象中的某个属性，单独提供给外部使用时</p>
</li>
<li><p>扩展：<code>toRefs</code>与<code>toRef</code>功能一致，但可以批量创建多个<code>ref</code>对象，语法：<code>toRefs(person)</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> x = <span class="title function_">toRefs</span>(person)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(x)</span><br></pre></td></tr></table></figure>

<p><img src="/2022/07/25/web/%E6%A1%86%E6%9E%B6/Vue/Vue3.0/Vue3%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/image-20220620064618982.png" alt="image-20220620064618982"></p>
<p>返回值是一个对象，<code>return</code>的时候需要解构赋值</p>
<p>返回对象的<code>key</code>，是源对象的<code>key</code>，</p>
<ul>
<li>若源对象<code>key</code>是基本数据类型，则<code>key</code>对应的属性值，是一个引用实现对象，模板中使用时不用加<code>.value</code>进行调用，</li>
<li>若源对象<code>key</code>的值仍是一个对象，则<code>key</code>对应的属性值，是一个<code>Proxy</code>实例对象</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> &#123;</span><br><span class="line">    ...<span class="title function_">toRefs</span>(person)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="8-3-11-toRefs"><a href="#8-3-11-toRefs" class="headerlink" title="8.3.11.toRefs"></a>8.3.11.<code>toRefs</code></h3><p>toRefs函数的作用是将响应式对象中的所有属性转换为单独的响应式数据，对象成为普通对象，并且值是关联的。在这个过程中toRefs会做以下两件事：</p>
<ul>
<li>把一个响应式对象转换成普通对象</li>
<li>对该普通对象的每个属性都做一次ref操作，这样每个属性都是响应式的</li>
</ul>
<p>说明：</p>
<ul>
<li>reactive 对象取出的所有属性值都是非响应式的，而利用 toRefs 可以将一个响应式 reactive 对象的所有原始属性转换为响应式的 ref 属性。</li>
<li>reactive的响应式功能是赋值给对象，如果展开对象，会让数丢失响应的能力</li>
<li>使用toRefs可以保证对象展开的每个属性都是响应式的</li>
</ul>
<p>应用场景：</p>
<ul>
<li>展开响应式对象时，想使用响应式对象中的多个或者所有属性做为响应式数据。</li>
<li>当函数返回响应式对象时，toRefs非常有用，这样消费组件就可以在不丢失响应式的情况下对返回的对象进行分解使用。-</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;h2&gt;姓名：&#123;&#123;name&#125;&#125;&lt;/h2&gt;</span><br><span class="line">    &lt;h2&gt;年龄：&#123;&#123;age&#125;&#125;&lt;/h2&gt;</span><br><span class="line">    &lt;h2&gt;地址：&#123;&#123;addr.province&#125;&#125;-&#123;&#123;addr.city&#125;&#125;&lt;/h2&gt;</span><br><span class="line">    &lt;button @click=&quot;name=&#x27;zhangsan&#x27;&quot;&gt;修改名字&lt;/button&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    import &#123; reactive, toRefs &#125; from &#x27;vue&#x27;</span><br><span class="line">    export default &#123;</span><br><span class="line">        setup() &#123;</span><br><span class="line">            const user = reactive(&#123;</span><br><span class="line">                name: &#x27;张三&#x27;,</span><br><span class="line">                age: 19,</span><br><span class="line">                addr: &#123;</span><br><span class="line">                    province: &#x27;河南&#x27;,</span><br><span class="line">                    city: &#x27;郑州&#x27;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            return &#123;</span><br><span class="line">                ...toRefs(user)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>







<h2 id="8-4-其它Composition-API"><a href="#8-4-其它Composition-API" class="headerlink" title="8.4.其它Composition API"></a>8.4.其它<code>Composition API</code></h2><h3 id="8-4-1-shallowReactive和shallowRef"><a href="#8-4-1-shallowReactive和shallowRef" class="headerlink" title="8.4.1.shallowReactive和shallowRef"></a>8.4.1.<code>shallowReactive</code>和<code>shallowRef</code></h3><ul>
<li><p><code>shallowReactive</code>：只处理对象最外层属性的响应式（浅响应式）</p>
</li>
<li><p><code>shallowRef</code>：只处理基本数据类型的响应式，不进行对象的响应式处理</p>
<ul>
<li><p>传的是基本类型，和<code>ref</code>一样</p>
</li>
<li><p>传的是对象类型数据，就不再求助于<code>reactive</code>了，就不再是响应式了</p>
<p><img src="/2022/07/25/web/%E6%A1%86%E6%9E%B6/Vue/Vue3.0/Vue3%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/image-20220620071743944.png" alt="image-20220620071743944"></p>
</li>
</ul>
</li>
<li><p>什么时候使用</p>
<ul>
<li>如果有一个对象数据，结构比较深，但变化时只是外层属性变化，使用<code>shallowReactive</code></li>
<li>如果有一个对象数据，后续功能不会修改该对象中的属性，而是生成新的对象来替换，使用<code>shallowRef</code></li>
</ul>
</li>
</ul>
<h3 id="8-4-2-readonly与shallowReadonly"><a href="#8-4-2-readonly与shallowReadonly" class="headerlink" title="8.4.2.readonly与shallowReadonly"></a>8.4.2.<code>readonly</code>与<code>shallowReadonly</code></h3><ul>
<li><p><code>readonly</code>：让一个响应式数据变为只读的（深只读）</p>
<ul>
<li><p><code>readonly</code>是一个函数，接收响应式数据作为参数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> person = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;sai&#x27;</span>,</span><br><span class="line">        <span class="attr">age</span>: <span class="number">18</span>,</span><br><span class="line">        <span class="attr">job</span>: &#123;</span><br><span class="line">            <span class="attr">j1</span>: &#123;</span><br><span class="line">                <span class="attr">salary</span>: <span class="number">30</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    person = <span class="title function_">readonly</span>(person)</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        ...<span class="title function_">toRefs</span>(person)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><code>shallowReadonly</code>：让一个响应式数据变为只读的（浅只读）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">person = <span class="title function_">shallowReadonly</span>(person)</span><br></pre></td></tr></table></figure>

<p>上述例子中，若使用<code>shallowReadonly</code>函数进行处理，则第一层数据不允许修改，但是里面的<code>salary</code>还是可以修改的</p>
<p>对于<code>ref</code>包裹的响应式数据，没有必要用<code>shallowReadonly</code>，因为基本数据类型始终就是一层</p>
</li>
<li><p>应用场景：不希望数据被修改时</p>
<ul>
<li><code>person</code>的数据不是自己定义的，用的是别人的组件，接收的时候可以用<code>readonly</code>限制一下，防止误操作</li>
</ul>
</li>
</ul>
<h3 id="8-4-3-toRaw与markRaw"><a href="#8-4-3-toRaw与markRaw" class="headerlink" title="8.4.3.toRaw与markRaw"></a>8.4.3.<code>toRaw</code>与<code>markRaw</code></h3><ul>
<li><p><code>toRaw</code></p>
<ul>
<li><p>作用：将一个由<code>reactive</code>生成的响应式对象，变成普通对象（不能处理<code>ref</code>定义的响应式数据）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> person = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;sai&#x27;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">showRawPerson</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> p = <span class="title function_">toRaw</span>(person)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(p)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>应用场景：用于读取响应式对象对应的普通对象，对这个普通对象的所有操作，不会引起页面更新</p>
</li>
</ul>
</li>
<li><p><code>makeRaw</code></p>
<ul>
<li>作用：标记一个对象，使其永远不会再成为响应式对象<ul>
<li>但是对于数据的更改仍然是生效的，只是<code>vue</code>不再做响应式处理了</li>
</ul>
</li>
<li>应用场景：<ul>
<li>有些值不应被设置为响应式的，例如复杂的第三方类库等</li>
<li>当渲染具有不可变数据源的大列表时，跳过响应式转换可以提高性能</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="8-4-4-customRef"><a href="#8-4-4-customRef" class="headerlink" title="8.4.4.customRef"></a>8.4.4.<code>customRef</code></h3><ul>
<li><p>作用：创建一个自定义的<code>ref</code>，并对其依赖项跟踪和更新触发，进行显示控制</p>
<ul>
<li>读数据找<code>get()</code>，写数据找<code>set()</code></li>
<li>在关键的地方调用<code>track</code>和<code>trigger</code></li>
</ul>
</li>
<li><p>实现防抖效果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;input type=&quot;text&quot; v-model=&quot;keyword&quot;&gt;</span><br><span class="line">	&lt;h3&gt;</span><br><span class="line">        &#123;&#123;keyword&#125;&#125;</span><br><span class="line">    &lt;/h3&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">	import &#123;ref, customRef&#125; from &#x27;vue&#x27;</span><br><span class="line">    export default &#123;</span><br><span class="line">        name: &#x27;Demo&#x27;,</span><br><span class="line">        setup() &#123;</span><br><span class="line">            // let keyword = ref(&#x27;hello&#x27;) // 使用vue准备好的内置的ref</span><br><span class="line">            // 自定义一个myRef</span><br><span class="line">            function myRef(value, delay) &#123;</span><br><span class="line">                let timer</span><br><span class="line">                // 通过customRef去实现自定义</span><br><span class="line">                return customRef((track, trigger) =&gt; &#123;</span><br><span class="line">                	return &#123;</span><br><span class="line">                        get() &#123;</span><br><span class="line">                            track() // 告诉vue这个value值是需要被“追踪”的</span><br><span class="line">                            return value</span><br><span class="line">                        &#125;,</span><br><span class="line">                        set(newValue) &#123;</span><br><span class="line">                            clearTimeout(timer)</span><br><span class="line">                            timer = setTimeout(() =&gt; &#123;</span><br><span class="line">								value = newValue	</span><br><span class="line">                                trigger() // 告诉vue去更新页面</span><br><span class="line">                            &#125;, delay)</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            let keyword = myRef(&#x27;hello&#x27;, 500)</span><br><span class="line">            return &#123;</span><br><span class="line">                keyword</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="8-4-5-provide与inject"><a href="#8-4-5-provide与inject" class="headerlink" title="8.4.5.provide与inject"></a>8.4.5.<code>provide</code>与<code>inject</code></h3><p><img src="/2022/07/25/web/%E6%A1%86%E6%9E%B6/Vue/Vue3.0/Vue3%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/image-20220620163000601.png" alt="image-20220620163000601"></p>
<ul>
<li><p>作用：实现<strong>祖组件</strong>与<strong>后代组件</strong>间通信</p>
<ul>
<li>虽然也可以用来父子组件通信，但那样直接用<code>props</code>即可</li>
</ul>
</li>
<li><p>套路：父组件有一个<code>provide</code>选项来提供数据，后代组件有一个<code>inject</code>选项来开始使用这些数据</p>
</li>
<li><p>具体写法：</p>
<ul>
<li><p>1.祖先组件中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;provide&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line">...</span><br><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">let</span> person = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;sai&#x27;</span>,</span><br><span class="line">        <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="title function_">provide</span>(<span class="string">&#x27;person&#x27;</span>, person)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>2.孙子组件中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;inject&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">const</span> person = <span class="title function_">inject</span>(<span class="string">&#x27;person&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> &#123;person&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h3 id="8-4-6-响应式数据的判断"><a href="#8-4-6-响应式数据的判断" class="headerlink" title="8.4.6.响应式数据的判断"></a>8.4.6.响应式数据的判断</h3><ul>
<li><code>isRef</code>：检查一个值，是否为一个<code>ref</code>对象</li>
<li><code>isReactive</code>：检查一个对象，是否是由<code>reactive</code>创建的响应式代理</li>
<li><code>isReadonly</code>：检查一个对象，是否是由<code>readonly</code>创建的只读代理</li>
<li><code>isProxy</code>：检查一个对象，是否是由<code>reactive</code>或者<code>readonly</code>方法创建的代理</li>
</ul>
<h2 id="8-5-Composition-API的优势"><a href="#8-5-Composition-API的优势" class="headerlink" title="8.5.Composition API的优势"></a>8.5.<code>Composition API</code>的优势</h2><h3 id="8-5-1-Options-API存在的问题"><a href="#8-5-1-Options-API存在的问题" class="headerlink" title="8.5.1.Options API存在的问题"></a>8.5.1.<code>Options API</code>存在的问题</h3><p>使用传统<code>Options API</code>，新增或者修改一个需求，就需要分别在<code>data</code>、<code>methods</code>、<code>computed</code>里修改</p>
<p><img src="/2022/07/25/web/%E6%A1%86%E6%9E%B6/Vue/Vue3.0/Vue3%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/image-20220620164219772.png" alt="image-20220620164219772"></p>
<p>如果一个组件里的功能特别多</p>
<ul>
<li>一个功能的数据、方法、计算属性都是拆散的</li>
<li>每个配置项里堆积了不同功能的代码</li>
<li>维护某一个功能代码时，就需要打开一个庞大的<code>data</code>找啊找，然后再打开一个庞大的<code>method</code>找啊找，可能还要去<code>computed</code>、<code>watch</code>、生命周期钩子里不断的查找修改</li>
</ul>
<h3 id="8-5-2-Composition-API的优势"><a href="#8-5-2-Composition-API的优势" class="headerlink" title="8.5.2.Composition API的优势"></a>8.5.2.<code>Composition API</code>的优势</h3><p>我们可以更加优雅的组织我们的代码，函数。让相关功能的代码更加有序的组织在一起</p>
<p><img src="/2022/07/25/web/%E6%A1%86%E6%9E%B6/Vue/Vue3.0/Vue3%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/image-20220620165208346.png" alt="image-20220620165208346"></p>
<p><img src="/2022/07/25/web/%E6%A1%86%E6%9E%B6/Vue/Vue3.0/Vue3%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/image-20220620164953100.png" alt="image-20220620164953100"></p>
<p><img src="/2022/07/25/web/%E6%A1%86%E6%9E%B6/Vue/Vue3.0/Vue3%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/image-20220620165019824.png" alt="image-20220620165019824"></p>
<h2 id="8-6-新的组件"><a href="#8-6-新的组件" class="headerlink" title="8.6.新的组件"></a>8.6.新的组件</h2><h3 id="8-6-1-Fragment"><a href="#8-6-1-Fragment" class="headerlink" title="8.6.1.Fragment"></a>8.6.1.<code>Fragment</code></h3><ul>
<li><p>在<code>vue2</code>中，组件必须有一个根标签</p>
</li>
<li><p>在<code>vue3</code>中，组件可以没有根标签，内部会将多个标签包含在一个<code>Fragment</code>虚拟元素中</p>
<ul>
<li>好处：减少标签层级，减小内存占用</li>
</ul>
<p><img src="/2022/07/25/web/%E6%A1%86%E6%9E%B6/Vue/Vue3.0/Vue3%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/image-20220620170100495.png" alt="image-20220620170100495"></p>
</li>
</ul>
<h3 id="8-6-2-Teleport"><a href="#8-6-2-Teleport" class="headerlink" title="8.6.2.Teleport"></a>8.6.2.<code>Teleport</code></h3><ul>
<li><p><code>Teleport</code>是一种能够将我们的<strong>组件<code>html</code>结构</strong>移动到指定位置的技术</p>
</li>
<li><p>后代组件中，直接显示的弹窗，会被包裹在<code>dom</code>结构内，即使可以使用定位，但组件嵌套一多，写起来也麻烦</p>
<ul>
<li><code>移动位置</code>可写的值：<ul>
<li><code>body</code><ul>
<li>组件的嵌套再多，渲染的<code>dom</code>结构，也是直接在<code>body</code>下的</li>
</ul>
</li>
<li><code>css</code>选择器</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;teleport to=&#x27;移动位置&#x27;&gt;</span><br><span class="line">	&lt;div v-if=&#x27;isShow&#x27; class=&#x27;mask&#x27;&gt;</span><br><span class="line">        &lt;div class=&#x27;dialog&#x27;&gt;</span><br><span class="line">            &lt;h3&gt;</span><br><span class="line">                我是一个弹窗</span><br><span class="line">            &lt;/h3&gt;</span><br><span class="line">            &lt;button @click=&#x27;isShow=false&#x27;&gt;</span><br><span class="line">                关闭弹窗</span><br><span class="line">            &lt;/button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/teleport&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="8-6-3-Suspense"><a href="#8-6-3-Suspense" class="headerlink" title="8.6.3.Suspense"></a>8.6.3.<code>Suspense</code></h3><ul>
<li><p>等待异步组件时渲染一些后备内容，获得更好地用户体验</p>
<ul>
<li><code>Suspense</code>底层是用插槽实现的<ul>
<li><code>v-slot:defalut</code><ul>
<li>用于放置本应该展示的组件</li>
</ul>
</li>
<li><code>v-slot:fallback</code><ul>
<li>组件未加载时，展示的内容</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>使用步骤：</p>
<ul>
<li><p>1.异步引入组件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;defineAsyncComponent&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="comment">// import Child from &#x27;./components/Child.vue&#x27; // 静态引入（同步引入）</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Child</span> = <span class="title function_">defineAsyncComponent</span>(<span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;./components/Child.vue&#x27;</span>)) <span class="comment">// 动态引入（异步引入）</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>2.使用<code>Suspence</code>包裹组件，并配置好<code>default</code>与<code>fallback</code></p>
<p><code>App.vue</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div class=&#x27;app&#x27;&gt;</span><br><span class="line">        &lt;h3&gt;</span><br><span class="line">        	我是App组件    </span><br><span class="line">    	&lt;/h3&gt;</span><br><span class="line">        &lt;Suspence&gt;</span><br><span class="line">    		&lt;template v-slot:default&gt;</span><br><span class="line">				&lt;Child/&gt;</span><br><span class="line">			&lt;/template&gt;</span><br><span class="line">			&lt;template v-slot:fallback&gt;</span><br><span class="line">				&lt;h3&gt;</span><br><span class="line">                    加载中...</span><br><span class="line">                &lt;/h3&gt;</span><br><span class="line">			&lt;/template&gt;</span><br><span class="line">    	&lt;/Suspence&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>同步引入情况下，会等到所有的组件引入加载完，才会展示</li>
<li>异步引入情况下，被设置成异步引入的组件，不会阻塞整个页面的加载</li>
</ul>
</li>
<li><p>之前说<code>setup</code>不能返回<code>Promise</code>，那是因为没有讲到这里，其实是可以的</p>
<p><code>Child.vue</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div class=&quot;child&quot;&gt;</span><br><span class="line">		&lt;h3&gt;我是Child组件&lt;/h3&gt;</span><br><span class="line">		&#123;&#123;sum&#125;&#125;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">	import &#123;ref&#125; from &#x27;vue&#x27;</span><br><span class="line">	export default &#123;</span><br><span class="line">		name: &#x27;Child&#x27;,</span><br><span class="line">		setup() &#123;</span><br><span class="line">			let sum = ref(0)</span><br><span class="line">			return new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">				setTimeout(() =&gt; &#123;</span><br><span class="line">					resolve(sum)</span><br><span class="line">				&#125;, 1000)</span><br><span class="line">			&#125;)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>或者写成<code>async</code>形式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div class=&quot;child&quot;&gt;</span><br><span class="line">		&lt;h3&gt;我是Child组件&lt;/h3&gt;</span><br><span class="line">		&#123;&#123;sum&#125;&#125;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">	import &#123;ref&#125; from &#x27;vue&#x27;</span><br><span class="line">	export default &#123;</span><br><span class="line">		name: &#x27;Child&#x27;,</span><br><span class="line">		async setup() &#123;</span><br><span class="line">			let sum = ref(0)</span><br><span class="line">			let p = new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">				setTimeout(() =&gt; &#123;</span><br><span class="line">					resolve(sum)</span><br><span class="line">				&#125;, 1000)</span><br><span class="line">			&#125;)</span><br><span class="line">            return await p</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>可以配合<code>Suspence</code>使用</p>
</li>
</ul>
</li>
</ul>
<h2 id="8-7-其他"><a href="#8-7-其他" class="headerlink" title="8.7.其他"></a>8.7.其他</h2><h3 id="8-7-1-全局API的转移"><a href="#8-7-1-全局API的转移" class="headerlink" title="8.7.1.全局API的转移"></a>8.7.1.全局<code>API</code>的转移</h3><ul>
<li><p><code>vue2</code>有许多全局<code>API</code>和配置</p>
<ul>
<li><p>例如：注册全局组件、注册全局指令等</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注册全局组件</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">component</span>(<span class="string">&#x27;MyButton&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">data</span>: <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">        <span class="attr">count</span>: <span class="number">0</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="attr">template</span>: <span class="string">`&lt;button @click=&quot;count++&gt;Clicked &#123;&#123;count&#125;&#125; times.&lt;/button&gt;`</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册全局指令</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">directive</span>(<span class="string">&#x27;focus&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">inserted</span>: <span class="function"><span class="params">el</span> =&gt;</span> el.<span class="title function_">focus</span>()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><code>vue3</code>中对这些<code>API</code>做出了调整</p>
<ul>
<li><p>将全局的<code>API</code>，即<code>Vue.xxx</code>调整到应用实例<code>app</code>上</p>
<table>
<thead>
<tr>
<th>2.x全局API（Vue）</th>
<th>3.x实例API（app）</th>
</tr>
</thead>
<tbody><tr>
<td>Vue.config.xxx</td>
<td>app.config.xxx</td>
</tr>
<tr>
<td>Vue.config.productionTip</td>
<td>移除</td>
</tr>
<tr>
<td>Vue.component</td>
<td>app.component</td>
</tr>
<tr>
<td>Vue.directive</td>
<td>app.directive</td>
</tr>
<tr>
<td>Vue.mixin</td>
<td>app.mixin</td>
</tr>
<tr>
<td>Vue.use</td>
<td>app.use</td>
</tr>
<tr>
<td>Vue.prototype</td>
<td>app.config.globalProperties</td>
</tr>
</tbody></table>
</li>
</ul>
</li>
</ul>
<h2 id="8-7-2-其他改变"><a href="#8-7-2-其他改变" class="headerlink" title="8.7.2.其他改变"></a>8.7.2.其他改变</h2><ul>
<li><p><code>data</code>选项应始终被声明为一个函数</p>
</li>
<li><p>过度类名的更改</p>
<ul>
<li><p><code>vue2</code>的写法</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.v-enter</span>, <span class="selector-class">.v-leave-to</span> &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.v-leave</span>, <span class="selector-class">.v-enter-to</span> &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>vue3</code>的写法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.<span class="property">v</span>-enter-<span class="keyword">from</span>, .<span class="property">v</span>-leave-to &#123;</span><br><span class="line">    <span class="attr">opacity</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">.<span class="property">v</span>-leave-<span class="keyword">from</span>, .<span class="property">v</span>-enter-to &#123;</span><br><span class="line">    <span class="attr">opacity</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>移除<code>keyCode</code>作为<code>v-on</code>的修饰符，同时也不再支持<code>config.keyCodes</code></p>
</li>
<li><p>移除<code>v-on.native</code>修饰符</p>
<ul>
<li><p>父组件中绑定事件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;my-component </span><br><span class="line">              v-on:close = &quot;handleComponentEvent&quot;</span><br><span class="line">              v-on:click = &quot;handleNativeClickEvent&quot;</span><br><span class="line">              /&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>子组件中声明自定义事件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">	export default &#123;</span><br><span class="line">        emits: [&#x27;close&#x27;] // 没指定的，会认为是原生事件</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>移除过滤器（<code>filter</code>）</p>
<ul>
<li>过滤器虽然看起来很方便，但它需要一个自定义语法，打破大括号内表达式“只是JavaScript”的假设，这不仅有学习成本，而且有实现成本</li>
<li>建议用方法调用或计算属性去替换过滤器</li>
</ul>
</li>
<li><p>其他</p>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://mindcons.cn/2022/07/25/web/%E6%A1%86%E6%9E%B6/Vue/Vue3.0/Vue3%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/" data-id="cldolkc8o0089fgx6egvj9cim" data-title="Vue3基本使用" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Vue3/" rel="tag">Vue3</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-web/JavaScript/TypeScript" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/07/19/web/JavaScript/TypeScript/" class="article-date">
  <time class="dt-published" datetime="2022-07-19T11:38:20.000Z" itemprop="datePublished">2022-07-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/07/19/web/JavaScript/TypeScript/">TypeScript基础</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>[TOC]</p>
<h1 id="环境配置和搭建"><a href="#环境配置和搭建" class="headerlink" title="环境配置和搭建"></a>环境配置和搭建</h1><h2 id="什么是TypeScript"><a href="#什么是TypeScript" class="headerlink" title="什么是TypeScript"></a>什么是<code>TypeScript</code></h2><p><code>TypeScript</code>是<code>JavaScript</code>的超集，遵循最新的<code>ES5/ES6</code>规范。<code>TypeScript</code>扩展了<code>JavaScript</code>语法</p>
<p>为什么要有<code>TS</code></p>
<ul>
<li><code>TS</code>更像后端语言，如<code>JAVA</code>，可以开发大型企业应用</li>
<li><code>TS</code>提供的类型系统，可以帮助我们在写代码时提供丰富的语法提示</li>
<li>在编写代码时，会对代码进行类型检查从而避免很多线上错误</li>
</ul>
<blockquote>
<p><code>TypeScript</code>不会取代<code>js</code>，两者是相互共存的</p>
<p>尤雨溪：我认为将类型添加到<code>js</code>本身是一个漫长的过程。让委员会设计一个类型系统是（根据<code>TC39</code>的经历来判断）不切实际的</p>
<p>我也是这么认为的</p>
</blockquote>
<h2 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h2><h3 id="全局编译TS文件"><a href="#全局编译TS文件" class="headerlink" title="全局编译TS文件"></a>全局编译<code>TS</code>文件</h3><p>全局安装<code>typescript</code>对<code>ts</code>进行编译</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm i typescript -g</span><br><span class="line">tsc --init <span class="comment"># 生成tsconfig.json</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tsc <span class="comment"># 可以将ts文件编译成js文件</span></span><br><span class="line">tsc --watch <span class="comment"># 监控ts文件变化生成js文件</span></span><br></pre></td></tr></table></figure>

<p>本地安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm i typescript -D</span><br><span class="line">npx tsc --init</span><br></pre></td></tr></table></figure>

<p>创建<code>tsconfig.json</code>，以下是默认生成的配置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">npx tsc --init</span><br><span class="line"></span><br><span class="line">Created a new tsconfig.json with:                                                                                       </span><br><span class="line">                                                                                                                     TS </span><br><span class="line">  target: es2016</span><br><span class="line">  module: commonjs</span><br><span class="line">  strict: <span class="literal">true</span></span><br><span class="line">  esModuleInterop: <span class="literal">true</span></span><br><span class="line">  skipLibCheck: <span class="literal">true</span></span><br><span class="line">  forceConsistentCasingInFileNames: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">You can learn more at https://aka.ms/tsconfig</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>新建<code>src/1.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">string</span>:<span class="title class_">String</span> = <span class="string">&#x27;hello&#x27;</span></span><br></pre></td></tr></table></figure>

<p>会根据配置文件，将其转为<code>js</code>语法</p>
<p>使用<code>tsc</code>指令，将文件转化为<code>js</code>语法，默认不添加文件名，会将当前目录及子目录下，所有的<code>ts</code>文件全部转为<code>js</code>文件，如果是局部安装，则使用<code>npx tsc</code>指令</p>
<p><img src="/2022/07/19/web/JavaScript/TypeScript/image-20220719224055435.png" alt="image-20220719224055435"></p>
<p><code>1.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&quot;use strict&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> string = <span class="string">&#x27;hello&#x27;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>但我们希望的是实时编译，使用<code>npx tsc --watch</code>指令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">D:\workspace\github\code\project-workshop\code-prac\typescript&gt;npx tsc --watch</span><br><span class="line">[下午10:44:16] File change detected. Starting incremental compilation...</span><br><span class="line"></span><br><span class="line">[下午10:44:16] Found 0 errors. Watching <span class="keyword">for</span> file changes.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>修改<code>1.ts</code>，是会实时编译的</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">string</span>:<span class="title class_">String</span> = <span class="string">&#x27;hello1&#x27;</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">hello</span>:<span class="title class_">String</span> = <span class="string">&#x27;hello&#x27;</span></span><br></pre></td></tr></table></figure>

<p><code>1.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&quot;use strict&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> string = <span class="string">&#x27;hello1&#x27;</span>;</span><br><span class="line"><span class="keyword">let</span> hello = <span class="string">&#x27;hello&#x27;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="code-runner-ts-node"><a href="#code-runner-ts-node" class="headerlink" title="code runner + ts-node"></a><code>code runner + ts-node</code></h3><p>现在我们还希望，直接运行<code>ts</code>文件，比如打印下<code>string</code>变量，目前可行的办法是，编译成<code>js</code>后，运行<code>js</code>文件</p>
<p>但很麻烦，借助于<code>code runner</code>插件（需要在<code>vscode</code>插件市场搜索安装），并安装<code>npm install ts-node -g</code>，必须装在全局</p>
<p><code>1.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">string</span>:<span class="title class_">String</span> = <span class="string">&#x27;hello1&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">hello</span>:<span class="title class_">String</span> = <span class="string">&#x27;hello&#x27;</span> <span class="comment">// 选中</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(hello) <span class="comment">// 选中</span></span><br></pre></td></tr></table></figure>

<p>然后选择<code>1.ts</code>中的代码，右键运行<code>Run Code</code>，控制台会打印输出<code>hello</code></p>
<p>同级目录下，会生成<code>tempCodeRunnerFile.js</code>，内容是选中的内容，然后借助了<code>ts-node</code>环境执行了该文件</p>
<p><img src="/2022/07/19/web/JavaScript/TypeScript/image-20220719225649559.png" alt="image-20220719225649559"></p>
<p>无论是全局编译还是使用<code>code runner + ts-code</code>来处理<code>ts</code>文件，在我们真正写代码时，还是不能满足需求的，所以要借助构建工具</p>
<p>可以使用<code>webpack</code>或<code>rollup</code></p>
<h3 id="构建工具来处理ts"><a href="#构建工具来处理ts" class="headerlink" title="构建工具来处理ts"></a>构建工具来处理<code>ts</code></h3><p>由于学习<code>ts</code>的过程中，并不会处理图片等资源，这里的构建工具暂不选取<code>webpack</code>，而使用<code>rollup</code></p>
<p>拓展：解析<code>ts</code>的方式有两种</p>
<ul>
<li><code>ts</code>插件来解析</li>
<li>通过<code>babel</code>来解析</li>
</ul>
<p>在<code>rollup</code>中，会采用<code>rollup-plugin-typescript2</code>包，配合当前配置文件来解析<code>ts</code></p>
<p>在<code>webpack</code>中，会采用<code>ts-loader</code>或者<code>babel-plugin-typescript</code>包来解析</p>
<h4 id="rollup来处理ts"><a href="#rollup来处理ts" class="headerlink" title="rollup来处理ts"></a><code>rollup</code>来处理<code>ts</code></h4><p>新建<code>rollup.config.js</code></p>
<p>本地安装</p>
<ul>
<li><code>rollup</code></li>
<li><code>typescript</code></li>
<li><code>rollup-plugin-typescript2</code>：连接<code>rollup</code>和<code>typescript</code>的桥梁</li>
<li><code>@rollup/plugin-node-resolve</code>：以<code>node</code>的方式导入第三方包</li>
<li><code>rollup-plugin-serve</code>：起服务相关</li>
</ul>
<p>在根路径下，<code>npm init -y</code>初始化<code>package.json</code></p>
<p>根目录下安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i rollup typescript rollup-plugin-typescript2 @rollup/plugin-node-resolve rollup-plugin-serve -D</span><br></pre></td></tr></table></figure>

<p>安装后的<code>package.json</code></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;typescript&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;main&quot;</span><span class="punctuation">:</span> <span class="string">&quot;index.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;test&quot;</span><span class="punctuation">:</span> <span class="string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;keywords&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;author&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;license&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ISC&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;devDependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;@rollup/plugin-node-resolve&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^13.3.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;rollup&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^2.77.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;rollup-plugin-serve&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^2.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;rollup-plugin-typescript2&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^0.32.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;typescript&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^4.7.4&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>新建<code>src/index.ts</code>文件</p>
<p>配置<code>rollup.config.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;nodeResolve&#125; <span class="keyword">from</span> <span class="string">&quot;@rollup/plugin-node-resolve&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> ts <span class="keyword">from</span> <span class="string">&quot;rollup-plugin-typescript2&quot;</span></span><br><span class="line"><span class="keyword">import</span> serve <span class="keyword">from</span> <span class="string">&quot;rollup-plugin-serve&quot;</span></span><br><span class="line"><span class="keyword">import</span> path <span class="keyword">from</span> <span class="string">&quot;path&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">input</span>:<span class="string">&#x27;src/index.ts&#x27;</span>,</span><br><span class="line">    <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">file</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;dist/bundle.js&#x27;</span>),</span><br><span class="line">        <span class="attr">format</span>: <span class="string">&#x27;iife&#x27;</span>, <span class="comment">// 告诉rollup，打包后的代码是可以执行的，所以打包成立即执行函数</span></span><br><span class="line">        <span class="comment">// 常见的有global(弄个全局变量来接受)</span></span><br><span class="line">        <span class="comment">// cjs（会变成module.exports）</span></span><br><span class="line">        <span class="comment">// esm（会变成 import export的es6语法）</span></span><br><span class="line">        <span class="comment">// umd（兼容amd + commonjs，不支持es6导入）</span></span><br><span class="line">        <span class="comment">// rollup的配置文件，支持es6语法，它就是根据es6的语法来解析的</span></span><br><span class="line">        <span class="attr">sourcemap</span>: <span class="literal">true</span> <span class="comment">// ts的配置文件也得配，ts配置文件中，搜索sourceMap，取消注释即可</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="comment">// 1.先拿到ts文件</span></span><br><span class="line">        <span class="title function_">nodeResolve</span>(&#123;</span><br><span class="line">            <span class="attr">extensions</span>: [<span class="string">&#x27;.js&#x27;</span>, <span class="string">&#x27;.ts&#x27;</span>] <span class="comment">// 默认解析ts文件</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="comment">// 2.根据配置文件解析</span></span><br><span class="line">        <span class="title function_">ts</span>(&#123;</span><br><span class="line">            <span class="comment">// 指定好ts的配置文件</span></span><br><span class="line">            <span class="attr">tsconfig</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;tsconfig.json&#x27;</span>)</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="comment">// 3.最后提供服务</span></span><br><span class="line">        <span class="title function_">serve</span>(&#123;</span><br><span class="line">            <span class="attr">port</span>: <span class="number">3000</span>, <span class="comment">// 指定服务的端口号</span></span><br><span class="line">            <span class="attr">contentBase</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 值为空，表示指定根目录</span></span><br><span class="line">            <span class="attr">openPage</span>: <span class="string">&#x27;/public/index.html&#x27;</span> <span class="comment">// 需要新建该目录和文件，并在index.html中引入`dist/bundle.js`</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>备注：<code>ts</code>的配置文件也得配<code>sourceMap</code>，搜索<code>sourceMap</code>，取消注释即可</p>
<p><code>package.json</code>中新增<code>script</code></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;test&quot;</span><span class="punctuation">:</span> <span class="string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;dev&quot;</span><span class="punctuation">:</span> <span class="string">&quot;rollup -cw&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>

<p>执行<code>npm run dev</code></p>
<p>报错：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[!] Error: Incompatible tsconfig option. Module resolves to <span class="string">&#x27;CommonJS&#x27;</span>. This is incompatible with rollup, please use <span class="string">&#x27;module: &quot;ES2015&quot;&#x27;</span> or <span class="string">&#x27;module: &quot;ESNext&quot;&#x27;</span>.</span><br><span class="line">Error: Incompatible tsconfig option. Module resolves to <span class="string">&#x27;CommonJS&#x27;</span>. This is incompatible with rollup, please use <span class="string">&#x27;module: &quot;ES2015&quot;&#x27;</span> or <span class="string">&#x27;module: &quot;ESNext&quot;&#x27;</span>.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>将<code>ts</code>的配置文件的<code>module</code>字段的值，改为<code>ESNext</code>（默认的是<code>commonjs</code>），<code>target</code>字段由<code>es2016</code>改为<code>es5</code></p>
<p>再次执行<code>npm run dev</code></p>
<p>成功：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">bundles src/index.ts → dist/bundle.js...</span><br><span class="line">rpt2: options error TS6053: File <span class="string">&#x27;D:/workspace/github/code/project-workshop/code-prac/src/index.ts&#x27;</span> not found.</span><br><span class="line">  The file is <span class="keyword">in</span> the program because:</span><br><span class="line">    Root file specified <span class="keyword">for</span> compilation</span><br><span class="line">http://localhost:3000 -&gt; D:\workspace\github\code\project-workshop\code-prac\typescript</span><br><span class="line">(!) Generated an empty chunk</span><br><span class="line">index</span><br><span class="line">created dist/bundle.js <span class="keyword">in</span> 4.5s</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>打开<code>localhost:8080/public/index.html</code>，看下控制台效果</p>
<p>注意<code>index.html</code>中，引入<code>bundle.js</code>的路径，<code>rollup</code>会自己去找</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/dist/bundle.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>当然也可以直接使用相对路径（推荐）</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../dist/bundle.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>目前我们是没有写任何<code>ts</code>代码的，所以会有如上提示</p>
<p>在<code>src/index.ts</code>中写点内容</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">str</span>:<span class="title class_">String</span> = <span class="string">&quot;hello&quot;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(str)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>注意要打印该变量（使用该变量），因为<code>rollup</code>默认开启了<code>tree-shaking</code></p>
<p>保存后查看<code>dist/bundle.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">	<span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> str = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(str);</span><br><span class="line"></span><br><span class="line">&#125;)();</span><br><span class="line"><span class="comment">//# sourceMappingURL=bundle.js.map</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="基本类型"><a href="#基本类型" class="headerlink" title="基本类型"></a>基本类型</h1><ul>
<li>最基本的类型有，数字、字符、布尔</li>
<li>所有的类型都在冒号后面，<code>ts</code>的核心：一切都以安全为准</li>
<li>什么时候可以不用类型（推导）</li>
</ul>
<p>基本演示</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 基础类型，基本演示</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">num</span>:<span class="built_in">number</span> = <span class="number">1</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">str</span>:<span class="built_in">string</span> = <span class="string">&#x27;sai&#x27;</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">bool</span>:<span class="built_in">boolean</span> = <span class="literal">true</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="数字类型"><a href="#数字类型" class="headerlink" title="数字类型"></a>数字类型</h2><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数字类型</span></span><br><span class="line"><span class="comment">// 分清小写`number`和大写`Number`的区别（`js`基础）</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">num2</span>:<span class="title class_">Number</span> = <span class="number">2</span> <span class="comment">// 类，也可以当做类型</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">num3</span>:<span class="built_in">number</span> = <span class="title class_">Number</span>(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">let</span> <span class="attr">num4</span>:<span class="title class_">Number</span> = <span class="keyword">new</span> <span class="title class_">Number</span>(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(num2, num3, num4)</span><br></pre></td></tr></table></figure>

<p><code>bundle.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">	<span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 数字类型</span></span><br><span class="line">	<span class="comment">// 分清小写`number`和大写`Number`的区别（`js`基础）</span></span><br><span class="line">	<span class="keyword">var</span> num2 = <span class="number">2</span>; <span class="comment">// 类，也可以当做类型</span></span><br><span class="line">	<span class="keyword">var</span> num3 = <span class="title class_">Number</span>(<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">var</span> num4 = <span class="keyword">new</span> <span class="title class_">Number</span>(<span class="number">1</span>);</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(num2, num3, num4);</span><br><span class="line"></span><br><span class="line">&#125;)();</span><br><span class="line"><span class="comment">//# sourceMappingURL=bundle.js.map</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="数组类型"><a href="#数组类型" class="headerlink" title="数组类型"></a>数组类型</h2><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数组类型，数组的概念：一类类型的集合</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">arr</span>:<span class="built_in">number</span>[]  = [] <span class="comment">// 声明只放数字的数组</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">arr2</span>:(<span class="built_in">number</span> | <span class="built_in">string</span>)[] = [<span class="string">&#x27;a&#x27;</span>, <span class="number">1</span>] <span class="comment">// 联合类型，声明既可以放数字，也可以放字符串的数组（并集）</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">arr3</span>:<span class="built_in">any</span>[] = [<span class="string">&#x27;&#x27;</span>, <span class="number">1</span>, &#123;&#125;] <span class="comment">// 如果数组里放的内容就是不规律的</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">arr4</span>:<span class="title class_">Array</span>&lt;<span class="built_in">boolean</span>&gt; = [<span class="literal">true</span>, <span class="literal">false</span>] <span class="comment">// 利用泛型来定义数组</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>bundle.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">	<span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 数组类型，数组的概念：一类类型的集合</span></span><br><span class="line">	<span class="keyword">var</span> arr = []; <span class="comment">// 声明只放数字的数组</span></span><br><span class="line">	<span class="keyword">var</span> arr2 = [<span class="string">&#x27;a&#x27;</span>, <span class="number">1</span>]; <span class="comment">// 联合类型，声明既可以放数字，也可以放字符串的数组（并集）</span></span><br><span class="line">	<span class="keyword">var</span> arr3 = [<span class="string">&#x27;&#x27;</span>, <span class="number">1</span>, &#123;&#125;]; <span class="comment">// 如果数组里放的内容就是不规律的</span></span><br><span class="line">	<span class="keyword">var</span> arr4 = [<span class="literal">true</span>, <span class="literal">false</span>]; <span class="comment">// 利用泛型来定义数组</span></span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(arr, arr2, arr3, arr4);</span><br><span class="line"></span><br><span class="line">&#125;)();</span><br><span class="line"><span class="comment">//# sourceMappingURL=bundle.js.map</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="元组类型"><a href="#元组类型" class="headerlink" title="元组类型"></a>元组类型</h2><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 元组，内容固定，类型固定</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">tuple</span>:[<span class="built_in">string</span>, <span class="built_in">boolean</span>, <span class="built_in">number</span>] = [<span class="string">&#x27;a&#x27;</span>, <span class="literal">true</span>, <span class="number">2</span>] <span class="comment">// 初始化的时候，必须按照要填入数据</span></span><br><span class="line"><span class="keyword">let</span> r = tuple.<span class="title function_">pop</span>() <span class="comment">// r的类型，三种都有可能，还有可能是undefined</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(r)</span><br><span class="line">tuple.<span class="title function_">push</span>(<span class="string">&#x27;bb&#x27;</span>, <span class="number">1</span>) <span class="comment">// 在放入的时候，只能放入元组中定义的类型</span></span><br><span class="line"><span class="comment">// tuple[3] = 100 // 不能通过索引来更改元组</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 应用场景：数据交换（要用到泛型，后面再说）</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>bundle.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">	<span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 元组，内容固定，类型固定</span></span><br><span class="line">	<span class="keyword">var</span> tuple = [<span class="string">&#x27;a&#x27;</span>, <span class="literal">true</span>, <span class="number">2</span>]; <span class="comment">// 初始化的时候，必须按照要填入数据</span></span><br><span class="line">	<span class="keyword">var</span> r = tuple.<span class="title function_">pop</span>(); <span class="comment">// r的类型，三种都有可能，还有可能是undefined</span></span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(r);</span><br><span class="line">	tuple.<span class="title function_">push</span>(<span class="string">&#x27;bb&#x27;</span>, <span class="number">1</span>); <span class="comment">// 在放入的时候，只能放入元组中定义的类型</span></span><br><span class="line">	<span class="comment">// tuple[3] = 100 // 不能通过索引来更改元组</span></span><br><span class="line">	<span class="comment">// 应用场景：数据交换（要用到泛型，后面再说）</span></span><br><span class="line"></span><br><span class="line">&#125;)();</span><br><span class="line"><span class="comment">//# sourceMappingURL=bundle.js.map</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="枚举类型"><a href="#枚举类型" class="headerlink" title="枚举类型"></a>枚举类型</h2><p><code>ts</code>最终编译成的<code>js</code>是没有类型的，只是在开发时使用，分为普通枚举、异构枚举和常量枚举</p>
<ul>
<li><p>普通枚举</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 普通枚举</span></span><br><span class="line"><span class="keyword">enum</span> <span class="variable constant_">ROLE</span> &#123; <span class="comment">// 大写是规范</span></span><br><span class="line">    <span class="variable constant_">USER</span>,</span><br><span class="line">    <span class="variable constant_">ADMIN</span>,</span><br><span class="line">    <span class="variable constant_">MANAGE</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable constant_">ROLE</span>) <span class="comment">// 值是默认加上的，可以通过USER取0，ADMIN取1</span></span><br><span class="line"><span class="comment">// 同时还可以反举，通过0来取USER，2取ADMIN</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//     &#x27;0&#x27;: &#x27;USER&#x27;,</span></span><br><span class="line"><span class="comment">//     &#x27;1&#x27;: &#x27;ADMIN&#x27;,</span></span><br><span class="line"><span class="comment">//     &#x27;2&#x27;: &#x27;MANAGE&#x27;,</span></span><br><span class="line"><span class="comment">//     USER: 0,</span></span><br><span class="line"><span class="comment">//     ADMIN: 1,</span></span><br><span class="line"><span class="comment">//     MANAGE: 2</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure>

<p><code>bundle.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 普通枚举</span></span><br><span class="line">    <span class="keyword">var</span> <span class="variable constant_">ROLE</span>;</span><br><span class="line">    (<span class="keyword">function</span> (<span class="params">ROLE</span>) &#123;</span><br><span class="line">        <span class="variable constant_">ROLE</span>[<span class="variable constant_">ROLE</span>[<span class="string">&quot;USER&quot;</span>] = <span class="number">0</span>] = <span class="string">&quot;USER&quot;</span>;</span><br><span class="line">        <span class="variable constant_">ROLE</span>[<span class="variable constant_">ROLE</span>[<span class="string">&quot;ADMIN&quot;</span>] = <span class="number">1</span>] = <span class="string">&quot;ADMIN&quot;</span>;</span><br><span class="line">        <span class="variable constant_">ROLE</span>[<span class="variable constant_">ROLE</span>[<span class="string">&quot;MANAGE&quot;</span>] = <span class="number">2</span>] = <span class="string">&quot;MANAGE&quot;</span>;</span><br><span class="line">    &#125;)(<span class="variable constant_">ROLE</span> || (<span class="variable constant_">ROLE</span> = &#123;&#125;));</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable constant_">ROLE</span>); <span class="comment">// 值是默认加上的，可以通过USER取0，ADMIN取1</span></span><br><span class="line">    <span class="comment">// 同时还可以反举，通过0来取USER，2取ADMIN</span></span><br><span class="line">    <span class="comment">// &#123;</span></span><br><span class="line">    <span class="comment">//     &#x27;0&#x27;: &#x27;USER&#x27;,</span></span><br><span class="line">    <span class="comment">//     &#x27;1&#x27;: &#x27;ADMIN&#x27;,</span></span><br><span class="line">    <span class="comment">//     &#x27;2&#x27;: &#x27;MANAGE&#x27;,</span></span><br><span class="line">    <span class="comment">//     USER: 0,</span></span><br><span class="line">    <span class="comment">//     ADMIN: 1,</span></span><br><span class="line">    <span class="comment">//     MANAGE: 2</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">&#125;)();</span><br><span class="line"><span class="comment">//# sourceMappingURL=bundle.js.map</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>异构枚举</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 异构枚举</span></span><br><span class="line"><span class="keyword">enum</span> <span class="variable constant_">ROLE</span> &#123;</span><br><span class="line">    <span class="variable constant_">USER</span> = <span class="string">&#x27;USER&#x27;</span>, <span class="comment">// 放字符串是不支持反举的</span></span><br><span class="line">    <span class="variable constant_">ADMIN</span> = <span class="number">5</span>,</span><br><span class="line">    <span class="variable constant_">MANAGE</span> <span class="comment">// 会根据上一个的值，自动进行推断，值默认往后加一</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable constant_">ROLE</span>)</span><br><span class="line"><span class="comment">// &#123; &#x27;5&#x27;: &#x27;ADMIN&#x27;, &#x27;6&#x27;: &#x27;MANAGE&#x27;, USER: &#x27;USER&#x27;, ADMIN: 5, MANAGE: 6 &#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>bundle.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 异构枚举</span></span><br><span class="line">    <span class="keyword">var</span> <span class="variable constant_">ROLE</span>;</span><br><span class="line">    (<span class="keyword">function</span> (<span class="params">ROLE</span>) &#123;</span><br><span class="line">        <span class="variable constant_">ROLE</span>[<span class="string">&quot;USER&quot;</span>] = <span class="string">&quot;USER&quot;</span>;</span><br><span class="line">        <span class="variable constant_">ROLE</span>[<span class="variable constant_">ROLE</span>[<span class="string">&quot;ADMIN&quot;</span>] = <span class="number">5</span>] = <span class="string">&quot;ADMIN&quot;</span>;</span><br><span class="line">        <span class="variable constant_">ROLE</span>[<span class="variable constant_">ROLE</span>[<span class="string">&quot;MANAGE&quot;</span>] = <span class="number">6</span>] = <span class="string">&quot;MANAGE&quot;</span>; <span class="comment">// 会根据上一个的值，自动进行推断，值默认往后加一</span></span><br><span class="line">    &#125;)(<span class="variable constant_">ROLE</span> || (<span class="variable constant_">ROLE</span> = &#123;&#125;));</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable constant_">ROLE</span>);</span><br><span class="line">    <span class="comment">// &#123; &#x27;5&#x27;: &#x27;ADMIN&#x27;, &#x27;6&#x27;: &#x27;MANAGE&#x27;, USER: &#x27;USER&#x27;, ADMIN: 5, MANAGE: 6 &#125;</span></span><br><span class="line"></span><br><span class="line">&#125;)();</span><br><span class="line"><span class="comment">//# sourceMappingURL=bundle.js.map</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>加上<code>const</code>后，不会生成一个对象（更简洁），没有反举了</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 异构枚举</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">enum</span> <span class="variable constant_">ROLE</span> &#123;</span><br><span class="line">    <span class="variable constant_">USER</span> = <span class="string">&#x27;USER&#x27;</span>,</span><br><span class="line">    <span class="variable constant_">ADMIN</span> = <span class="number">5</span>,</span><br><span class="line">    <span class="variable constant_">MANAGE</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable constant_">ROLE</span>.<span class="property">USER</span>) <span class="comment">// USER</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>bundle.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;USER&quot;</span> <span class="comment">/* ROLE.USER */</span>); <span class="comment">// USER</span></span><br><span class="line"></span><br><span class="line">&#125;)();</span><br><span class="line"><span class="comment">//# sourceMappingURL=bundle.js.map</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="null和undefined"><a href="#null和undefined" class="headerlink" title="null和undefined"></a><code>null</code>和<code>undefined</code></h2><p><code>null</code>和<code>undefined</code>是任何类型的子类型，可以赋值给其他类型</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">name</span>:<span class="built_in">number</span> = <span class="literal">undefined</span> <span class="comment">// 默认情况下，是不能把undefined和null赋给其他人的</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/07/19/web/JavaScript/TypeScript/image-20220720200619011.png" alt="image-20220720200619011"></p>
<p>修改<code>ts</code>的配置文件，取消<code>strictNullChecks</code>字段的注释，设置为<code>false</code>，或者不用改这里，直接取消严格模式</p>
<p>由于<code>name</code>变量已经在<code>ts</code>的全局环境中定义了，所以导出当前的变量</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">name</span>:<span class="built_in">number</span> = <span class="literal">undefined</span> <span class="comment">// 默认情况下，是不能把undefined和null赋给其他人的</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;&#125; <span class="comment">// name属性，在ts全局下已经被声明过了，再声明就重复了。如果想要在自己的文件中也能声明，就需要加上export &#123;&#125;，做一个导出，表示name是当前模块的name，而不是外部的name。如果不加这个声明，ts会把所有的声明类型做一个合并。声明的作用是：防止模块间的数据共享类型。一般情况下，都会导出的</span></span><br></pre></td></tr></table></figure>

<p><code>bundle.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">	<span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> name = <span class="literal">undefined</span>; <span class="comment">// 默认情况下，是不能把undefined和null赋给其他人的</span></span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(name);</span><br><span class="line"></span><br><span class="line">&#125;)();</span><br><span class="line"><span class="comment">//# sourceMappingURL=bundle.js.map</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>我们恢复对<code>ts</code>配置文件的修改，在严格模式下，<code>undefined</code>赋值给<code>undefined</code>，<code>null</code>赋值给<code>null</code>，是没有问题的</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">u</span>:<span class="literal">undefined</span> = <span class="literal">undefined</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">n</span>:<span class="literal">null</span> = <span class="literal">null</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(u, n)</span><br></pre></td></tr></table></figure>

<p><code>bundle.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">	<span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> u = <span class="literal">undefined</span>;</span><br><span class="line">	<span class="keyword">var</span> n = <span class="literal">null</span>;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(u, n);</span><br><span class="line"></span><br><span class="line">&#125;)();</span><br><span class="line"><span class="comment">//# sourceMappingURL=bundle.js.map</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="never"><a href="#never" class="headerlink" title="never"></a><code>never</code></h2><p>表示代码无法达到终点（无法执行到），也是任何类型的子类型</p>
<ul>
<li><p>出错</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 应用场景：出错了，我希望抛个错，错误函数的类型，可以设置成never类型</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">throwError</span>(<span class="params"></span>):<span class="built_in">never</span> &#123; <span class="comment">// never可以赋值给void，因为它是任意类型的子类型</span></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">xxx</span>:<span class="built_in">string</span> = <span class="title function_">throwError</span>() <span class="comment">// never可以赋值给任意类型</span></span><br></pre></td></tr></table></figure>


</li>
<li><p>死循环</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">whileTrue</span>(<span class="params"></span>):<span class="built_in">never</span> &#123; <span class="comment">// 代码本身是不知道内部有没有死循环的，所以要明确指出，返回值就是never</span></span><br><span class="line">    <span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>永远走不到的判断</p>
</li>
<li><p>做代码的完整性校验</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">setVal</span>(<span class="params">val:<span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">typeof</span> val === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 这里永远走不到，因为入参已经限制死了</span></span><br><span class="line">        <span class="comment">// 帮我们代码做完整校验，走不到else中，val就是never</span></span><br><span class="line">        val </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="void"><a href="#void" class="headerlink" title="void"></a><code>void</code></h2><p><code>void</code>一般用来描述函数返回值，也可以描述变量</p>
<p>只能把<code>undefined</code>和<code>null</code>赋值给<code>void</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getVoid</span>(<span class="params"></span>):<span class="built_in">void</span> &#123; <span class="comment">// 指定返回值为void时</span></span><br><span class="line">    <span class="comment">// return undefined 并且函数内部啥都不写，相当于返回undefined，undefined是可以赋值给void的，写法时兼容的</span></span><br><span class="line">    <span class="comment">// 那么返回null呢？可以取消严格模式，或者设置ts配置文件的`strictNullChecks`字段为false,就可以将null赋值给void，但一般不会这么写（都会在严格模式下写代码）</span></span><br><span class="line">&#125;</span><br><span class="line">a = <span class="title function_">getVoid</span>() <span class="comment">// 当a的类型是void时，就知道该方法没有返回值了</span></span><br></pre></td></tr></table></figure>

<h2 id="object"><a href="#object" class="headerlink" title="object"></a><code>object</code></h2><p>非原始数据，后面泛型约束，会大量使用<code>object</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">create</span>(<span class="params">obj:<span class="built_in">object</span></span>) &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">create</span>(&#123;&#125;)</span><br><span class="line"><span class="title function_">create</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line"><span class="title function_">create</span>([])</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="symbol和bigint"><a href="#symbol和bigint" class="headerlink" title="symbol和bigint"></a><code>symbol</code>和<code>bigint</code></h2><p><code>js</code>本身就有的类型，并不是<code>ts</code>提供的</p>
<p><strong><code>Symbol</code></strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">s1</span>:<span class="built_in">symbol</span> = <span class="title class_">Symbol</span>(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">let</span> <span class="attr">s2</span>:<span class="built_in">symbol</span> = <span class="title class_">Symbol</span>(<span class="number">2</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(s1 === s2) <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<p>无法编译成<code>es5</code>，会原样输出</p>
<p><code>bundle.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">	<span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> s1 = <span class="title class_">Symbol</span>(<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">var</span> s2 = <span class="title class_">Symbol</span>(<span class="number">2</span>);</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(s1 === s2); <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line">&#125;)();</span><br><span class="line"><span class="comment">//# sourceMappingURL=bundle.js.map</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><code>bigint</code></strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> max = <span class="title class_">Number</span>.<span class="property">MAX_SAFE_INTEGER</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(max + <span class="number">1</span> === max + <span class="number">2</span>); <span class="comment">// true 取到js中的最大值，然后相加，结果为true，很明显是有问题的</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">r1</span>:<span class="built_in">bigint</span> = <span class="title class_">BigInt</span>(max)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">BigInt</span>(max) + <span class="title class_">BigInt</span>(<span class="number">1</span>) === <span class="title class_">BigInt</span>(max) + <span class="title class_">BigInt</span>(<span class="number">2</span>)) <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<p><code>bundle.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">	<span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> max = <span class="title class_">Number</span>.<span class="property">MAX_SAFE_INTEGER</span>;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(max + <span class="number">1</span> === max + <span class="number">2</span>); <span class="comment">// true 取到js中的最大值，然后相加，结果为true，很明显是有问题的</span></span><br><span class="line">	<span class="title class_">BigInt</span>(max);</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">BigInt</span>(max) + <span class="title class_">BigInt</span>(<span class="number">1</span>) === <span class="title class_">BigInt</span>(max) + <span class="title class_">BigInt</span>(<span class="number">2</span>)); <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line">&#125;)();</span><br><span class="line"><span class="comment">//# sourceMappingURL=bundle.js.map</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="联合类型"><a href="#联合类型" class="headerlink" title="联合类型"></a>联合类型</h1><p>联合类型如果不进行赋值，在没有确定类型之前，默认会取公共方法</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">numOrStr</span>:<span class="built_in">string</span> | <span class="built_in">number</span></span><br></pre></td></tr></table></figure>



<p><img src="/2022/07/19/web/JavaScript/TypeScript/image-20220721211404171.png" alt="image-20220721211404171"></p>
<p>在确定类型后，可以设置相对应的方法</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">numOrStr = <span class="number">123</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/07/19/web/JavaScript/TypeScript/image-20220721223156872.png" alt="image-20220721223156872"></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">numOrStr = <span class="string">&#x27;abc&#x27;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/07/19/web/JavaScript/TypeScript/image-20220721223246737.png" alt="image-20220721223246737"></p>
<p>赋予类型后，可以根据上下文自动推断对应类型的方法</p>
<p>场景：</p>
<ul>
<li><p>在取值的时候，也会遇到联合类型</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">ele</span>:<span class="title class_">HTMLElement</span> | <span class="literal">null</span> = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;app&#x27;</span>) <span class="comment">// 真正取到了这个元素，或这个元素不存在</span></span><br><span class="line">ele.<span class="property">innerHTML</span> = <span class="string">&#x27;abc&#x27;</span></span><br></pre></td></tr></table></figure>

<p>直接就提示了<code>ele</code>可能为空，备注：<code>HTMLElement</code>类型是<code>ts</code>内部提供的类型</p>
<p><img src="/2022/07/19/web/JavaScript/TypeScript/image-20220721224547820.png" alt="image-20220721224547820"></p>
<p>之前我们可以通过</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(ele) &#123;</span><br><span class="line">    ele.<span class="property">innerHTML</span> = <span class="string">&#x27;abc&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ele &amp;&amp; (ele.<span class="property">innerHTML</span> = <span class="string">&#x27;abc&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>来进行判断</p>
<p>但现在我们就明确知道了，<code>ele</code>一定不为空，可以使用非空断言：<code>!</code>，告诉<code>ts</code>，这个东西一定有值，后续出事我负责</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ele!.<span class="property">innerHTML</span> = <span class="string">&#x27;abc&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 另外一个例子</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">a</span>:<span class="built_in">string</span> | <span class="built_in">number</span> | <span class="literal">undefined</span></span><br><span class="line">a!.<span class="title function_">toString</span>()</span><br></pre></td></tr></table></figure>

<p>上面是去除掉了空的情况，也可以直接使用<code>as</code>或<code>&lt;&gt;</code>强转某个类型</p>
<p>强制告诉<code>ts</code>，当前这个变量，就是其中某个类型的一个</p>
<p>强转要求必须在联合类型中用才行</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">a</span>:<span class="built_in">string</span> | <span class="built_in">number</span> | <span class="literal">undefined</span></span><br><span class="line"></span><br><span class="line">(&lt;<span class="built_in">string</span>&gt;a).<span class="title function_">indexOf</span>(<span class="string">&#x27;abc&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><img src="/2022/07/19/web/JavaScript/TypeScript/image-20220721225834606.png" alt="image-20220721225834606"></p>
<p>为了避免和<code>jsx</code>语法中的尖括号冲突，强转的语法可以用<code>as</code>来描述，这也是一种断言</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">a</span>:<span class="built_in">string</span> | <span class="built_in">number</span> | <span class="literal">undefined</span></span><br><span class="line"></span><br><span class="line">(a <span class="keyword">as</span> <span class="built_in">string</span>).<span class="title function_">indexOf</span>(<span class="string">&#x27;abc&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>可以使用双重断言，将<code>a</code>强转成<code>boolean</code>类型，但不建议这么搞</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">a</span>:string | number | <span class="literal">undefined</span></span><br><span class="line"></span><br><span class="line">(a <span class="keyword">as</span> any) <span class="keyword">as</span> boolean</span><br></pre></td></tr></table></figure>

<p>双重断言：先转换成<code>any</code>，再转换成一个具体的类型。</p>
<p>问题：会导致类型出问题</p>
</li>
</ul>
<h2 id="拓展"><a href="#拓展" class="headerlink" title="拓展"></a>拓展</h2><h3 id=""><a href="#" class="headerlink" title="?"></a><code>?</code></h3><p>还有一个符号是<code>?</code>，表示<code>aa &amp;&amp; aa.xxx</code>，这个是<code>js</code>中本来就有的</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">ele</span>:<span class="title class_">HTMLElement</span> | <span class="literal">null</span> = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;app&#x27;</span>) <span class="comment">// 真正取到了这个元素，或这个元素不存在</span></span><br><span class="line">ele?.<span class="property">style</span> <span class="comment">// ele &amp;&amp; ele.style 如果有ele的话，取ele得style属性</span></span><br><span class="line">ele?.<span class="property">style</span>?.<span class="property">color</span> <span class="comment">// ele &amp;&amp; ele.style &amp;&amp; ele.style.color 在js中，这是链判断符</span></span><br></pre></td></tr></table></figure>
<p><code>bundle.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">	<span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> _a;</span><br><span class="line">	<span class="keyword">var</span> ele = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;app&#x27;</span>); <span class="comment">// 真正取到了这个元素，或这个元素不存在</span></span><br><span class="line">	ele === <span class="literal">null</span> || ele === <span class="keyword">void</span> <span class="number">0</span> ? <span class="keyword">void</span> <span class="number">0</span> : ele.<span class="property">style</span>; <span class="comment">// ele &amp;&amp; ele.style 如果有ele的话，取ele得style属性</span></span><br><span class="line">	(_a = ele === <span class="literal">null</span> || ele === <span class="keyword">void</span> <span class="number">0</span> ? <span class="keyword">void</span> <span class="number">0</span> : ele.<span class="property">style</span>) === <span class="literal">null</span> || _a === <span class="keyword">void</span> <span class="number">0</span> ? <span class="keyword">void</span> <span class="number">0</span> : _a.<span class="property">color</span>; <span class="comment">// ele &amp;&amp; ele.style &amp;&amp; ele.style.color 在js中，这是链判断符</span></span><br><span class="line"></span><br><span class="line">&#125;)();</span><br><span class="line"><span class="comment">//# sourceMappingURL=bundle.js.map</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>样例二</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> aa = &#123;</span><br><span class="line">  <span class="attr">bb</span>: &#123;</span><br><span class="line">   <span class="attr">cc</span>: <span class="string">&#x27;123&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(aa?.<span class="property">bb</span>?.<span class="property">cc</span>) <span class="comment">// 123</span></span><br></pre></td></tr></table></figure>

<h3 id="-1"><a href="#-1" class="headerlink" title="??"></a><code>??</code></h3><p><code>false ?? true</code>的结果是多少呢？</p>
<p>只要第一个的值不是<code>null</code>或者<code>undefined</code>，就将第一个的值返回，否则就返回第二个值（表示排除<code>null</code>和<code>undefined</code>）</p>
<p>还有的操作符有：<code>||</code>、<code>&amp;&amp;</code>、<code>|</code>、<code>&amp;</code></p>
<h2 id="字面量类型"><a href="#字面量类型" class="headerlink" title="字面量类型"></a>字面量类型</h2><p>类型的内容是固定的，已经确定好了，变量的值只能是这几个</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">type</span>: <span class="string">&#x27;a&#x27;</span> | <span class="string">&#x27;b&#x27;</span> | <span class="string">&#x27;c&#x27;</span> | <span class="string">&#x27;d&#x27;</span> = <span class="string">&#x27;b&#x27;</span></span><br></pre></td></tr></table></figure>

<p>但是这样写，会导致类型过于复杂（太长了），我们可以把类型单独提出来</p>
<p>使用<code>ts</code>中的类型别名</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">IType</span> = <span class="string">&#x27;a&#x27;</span> | <span class="string">&#x27;b&#x27;</span> | <span class="string">&#x27;c&#x27;</span> | <span class="string">&#x27;d&#x27;</span> <span class="comment">// 类型别名</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">type</span>:<span class="title class_">IType</span> = <span class="string">&#x27;b&#x27;</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">type2</span>:<span class="title class_">IType</span> = <span class="string">&#x27;c&#x27;</span></span><br></pre></td></tr></table></figure>

<p>值虽然可以写对象，但一般不这么搞</p>
<p>应用场景：接口的参数、状态码、下拉框的值</p>
<h1 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h1><h2 id="类型"><a href="#类型" class="headerlink" title="类型"></a>类型</h2><p>可以对函数增加类型</p>
<ul>
<li>对函数的参数进行类型校验</li>
<li>对函数的返回值进行类型校验</li>
<li>也可以对函数本身进行校验（声明、参数、返回值）</li>
</ul>
<p>有两种声明函数的方式</p>
<ul>
<li><p>函数关键字<code>function name()&#123;&#125;</code></p>
<ul>
<li><p>入参默认类型为<code>any</code>，返回值默认类型为<code>void</code></p>
</li>
<li><p>可以指定入参和返回值类型</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">sum</span>(<span class="params">x:<span class="built_in">string</span>, y:<span class="built_in">string</span></span>):<span class="built_in">string</span> &#123; <span class="comment">// 括号后面的表示返回值类型</span></span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><code>let myFuc = function() &#123;&#125;</code>，可以自动根据当前等号右边的内容，推断左边的内容</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> res = (<span class="attr">x</span>:<span class="built_in">number</span>, <span class="attr">y</span>:<span class="built_in">number</span>):<span class="function"><span class="params">number</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>res</code>的类型是<code>(x:number, y:number) =&gt; number</code>，可以显示指定</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">res</span>:<span class="function">(<span class="params">x:<span class="built_in">number</span>, y:<span class="built_in">number</span></span>) =&gt;</span> <span class="built_in">number</span> = (<span class="attr">x</span>:<span class="built_in">number</span>, <span class="attr">y</span>:<span class="built_in">number</span>):<span class="function"><span class="params">number</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但这样写比较恶心，优化一下写法</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">IFn</span> = <span class="function">(<span class="params">x: <span class="built_in">number</span>, y: <span class="built_in">number</span></span>) =&gt;</span> <span class="built_in">number</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">res</span>: <span class="title class_">IFn</span> = (<span class="attr">x</span>: <span class="built_in">number</span>, <span class="attr">y</span>: <span class="built_in">number</span>): <span class="function"><span class="params">number</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果此时这么写了，后面函数就不需要再指定参数和返回值类型了，会自动匹配你写的函数，是否符合前面指定的要求</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">IFn</span> = <span class="function">(<span class="params">x: <span class="built_in">number</span>, y: <span class="built_in">number</span></span>) =&gt;</span> <span class="built_in">number</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">res</span>: <span class="title class_">IFn</span> = <span class="function">(<span class="params">x, y</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">res</span>(<span class="string">&#x27;a&#x27;</span>, <span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<p>如果入参中类型不匹配，会给出提示</p>
<p><img src="/2022/07/19/web/JavaScript/TypeScript/image-20220722063509281.png" alt="image-20220722063509281"></p>
</li>
<li><p>小结：</p>
<ul>
<li>自动根据等号右边的内容，推断左边的类型（比较常用）</li>
<li>可以指定类型，右边赋予一个可以兼容这个类型的函数</li>
</ul>
</li>
</ul>
<h2 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h2><p>参数可以设置不传，使用<code>?</code>（可选参数）对参数进行限制</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> res = (<span class="attr">x</span>:<span class="built_in">number</span>, y?:<span class="built_in">number</span>):<span class="function"><span class="params">number</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是直接这样写，<code>return</code>的时候可能会有问题，因为<code>y</code>通过<code>?</code>进行限制，表示可传可不传</p>
<p><img src="/2022/07/19/web/JavaScript/TypeScript/image-20220723064245891.png" alt="image-20220723064245891"></p>
<p>那怎么处理呢？给一个默认值嘛</p>
<p><code>js</code>中默认值和可选参数不能一起使用</p>
<p>使用明确指出<code>y</code>一定不为空</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> res = (<span class="attr">x</span>:<span class="built_in">number</span>, y?:<span class="built_in">number</span>):<span class="function"><span class="params">number</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> x + y!</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>或者使用<code>as</code>（一般我们都是用<code>as</code>）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> res = (<span class="attr">x</span>:number, y?:number):<span class="function"><span class="params">number</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> x + (y <span class="keyword">as</span> number)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>那么剩余运算符，在<code>ts</code>中怎么用呢?</p>
<p>但是要指出类型</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> res = (<span class="attr">x</span>:<span class="built_in">number</span>, y?:<span class="built_in">number</span>, ...<span class="attr">args</span>:<span class="built_in">number</span>[]):<span class="function"><span class="params">number</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> x + (y <span class="keyword">as</span> <span class="built_in">number</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">res</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)</span><br></pre></td></tr></table></figure>

<h2 id="重载"><a href="#重载" class="headerlink" title="重载"></a>重载</h2><p>一个方法，根据参数的不同，实现不同的功能，<code>ts</code>的目的就是根据不同的参数返回类型</p>
<p>需求：将数值<code>123</code>转为<code>[1, 2, 3]</code>，并将字符串<code>abc</code>转为<code>[&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">toArray</span>(<span class="params">value: <span class="built_in">number</span> | <span class="built_in">string</span></span>): <span class="built_in">number</span>[] | <span class="built_in">string</span> [] &#123; <span class="comment">// 重载方法在真实方法的上方</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">typeof</span> value == <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> value.<span class="title function_">split</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> value.<span class="title function_">toString</span>().<span class="title function_">split</span>(<span class="string">&#x27;&#x27;</span>).<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> <span class="title class_">Number</span>(item))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> res = <span class="title function_">toArray</span>(<span class="string">&#x27;abc&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br></pre></td></tr></table></figure>

<p>这样写有个问题，传的是number，但是返回的可能是string数组（反之），应该限制一下（但事实上对于打包后的<code>js</code>来说，经过测试后，好像是没问题的）</p>
<p><code>bundle.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">toArray</span>(<span class="params">value</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> value == <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> value.<span class="title function_">split</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> value.<span class="title function_">toString</span>().<span class="title function_">split</span>(<span class="string">&#x27;&#x27;</span>).<span class="title function_">map</span>(<span class="keyword">function</span> (<span class="params">item</span>) &#123; <span class="keyword">return</span> <span class="title class_">Number</span>(item); &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> res = <span class="title function_">toArray</span>(<span class="string">&#x27;abc&#x27;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line"></span><br><span class="line">&#125;)();</span><br><span class="line"><span class="comment">//# sourceMappingURL=bundle.js.map</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这时就要用到函数的重载</p>
<p>重载方法需要写法函数的上面</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">toArray</span>(<span class="params">value:<span class="built_in">number</span></span>):<span class="built_in">number</span>[] <span class="comment">// number类型的toArray被treeShaking了</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">toArray</span>(<span class="params">value:<span class="built_in">string</span></span>):<span class="built_in">string</span>[]</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">toArray</span>(<span class="params">value: <span class="built_in">number</span> | <span class="built_in">string</span></span>): <span class="built_in">number</span>[] | <span class="built_in">string</span> [] &#123; <span class="comment">// 重载方法在真实方法的上方</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">typeof</span> value == <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> value.<span class="title function_">split</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> value.<span class="title function_">toString</span>().<span class="title function_">split</span>(<span class="string">&#x27;&#x27;</span>).<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> <span class="title class_">Number</span>(item))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> res = <span class="title function_">toArray</span>(<span class="string">&#x27;abc&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br></pre></td></tr></table></figure>

<p>但打包后的<code>js</code>还是原来的</p>
<p><code>bundle.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">toArray</span>(<span class="params">value</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> value == <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> value.<span class="title function_">split</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> value.<span class="title function_">toString</span>().<span class="title function_">split</span>(<span class="string">&#x27;&#x27;</span>).<span class="title function_">map</span>(<span class="keyword">function</span> (<span class="params">item</span>) &#123; <span class="keyword">return</span> <span class="title class_">Number</span>(item); &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> res = <span class="title function_">toArray</span>(<span class="string">&#x27;abc&#x27;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line"></span><br><span class="line">&#125;)();</span><br><span class="line"><span class="comment">//# sourceMappingURL=bundle.js.map</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>写了老半天，写了一堆空气，<code>○( ＾皿＾)っHiahiahia…</code></p>
<p><code>ts</code>的目的：为了安全，以及更好的提示</p>
<h1 id="类"><a href="#类" class="headerlink" title="类"></a>类</h1><p>类，最早都是用构造函数来替代的，如果<code>es6</code>中的类，编译成<code>es5</code>，最终还是会编译成函数的</p>
<p>类有哪些特点呢？</p>
<ul>
<li>实例属性、实例方法、静态属性、静态方法、原型属性、原型方法</li>
</ul>
<h2 id="实例属性、方法"><a href="#实例属性、方法" class="headerlink" title="实例属性、方法"></a>实例属性、方法</h2><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Pointer</span> &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样就声明了一个类，一般都大写</p>
<p>类里面有一个构造函数，当使用<code>new</code>操作符，<code>new Pointer</code>时，执行的就是这个构造函数，在构造函数中的操作，都是初始化操作</p>
<p>对于<code>ts</code>而言，在使用必须先声明类型，声明的变量会被增加到实例上，可以通过实例来调用该属性</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Pointer</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="attr">x</span>: <span class="built_in">number</span></span><br><span class="line">    <span class="attr">y</span>: <span class="built_in">number</span></span><br><span class="line"></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">x: <span class="built_in">number</span>, y: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">x</span> = x</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">y</span> = y</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Pointer</span>(<span class="number">100</span>, <span class="number">200</span>)</span><br></pre></td></tr></table></figure>

<p>如果在构造函数中没有进行初始化，则需要在声明时进行初始化，否则会报错</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Pointer</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="attr">x</span>: <span class="built_in">number</span></span><br><span class="line">    <span class="attr">y</span>: <span class="built_in">number</span></span><br><span class="line"></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">x: <span class="built_in">number</span>, y: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Pointer</span>(<span class="number">100</span>, <span class="number">200</span>)</span><br></pre></td></tr></table></figure>

<p>报错信息：提示参数没有初始化</p>
<p><img src="/2022/07/19/web/JavaScript/TypeScript/image-20220723072512685.png" alt="image-20220723072512685"></p>
<p>在声明时进行初始化</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Pointer</span> &#123;</span><br><span class="line">    <span class="comment">// ts比较特殊，在使用必须先声明类型</span></span><br><span class="line">    <span class="attr">x</span>: <span class="built_in">number</span> = <span class="number">1</span></span><br><span class="line">    <span class="attr">y</span>: <span class="built_in">number</span> = <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">x: <span class="built_in">number</span>, y: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">        <span class="comment">// this.x = x</span></span><br><span class="line">        <span class="comment">// this.y = y</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> res = <span class="keyword">new</span> <span class="title class_">Pointer</span>(<span class="number">100</span>, <span class="number">200</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(res, res.<span class="property">x</span>) <span class="comment">// Pointer &#123;x: 1, y: 2&#125; 1</span></span><br></pre></td></tr></table></figure>

<p>看下<code>bundle.js</code>，这里是转成了<code>es5</code>了</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">Pointer</span> = <span class="comment">/** <span class="doctag">@class</span> */</span> (<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">Pointer</span>(<span class="params">x, y</span>) &#123;</span><br><span class="line">            <span class="comment">// ts比较特殊，在使用必须先声明类型</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">x</span> = <span class="number">1</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">y</span> = <span class="number">2</span>;</span><br><span class="line">            <span class="comment">// this.x = x</span></span><br><span class="line">            <span class="comment">// this.y = y</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Pointer</span>;</span><br><span class="line">    &#125;());</span><br><span class="line">    <span class="keyword">var</span> res = <span class="keyword">new</span> <span class="title class_">Pointer</span>(<span class="number">100</span>, <span class="number">200</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res, res.<span class="property">x</span>); <span class="comment">// Pointer &#123;x: 1, y: 2&#125; 1</span></span><br><span class="line"></span><br><span class="line">&#125;)();</span><br><span class="line"><span class="comment">//# sourceMappingURL=bundle.js.map</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在声明类型的同时初始化，就相当于在实例的构造函数中初始化了</p>
<p>继续上面的：</p>
<p>但是呢，我们一般只会在构造函数里面赋值</p>
<p>另外，如果我们就不想初始化，可以使用非空断言，或者取消配置文件的严格模式（不推荐）</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Pointer</span> &#123;</span><br><span class="line">    <span class="comment">// ts比较特殊，在使用必须先声明类型</span></span><br><span class="line">    x!: <span class="built_in">number</span></span><br><span class="line">    y!: <span class="built_in">number</span></span><br><span class="line"></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">x: <span class="built_in">number</span>, y: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">        <span class="comment">// this.x = x</span></span><br><span class="line">        <span class="comment">// this.y = y</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> res = <span class="keyword">new</span> <span class="title class_">Pointer</span>(<span class="number">100</span>, <span class="number">200</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(res, res.<span class="property">x</span>)</span><br></pre></td></tr></table></figure>

<p>但是一般情况下，我们还是会在构造函数中赋值的</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Pointer</span> &#123;</span><br><span class="line">    <span class="comment">// ts比较特殊，在使用必须先声明类型</span></span><br><span class="line">    <span class="attr">x</span>: <span class="built_in">number</span></span><br><span class="line">    <span class="attr">y</span>: <span class="built_in">number</span></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">x: <span class="built_in">number</span>, y: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">x</span> = x</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">y</span> = y</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> res = <span class="keyword">new</span> <span class="title class_">Pointer</span>(<span class="number">100</span>, <span class="number">200</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(res, res.<span class="property">x</span>) <span class="comment">// Pointer &#123;x: 100, y: 200&#125; 100</span></span><br></pre></td></tr></table></figure>

<p>构造函数它也是个函数，里面依然可以使用剩余运算符、可选参数、默认参数</p>
<h2 id="属性修饰符"><a href="#属性修饰符" class="headerlink" title="属性修饰符"></a>属性修饰符</h2><h3 id="public"><a href="#public" class="headerlink" title="public"></a><code>public</code></h3><p>对于类型声明，默认是由<code>public</code>关键字修饰的</p>
<p>上面的等价于</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Pointer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="attr">x</span>: <span class="built_in">number</span></span><br><span class="line">    <span class="keyword">public</span> <span class="attr">y</span>: <span class="built_in">number</span></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">x: <span class="built_in">number</span>, y: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">x</span> = x</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">y</span> = y</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> res = <span class="keyword">new</span> <span class="title class_">Pointer</span>(<span class="number">100</span>, <span class="number">200</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(res, res.<span class="property">x</span>) <span class="comment">// Pointer &#123;x: 100, y: 200&#125; 100</span></span><br></pre></td></tr></table></figure>

<p>当然也可以将传入的参数，直接放在实例上，无需再次声明。<code>public</code>是属性修饰符，<code>js</code>中是没有的</p>
<p>等价写法如下：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Pointer</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"><span class="keyword">public</span> x: <span class="built_in">number</span>, <span class="keyword">public</span> y: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">x</span> = x</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">y</span> = y</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> res = <span class="keyword">new</span> <span class="title class_">Pointer</span>(<span class="number">100</span>, <span class="number">200</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(res, res.<span class="property">x</span>) <span class="comment">// Pointer &#123;x: 100, y: 200&#125; 100</span></span><br></pre></td></tr></table></figure>

<p>值得注意的是，将传入的参数，直接放在实例上时，相当于已经给实例进行了初始化赋值操作，构造函数中不必再初始化了</p>
<p>只要在构造函数外面，声明了变量，这个变量就会被添加到实例上（等价写法，相当于在构造函数外面声明了变量）</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Pointer</span> &#123;</span><br><span class="line">    <span class="comment">// public x: number</span></span><br><span class="line">    <span class="comment">// public y: number</span></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"><span class="keyword">public</span> x: <span class="built_in">number</span>, <span class="keyword">public</span> y: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">        <span class="comment">// this.x = x</span></span><br><span class="line">        <span class="comment">// this.y = y</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> res = <span class="keyword">new</span> <span class="title class_">Pointer</span>(<span class="number">100</span>, <span class="number">200</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(res, res.<span class="property">x</span>) <span class="comment">// Pointer &#123;x: 100, y: 200&#125; 100</span></span><br></pre></td></tr></table></figure>

<p><code>bundle.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">Pointer</span> = <span class="comment">/** <span class="doctag">@class</span> */</span> (<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// public x: number</span></span><br><span class="line">        <span class="comment">// public y: number</span></span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">Pointer</span>(<span class="params">x, y</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">x</span> = x;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">y</span> = y;</span><br><span class="line">            <span class="comment">// this.x = x</span></span><br><span class="line">            <span class="comment">// this.y = y</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Pointer</span>;</span><br><span class="line">    &#125;());</span><br><span class="line">    <span class="keyword">var</span> res = <span class="keyword">new</span> <span class="title class_">Pointer</span>(<span class="number">100</span>, <span class="number">200</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res, res.<span class="property">x</span>); <span class="comment">// Pointer &#123;x: 100, y: 200&#125; 100</span></span><br><span class="line"></span><br><span class="line">&#125;)();</span><br><span class="line"><span class="comment">//# sourceMappingURL=bundle.js.map</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="private"><a href="#private" class="headerlink" title="private"></a><code>private</code></h3><p>表示只有自己能访问的属性</p>
<p>先看一个简单继承的例子</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"><span class="keyword">public</span> name: <span class="built_in">string</span>, <span class="keyword">public</span> age: <span class="built_in">number</span></span>) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cat</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Animal</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">name: <span class="built_in">string</span>, age: <span class="built_in">number</span>, <span class="keyword">public</span> address: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>(name, age); <span class="comment">// 子类继承父类的话，构造函数中，必须要调用super，相当于执行了Animal.call(this, name, age)</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> cat = <span class="keyword">new</span> <span class="title class_">Cat</span>(<span class="string">&#x27;Tom&#x27;</span>, <span class="number">8</span>,  <span class="string">&#x27;USA&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(cat) <span class="comment">// Cat &#123;name: &#x27;Tom&#x27;, age: 8, address: &#x27;USA&#x27;&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>看下<code>bundle.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/******************************************************************************</span></span><br><span class="line"><span class="comment">    Copyright (c) Microsoft Corporation.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    Permission to use, copy, modify, and/or distribute this software for any</span></span><br><span class="line"><span class="comment">    purpose with or without fee is hereby granted.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    THE SOFTWARE IS PROVIDED &quot;AS IS&quot; AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH</span></span><br><span class="line"><span class="comment">    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY</span></span><br><span class="line"><span class="comment">    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,</span></span><br><span class="line"><span class="comment">    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM</span></span><br><span class="line"><span class="comment">    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR</span></span><br><span class="line"><span class="comment">    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR</span></span><br><span class="line"><span class="comment">    PERFORMANCE OF THIS SOFTWARE.</span></span><br><span class="line"><span class="comment">    ***************************************************************************** */</span></span><br><span class="line">    <span class="comment">/* global Reflect, Promise */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> extendStatics = <span class="keyword">function</span>(<span class="params">d, b</span>) &#123;</span><br><span class="line">        extendStatics = <span class="title class_">Object</span>.<span class="property">setPrototypeOf</span> ||</span><br><span class="line">            (&#123; <span class="attr">__proto__</span>: [] &#125; <span class="keyword">instanceof</span> <span class="title class_">Array</span> &amp;&amp; <span class="keyword">function</span> (<span class="params">d, b</span>) &#123; d.<span class="property">__proto__</span> = b; &#125;) ||</span><br><span class="line">            <span class="keyword">function</span> (<span class="params">d, b</span>) &#123; <span class="keyword">for</span> (<span class="keyword">var</span> p <span class="keyword">in</span> b) <span class="keyword">if</span> (<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">hasOwnProperty</span>.<span class="title function_">call</span>(b, p)) d[p] = b[p]; &#125;;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">extendStatics</span>(d, b);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">__extends</span>(<span class="params">d, b</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> b !== <span class="string">&quot;function&quot;</span> &amp;&amp; b !== <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&quot;Class extends value &quot;</span> + <span class="title class_">String</span>(b) + <span class="string">&quot; is not a constructor or null&quot;</span>);</span><br><span class="line">        <span class="title function_">extendStatics</span>(d, b);</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">__</span>(<span class="params"></span>) &#123; <span class="variable language_">this</span>.<span class="property">constructor</span> = d; &#125;</span><br><span class="line">        d.<span class="property"><span class="keyword">prototype</span></span> = b === <span class="literal">null</span> ? <span class="title class_">Object</span>.<span class="title function_">create</span>(b) : (__.<span class="property"><span class="keyword">prototype</span></span> = b.<span class="property"><span class="keyword">prototype</span></span>, <span class="keyword">new</span> <span class="title function_">__</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">Animal</span> = <span class="comment">/** <span class="doctag">@class</span> */</span> (<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">Animal</span>(<span class="params">name, age</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Animal</span>;</span><br><span class="line">    &#125;());</span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">Cat</span> = <span class="comment">/** <span class="doctag">@class</span> */</span> (<span class="keyword">function</span> (<span class="params">_super</span>) &#123;</span><br><span class="line">        <span class="title function_">__extends</span>(<span class="title class_">Cat</span>, _super);</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">Cat</span>(<span class="params">name, age, address</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> _this = _super.<span class="title function_">call</span>(<span class="variable language_">this</span>, name, age) || <span class="variable language_">this</span>;</span><br><span class="line">            _this.<span class="property">address</span> = address;</span><br><span class="line">            <span class="keyword">return</span> _this;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Cat</span>;</span><br><span class="line">    &#125;(<span class="title class_">Animal</span>)); </span><br><span class="line">    <span class="keyword">var</span> cat = <span class="keyword">new</span> <span class="title class_">Cat</span>(<span class="string">&#x27;Tome&#x27;</span>, <span class="number">8</span>, <span class="string">&#x27;USA&#x27;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(cat); <span class="comment">// Cat &#123;name: &#x27;Tom&#x27;, age: 8, address: &#x27;USA&#x27;&#125;</span></span><br><span class="line"></span><br><span class="line">&#125;)();</span><br><span class="line"><span class="comment">//# sourceMappingURL=bundle.js.map</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>我们在父类和子类中构造函数中，都打印一下<code>name</code>属性</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"><span class="keyword">public</span> name: <span class="built_in">string</span>, <span class="keyword">public</span> age: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>) <span class="comment">// Tom</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cat</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Animal</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">name: <span class="built_in">string</span>, age: <span class="built_in">number</span>, <span class="keyword">public</span> address: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>(name, age);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>) <span class="comment">// Tom</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> cat = <span class="keyword">new</span> <span class="title class_">Cat</span>(<span class="string">&#x27;Tom&#x27;</span>, <span class="number">8</span>,  <span class="string">&#x27;USA&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(cat.<span class="property">name</span>) <span class="comment">// Tom</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>如果将父类的构造函数的<code>name</code>修饰符，改成<code>private</code>，子类及子类实例就不能访问了</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"><span class="keyword">private</span> name: <span class="built_in">string</span>, <span class="keyword">public</span> age: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cat</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Animal</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">name: <span class="built_in">string</span>, age: <span class="built_in">number</span>, <span class="keyword">public</span> address: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>(name, age);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>) <span class="comment">// 这里无法访问</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> cat = <span class="keyword">new</span> <span class="title class_">Cat</span>(<span class="string">&#x27;Tom&#x27;</span>, <span class="number">8</span>,  <span class="string">&#x27;USA&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(cat.<span class="property">name</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;&#125;</span><br></pre></td></tr></table></figure>



<p><img src="/2022/07/19/web/JavaScript/TypeScript/image-20220724110934800.png" alt="image-20220724110934800"></p>
<h3 id="protected"><a href="#protected" class="headerlink" title="protected"></a><code>protected</code></h3><p>表示只有自己，和自己的子孙可以访问</p>
<p>外界是访问不了的</p>
<ul>
<li>后代的实例里，是访问不了的</li>
</ul>
<p>将参数修饰符改为<code>protected</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"><span class="keyword">protected</span> name: <span class="built_in">string</span>, <span class="keyword">public</span> age: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cat</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Animal</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">name: <span class="built_in">string</span>, age: <span class="built_in">number</span>, <span class="keyword">public</span> address: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>(name, age);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> cat = <span class="keyword">new</span> <span class="title class_">Cat</span>(<span class="string">&#x27;Tom&#x27;</span>, <span class="number">8</span>,  <span class="string">&#x27;USA&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(cat.<span class="property">name</span>)  <span class="comment">// 这里无法访问</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/07/19/web/JavaScript/TypeScript/image-20220724111222897.png" alt="image-20220724111222897"></p>
<p>补充</p>
<p>我们可以给构造函数添加修饰符，默认的是<code>public</code></p>
<ul>
<li><code>protected</code><ul>
<li>可以被继承，不能被<code>new</code></li>
<li><code>new</code>是在实例化，调用这个构造函数，而<code>protected</code>的函数只能在类的内部被调用</li>
</ul>
</li>
<li><code>private</code><ul>
<li>不能被继承，也不能被<code>new</code></li>
</ul>
</li>
</ul>
<h3 id="readonly"><a href="#readonly" class="headerlink" title="readonly"></a><code>readonly</code></h3><p>表示只读属性，在初始化完毕后，就不能修改了，有点类似于<code>const</code></p>
<p>值得注意的是，在<code>constructor</code>中，表示的都是初始化操作，在<code>constructor</code>里面，是可以修改的</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">readonly</span> <span class="attr">n</span>: <span class="built_in">number</span> = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">constructor</span>(<span class="params"><span class="keyword">public</span> name: <span class="built_in">string</span>, <span class="keyword">public</span> age: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">n</span> = <span class="number">100</span>  <span class="comment">// 这里可以修改</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cat</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Animal</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">constructor</span>(<span class="params">name: <span class="built_in">string</span>, age: <span class="built_in">number</span>, <span class="keyword">public</span> <span class="keyword">readonly</span> address: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>(name, age);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>)</span><br><span class="line">        <span class="comment">// this.n = 200 // 这里不能修改，因为对于父类而言，已经初始化完毕了</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> cat = <span class="keyword">new</span> <span class="title class_">Cat</span>(<span class="string">&#x27;Tom&#x27;</span>, <span class="number">8</span>, <span class="string">&#x27;USA&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(cat.<span class="property">name</span>)</span><br><span class="line"><span class="comment">// cat.address = &#x27;shanghai&#x27; 编译不会通过的</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>不能修改的只是变量的引用</p>
<p>上例中，如果<code>address</code>是个对象，修改的是对象里面的属性，是可以的</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">readonly</span> <span class="attr">n</span>: <span class="built_in">number</span> = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">constructor</span>(<span class="params"><span class="keyword">public</span> name: <span class="built_in">string</span>, <span class="keyword">public</span> age: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">n</span> = <span class="number">100</span>  <span class="comment">// 这里可以修改</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cat</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Animal</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">constructor</span>(<span class="params">name: <span class="built_in">string</span>, age: <span class="built_in">number</span>, <span class="keyword">public</span> <span class="keyword">readonly</span> address: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>(name, age);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>)</span><br><span class="line">        <span class="comment">// this.n = 200 // 这里不能修改，因为对于父类而言，已经初始化完毕了</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> cat = <span class="keyword">new</span> <span class="title class_">Cat</span>(<span class="string">&#x27;Tom&#x27;</span>, <span class="number">8</span>, &#123;<span class="attr">name</span>:<span class="string">&#x27;USA&#x27;</span>&#125;)</span><br><span class="line">cat.<span class="property">address</span>.<span class="property">name</span> = <span class="string">&#x27;shanghai&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(cat)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="静态属性、方法"><a href="#静态属性、方法" class="headerlink" title="静态属性、方法"></a>静态属性、方法</h2><p>之前讲过的实例属性、方法，需要通过<code>new</code>生成实例对象来调用</p>
<p>静态属性、方法，通过类来调用</p>
<h3 id="静态属性"><a href="#静态属性" class="headerlink" title="静态属性"></a>静态属性</h3><p><code>es6</code>写法</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">constructor</span>(<span class="params"><span class="keyword">public</span> name: <span class="built_in">string</span>, <span class="keyword">public</span> age: <span class="built_in">number</span></span>) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// es6中要写成属性访问器</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">get</span> <span class="title function_">type</span>() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;哺乳动物&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// static types = &#x27;哺乳动物&#x27; // 静态属性，es7语法，es6是不认的</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Animal</span>.<span class="property">type</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<p><code>bundle.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">Animal</span> = <span class="comment">/** <span class="doctag">@class</span> */</span> (<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">Animal</span>(<span class="params">name, age</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(<span class="title class_">Animal</span>, <span class="string">&quot;type&quot;</span>, &#123;</span><br><span class="line">            <span class="comment">// static types = &#x27;哺乳动物&#x27; // 静态属性，es7语法，es6是不认的</span></span><br><span class="line">            <span class="comment">// es6中要写成属性访问器</span></span><br><span class="line">            <span class="attr">get</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&#x27;哺乳动物&#x27;</span>;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">enumerable</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">configurable</span>: <span class="literal">true</span></span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Animal</span>;</span><br><span class="line">    &#125;());</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Animal</span>.<span class="property">type</span>);</span><br><span class="line"></span><br><span class="line">&#125;)();</span><br><span class="line"><span class="comment">//# sourceMappingURL=bundle.js.map</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>编译后的结果，是通过<code>defineProperty</code>来实现的</p>
<p><code>es7</code>语法</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">constructor</span>(<span class="params"><span class="keyword">public</span> name: <span class="built_in">string</span>, <span class="keyword">public</span> age: <span class="built_in">number</span></span>) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// es6中要写成属性访问器</span></span><br><span class="line">    <span class="comment">// static get type() &#123;</span></span><br><span class="line">    <span class="comment">//     return &#x27;哺乳动物&#x27;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">type</span> = <span class="string">&#x27;哺乳动物&#x27;</span> <span class="comment">// 静态属性，es7语法，es6是不认的</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Animal</span>.<span class="property">type</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<p><code>bundle.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">Animal</span> = <span class="comment">/** <span class="doctag">@class</span> */</span> (<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">Animal</span>(<span class="params">name, age</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// es6中要写成属性访问器</span></span><br><span class="line">        <span class="comment">// static get type() &#123;</span></span><br><span class="line">        <span class="comment">//     return &#x27;哺乳动物&#x27;</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line">        <span class="title class_">Animal</span>.<span class="property">type</span> = <span class="string">&#x27;哺乳动物&#x27;</span>; <span class="comment">// 静态属性，es7语法，es6是不认的</span></span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Animal</span>;</span><br><span class="line">    &#125;());</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Animal</span>.<span class="property">type</span>);</span><br><span class="line"></span><br><span class="line">&#125;)();</span><br><span class="line"><span class="comment">//# sourceMappingURL=bundle.js.map</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="静态方法"><a href="#静态方法" class="headerlink" title="静态方法"></a>静态方法</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">constructor</span>(<span class="params"><span class="keyword">public</span> name: <span class="built_in">string</span>, <span class="keyword">public</span> age: <span class="built_in">number</span></span>) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">type</span> = <span class="string">&#x27;哺乳动物&#x27;</span> <span class="comment">// 静态属性，es7语法，es6是不认的</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="title function_">getName</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;动物&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Animal</span>.<span class="property">type</span>, <span class="title class_">Animal</span>.<span class="title function_">getName</span>()) <span class="comment">// 哺乳动物 动物</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<p><code>bundles.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">Animal</span> = <span class="comment">/** <span class="doctag">@class</span> */</span> (<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">Animal</span>(<span class="params">name, age</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title class_">Animal</span>.<span class="property">getName</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;动物&#x27;</span>;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="title class_">Animal</span>.<span class="property">type</span> = <span class="string">&#x27;哺乳动物&#x27;</span>; <span class="comment">// 静态属性，es7语法，es6是不认的</span></span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Animal</span>;</span><br><span class="line">    &#125;());</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Animal</span>.<span class="property">type</span>, <span class="title class_">Animal</span>.<span class="title function_">getName</span>());</span><br><span class="line"></span><br><span class="line">&#125;)();</span><br><span class="line"><span class="comment">//# sourceMappingURL=bundle.js.map</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>静态方法可以被继承，可以通过子类来调用</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">constructor</span>(<span class="params"><span class="keyword">public</span> name: <span class="built_in">string</span>, <span class="keyword">public</span> age: <span class="built_in">number</span></span>) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">type</span> = <span class="string">&#x27;哺乳动物&#x27;</span> <span class="comment">// 静态属性，es7语法，es6是不认的</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="title function_">getName</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;动物&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cat</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Animal</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">constructor</span>(<span class="params">name: <span class="built_in">string</span>, age: <span class="built_in">number</span>, <span class="keyword">public</span> <span class="keyword">readonly</span> address: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>(name, age);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Cat</span>.<span class="property">type</span>, <span class="title class_">Cat</span>.<span class="title function_">getName</span>()) <span class="comment">// 哺乳动物 动物</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>子类也可以拿到父类的实例属性、方法</p>
<p>那么是怎么实现的呢？</p>
<p><code>bundle.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line">	</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> extendStatics = <span class="keyword">function</span>(<span class="params">d, b</span>) &#123;</span><br><span class="line">        extendStatics = <span class="title class_">Object</span>.<span class="property">setPrototypeOf</span> ||</span><br><span class="line">            (&#123; <span class="attr">__proto__</span>: [] &#125; <span class="keyword">instanceof</span> <span class="title class_">Array</span> &amp;&amp; <span class="keyword">function</span> (<span class="params">d, b</span>) &#123; d.<span class="property">__proto__</span> = b; &#125;) ||</span><br><span class="line">            <span class="keyword">function</span> (<span class="params">d, b</span>) &#123; <span class="keyword">for</span> (<span class="keyword">var</span> p <span class="keyword">in</span> b) <span class="keyword">if</span> (<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">hasOwnProperty</span>.<span class="title function_">call</span>(b, p)) d[p] = b[p]; &#125;;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">extendStatics</span>(d, b);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">__extends</span>(<span class="params">d, b</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> b !== <span class="string">&quot;function&quot;</span> &amp;&amp; b !== <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&quot;Class extends value &quot;</span> + <span class="title class_">String</span>(b) + <span class="string">&quot; is not a constructor or null&quot;</span>);</span><br><span class="line">        <span class="title function_">extendStatics</span>(d, b);</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">__</span>(<span class="params"></span>) &#123; <span class="variable language_">this</span>.<span class="property">constructor</span> = d; &#125;</span><br><span class="line">        d.<span class="property"><span class="keyword">prototype</span></span> = b === <span class="literal">null</span> ? <span class="title class_">Object</span>.<span class="title function_">create</span>(b) : (__.<span class="property"><span class="keyword">prototype</span></span> = b.<span class="property"><span class="keyword">prototype</span></span>, <span class="keyword">new</span> <span class="title function_">__</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">Animal</span> = <span class="comment">/** <span class="doctag">@class</span> */</span> (<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">Animal</span>(<span class="params">name, age</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title class_">Animal</span>.<span class="property">getName</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;动物&#x27;</span>;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="title class_">Animal</span>.<span class="property">type</span> = <span class="string">&#x27;哺乳动物&#x27;</span>; <span class="comment">// 静态属性，es7语法，es6是不认的</span></span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Animal</span>;</span><br><span class="line">    &#125;());</span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">Cat</span> = <span class="comment">/** <span class="doctag">@class</span> */</span> (<span class="keyword">function</span> (<span class="params">_super</span>) &#123;</span><br><span class="line">        <span class="title function_">__extends</span>(<span class="title class_">Cat</span>, _super); </span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">Cat</span>(<span class="params">name, age, address</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> _this = _super.<span class="title function_">call</span>(<span class="variable language_">this</span>, name, age) || <span class="variable language_">this</span>;</span><br><span class="line">            _this.<span class="property">address</span> = address;</span><br><span class="line">            <span class="keyword">return</span> _this;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Cat</span>;</span><br><span class="line">    &#125;(<span class="title class_">Animal</span>));</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Cat</span>.<span class="property">type</span>, <span class="title class_">Cat</span>.<span class="title function_">getName</span>()); <span class="comment">// 哺乳动物 动物</span></span><br><span class="line"></span><br><span class="line">&#125;)();</span><br><span class="line"><span class="comment">//# sourceMappingURL=bundle.js.map</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>看下编译后的结果，看下<code>__extends(Cat, _super)</code>，它会把子类和父类都传进来，只做了一件事<code>extendStatics</code>，继承静态属性，把子类的原型对象指向父类的原型对象，这样子类就可以通过原型类查找来调用父类的属性或方法了</p>
<p>如果子类中，有同名方法，调用的就是自己身上的属性和方法</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">constructor</span>(<span class="params"><span class="keyword">public</span> name: <span class="built_in">string</span>, <span class="keyword">public</span> age: <span class="built_in">number</span></span>) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">type</span> = <span class="string">&#x27;哺乳动物&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="title function_">getName</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;动物&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cat</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Animal</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">constructor</span>(<span class="params">name: <span class="built_in">string</span>, age: <span class="built_in">number</span>, <span class="keyword">public</span> <span class="keyword">readonly</span> address: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>(name, age);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">type</span> = <span class="string">&#x27;猫科动物&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="title function_">getName</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;猫&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Cat</span>.<span class="property">type</span>, <span class="title class_">Cat</span>.<span class="title function_">getName</span>()) <span class="comment">// 猫科动物 猫</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>此时，如果想要访问父类的同名属性和方法，需要在子类的同名方法中，使用<code>super</code>关键字，获取到父类，然后调用方法（构造函数和静态方法中的<code>super</code>，默认指向的都是自己的父类，在原型方法中的<code>super</code>，指向父类的原型）</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">constructor</span>(<span class="params"><span class="keyword">public</span> name: <span class="built_in">string</span>, <span class="keyword">public</span> age: <span class="built_in">number</span></span>) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">type</span> = <span class="string">&#x27;哺乳动物&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="title function_">getName</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;动物&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cat</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Animal</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">constructor</span>(<span class="params">name: <span class="built_in">string</span>, age: <span class="built_in">number</span>, <span class="keyword">public</span> <span class="keyword">readonly</span> address: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>(name, age);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">type</span> = <span class="string">&#x27;猫科动物&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="title function_">getName</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">super</span>.<span class="title function_">getName</span>()) <span class="comment">// 动物</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;猫&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Cat</span>.<span class="property">type</span>, <span class="title class_">Cat</span>.<span class="title function_">getName</span>()) <span class="comment">// 猫科动物 猫</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<p><code>bundle.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> extendStatics = <span class="keyword">function</span>(<span class="params">d, b</span>) &#123;</span><br><span class="line">        extendStatics = <span class="title class_">Object</span>.<span class="property">setPrototypeOf</span> ||</span><br><span class="line">            (&#123; <span class="attr">__proto__</span>: [] &#125; <span class="keyword">instanceof</span> <span class="title class_">Array</span> &amp;&amp; <span class="keyword">function</span> (<span class="params">d, b</span>) &#123; d.<span class="property">__proto__</span> = b; &#125;) ||</span><br><span class="line">            <span class="keyword">function</span> (<span class="params">d, b</span>) &#123; <span class="keyword">for</span> (<span class="keyword">var</span> p <span class="keyword">in</span> b) <span class="keyword">if</span> (<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">hasOwnProperty</span>.<span class="title function_">call</span>(b, p)) d[p] = b[p]; &#125;;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">extendStatics</span>(d, b);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">__extends</span>(<span class="params">d, b</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> b !== <span class="string">&quot;function&quot;</span> &amp;&amp; b !== <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&quot;Class extends value &quot;</span> + <span class="title class_">String</span>(b) + <span class="string">&quot; is not a constructor or null&quot;</span>);</span><br><span class="line">        <span class="title function_">extendStatics</span>(d, b);</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">__</span>(<span class="params"></span>) &#123; <span class="variable language_">this</span>.<span class="property">constructor</span> = d; &#125;</span><br><span class="line">        d.<span class="property"><span class="keyword">prototype</span></span> = b === <span class="literal">null</span> ? <span class="title class_">Object</span>.<span class="title function_">create</span>(b) : (__.<span class="property"><span class="keyword">prototype</span></span> = b.<span class="property"><span class="keyword">prototype</span></span>, <span class="keyword">new</span> <span class="title function_">__</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">Animal</span> = <span class="comment">/** <span class="doctag">@class</span> */</span> (<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">Animal</span>(<span class="params">name, age</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title class_">Animal</span>.<span class="property">getName</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;动物&#x27;</span>;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="title class_">Animal</span>.<span class="property">type</span> = <span class="string">&#x27;哺乳动物&#x27;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Animal</span>;</span><br><span class="line">    &#125;());</span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">Cat</span> = <span class="comment">/** <span class="doctag">@class</span> */</span> (<span class="keyword">function</span> (<span class="params">_super</span>) &#123;</span><br><span class="line">        <span class="title function_">__extends</span>(<span class="title class_">Cat</span>, _super);</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">Cat</span>(<span class="params">name, age, address</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> _this = _super.<span class="title function_">call</span>(<span class="variable language_">this</span>, name, age) || <span class="variable language_">this</span>;</span><br><span class="line">            _this.<span class="property">address</span> = address;</span><br><span class="line">            <span class="keyword">return</span> _this;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title class_">Cat</span>.<span class="property">getName</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(_super.<span class="property">getName</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>)); <span class="comment">// 动物</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;猫&#x27;</span>;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="title class_">Cat</span>.<span class="property">type</span> = <span class="string">&#x27;猫科动物&#x27;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Cat</span>;</span><br><span class="line">    &#125;(<span class="title class_">Animal</span>));</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Cat</span>.<span class="property">type</span>, <span class="title class_">Cat</span>.<span class="title function_">getName</span>()); <span class="comment">// 猫科动物 猫</span></span><br><span class="line"></span><br><span class="line">&#125;)();</span><br><span class="line"><span class="comment">//# sourceMappingURL=bundle.js.map</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="原型属性、方法"><a href="#原型属性、方法" class="headerlink" title="原型属性、方法"></a>原型属性、方法</h2><h3 id="原型方法"><a href="#原型方法" class="headerlink" title="原型方法"></a>原型方法</h3><p>直接在类中写的方法，就是原型方法</p>
<p>可以通过属性访问器，定义原型属性</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">constructor</span>(<span class="params"><span class="keyword">public</span> name: <span class="built_in">string</span>, <span class="keyword">public</span> age: <span class="built_in">number</span></span>) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">type</span> = <span class="string">&#x27;哺乳动物&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="title function_">getName</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;动物&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cat</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Animal</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">constructor</span>(<span class="params">name: <span class="built_in">string</span>, age: <span class="built_in">number</span>, <span class="keyword">public</span> <span class="keyword">readonly</span> address: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>(name, age);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">type</span> = <span class="string">&#x27;猫科动物&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="title function_">getName</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">super</span>.<span class="title function_">getName</span>()) <span class="comment">// 动物</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;猫&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 原型方法</span></span><br><span class="line">    <span class="title function_">say</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;miao&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Cat</span>.<span class="property">type</span>, <span class="title class_">Cat</span>.<span class="title function_">getName</span>()) <span class="comment">// 猫科动物 猫</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<p><code>bundle.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> extendStatics = <span class="keyword">function</span>(<span class="params">d, b</span>) &#123;</span><br><span class="line">        extendStatics = <span class="title class_">Object</span>.<span class="property">setPrototypeOf</span> ||</span><br><span class="line">            (&#123; <span class="attr">__proto__</span>: [] &#125; <span class="keyword">instanceof</span> <span class="title class_">Array</span> &amp;&amp; <span class="keyword">function</span> (<span class="params">d, b</span>) &#123; d.<span class="property">__proto__</span> = b; &#125;) ||</span><br><span class="line">            <span class="keyword">function</span> (<span class="params">d, b</span>) &#123; <span class="keyword">for</span> (<span class="keyword">var</span> p <span class="keyword">in</span> b) <span class="keyword">if</span> (<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">hasOwnProperty</span>.<span class="title function_">call</span>(b, p)) d[p] = b[p]; &#125;;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">extendStatics</span>(d, b);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">__extends</span>(<span class="params">d, b</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> b !== <span class="string">&quot;function&quot;</span> &amp;&amp; b !== <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&quot;Class extends value &quot;</span> + <span class="title class_">String</span>(b) + <span class="string">&quot; is not a constructor or null&quot;</span>);</span><br><span class="line">        <span class="title function_">extendStatics</span>(d, b);</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">__</span>(<span class="params"></span>) &#123; <span class="variable language_">this</span>.<span class="property">constructor</span> = d; &#125;</span><br><span class="line">        d.<span class="property"><span class="keyword">prototype</span></span> = b === <span class="literal">null</span> ? <span class="title class_">Object</span>.<span class="title function_">create</span>(b) : (__.<span class="property"><span class="keyword">prototype</span></span> = b.<span class="property"><span class="keyword">prototype</span></span>, <span class="keyword">new</span> <span class="title function_">__</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">Animal</span> = <span class="comment">/** <span class="doctag">@class</span> */</span> (<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">Animal</span>(<span class="params">name, age</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title class_">Animal</span>.<span class="property">getName</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;动物&#x27;</span>;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="title class_">Animal</span>.<span class="property">type</span> = <span class="string">&#x27;哺乳动物&#x27;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Animal</span>;</span><br><span class="line">    &#125;());</span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">Cat</span> = <span class="comment">/** <span class="doctag">@class</span> */</span> (<span class="keyword">function</span> (<span class="params">_super</span>) &#123;</span><br><span class="line">        <span class="title function_">__extends</span>(<span class="title class_">Cat</span>, _super);</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">Cat</span>(<span class="params">name, age, address</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> _this = _super.<span class="title function_">call</span>(<span class="variable language_">this</span>, name, age) || <span class="variable language_">this</span>;</span><br><span class="line">            _this.<span class="property">address</span> = address;</span><br><span class="line">            <span class="keyword">return</span> _this;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title class_">Cat</span>.<span class="property">getName</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(_super.<span class="property">getName</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>)); <span class="comment">// 动物</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;猫&#x27;</span>;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">// 原型方法</span></span><br><span class="line">        <span class="title class_">Cat</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">say</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;miao&#x27;</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="title class_">Cat</span>.<span class="property">type</span> = <span class="string">&#x27;猫科动物&#x27;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Cat</span>;</span><br><span class="line">    &#125;(<span class="title class_">Animal</span>));</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Cat</span>.<span class="property">type</span>, <span class="title class_">Cat</span>.<span class="title function_">getName</span>()); <span class="comment">// 猫科动物 猫</span></span><br><span class="line"></span><br><span class="line">&#125;)();</span><br><span class="line"><span class="comment">//# sourceMappingURL=bundle.js.map</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="原型属性"><a href="#原型属性" class="headerlink" title="原型属性"></a>原型属性</h3><p>原型属性也能不能直接写在类中呢，我们先写一下，看下编译后的结果</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">constructor</span>(<span class="params"><span class="keyword">public</span> name: <span class="built_in">string</span>, <span class="keyword">public</span> age: <span class="built_in">number</span></span>) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">type</span> = <span class="string">&#x27;哺乳动物&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="title function_">getName</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;动物&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cat</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Animal</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">constructor</span>(<span class="params">name: <span class="built_in">string</span>, age: <span class="built_in">number</span>, <span class="keyword">public</span> <span class="keyword">readonly</span> address: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>(name, age);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">type</span> = <span class="string">&#x27;猫科动物&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="title function_">getName</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">super</span>.<span class="title function_">getName</span>())</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;猫&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    aaaaa = <span class="number">1</span> <span class="comment">// es7语法，不建议使用（会作为实例方法）</span></span><br><span class="line">    <span class="comment">// 原型方法</span></span><br><span class="line">    <span class="title function_">say</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;miao&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Cat</span>.<span class="property">type</span>, <span class="title class_">Cat</span>.<span class="title function_">getName</span>()) <span class="comment">// 猫科动物 猫</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<p><code>aaaaa</code>被放在了实例上</p>
<p><code>bundle.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> extendStatics = <span class="keyword">function</span>(<span class="params">d, b</span>) &#123;</span><br><span class="line">        extendStatics = <span class="title class_">Object</span>.<span class="property">setPrototypeOf</span> ||</span><br><span class="line">            (&#123; <span class="attr">__proto__</span>: [] &#125; <span class="keyword">instanceof</span> <span class="title class_">Array</span> &amp;&amp; <span class="keyword">function</span> (<span class="params">d, b</span>) &#123; d.<span class="property">__proto__</span> = b; &#125;) ||</span><br><span class="line">            <span class="keyword">function</span> (<span class="params">d, b</span>) &#123; <span class="keyword">for</span> (<span class="keyword">var</span> p <span class="keyword">in</span> b) <span class="keyword">if</span> (<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">hasOwnProperty</span>.<span class="title function_">call</span>(b, p)) d[p] = b[p]; &#125;;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">extendStatics</span>(d, b);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">__extends</span>(<span class="params">d, b</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> b !== <span class="string">&quot;function&quot;</span> &amp;&amp; b !== <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&quot;Class extends value &quot;</span> + <span class="title class_">String</span>(b) + <span class="string">&quot; is not a constructor or null&quot;</span>);</span><br><span class="line">        <span class="title function_">extendStatics</span>(d, b);</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">__</span>(<span class="params"></span>) &#123; <span class="variable language_">this</span>.<span class="property">constructor</span> = d; &#125;</span><br><span class="line">        d.<span class="property"><span class="keyword">prototype</span></span> = b === <span class="literal">null</span> ? <span class="title class_">Object</span>.<span class="title function_">create</span>(b) : (__.<span class="property"><span class="keyword">prototype</span></span> = b.<span class="property"><span class="keyword">prototype</span></span>, <span class="keyword">new</span> <span class="title function_">__</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">Animal</span> = <span class="comment">/** <span class="doctag">@class</span> */</span> (<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">Animal</span>(<span class="params">name, age</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title class_">Animal</span>.<span class="property">getName</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;动物&#x27;</span>;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="title class_">Animal</span>.<span class="property">type</span> = <span class="string">&#x27;哺乳动物&#x27;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Animal</span>;</span><br><span class="line">    &#125;());</span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">Cat</span> = <span class="comment">/** <span class="doctag">@class</span> */</span> (<span class="keyword">function</span> (<span class="params">_super</span>) &#123;</span><br><span class="line">        <span class="title function_">__extends</span>(<span class="title class_">Cat</span>, _super);</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">Cat</span>(<span class="params">name, age, address</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> _this = _super.<span class="title function_">call</span>(<span class="variable language_">this</span>, name, age) || <span class="variable language_">this</span>;</span><br><span class="line">            _this.<span class="property">address</span> = address;</span><br><span class="line">            _this.<span class="property">aaaaa</span> = <span class="number">1</span>; <span class="comment">// es7语法，不建议使用（会作为实例方法）</span></span><br><span class="line">            <span class="keyword">return</span> _this;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title class_">Cat</span>.<span class="property">getName</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(_super.<span class="property">getName</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>));</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;猫&#x27;</span>;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">// 原型方法</span></span><br><span class="line">        <span class="title class_">Cat</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">say</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;miao&#x27;</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="title class_">Cat</span>.<span class="property">type</span> = <span class="string">&#x27;猫科动物&#x27;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Cat</span>;</span><br><span class="line">    &#125;(<span class="title class_">Animal</span>));</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Cat</span>.<span class="property">type</span>, <span class="title class_">Cat</span>.<span class="title function_">getName</span>()); <span class="comment">// 猫科动物 猫</span></span><br><span class="line"></span><br><span class="line">&#125;)();</span><br><span class="line"><span class="comment">//# sourceMappingURL=bundle.js.map</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>那么怎么加原型属性呢？</p>
<p>使用<code>get</code>修饰符（属性访问器）</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">constructor</span>(<span class="params"><span class="keyword">public</span> name: <span class="built_in">string</span>, <span class="keyword">public</span> age: <span class="built_in">number</span></span>) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">type</span> = <span class="string">&#x27;哺乳动物&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="title function_">getName</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;动物&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cat</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Animal</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">constructor</span>(<span class="params">name: <span class="built_in">string</span>, age: <span class="built_in">number</span>, <span class="keyword">public</span> <span class="keyword">readonly</span> address: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>(name, age);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">type</span> = <span class="string">&#x27;猫科动物&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="title function_">getName</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">super</span>.<span class="title function_">getName</span>())</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;猫&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// aaaaa = 1 // es7语法，不建议使用（会作为实例方法）</span></span><br><span class="line">    <span class="comment">// 原型属性</span></span><br><span class="line">    <span class="comment">// 使用属性访问器</span></span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">content</span>() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;aaa&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">set</span> <span class="title function_">content</span>(<span class="params">newVal:<span class="built_in">string</span></span>) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 原型方法</span></span><br><span class="line">    <span class="title function_">say</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;miao&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Cat</span>.<span class="property">type</span>, <span class="title class_">Cat</span>.<span class="title function_">getName</span>()) <span class="comment">// 猫科动物 猫</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到编译后，给<code>Cat.prototype</code>定义了属性</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/******************************************************************************</span></span><br><span class="line"><span class="comment">    Copyright (c) Microsoft Corporation.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    Permission to use, copy, modify, and/or distribute this software for any</span></span><br><span class="line"><span class="comment">    purpose with or without fee is hereby granted.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    THE SOFTWARE IS PROVIDED &quot;AS IS&quot; AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH</span></span><br><span class="line"><span class="comment">    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY</span></span><br><span class="line"><span class="comment">    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,</span></span><br><span class="line"><span class="comment">    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM</span></span><br><span class="line"><span class="comment">    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR</span></span><br><span class="line"><span class="comment">    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR</span></span><br><span class="line"><span class="comment">    PERFORMANCE OF THIS SOFTWARE.</span></span><br><span class="line"><span class="comment">    ***************************************************************************** */</span></span><br><span class="line">    <span class="comment">/* global Reflect, Promise */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> extendStatics = <span class="keyword">function</span>(<span class="params">d, b</span>) &#123;</span><br><span class="line">        extendStatics = <span class="title class_">Object</span>.<span class="property">setPrototypeOf</span> ||</span><br><span class="line">            (&#123; <span class="attr">__proto__</span>: [] &#125; <span class="keyword">instanceof</span> <span class="title class_">Array</span> &amp;&amp; <span class="keyword">function</span> (<span class="params">d, b</span>) &#123; d.<span class="property">__proto__</span> = b; &#125;) ||</span><br><span class="line">            <span class="keyword">function</span> (<span class="params">d, b</span>) &#123; <span class="keyword">for</span> (<span class="keyword">var</span> p <span class="keyword">in</span> b) <span class="keyword">if</span> (<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">hasOwnProperty</span>.<span class="title function_">call</span>(b, p)) d[p] = b[p]; &#125;;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">extendStatics</span>(d, b);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">__extends</span>(<span class="params">d, b</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> b !== <span class="string">&quot;function&quot;</span> &amp;&amp; b !== <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&quot;Class extends value &quot;</span> + <span class="title class_">String</span>(b) + <span class="string">&quot; is not a constructor or null&quot;</span>);</span><br><span class="line">        <span class="title function_">extendStatics</span>(d, b);</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">__</span>(<span class="params"></span>) &#123; <span class="variable language_">this</span>.<span class="property">constructor</span> = d; &#125;</span><br><span class="line">        d.<span class="property"><span class="keyword">prototype</span></span> = b === <span class="literal">null</span> ? <span class="title class_">Object</span>.<span class="title function_">create</span>(b) : (__.<span class="property"><span class="keyword">prototype</span></span> = b.<span class="property"><span class="keyword">prototype</span></span>, <span class="keyword">new</span> <span class="title function_">__</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">Animal</span> = <span class="comment">/** <span class="doctag">@class</span> */</span> (<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">Animal</span>(<span class="params">name, age</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title class_">Animal</span>.<span class="property">getName</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;动物&#x27;</span>;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="title class_">Animal</span>.<span class="property">type</span> = <span class="string">&#x27;哺乳动物&#x27;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Animal</span>;</span><br><span class="line">    &#125;());</span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">Cat</span> = <span class="comment">/** <span class="doctag">@class</span> */</span> (<span class="keyword">function</span> (<span class="params">_super</span>) &#123;</span><br><span class="line">        <span class="title function_">__extends</span>(<span class="title class_">Cat</span>, _super);</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">Cat</span>(<span class="params">name, age, address</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> _this = _super.<span class="title function_">call</span>(<span class="variable language_">this</span>, name, age) || <span class="variable language_">this</span>;</span><br><span class="line">            _this.<span class="property">address</span> = address;</span><br><span class="line">            <span class="keyword">return</span> _this;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title class_">Cat</span>.<span class="property">getName</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(_super.<span class="property">getName</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>));</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;猫&#x27;</span>;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(<span class="title class_">Cat</span>.<span class="property"><span class="keyword">prototype</span></span>, <span class="string">&quot;content&quot;</span>, &#123;</span><br><span class="line">            <span class="comment">// aaaaa = 1 // es7语法，不建议使用（会作为实例方法）</span></span><br><span class="line">            <span class="comment">// 原型属性</span></span><br><span class="line">            <span class="comment">// 使用属性访问器</span></span><br><span class="line">            <span class="attr">get</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&#x27;aaa&#x27;</span>;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">set</span>: <span class="keyword">function</span> (<span class="params">newVal</span>) &#123;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">enumerable</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">configurable</span>: <span class="literal">true</span></span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 原型方法</span></span><br><span class="line">        <span class="title class_">Cat</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">say</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;miao&#x27;</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="title class_">Cat</span>.<span class="property">type</span> = <span class="string">&#x27;猫科动物&#x27;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Cat</span>;</span><br><span class="line">    &#125;(<span class="title class_">Animal</span>));</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Cat</span>.<span class="property">type</span>, <span class="title class_">Cat</span>.<span class="title function_">getName</span>()); <span class="comment">// 猫科动物 猫</span></span><br><span class="line"></span><br><span class="line">&#125;)();</span><br><span class="line"><span class="comment">//# sourceMappingURL=bundle.js.map</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>属性访问器的好处：可以访问私有属性</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">constructor</span>(<span class="params"><span class="keyword">public</span> name: <span class="built_in">string</span>, <span class="keyword">public</span> age: <span class="built_in">number</span></span>) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">type</span> = <span class="string">&#x27;哺乳动物&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="title function_">getName</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;动物&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 父类中定义原型方法</span></span><br><span class="line">    <span class="title function_">say</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;父&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cat</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Animal</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">constructor</span>(<span class="params">name: <span class="built_in">string</span>, age: <span class="built_in">number</span>, <span class="keyword">public</span> <span class="keyword">readonly</span> address: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>(name, age);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">type</span> = <span class="string">&#x27;猫科动物&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="title function_">getName</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">super</span>.<span class="title function_">getName</span>())</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;猫&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 私有属性</span></span><br><span class="line">    <span class="keyword">private</span> <span class="attr">str</span>: <span class="built_in">string</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">content</span>() &#123; <span class="comment">// 访问器上不用加修饰符</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">str</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">set</span> <span class="title function_">content</span>(<span class="params">newVal: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">str</span> = newVal</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">say</span>(<span class="params"></span>) &#123; <span class="comment">// 原型方法中的super指向的是父类的原型</span></span><br><span class="line">        <span class="variable language_">super</span>.<span class="title function_">say</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> cat = <span class="keyword">new</span> <span class="title class_">Cat</span>(<span class="string">&#x27;Tom&#x27;</span>, <span class="number">8</span>, <span class="string">&#x27;USA&#x27;</span>)</span><br><span class="line"><span class="comment">// 直接是拿不到str的</span></span><br><span class="line"><span class="comment">// console.log(cat.str)</span></span><br><span class="line">cat.<span class="property">content</span> = <span class="string">&#x27;abc&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(cat.<span class="property">content</span>) <span class="comment">// abc</span></span><br><span class="line"><span class="keyword">export</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<p><code>bundle.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/******************************************************************************</span></span><br><span class="line"><span class="comment">    Copyright (c) Microsoft Corporation.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    Permission to use, copy, modify, and/or distribute this software for any</span></span><br><span class="line"><span class="comment">    purpose with or without fee is hereby granted.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    THE SOFTWARE IS PROVIDED &quot;AS IS&quot; AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH</span></span><br><span class="line"><span class="comment">    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY</span></span><br><span class="line"><span class="comment">    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,</span></span><br><span class="line"><span class="comment">    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM</span></span><br><span class="line"><span class="comment">    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR</span></span><br><span class="line"><span class="comment">    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR</span></span><br><span class="line"><span class="comment">    PERFORMANCE OF THIS SOFTWARE.</span></span><br><span class="line"><span class="comment">    ***************************************************************************** */</span></span><br><span class="line">    <span class="comment">/* global Reflect, Promise */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> extendStatics = <span class="keyword">function</span>(<span class="params">d, b</span>) &#123;</span><br><span class="line">        extendStatics = <span class="title class_">Object</span>.<span class="property">setPrototypeOf</span> ||</span><br><span class="line">            (&#123; <span class="attr">__proto__</span>: [] &#125; <span class="keyword">instanceof</span> <span class="title class_">Array</span> &amp;&amp; <span class="keyword">function</span> (<span class="params">d, b</span>) &#123; d.<span class="property">__proto__</span> = b; &#125;) ||</span><br><span class="line">            <span class="keyword">function</span> (<span class="params">d, b</span>) &#123; <span class="keyword">for</span> (<span class="keyword">var</span> p <span class="keyword">in</span> b) <span class="keyword">if</span> (<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">hasOwnProperty</span>.<span class="title function_">call</span>(b, p)) d[p] = b[p]; &#125;;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">extendStatics</span>(d, b);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">__extends</span>(<span class="params">d, b</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> b !== <span class="string">&quot;function&quot;</span> &amp;&amp; b !== <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&quot;Class extends value &quot;</span> + <span class="title class_">String</span>(b) + <span class="string">&quot; is not a constructor or null&quot;</span>);</span><br><span class="line">        <span class="title function_">extendStatics</span>(d, b);</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">__</span>(<span class="params"></span>) &#123; <span class="variable language_">this</span>.<span class="property">constructor</span> = d; &#125;</span><br><span class="line">        d.<span class="property"><span class="keyword">prototype</span></span> = b === <span class="literal">null</span> ? <span class="title class_">Object</span>.<span class="title function_">create</span>(b) : (__.<span class="property"><span class="keyword">prototype</span></span> = b.<span class="property"><span class="keyword">prototype</span></span>, <span class="keyword">new</span> <span class="title function_">__</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">Animal</span> = <span class="comment">/** <span class="doctag">@class</span> */</span> (<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">Animal</span>(<span class="params">name, age</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title class_">Animal</span>.<span class="property">getName</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;动物&#x27;</span>;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">// 父类中定义原型方法</span></span><br><span class="line">        <span class="title class_">Animal</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">say</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;父&#x27;</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="title class_">Animal</span>.<span class="property">type</span> = <span class="string">&#x27;哺乳动物&#x27;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Animal</span>;</span><br><span class="line">    &#125;());</span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">Cat</span> = <span class="comment">/** <span class="doctag">@class</span> */</span> (<span class="keyword">function</span> (<span class="params">_super</span>) &#123;</span><br><span class="line">        <span class="title function_">__extends</span>(<span class="title class_">Cat</span>, _super);</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">Cat</span>(<span class="params">name, age, address</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> _this = _super.<span class="title function_">call</span>(<span class="variable language_">this</span>, name, age) || <span class="variable language_">this</span>;</span><br><span class="line">            _this.<span class="property">address</span> = address;</span><br><span class="line">            <span class="comment">// 私有属性</span></span><br><span class="line">            _this.<span class="property">str</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            <span class="keyword">return</span> _this;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title class_">Cat</span>.<span class="property">getName</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(_super.<span class="property">getName</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>));</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;猫&#x27;</span>;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(<span class="title class_">Cat</span>.<span class="property"><span class="keyword">prototype</span></span>, <span class="string">&quot;content&quot;</span>, &#123;</span><br><span class="line">            <span class="attr">get</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">str</span>;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">set</span>: <span class="keyword">function</span> (<span class="params">newVal</span>) &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">str</span> = newVal;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">enumerable</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">configurable</span>: <span class="literal">true</span></span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="title class_">Cat</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">say</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            _super.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">say</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="title class_">Cat</span>.<span class="property">type</span> = <span class="string">&#x27;猫科动物&#x27;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Cat</span>;</span><br><span class="line">    &#125;(<span class="title class_">Animal</span>));</span><br><span class="line">    <span class="keyword">var</span> cat = <span class="keyword">new</span> <span class="title class_">Cat</span>(<span class="string">&#x27;Tom&#x27;</span>, <span class="number">8</span>, <span class="string">&#x27;USA&#x27;</span>);</span><br><span class="line">    <span class="comment">// 直接是拿不到str的</span></span><br><span class="line">    <span class="comment">// console.log(cat.str)</span></span><br><span class="line">    cat.<span class="property">content</span> = <span class="string">&#x27;abc&#x27;</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(cat.<span class="property">content</span>);</span><br><span class="line"></span><br><span class="line">&#125;)();</span><br><span class="line"><span class="comment">//# sourceMappingURL=bundle.js.map</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="原型方法中的super"><a href="#原型方法中的super" class="headerlink" title="原型方法中的super"></a>原型方法中的<code>super</code></h3><p>原型方法中的<code>super</code>，指向的是父类原型</p>
<p>我们在父类中，加上个<code>say</code>方法，并在子类中调用，最后实例上调用<code>say</code>方法</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">constructor</span>(<span class="params"><span class="keyword">public</span> name: <span class="built_in">string</span>, <span class="keyword">public</span> age: <span class="built_in">number</span></span>) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">type</span> = <span class="string">&#x27;哺乳动物&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="title function_">getName</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;动物&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 父类中定义原型方法</span></span><br><span class="line">    <span class="title function_">say</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;父&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cat</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Animal</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">constructor</span>(<span class="params">name: <span class="built_in">string</span>, age: <span class="built_in">number</span>, <span class="keyword">public</span> <span class="keyword">readonly</span> address: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>(name, age);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">type</span> = <span class="string">&#x27;猫科动物&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="title function_">getName</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">super</span>.<span class="title function_">getName</span>())</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;猫&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">content</span>() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;aaa&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">set</span> <span class="title function_">content</span>(<span class="params">newVal:<span class="built_in">string</span></span>) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">say</span>(<span class="params"></span>) &#123; <span class="comment">// 原型方法中的super指向的是父类的原型</span></span><br><span class="line">        <span class="variable language_">super</span>.<span class="title function_">say</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> cat = <span class="keyword">new</span> <span class="title class_">Cat</span>(<span class="string">&#x27;Tom&#x27;</span>, <span class="number">8</span>,<span class="string">&#x27;USA&#x27;</span>)</span><br><span class="line">cat.<span class="title function_">say</span>() <span class="comment">// 父</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(cat)</span><br><span class="line"><span class="keyword">export</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/image-20220724164421552.png" alt="image-20220724164421552"></p>
<p><code>bundle.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> extendStatics = <span class="keyword">function</span>(<span class="params">d, b</span>) &#123;</span><br><span class="line">        extendStatics = <span class="title class_">Object</span>.<span class="property">setPrototypeOf</span> ||</span><br><span class="line">            (&#123; <span class="attr">__proto__</span>: [] &#125; <span class="keyword">instanceof</span> <span class="title class_">Array</span> &amp;&amp; <span class="keyword">function</span> (<span class="params">d, b</span>) &#123; d.<span class="property">__proto__</span> = b; &#125;) ||</span><br><span class="line">            <span class="keyword">function</span> (<span class="params">d, b</span>) &#123; <span class="keyword">for</span> (<span class="keyword">var</span> p <span class="keyword">in</span> b) <span class="keyword">if</span> (<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">hasOwnProperty</span>.<span class="title function_">call</span>(b, p)) d[p] = b[p]; &#125;;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">extendStatics</span>(d, b);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">__extends</span>(<span class="params">d, b</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> b !== <span class="string">&quot;function&quot;</span> &amp;&amp; b !== <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&quot;Class extends value &quot;</span> + <span class="title class_">String</span>(b) + <span class="string">&quot; is not a constructor or null&quot;</span>);</span><br><span class="line">        <span class="title function_">extendStatics</span>(d, b);</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">__</span>(<span class="params"></span>) &#123; <span class="variable language_">this</span>.<span class="property">constructor</span> = d; &#125;</span><br><span class="line">        d.<span class="property"><span class="keyword">prototype</span></span> = b === <span class="literal">null</span> ? <span class="title class_">Object</span>.<span class="title function_">create</span>(b) : (__.<span class="property"><span class="keyword">prototype</span></span> = b.<span class="property"><span class="keyword">prototype</span></span>, <span class="keyword">new</span> <span class="title function_">__</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">Animal</span> = <span class="comment">/** <span class="doctag">@class</span> */</span> (<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">Animal</span>(<span class="params">name, age</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title class_">Animal</span>.<span class="property">getName</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;动物&#x27;</span>;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">// 父类中定义原型方法</span></span><br><span class="line">        <span class="title class_">Animal</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">say</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;父&#x27;</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="title class_">Animal</span>.<span class="property">type</span> = <span class="string">&#x27;哺乳动物&#x27;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Animal</span>;</span><br><span class="line">    &#125;());</span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">Cat</span> = <span class="comment">/** <span class="doctag">@class</span> */</span> (<span class="keyword">function</span> (<span class="params">_super</span>) &#123;</span><br><span class="line">        <span class="title function_">__extends</span>(<span class="title class_">Cat</span>, _super);</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">Cat</span>(<span class="params">name, age, address</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> _this = _super.<span class="title function_">call</span>(<span class="variable language_">this</span>, name, age) || <span class="variable language_">this</span>;</span><br><span class="line">            _this.<span class="property">address</span> = address;</span><br><span class="line">            <span class="keyword">return</span> _this;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title class_">Cat</span>.<span class="property">getName</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(_super.<span class="property">getName</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>));</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;猫&#x27;</span>;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(<span class="title class_">Cat</span>.<span class="property"><span class="keyword">prototype</span></span>, <span class="string">&quot;content&quot;</span>, &#123;</span><br><span class="line">            <span class="attr">get</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&#x27;aaa&#x27;</span>;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">set</span>: <span class="keyword">function</span> (<span class="params">newVal</span>) &#123;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">enumerable</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">configurable</span>: <span class="literal">true</span></span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="title class_">Cat</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">say</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            _super.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">say</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="title class_">Cat</span>.<span class="property">type</span> = <span class="string">&#x27;猫科动物&#x27;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Cat</span>;</span><br><span class="line">    &#125;(<span class="title class_">Animal</span>));</span><br><span class="line">    <span class="keyword">var</span> cat = <span class="keyword">new</span> <span class="title class_">Cat</span>(<span class="string">&#x27;Tom&#x27;</span>, <span class="number">8</span>, <span class="string">&#x27;USA&#x27;</span>);</span><br><span class="line">    cat.<span class="title function_">say</span>(); <span class="comment">// 父</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(cat);</span><br><span class="line"></span><br><span class="line">&#125;)();</span><br><span class="line"><span class="comment">//# sourceMappingURL=bundle.js.map</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="装饰器"><a href="#装饰器" class="headerlink" title="装饰器"></a>装饰器</h1><p><code>es7</code>中的</p>
<p>装饰器是一个实验性语法，语法会有改动，<code>vue2</code>中刚开始用的就是装饰器，要使用这个功能，需要注释掉<code>ts</code>配置文件中的<code>experimentalDecorator</code>选项，设置为<code>true</code></p>
<p>装饰器的作用，就是扩展类中的属性和方法</p>
<p>可以在不同的类上，增加装饰器以增加不同的功能，实现复用</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">addSay1</span>(<span class="params">target:<span class="built_in">any</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">addSay2</span>(<span class="params">target:<span class="built_in">any</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">addSay3</span>(<span class="params">target:<span class="built_in">any</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@addSay1</span></span><br><span class="line"><span class="meta">@addSay2</span></span><br><span class="line"><span class="meta">@addSay3</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 等价于addSay1(addSay2(addSay3(Person)))</span></span><br></pre></td></tr></table></figure>

<p><code>bundle.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> __decorate = (<span class="literal">undefined</span> &amp;&amp; <span class="literal">undefined</span>.<span class="property">__decorate</span>) || <span class="keyword">function</span> (<span class="params">decorators, target, key, desc</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> c = <span class="variable language_">arguments</span>.<span class="property">length</span>, r = c &lt; <span class="number">3</span> ? target : desc === <span class="literal">null</span> ? desc = <span class="title class_">Object</span>.<span class="title function_">getOwnPropertyDescriptor</span>(target, key) : desc, d;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="title class_">Reflect</span> === <span class="string">&quot;object&quot;</span> &amp;&amp; <span class="keyword">typeof</span> <span class="title class_">Reflect</span>.<span class="property">decorate</span> === <span class="string">&quot;function&quot;</span>) r = <span class="title class_">Reflect</span>.<span class="title function_">decorate</span>(decorators, target, key, desc);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">for</span> (<span class="keyword">var</span> i = decorators.<span class="property">length</span> - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) <span class="keyword">if</span> (d = decorators[i]) r = (c &lt; <span class="number">3</span> ? <span class="title function_">d</span>(r) : c &gt; <span class="number">3</span> ? <span class="title function_">d</span>(target, key, r) : <span class="title function_">d</span>(target, key)) || r; <span class="comment">// 反向依此执行</span></span><br><span class="line">        <span class="keyword">return</span> c &gt; <span class="number">3</span> &amp;&amp; r &amp;&amp; <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(target, key, r), r;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">addSay1</span>(<span class="params">target</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">addSay2</span>(<span class="params">target</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;2&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">addSay3</span>(<span class="params">target</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;3&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/** <span class="doctag">@class</span> */</span> ((<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params"></span>) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title class_">Person</span> = <span class="title function_">__decorate</span>([</span><br><span class="line">            addSay1,</span><br><span class="line">            addSay2,</span><br><span class="line">            addSay3 <span class="comment">// 是个数组</span></span><br><span class="line">        ], <span class="title class_">Person</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Person</span>;</span><br><span class="line">    &#125;)());</span><br><span class="line">    <span class="comment">// 等价于addSay1(addSay2(addSay3(Person)))</span></span><br><span class="line"></span><br><span class="line">&#125;)();</span><br><span class="line"><span class="comment">//# sourceMappingURL=bundle.js.map</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p> 等价于<code>addSay1(addSay2(addSay3(Person)))</code>，结果：</p>
<p><img src="/image-20220724190408049.png" alt="image-20220724190408049"></p>
<p>装饰器只能修饰类，不能修饰函数，因为函数会有变量提升的问题</p>
<h2 id="洋葱模型"><a href="#洋葱模型" class="headerlink" title="洋葱模型"></a>洋葱模型</h2><p>如果装饰器本身返回的是个函数</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">addSay1</span>(<span class="params">val: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(val)</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">target: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">addSay2</span>(<span class="params">val: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(val)</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">target: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">addSay3</span>(<span class="params">val: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(val)</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">target: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@addSay1</span>(<span class="string">&#x27;a1&#x27;</span>)</span><br><span class="line"><span class="meta">@addSay2</span>(<span class="string">&#x27;a2&#x27;</span>)</span><br><span class="line"><span class="meta">@addSay3</span>(<span class="string">&#x27;a3&#x27;</span>) <span class="comment">// 这里也可以写成多层@addSay3(&#x27;a3&#x27;)()()，只要返回值是一个函数，类似于函数柯里化</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果：<code>a1 a2 a3 3 2 1</code></p>
<p><img src="/2022/07/19/web/JavaScript/TypeScript/image-20220724191054323.png" alt="image-20220724191054323"></p>
<p><code>bundle.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> __decorate = (<span class="literal">undefined</span> &amp;&amp; <span class="literal">undefined</span>.<span class="property">__decorate</span>) || <span class="keyword">function</span> (<span class="params">decorators, target, key, desc</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> c = <span class="variable language_">arguments</span>.<span class="property">length</span>, r = c &lt; <span class="number">3</span> ? target : desc === <span class="literal">null</span> ? desc = <span class="title class_">Object</span>.<span class="title function_">getOwnPropertyDescriptor</span>(target, key) : desc, d;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="title class_">Reflect</span> === <span class="string">&quot;object&quot;</span> &amp;&amp; <span class="keyword">typeof</span> <span class="title class_">Reflect</span>.<span class="property">decorate</span> === <span class="string">&quot;function&quot;</span>) r = <span class="title class_">Reflect</span>.<span class="title function_">decorate</span>(decorators, target, key, desc);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">for</span> (<span class="keyword">var</span> i = decorators.<span class="property">length</span> - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) <span class="keyword">if</span> (d = decorators[i]) r = (c &lt; <span class="number">3</span> ? <span class="title function_">d</span>(r) : c &gt; <span class="number">3</span> ? <span class="title function_">d</span>(target, key, r) : <span class="title function_">d</span>(target, key)) || r;</span><br><span class="line">        <span class="keyword">return</span> c &gt; <span class="number">3</span> &amp;&amp; r &amp;&amp; <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(target, key, r), r;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">addSay1</span>(<span class="params">val</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(val);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">target</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">addSay2</span>(<span class="params">val</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(val);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">target</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;2&#x27;</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">addSay3</span>(<span class="params">val</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(val);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">target</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;3&#x27;</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/** <span class="doctag">@class</span> */</span> ((<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params"></span>) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title class_">Person</span> = <span class="title function_">__decorate</span>([</span><br><span class="line">            <span class="title function_">addSay1</span>(<span class="string">&#x27;a1&#x27;</span>),</span><br><span class="line">            <span class="title function_">addSay2</span>(<span class="string">&#x27;a2&#x27;</span>),</span><br><span class="line">            <span class="title function_">addSay3</span>(<span class="string">&#x27;a3&#x27;</span>)</span><br><span class="line">        ], <span class="title class_">Person</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Person</span>;</span><br><span class="line">    &#125;)());</span><br><span class="line"></span><br><span class="line">&#125;)();</span><br><span class="line"><span class="comment">//# sourceMappingURL=bundle.js.map</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h2><h3 id="修饰方法"><a href="#修饰方法" class="headerlink" title="修饰方法"></a>修饰方法</h3><p>使用装饰器，给<code>person</code>新增<code>eat</code>方法</p>
<p><code>target</code>参数指向的是类</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">eat</span>(<span class="params">target: <span class="built_in">any</span></span>) &#123; <span class="comment">// target参数指向的是类</span></span><br><span class="line">    target.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">eat</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;eat&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@eat</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    eat!: <span class="function">() =&gt;</span> <span class="built_in">void</span> <span class="comment">// 需要在Person类中先声明下</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> p = <span class="keyword">new</span> <span class="title class_">Person</span>()</span><br><span class="line">p.<span class="title function_">eat</span>() <span class="comment">// eat</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>bundle.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> __decorate = (<span class="literal">undefined</span> &amp;&amp; <span class="literal">undefined</span>.<span class="property">__decorate</span>) || <span class="keyword">function</span> (<span class="params">decorators, target, key, desc</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> c = <span class="variable language_">arguments</span>.<span class="property">length</span>, r = c &lt; <span class="number">3</span> ? target : desc === <span class="literal">null</span> ? desc = <span class="title class_">Object</span>.<span class="title function_">getOwnPropertyDescriptor</span>(target, key) : desc, d;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="title class_">Reflect</span> === <span class="string">&quot;object&quot;</span> &amp;&amp; <span class="keyword">typeof</span> <span class="title class_">Reflect</span>.<span class="property">decorate</span> === <span class="string">&quot;function&quot;</span>) r = <span class="title class_">Reflect</span>.<span class="title function_">decorate</span>(decorators, target, key, desc);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">for</span> (<span class="keyword">var</span> i = decorators.<span class="property">length</span> - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) <span class="keyword">if</span> (d = decorators[i]) r = (c &lt; <span class="number">3</span> ? <span class="title function_">d</span>(r) : c &gt; <span class="number">3</span> ? <span class="title function_">d</span>(target, key, r) : <span class="title function_">d</span>(target, key)) || r;</span><br><span class="line">        <span class="keyword">return</span> c &gt; <span class="number">3</span> &amp;&amp; r &amp;&amp; <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(target, key, r), r;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">eat</span>(<span class="params">target</span>) &#123;</span><br><span class="line">        target.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">eat</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;eat&#x27;</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">Person</span> = <span class="comment">/** <span class="doctag">@class</span> */</span> (<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params"></span>) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title class_">Person</span> = <span class="title function_">__decorate</span>([</span><br><span class="line">            eat</span><br><span class="line">        ], <span class="title class_">Person</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Person</span>;</span><br><span class="line">    &#125;());</span><br><span class="line">    <span class="keyword">var</span> p = <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line">    p.<span class="title function_">eat</span>(); <span class="comment">// eat</span></span><br><span class="line"></span><br><span class="line">&#125;)();</span><br><span class="line"><span class="comment">//# sourceMappingURL=bundle.js.map</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="修饰属性"><a href="#修饰属性" class="headerlink" title="修饰属性"></a>修饰属性</h3><p><code>target</code>参数指向的是原型（可以看编译后的代码）</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">toUpperCase</span>(<span class="params">target:<span class="built_in">any</span>, key:<span class="built_in">string</span></span>) &#123; <span class="comment">// target指的是原型</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="meta">@toUpperCase</span></span><br><span class="line">    <span class="keyword">public</span> <span class="attr">name</span>: <span class="built_in">string</span> = <span class="string">&#x27;sai&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> p = <span class="keyword">new</span> <span class="title class_">Person</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p.<span class="property">name</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>bundle.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> __decorate = (<span class="literal">undefined</span> &amp;&amp; <span class="literal">undefined</span>.<span class="property">__decorate</span>) || <span class="keyword">function</span> (<span class="params">decorators, target, key, desc</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> c = <span class="variable language_">arguments</span>.<span class="property">length</span>, r = c &lt; <span class="number">3</span> ? target : desc === <span class="literal">null</span> ? desc = <span class="title class_">Object</span>.<span class="title function_">getOwnPropertyDescriptor</span>(target, key) : desc, d;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="title class_">Reflect</span> === <span class="string">&quot;object&quot;</span> &amp;&amp; <span class="keyword">typeof</span> <span class="title class_">Reflect</span>.<span class="property">decorate</span> === <span class="string">&quot;function&quot;</span>) r = <span class="title class_">Reflect</span>.<span class="title function_">decorate</span>(decorators, target, key, desc);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">for</span> (<span class="keyword">var</span> i = decorators.<span class="property">length</span> - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) <span class="keyword">if</span> (d = decorators[i]) r = (c &lt; <span class="number">3</span> ? <span class="title function_">d</span>(r) : c &gt; <span class="number">3</span> ? <span class="title function_">d</span>(target, key, r) : <span class="title function_">d</span>(target, key)) || r;</span><br><span class="line">        <span class="keyword">return</span> c &gt; <span class="number">3</span> &amp;&amp; r &amp;&amp; <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(target, key, r), r;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">toUpperCase</span>(<span class="params">target, key</span>) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">Person</span> = <span class="comment">/** <span class="doctag">@class</span> */</span> (<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">name</span> = <span class="string">&#x27;sai&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_">__decorate</span>([</span><br><span class="line">            toUpperCase</span><br><span class="line">        ], <span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>, <span class="string">&quot;name&quot;</span>, <span class="keyword">void</span> <span class="number">0</span>); <span class="comment">// 指向的是原型</span></span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Person</span>;</span><br><span class="line">    &#125;());</span><br><span class="line">    <span class="keyword">var</span> p = <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(p.<span class="property">name</span>);</span><br><span class="line"></span><br><span class="line">&#125;)();</span><br><span class="line"><span class="comment">//# sourceMappingURL=bundle.js.map</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>现在<code>toUpperCase</code>的功能，是想实现大写，该怎么玩</p>
<p>我们知道代码是顺序执行的，执行到<code>toUpperCase</code>的时候，<code>name</code>还没有赋值</p>
<p>装饰器中，使用<code>Object.defineProperty</code>给<code>target</code>（原型）增加<code>get</code>和<code>set</code>，这样在后面修改值的时候，就可以触发更新了</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">toUpperCase</span>(<span class="params">target: <span class="built_in">any</span>, key: <span class="built_in">string</span></span>) &#123; <span class="comment">// target指的是原型</span></span><br><span class="line">    <span class="keyword">let</span> <span class="attr">val</span>: <span class="built_in">string</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(target, key, &#123;</span><br><span class="line">        <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> val.<span class="title function_">toUpperCase</span>()</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="title function_">set</span>(<span class="params">newVal: <span class="built_in">string</span></span>) &#123; <span class="comment">//给原型对象上，赋值的时候，就会触发set</span></span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(newVal)</span><br><span class="line">            val = newVal</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="meta">@toUpperCase</span></span><br><span class="line">    <span class="keyword">public</span> <span class="attr">name</span>: <span class="built_in">string</span> = <span class="string">&#x27;sai&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> p = <span class="keyword">new</span> <span class="title class_">Person</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p.<span class="property">name</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/2022/07/19/web/JavaScript/TypeScript/image-20220724225645165.png" alt="image-20220724225645165"></p>
<h3 id="修饰静态属性"><a href="#修饰静态属性" class="headerlink" title="修饰静态属性"></a>修饰静态属性</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">toUpperCase</span>(<span class="params">target: <span class="built_in">any</span>, key: <span class="built_in">string</span></span>) &#123; <span class="comment">// target指的是原型</span></span><br><span class="line">    <span class="keyword">let</span> <span class="attr">val</span>: <span class="built_in">string</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(target, key, &#123;</span><br><span class="line">        <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> val.<span class="title function_">toUpperCase</span>()</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="title function_">set</span>(<span class="params">newVal: <span class="built_in">string</span></span>) &#123; <span class="comment">//给原型对象上，赋值的时候，就会触发set</span></span><br><span class="line">            val = newVal</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">double</span>(<span class="params">num:<span class="built_in">number</span></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">target:<span class="built_in">any</span>, key:<span class="built_in">string</span></span>) &#123; <span class="comment">// target指向类</span></span><br><span class="line">        <span class="keyword">let</span> <span class="attr">val</span>:<span class="built_in">number</span> = target[key]</span><br><span class="line">        <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(target, key,  &#123;</span><br><span class="line">            <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> val * <span class="number">2</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="meta">@toUpperCase</span></span><br><span class="line">    <span class="keyword">public</span> <span class="attr">name</span>: <span class="built_in">string</span> = <span class="string">&#x27;sai&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@double</span>(<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">static</span> <span class="attr">age</span>:<span class="built_in">number</span> = <span class="number">18</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> p = <span class="keyword">new</span> <span class="title class_">Person</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p.<span class="property">name</span>, <span class="title class_">Person</span>.<span class="property">age</span>) <span class="comment">// SAI 36</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="修饰静态方法"><a href="#修饰静态方法" class="headerlink" title="修饰静态方法"></a>修饰静态方法</h3>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://mindcons.cn/2022/07/19/web/JavaScript/TypeScript/" data-id="cldolkc4f001efgx6drw7alfs" data-title="TypeScript基础" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/TypeScript/" rel="tag">TypeScript</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-web/专栏/DevOps" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/07/19/web/%E4%B8%93%E6%A0%8F/DevOps/" class="article-date">
  <time class="dt-published" datetime="2022-07-18T23:28:42.000Z" itemprop="datePublished">2022-07-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/07/19/web/%E4%B8%93%E6%A0%8F/DevOps/">DevOps</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        
      
    </div>
    <footer class="article-footer">
      <a data-url="https://mindcons.cn/2022/07/19/web/%E4%B8%93%E6%A0%8F/DevOps/" data-id="cldolkc4q001zfgx6842w0yhb" data-title="DevOps" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-web/专栏/web原理及基础概念" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/07/19/web/%E4%B8%93%E6%A0%8F/web%E5%8E%9F%E7%90%86%E5%8F%8A%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/" class="article-date">
  <time class="dt-published" datetime="2022-07-18T23:28:42.000Z" itemprop="datePublished">2022-07-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/07/19/web/%E4%B8%93%E6%A0%8F/web%E5%8E%9F%E7%90%86%E5%8F%8A%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/">web原理及基础概念</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="链接"><a href="#链接" class="headerlink" title="链接"></a>链接</h1><p>渲染页面：浏览器的工作原理<br><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/Performance/How_browsers_work">渲染页面：浏览器的工作原理 - Web 性能 | MDN (mozilla.org)</a></p>
<p>理解回调函数</p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/326902537">10张图让你彻底理解回调函数 - 知乎 (zhihu.com)</a></p>
<p>并发模型与事件循环</p>
<p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/EventLoop">并发模型与事件循环 - JavaScript | MDN (mozilla.org)</a></p>
<p>Promise</p>
<p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise - JavaScript | MDN (mozilla.org)</a></p>
<p>沙箱环境</p>
<p>缓存</p>
<h1 id="回调函数"><a href="#回调函数" class="headerlink" title="回调函数"></a>回调函数</h1>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://mindcons.cn/2022/07/19/web/%E4%B8%93%E6%A0%8F/web%E5%8E%9F%E7%90%86%E5%8F%8A%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/" data-id="cldolkc4s0024fgx6hn8ih7q9" data-title="web原理及基础概念" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-web/专栏/Chrome插件开发/15000字大章带你一步一步使用Vue3开发chrome浏览器插件  掘金年度征文" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/07/19/web/%E4%B8%93%E6%A0%8F/Chrome%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/15000%E5%AD%97%E5%A4%A7%E7%AB%A0%E5%B8%A6%E4%BD%A0%E4%B8%80%E6%AD%A5%E4%B8%80%E6%AD%A5%E4%BD%BF%E7%94%A8Vue3%E5%BC%80%E5%8F%91chrome%E6%B5%8F%E8%A7%88%E5%99%A8%E6%8F%92%E4%BB%B6%20%20%E6%8E%98%E9%87%91%E5%B9%B4%E5%BA%A6%E5%BE%81%E6%96%87/" class="article-date">
  <time class="dt-published" datetime="2022-07-18T23:28:42.000Z" itemprop="datePublished">2022-07-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/07/19/web/%E4%B8%93%E6%A0%8F/Chrome%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/15000%E5%AD%97%E5%A4%A7%E7%AB%A0%E5%B8%A6%E4%BD%A0%E4%B8%80%E6%AD%A5%E4%B8%80%E6%AD%A5%E4%BD%BF%E7%94%A8Vue3%E5%BC%80%E5%8F%91chrome%E6%B5%8F%E8%A7%88%E5%99%A8%E6%8F%92%E4%BB%B6%20%20%E6%8E%98%E9%87%91%E5%B9%B4%E5%BA%A6%E5%BE%81%E6%96%87/">工程化开发crx</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="15000字大章带你一步一步使用Vue3开发chrome浏览器插件-掘金年度征文"><a href="#15000字大章带你一步一步使用Vue3开发chrome浏览器插件-掘金年度征文" class="headerlink" title="15000字大章带你一步一步使用Vue3开发chrome浏览器插件 | 掘金年度征文"></a>15000字大章带你一步一步使用Vue3开发chrome浏览器插件 | 掘金年度征文</h1><blockquote>
<p>之前写过一篇 chrome 浏览器插件开发的文章 <a target="_blank" rel="noopener" href="https://juejin.cn/post/6902306686716313614">全方面手把手从0到1带你开发谷歌浏览器插件</a> ，但是不是 <code>vue/react</code> 这种第三方框架的，是原生和 <code>jquery</code> 混合的，但是那种开发前端方式比较麻烦，所以下面是用 <code>vue</code> 来开发插件。</p>
</blockquote>
<blockquote>
<p>文章有点长，建议先收藏再一步步来进行实操</p>
</blockquote>
<blockquote>
<p><a href="https://link.juejin.cn/?target=https://github.com/18055975947/my-vue3-plugin">github地址：https://github.com/18055975947/my-vue3-plugin</a></p>
</blockquote>
<blockquote>
<p><a href="https://link.juejin.cn/?target=https://gitee.com/guoqiankun/my-vue3-plugin">码云地址：https://gitee.com/guoqiankun/my-vue3-plugin</a></p>
</blockquote>
<h2 id="一、创建-Vue-项目"><a href="#一、创建-Vue-项目" class="headerlink" title="一、创建 Vue 项目"></a>一、创建 Vue 项目</h2><p>使用 <code>vue-cli</code> 创建 <code>vue3.x</code> 版本的 <code>vue</code> 项目 <code>vue create my-vue3-plugin</code> 如果在创建项目的时候报错，报错内容如下：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">error Couldn&#x27;t find package &quot;postcss-normalize-string@^4.0.2&quot; required by &quot;cssnano-preset-default@^4.0.0&quot; on the &quot;npm&quot; registry.</span><br><span class="line">Error: Couldn&#x27;t find package &quot;@vue/cli-overlay@^4.5.9&quot; required by &quot;@vue/cli-service@~4.5.0&quot; on the &quot;npm&quot; registry.</span><br><span class="line">    at MessageError.ExtendableBuiltin (/usr/local/lib/node_modules/yarn/lib/cli.js:243:66)</span><br><span class="line">    at new MessageError (/usr/local/lib/node_modules/yarn/lib/cli.js:272:123)</span><br><span class="line">    at PackageRequest.&lt;anonymous&gt; (/usr/local/lib/node_modules/yarn/lib/cli.js:38988:17)</span><br><span class="line">    at Generator.throw (&lt;anonymous&gt;)</span><br><span class="line">    at step (/usr/local/lib/node_modules/yarn/lib/cli.js:92:30)</span><br><span class="line">    at /usr/local/lib/node_modules/yarn/lib/cli.js:105:13</span><br><span class="line">    at process._tickCallback (internal/process/next_tick.js:68:7)</span><br><span class="line"> ERROR  command failed: yarn </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>可以参考 <a target="_blank" rel="noopener" href="https://juejin.cn/post/6911974908025110536">使用 <code>vue-cli</code> 创建 <code>vue3.x</code> 版本项目报错</a> 文章来处理 此时文件目录为：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── README.md</span><br><span class="line">├── babel.config.js</span><br><span class="line">├── package.json</span><br><span class="line">├── public</span><br><span class="line">│   ├── favicon.ico</span><br><span class="line">│   └── index.html</span><br><span class="line">├── src</span><br><span class="line">│   ├── App.vue</span><br><span class="line">│   ├── assets</span><br><span class="line">│   │   └── logo.png</span><br><span class="line">│   ├── components</span><br><span class="line">│   │   └── HelloWorld.vue</span><br><span class="line">│   └── main.js</span><br><span class="line">└── yarn.lock</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="二、修改项目"><a href="#二、修改项目" class="headerlink" title="二、修改项目"></a>二、修改项目</h2><p>因为我们要开发 <code>chrome</code> 插件项目，而这种生成的 <code>vue</code> 项目里面的文件夹和文件很多我们不需要，所以我们需要处理下：</p>
<ol>
<li>在根目录下创建 <code>vue.config.js</code> 的 <code>vue</code> 配置文件；</li>
<li>把 <code>src</code> 文件夹下面的 <code>app.vue、components</code> 文件夹删除</li>
<li>在 <code>assets</code> 文件中创建 <code>images</code> 文件夹，并在 <code>images</code> 文件夹里面添加自己插件的 <code>icon</code></li>
<li>删除根目录下的 <code>public</code> 文件夹</li>
<li>在 <code>src</code> 文件夹下 创建 <code>background、content、plugins、popup、utils</code> 文件夹</li>
<li>在 <code>background</code> 文件夹下创建 <code>main.js</code></li>
<li>在 <code>content</code> 文件夹下创建 <code>components</code> 文件夹和 <code>main.js</code>，<code>components</code> 文件夹下创建 <code>app.vue</code></li>
<li>在 <code>plugins</code> 文件夹下创建 <code>inject.js、manifest.json</code> 文件</li>
<li>在 <code>popup</code> 文件夹下创建 <code>components</code> 文件夹 <code>main.js</code> 和 <code>index.html</code>，<code>components</code> 文件夹下创建 <code>app.vue</code></li>
</ol>
<p><strong>步骤解析：</strong></p>
<ul>
<li><code>vue.config.js</code> 是 <code>vue</code> 项目的打包、运行、等的配置文件，我们需要生成插件项目，这个文件需要创建并且自行配置</li>
<li>删除多余的文件，我们插件里面目前只有 需要一个 <code>popup</code> 页面，不需要 外部的 <code>app.vue</code> 和 组件</li>
<li>自己的插件 <code>icon</code>，按照 <code>16 * 16、48 * 48、128 * 128</code> 三个尺寸</li>
<li>不需要 <code>public</code> 文件夹里面的 <code>index.html</code></li>
<li>创建我们插件需要的 <code>background.js、content.js、popup页面、插件配置</code> 等</li>
<li>创建 <code>background.js</code> 文件</li>
<li>创建 <code>content.js</code> 文件</li>
<li>创建 <code>popup.js、popup.html</code> 文件</li>
</ul>
<p>此时文件目录：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── README.md</span><br><span class="line">├── babel.config.js</span><br><span class="line">├── package.json</span><br><span class="line">├── src</span><br><span class="line">│   ├── assets</span><br><span class="line">│   │   ├── images</span><br><span class="line">│   │   │   ├── icon128.png</span><br><span class="line">│   │   │   ├── icon16.png</span><br><span class="line">│   │   │   └── icon48.png</span><br><span class="line">│   │   └── logo.png</span><br><span class="line">│   ├── background</span><br><span class="line">│   │   └── main.js</span><br><span class="line">│   ├── content</span><br><span class="line">│   │   ├── components</span><br><span class="line">│   │   │   └── app.vue</span><br><span class="line">│   │   └── main.js</span><br><span class="line">│   ├── main.js</span><br><span class="line">│   ├── plugins</span><br><span class="line">│   │   ├── inject.js</span><br><span class="line">│   │   └── manifest.json</span><br><span class="line">│   ├── popup</span><br><span class="line">│   │   ├── components</span><br><span class="line">│   │   │   └── app.vue</span><br><span class="line">│   │   ├── index.html</span><br><span class="line">│   │   └── main.js</span><br><span class="line">│   └── utils</span><br><span class="line">├── vue.config.js</span><br><span class="line">└── yarn.lock</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="三、配置项目"><a href="#三、配置项目" class="headerlink" title="三、配置项目"></a>三、配置项目</h2><h3 id="1、plugins-manifest-json-文件配置"><a href="#1、plugins-manifest-json-文件配置" class="headerlink" title="1、plugins/manifest.json 文件配置"></a>1、<code>plugins/manifest.json</code> 文件配置</h3><p>先配置 <code>manifest.json</code> 文件，在按照此文件配置 <code>vue.config.js</code> 文件</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;manifest_version&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;my-vue3-plugin&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;基于vue3.x版本的chrome插件&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;browser_action&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;default_title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;my-vue3-plugin&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;default_icon&quot;</span><span class="punctuation">:</span> <span class="string">&quot;assets/images/icon48.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;default_popup&quot;</span><span class="punctuation">:</span> <span class="string">&quot;popup.html&quot;</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;permissions&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;background&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;js/background.js&quot;</span><span class="punctuation">]</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;icons&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;16&quot;</span><span class="punctuation">:</span> <span class="string">&quot;assets/images/icon16.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;48&quot;</span><span class="punctuation">:</span> <span class="string">&quot;assets/images/icon48.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;128&quot;</span><span class="punctuation">:</span> <span class="string">&quot;assets/images/icon128.png&quot;</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;content_scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">		<span class="punctuation">&#123;</span></span><br><span class="line">			<span class="attr">&quot;matches&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;https://*.taobao.com/*&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;css&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;css/content.css&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;js&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;js/content.js&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;run_at&quot;</span><span class="punctuation">:</span> <span class="string">&quot;document_idle&quot;</span></span><br><span class="line">		<span class="punctuation">&#125;</span></span><br><span class="line">	<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;web_accessible_resources&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;js/inject.js&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="解析："><a href="#解析：" class="headerlink" title="解析："></a>解析：</h4><ol>
<li><code>browser_action</code> 中的 <code>default_popup</code> 配置为 和 <code>manifest.json</code> 文件一级的 <code>popup.html</code></li>
<li><code>browser_action</code> 中的 <code>default_icon</code> 配置为 <code>assets/images/icon48.png</code></li>
<li><code>background</code> 配置为 <code>js/background.js</code></li>
<li><code>icons</code> 文件进行 项目的配置</li>
<li><code>content_scripts</code> 配置对应的 <code>js、css、和 matches</code></li>
<li><code>web_accessible_resources</code> 配置网页内置 <code>js/inject.js</code></li>
</ol>
<h3 id="2、配置-vue-config-js-文件"><a href="#2、配置-vue-config-js-文件" class="headerlink" title="2、配置 vue.config.js 文件"></a>2、配置 <code>vue.config.js</code> 文件</h3><p>通过上面的 <code>manifest.json</code> 文件可以看出，我们需要配置 <code>js</code> 文件夹，<code>css</code> 文件夹，<code>popup.html</code> 文件，<code>background.js</code> 文件，<code>inject.js</code> 文件，<code>content.js</code> 文件，<code>content.css</code> 文件；</p>
<h4 id="1-添加-copy-webpack-plugin-模块，用于复制文件"><a href="#1-添加-copy-webpack-plugin-模块，用于复制文件" class="headerlink" title="1. 添加 copy-webpack-plugin 模块，用于复制文件"></a>1. 添加 <code>copy-webpack-plugin</code> 模块，用于复制文件</h4><p>我们需要把 <code>plugins</code> 文件夹下的文件复制到打包之后的 <code>dist</code> 文件中</p>
<p><strong>安装：</strong></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yarn add copy-webpack-plugin@6.0.2 --dev</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="2-文件内容"><a href="#2-文件内容" class="headerlink" title="2. 文件内容"></a>2. 文件内容</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">CopyWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;copy-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 复制文件到指定目录</span></span><br><span class="line"><span class="keyword">const</span> copyFiles = [</span><br><span class="line">	&#123;</span><br><span class="line">    	<span class="attr">from</span>: path.<span class="title function_">resolve</span>(<span class="string">&quot;src/plugins/manifest.json&quot;</span>),</span><br><span class="line">    	<span class="attr">to</span>: <span class="string">`<span class="subst">$&#123;path.resolve(<span class="string">&quot;dist&quot;</span>)&#125;</span>/manifest.json`</span></span><br><span class="line">  	&#125;,</span><br><span class="line">  	&#123;</span><br><span class="line">    	<span class="attr">from</span>: path.<span class="title function_">resolve</span>(<span class="string">&quot;src/assets&quot;</span>),</span><br><span class="line">    	<span class="attr">to</span>: path.<span class="title function_">resolve</span>(<span class="string">&quot;dist/assets&quot;</span>)</span><br><span class="line">  	&#125;,</span><br><span class="line">  	&#123;</span><br><span class="line">	    <span class="attr">from</span>: path.<span class="title function_">resolve</span>(<span class="string">&quot;src/plugins/inject.js&quot;</span>),</span><br><span class="line">	    <span class="attr">to</span>: path.<span class="title function_">resolve</span>(<span class="string">&quot;dist/js&quot;</span>)</span><br><span class="line">  	&#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 复制插件</span></span><br><span class="line"><span class="keyword">const</span> plugins = [</span><br><span class="line">  	<span class="keyword">new</span> <span class="title class_">CopyWebpackPlugin</span>(&#123;</span><br><span class="line">    	<span class="attr">patterns</span>: copyFiles</span><br><span class="line">  	&#125;)</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 页面文件</span></span><br><span class="line"><span class="keyword">const</span> pages = &#123;&#125;;</span><br><span class="line"><span class="comment">// 配置 popup.html 页面</span></span><br><span class="line"><span class="keyword">const</span> chromeName = [<span class="string">&quot;popup&quot;</span>];</span><br><span class="line"></span><br><span class="line">chromeName.<span class="title function_">forEach</span>(<span class="function"><span class="params">name</span> =&gt;</span> &#123;</span><br><span class="line">  	pages[name] = &#123;</span><br><span class="line">    	<span class="attr">entry</span>: <span class="string">`src/<span class="subst">$&#123;name&#125;</span>/main.js`</span>,</span><br><span class="line">    	<span class="attr">template</span>: <span class="string">`src/<span class="subst">$&#123;name&#125;</span>/index.html`</span>,</span><br><span class="line">    	<span class="attr">filename</span>: <span class="string">`<span class="subst">$&#123;name&#125;</span>.html`</span></span><br><span class="line">  	&#125;;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">	pages,</span><br><span class="line">	<span class="attr">productionSourceMap</span>: <span class="literal">false</span>,</span><br><span class="line">	<span class="comment">// 配置 content.js background.js</span></span><br><span class="line">	<span class="attr">configureWebpack</span>: &#123;</span><br><span class="line">		<span class="attr">entry</span>: &#123;</span><br><span class="line">			<span class="attr">content</span>: <span class="string">&quot;./src/content/main.js&quot;</span>,</span><br><span class="line">			<span class="attr">background</span>: <span class="string">&quot;./src/background/main.js&quot;</span></span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="attr">output</span>: &#123;</span><br><span class="line">			<span class="attr">filename</span>: <span class="string">&quot;js/[name].js&quot;</span></span><br><span class="line">		&#125;,</span><br><span class="line">		plugins</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="comment">// 配置 content.css</span></span><br><span class="line">	<span class="attr">css</span>: &#123;</span><br><span class="line">		<span class="attr">extract</span>: &#123;</span><br><span class="line">			<span class="attr">filename</span>: <span class="string">&quot;css/[name].css&quot;</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="3-解析："><a href="#3-解析：" class="headerlink" title="3. 解析："></a>3. 解析：</h4><ol>
<li><code>copyFiles</code> 是复制文件的字段</li>
<li><code>pages</code> 是配置多页面的文件字段</li>
<li><code>configureWebpack</code> 来配置 <code>content.js</code>、<code>background.js</code> 文件</li>
<li><code>css</code> 配置 <code>content.css</code> 文件</li>
</ol>
<h3 id="3、popup-文件夹修改"><a href="#3、popup-文件夹修改" class="headerlink" title="3、popup 文件夹修改"></a>3、<code>popup</code> 文件夹修改</h3><p>从上面的配置我们知道了，<code>popup</code> 文件夹是用来生成 <code>browser_action</code> 的 <code>popup.html</code> 文件的，所以此时我们来写入 <code>popup</code> 文件夹</p>
<h4 id="1-popup-index-html"><a href="#1-popup-index-html" class="headerlink" title="1. popup/index.html"></a>1. <code>popup/index.html</code></h4><p><code>popup</code> 文件夹下的 <code>index.html</code> 文件，因为这个是 <code>html</code> 文件，我们就只需要按照 <code>vue create</code> 生成的项目中的 <code>public</code> 文件夹下的 <code>index.html</code> 文件内容拷贝过来即可，顺便把 <code>favicon</code> 删除，把 <code>title</code> 修改下</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width,initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>my-vue-chrome-plugin<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">noscript</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">strong</span>&gt;</span>We&#x27;re sorry but &lt;%= htmlWebpackPlugin.options.title %&gt; doesn&#x27;t work properly without JavaScript enabled. Please enable it to continue.<span class="tag">&lt;/<span class="name">strong</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">noscript</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- built files will be auto injected --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="2-popup-main-js"><a href="#2-popup-main-js" class="headerlink" title="2. popup/main.js"></a>2. <code>popup/main.js</code></h4><p>这个是 <code>vue</code> 项目的入口配置文件，就按照 <code>src</code> 下面的 <code>main.js</code> 复制过来即可，别忘了改下 大小写</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> app <span class="keyword">from</span> <span class="string">&#x27;./components/app.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">createApp</span>(app).<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="3-popup-components-app-vue"><a href="#3-popup-components-app-vue" class="headerlink" title="3. popup/components/app.vue"></a>3. <code>popup/components/app.vue</code></h4><p>此文件就是正常的 <code>vue</code> 文件，按照平时写 <code>vue</code> 项目开发即可</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;popup_page&quot;</span>&gt;</span></span><br><span class="line">		this is popup page</span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;popup_page_main&quot;</span>&gt;</span></span><br><span class="line">			this is popup page main</span><br><span class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">	<span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">	&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="4、content-文件夹修改"><a href="#4、content-文件夹修改" class="headerlink" title="4、content 文件夹修改"></a>4、<code>content</code> 文件夹修改</h3><p><code>content</code> 文件夹下是对应 <code>chrome</code> 插件的 <code>content.js</code>，这个可以在嵌入页面里面渲染页面，我们也可以用 <code>vue</code> 开发</p>
<h4 id="1-content-components-app-vue"><a href="#1-content-components-app-vue" class="headerlink" title="1. content/components/app.vue"></a>1. <code>content/components/app.vue</code></h4><p>正常的 <code>vue</code> 开发</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content_page&quot;</span>&gt;</span></span><br><span class="line">		content_page</span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content_page_main&quot;</span>&gt;</span></span><br><span class="line">			content_page_main</span><br><span class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">	<span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">	&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="2-content-main-js"><a href="#2-content-main-js" class="headerlink" title="2. content/main.js"></a>2. <code>content/main.js</code></h4><p><code>main.js</code> 这个文件是<strong>比较重要</strong>的，是通过这个文件引入 <code>vue</code> 组件以及使用 <code>vue</code> 开发 <code>content</code> 页面的，所以这个页面，需要在插件嵌入的页面，增加一个 <code>dom</code> 元素，并把这个插件的 <code>content</code> 页面，渲染进去。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> app <span class="keyword">from</span> <span class="string">&#x27;./components/app.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">joinContent</span>(app)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">joinContent</span> (element) &#123;</span><br><span class="line">	<span class="keyword">const</span> div = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line">	div.<span class="property">id</span> = <span class="string">&#x27;joinContentApp&#x27;</span></span><br><span class="line">	<span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(div)</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(div)</span><br><span class="line">	<span class="title function_">createApp</span>(element).<span class="title function_">mount</span>(<span class="string">&#x27;#joinContentApp&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>解析：</strong></p>
<ol>
<li>引入 <code>vue3</code> 的 <code>createApp</code></li>
<li>引入 <code>app</code> 组件</li>
<li>创建一个 <code>id</code> 为 <code>joinContentApp</code> 的 <code>dom</code> 元素，把此元素插入 <code>body</code> 中，并把应用实例挂载到此 <code>dom</code> 上</li>
</ol>
<h3 id="5、background-文件夹"><a href="#5、background-文件夹" class="headerlink" title="5、background 文件夹"></a>5、<code>background</code> 文件夹</h3><p>此文件夹是对应的 <code>background.js</code> 文件，可以只写一个简单的日志打印即可</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;this is background main.js&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="6、yarn-run-build-打包"><a href="#6、yarn-run-build-打包" class="headerlink" title="6、yarn run build 打包"></a>6、<code>yarn run build</code> 打包</h3><p>此时，先进行 <code>run build</code> 打包，如果你报错了，是 <code>eslint</code> 报错，可以进行在 <code>.eslintrc.js</code> 文件中进行配置，添加一些我常用的 <code>eslint</code> 配置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">root</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">env</span>: &#123;</span><br><span class="line">    <span class="attr">node</span>: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">extends</span>: [</span><br><span class="line">    <span class="string">&#x27;plugin:vue/vue3-essential&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;@vue/standard&#x27;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">parserOptions</span>: &#123;</span><br><span class="line">    <span class="attr">parser</span>: <span class="string">&#x27;babel-eslint&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">rules</span>: &#123;</span><br><span class="line">    <span class="string">&quot;generator-star-spacing&quot;</span>: <span class="string">&quot;off&quot;</span>,</span><br><span class="line">    <span class="string">&quot;object-curly-spacing&quot;</span>: <span class="string">&quot;off&quot;</span>,</span><br><span class="line">    <span class="string">&quot;no-var&quot;</span>: <span class="string">&quot;error&quot;</span>,</span><br><span class="line">    <span class="string">&quot;semi&quot;</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">&quot;eol-last&quot;</span>: <span class="string">&quot;off&quot;</span>,</span><br><span class="line">    <span class="string">&quot;no-tabs&quot;</span>: <span class="string">&quot;off&quot;</span>,</span><br><span class="line">    <span class="string">&quot;indent&quot;</span>: <span class="string">&quot;off&quot;</span>,</span><br><span class="line">    <span class="string">&quot;quote-props&quot;</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">&quot;no-mixed-spaces-and-tabs&quot;</span>: <span class="string">&quot;off&quot;</span>,</span><br><span class="line">    <span class="string">&quot;no-trailing-spaces&quot;</span>: <span class="string">&quot;off&quot;</span>,</span><br><span class="line">    <span class="string">&quot;arrow-parens&quot;</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">&quot;spaced-comment&quot;</span>: <span class="string">&quot;off&quot;</span>,</span><br><span class="line">    <span class="string">&quot;space-before-function-paren&quot;</span>: <span class="string">&quot;off&quot;</span>,</span><br><span class="line">    <span class="string">&quot;no-empty&quot;</span>: <span class="string">&quot;off&quot;</span>,</span><br><span class="line">    <span class="string">&quot;no-else-return&quot;</span>: <span class="string">&quot;off&quot;</span>,</span><br><span class="line">    <span class="string">&quot;no-unused-vars&quot;</span>: [<span class="number">2</span>, &#123;<span class="string">&quot;vars&quot;</span>: <span class="string">&quot;all&quot;</span>, <span class="string">&quot;args&quot;</span>: <span class="string">&quot;after-used&quot;</span>&#125;],</span><br><span class="line">    <span class="string">&quot;no-console&quot;</span>: <span class="string">&quot;off&quot;</span>,</span><br><span class="line">    <span class="string">&#x27;no-debugger&#x27;</span>: process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;production&#x27;</span> ? <span class="string">&#x27;warn&#x27;</span> : <span class="string">&#x27;off&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后在进行打包</p>
<p>此时的文件内容</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── README.md</span><br><span class="line">├── babel.config.js</span><br><span class="line">├── dist</span><br><span class="line">│   ├── assets</span><br><span class="line">│   │   ├── images</span><br><span class="line">│   │   │   ├── icon128.png</span><br><span class="line">│   │   │   ├── icon16.png</span><br><span class="line">│   │   │   └── icon48.png</span><br><span class="line">│   │   └── logo.png</span><br><span class="line">│   ├── js</span><br><span class="line">│   │   ├── background.js</span><br><span class="line">│   │   ├── chunk-vendors.fa86ccee.js</span><br><span class="line">│   │   ├── content.js</span><br><span class="line">│   │   ├── inject.js</span><br><span class="line">│   │   └── popup.js</span><br><span class="line">│   ├── manifest.json</span><br><span class="line">│   └── popup.html</span><br><span class="line">├── package.json</span><br><span class="line">├── src</span><br><span class="line">│   ├── assets</span><br><span class="line">│   │   ├── images</span><br><span class="line">│   │   │   ├── icon128.png</span><br><span class="line">│   │   │   ├── icon16.png</span><br><span class="line">│   │   │   └── icon48.png</span><br><span class="line">│   │   └── logo.png</span><br><span class="line">│   ├── background</span><br><span class="line">│   │   └── main.js</span><br><span class="line">│   ├── content</span><br><span class="line">│   │   ├── components</span><br><span class="line">│   │   │   └── app.vue</span><br><span class="line">│   │   └── main.js</span><br><span class="line">│   ├── main.js</span><br><span class="line">│   ├── plugins</span><br><span class="line">│   │   ├── inject.js</span><br><span class="line">│   │   └── manifest.json</span><br><span class="line">│   ├── popup</span><br><span class="line">│   │   ├── components</span><br><span class="line">│   │   │   └── app.vue</span><br><span class="line">│   │   ├── index.html</span><br><span class="line">│   │   └── main.js</span><br><span class="line">│   └── utils</span><br><span class="line">├── vue.config.js</span><br><span class="line">└── yarn.lock</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>此时我们可以看到 <code>dist</code> 文件夹下已经按照我们需要的内容进行打包了，但是没有 <code>css</code> 文件夹那是因为我们没有写入 <code>css</code></p>
<h3 id="7、引入-less"><a href="#7、引入-less" class="headerlink" title="7、引入 less"></a>7、引入 <code>less</code></h3><p>我们写页面少不了使用 <code>css</code>，现在都是使用预处理器，我比较倾向于 <code>less</code>，所以我使用 <code>less、less-loader</code></p>
<h4 id="1-引入-less-less-loader"><a href="#1-引入-less-less-loader" class="headerlink" title="1. 引入 less less-loader"></a>1. 引入 <code>less less-loader</code></h4><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yarn add less less-loader --dev</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="2-修改-app-vue-文件"><a href="#2-修改-app-vue-文件" class="headerlink" title="2. 修改 app.vue 文件"></a>2. 修改 <code>app.vue</code> 文件</h4><p>然后我们在 <code>content/components/app.vue</code> 和 <code>popup/components/app.vue</code> 文件中写入 <code>css</code> 样式</p>
<p><strong><code>content/components/app.vue</code></strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content_page&quot;</span>&gt;</span></span><br><span class="line">		content_page</span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content_page_main&quot;</span>&gt;</span></span><br><span class="line">			content_page_main</span><br><span class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">	<span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">	&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">&quot;less&quot;</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">	<span class="selector-class">.content_page</span>&#123;</span></span><br><span class="line"><span class="language-css">		<span class="attribute">color</span>: red;</span></span><br><span class="line"><span class="language-css">		<span class="attribute">position</span>: fixed;</span></span><br><span class="line"><span class="language-css">		<span class="attribute">z-index</span>: <span class="number">100001</span>;</span></span><br><span class="line"><span class="language-css">		<span class="attribute">right</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">		<span class="attribute">bottom</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">		<span class="selector-class">.content_page_main</span>&#123;</span></span><br><span class="line"><span class="language-css">			<span class="attribute">color</span>: green;</span></span><br><span class="line"><span class="language-css">		&#125;</span></span><br><span class="line"><span class="language-css">	&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><code>popup/components/app.vue</code></strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;popup_page&quot;</span>&gt;</span></span><br><span class="line">		this is popup page</span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;popup_page_main&quot;</span>&gt;</span></span><br><span class="line">			this is popup page main</span><br><span class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">	<span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">	&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">&quot;less&quot;</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">	<span class="selector-class">.popup_page</span>&#123;</span></span><br><span class="line"><span class="language-css">		<span class="attribute">color</span>: red;</span></span><br><span class="line"><span class="language-css">		<span class="selector-class">.popup_page_main</span>&#123;</span></span><br><span class="line"><span class="language-css">			<span class="attribute">color</span>: green;</span></span><br><span class="line"><span class="language-css">		&#125;</span></span><br><span class="line"><span class="language-css">	&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="3-yarn-run-build-打包"><a href="#3-yarn-run-build-打包" class="headerlink" title="3. yarn run build 打包"></a>3. <code>yarn run build</code> 打包</h4><p>此时 <code>tree dist</code> 查看 <code>dist</code> 文件夹内容</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">dist</span><br><span class="line">├── assets</span><br><span class="line">│   ├── images</span><br><span class="line">│   │   ├── icon128.png</span><br><span class="line">│   │   ├── icon16.png</span><br><span class="line">│   │   └── icon48.png</span><br><span class="line">│   └── logo.png</span><br><span class="line">├── css</span><br><span class="line">│   ├── content.css</span><br><span class="line">│   └── popup.css</span><br><span class="line">├── js</span><br><span class="line">│   ├── background.js</span><br><span class="line">│   ├── chunk-vendors.4f73d0d4.js</span><br><span class="line">│   ├── content.js</span><br><span class="line">│   ├── inject.js</span><br><span class="line">│   └── popup.js</span><br><span class="line">├── manifest.json</span><br><span class="line">└── popup.html</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>我们可以看到，我们通过 <code>vue.config.js</code> 文件配置的内容都已经生成到 <code>dist</code> 文件夹中了</p>
<h2 id="四、导入插件项目"><a href="#四、导入插件项目" class="headerlink" title="四、导入插件项目"></a>四、导入插件项目</h2><h3 id="1、在谷歌拓展程序中打开我们的插件"><a href="#1、在谷歌拓展程序中打开我们的插件" class="headerlink" title="1、在谷歌拓展程序中打开我们的插件"></a>1、在谷歌拓展程序中打开我们的插件</h3><p>点击 <strong>加载已解压的拓展程序</strong>，选择我们的 <code>dist</code> 文件夹，此时我们的插件就被引入进来了</p>
<p>![插件](15000字大章带你一步一步使用Vue3开发chrome浏览器插件  掘金年度征文.image&#x2F;7d9444b4f858469b9c9c62fcb6d52b77tplv-k3u1fbpfcp-watermark.awebp)</p>
<h3 id="2、打开-淘宝首页"><a href="#2、打开-淘宝首页" class="headerlink" title="2、打开 淘宝首页"></a>2、打开 <a href="https://link.juejin.cn/?target=https://www.taobao.com/">淘宝首页</a></h3><h4 id="1-为什么打开淘宝首页呢？"><a href="#1-为什么打开淘宝首页呢？" class="headerlink" title="1. 为什么打开淘宝首页呢？"></a>1. 为什么打开淘宝首页呢？</h4><p>因为我们在 <code>manifest.json</code> 中的 <code>content_scripts</code> 中配置 <code>&quot;matches&quot;: [&quot;https://*.taobao.com/*&quot;]</code></p>
<h4 id="2-点击右上角的插件-icon"><a href="#2-点击右上角的插件-icon" class="headerlink" title="2. 点击右上角的插件 icon"></a>2. 点击右上角的插件 <code>icon</code></h4><p>![popup](15000字大章带你一步一步使用Vue3开发chrome浏览器插件  掘金年度征文.image&#x2F;1803339a7dd9420582a654e4ddb75c93tplv-k3u1fbpfcp-watermark.awebp) </p>
<p>我们可以看到我们的 <code>popup</code> 页面已经我们给它写的样式</p>
<h3 id="3、我们的-content-文件呢？"><a href="#3、我们的-content-文件呢？" class="headerlink" title="3、我们的 content 文件呢？"></a>3、我们的 <code>content</code> 文件呢？</h3><p>我们在 <code>content</code> 文件中配置的 <code>main.js</code> 和 <code>app.vue</code> 也写入了样式，也挂载到 <code>dom</code> 实例上了，但是为什么没有渲染，也没有打印</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">joinContent</span> (element) &#123;</span><br><span class="line">	<span class="keyword">const</span> div = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line">	div.<span class="property">id</span> = <span class="string">&#x27;joinContentApp&#x27;</span></span><br><span class="line">	<span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(div)</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(div)</span><br><span class="line">	<span class="title function_">createApp</span>(element).<span class="title function_">mount</span>(<span class="string">&#x27;#joinContentApp&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>我们在 <code>js</code> 文件中有个 <code>console.log</code> 日志输入，但是可以看到淘宝页面的控制台并没有输入</p>
<h4 id="1-为什么没有输出"><a href="#1-为什么没有输出" class="headerlink" title="1. 为什么没有输出"></a>1. 为什么没有输出</h4><p>因为我们是用的 <code>vue</code> 开发项目，在 <code>main.js</code> 中是用的 <code>vue</code> 开发，所以我们得引入 <code>vue</code> 文件，得在 <code>content</code> 中引入 <code>vue</code> 才可以</p>
<h4 id="2-解决方法，引入-vue"><a href="#2-解决方法，引入-vue" class="headerlink" title="2. 解决方法，引入 vue"></a>2. 解决方法，引入 <code>vue</code></h4><p>我们可以看到 <code>dist</code> 文件夹下面有一个 <code>chunk-vendors.4f73d0d4.js</code>，这个就是 <code>vue</code> 打包之后的文件，我们先在 <code>dist</code> 中的 <code>manifest.json</code> 文件先把它引入进来先看下</p>
<p><code>dist/manifest.json</code> 文件下的 <code>content_scripts</code> 字段</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;content_scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">	<span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;matches&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;https://*.taobao.com/*&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;css&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;css/content.css&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;js&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;js/chunk-vendors.4f73d0d4.js&quot;</span><span class="punctuation">,</span> <span class="string">&quot;js/content.js&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;run_at&quot;</span><span class="punctuation">:</span> <span class="string">&quot;document_idle&quot;</span></span><br><span class="line">	<span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>此时，拓展程序页面刷新插件，并刷新淘宝首页，可以看到</p>
<p>![控制台输出](15000字大章带你一步一步使用Vue3开发chrome浏览器插件  掘金年度征文.image&#x2F;c4fd576ab93b4aac94c9d1de8735f3aftplv-k3u1fbpfcp-watermark.awebp) <img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e4abe3c0af21485dac45dbf10a770e14~tplv-k3u1fbpfcp-watermark.awebp" alt="content"> </p>
<p>此时可以看到我们的 <code>content</code> 文件已经输出了。</p>
<h3 id="4、background-js-文件"><a href="#4、background-js-文件" class="headerlink" title="4、background.js 文件"></a>4、<code>background.js</code> 文件</h3><p>还记得我们在 <code>background</code> 文件夹下中的 <code>main.js</code> 写入日志输出吗？</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;this is background main.js&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>我们打开拓展程序，找到我们的插件，点击 <strong>背景页</strong> 按钮</p>
<p>![在这里插入图片描述](15000字大章带你一步一步使用Vue3开发chrome浏览器插件  掘金年度征文.image&#x2F;62c2dcefa41b4933967355d8dc38d6fatplv-k3u1fbpfcp-watermark.awebp) </p>
<p>此时，背景页的控制台就出来，我们可以看到我们的日志输出，好像并没有输出我们的日志？？？</p>
<h4 id="1-原因"><a href="#1-原因" class="headerlink" title="1. 原因"></a>1. 原因</h4><p>此问题的原因和上面的 <code>content</code> 文件的原因是一致的，也是没有引入 <code>vue</code> 文件</p>
<h4 id="2-解决，引入-vue"><a href="#2-解决，引入-vue" class="headerlink" title="2. 解决，引入 vue"></a>2. 解决，引入 <code>vue</code></h4><p><code>dist/manifest.json</code> 中 <code>background</code> 字段</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;background&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;js/chunk-vendors.4f73d0d4.js&quot;</span><span class="punctuation">,</span> <span class="string">&quot;js/background.js&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>此时，刷新插件，可以看到日志输出 </p>
<p>![background日志输出](15000字大章带你一步一步使用Vue3开发chrome浏览器插件  掘金年度征文.image&#x2F;82f92426d33d4d40a6dd5d073a5204b2tplv-k3u1fbpfcp-watermark.awebp)</p>
<h3 id="5、引入-inject-文件"><a href="#5、引入-inject-文件" class="headerlink" title="5、引入 inject 文件"></a>5、引入 <code>inject</code> 文件</h3><h4 id="1-首先我们在-plugins-inject-js-文件中输出日志"><a href="#1-首先我们在-plugins-inject-js-文件中输出日志" class="headerlink" title="1. 首先我们在 plugins/inject.js 文件中输出日志"></a>1. 首先我们在 <code>plugins/inject.js</code> 文件中输出日志</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;this is my inject.js&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="2-然后在-content-main-js-文件中引入-inject-js"><a href="#2-然后在-content-main-js-文件中引入-inject-js" class="headerlink" title="2. 然后在 content/main.js 文件中引入 inject.js"></a>2. 然后在 <code>content/main.js</code> 文件中引入 <code>inject.js</code></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> app <span class="keyword">from</span> <span class="string">&#x27;./components/app.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">joinContent</span>(app)</span><br><span class="line"><span class="title function_">injectJsInsert</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">joinContent</span> (element) &#123;</span><br><span class="line">	<span class="keyword">const</span> div = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line">	div.<span class="property">id</span> = <span class="string">&#x27;joinContentApp&#x27;</span></span><br><span class="line">	<span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(div)</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(div)</span><br><span class="line">	<span class="title function_">createApp</span>(element).<span class="title function_">mount</span>(<span class="string">&#x27;#joinContentApp&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">injectJsInsert</span> () &#123;</span><br><span class="line">	<span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;readystatechange&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">		<span class="keyword">const</span> injectPath = <span class="string">&#x27;js/inject.js&#x27;</span></span><br><span class="line">		<span class="keyword">const</span> script = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;script&#x27;</span>)</span><br><span class="line"></span><br><span class="line">		script.<span class="title function_">setAttribute</span>(<span class="string">&#x27;type&#x27;</span>, <span class="string">&#x27;text/javascript&#x27;</span>)</span><br><span class="line">		script.<span class="property">src</span> = chrome.<span class="property">extension</span>.<span class="title function_">getURL</span>(injectPath)</span><br><span class="line">		<span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(script)</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="3-yarn-run-build-打包-1"><a href="#3-yarn-run-build-打包-1" class="headerlink" title="3. yarn run build 打包"></a>3. <code>yarn run build</code> 打包</h4><p>此时打包可以发现报错了</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">yarn run v1.<span class="number">22.10</span></span><br><span class="line"><span class="variable">$</span> vue<span class="literal">-cli-service</span> build</span><br><span class="line"></span><br><span class="line">⠼  Building <span class="keyword">for</span> production...</span><br><span class="line"></span><br><span class="line"> ERROR  Failed to compile with <span class="number">1</span> error                              上午<span class="number">11</span>:<span class="number">12</span>:<span class="number">48</span></span><br><span class="line"></span><br><span class="line"> error  <span class="keyword">in</span> ./src/content/main.js</span><br><span class="line"></span><br><span class="line">Module Error (from ./node_modules/th<span class="built_in">read-loader</span>/dist/cjs.js):</span><br><span class="line"></span><br><span class="line">/Users/guoqiankun/work/chromePlugin/my<span class="literal">-vue3-plugin</span>/src/content/main.js</span><br><span class="line">  <span class="number">21</span>:<span class="number">16</span>  error  <span class="string">&#x27;chrome&#x27;</span> is not defined  no<span class="literal">-undef</span></span><br><span class="line"></span><br><span class="line">✖ <span class="number">1</span> problem (<span class="number">1</span> error, <span class="number">0</span> warnings)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> ERROR  Build failed with errors.</span><br><span class="line">error Command failed with <span class="keyword">exit</span> code <span class="number">1</span>.</span><br><span class="line">info Visit https://yarnpkg.com/en/docs/<span class="built_in">cli</span>/run <span class="keyword">for</span> documentation about this command.</span><br><span class="line"></span><br><span class="line">error <span class="string">&#x27;chrome&#x27;</span> is not defined no<span class="literal">-undef</span></span><br></pre></td></tr></table></figure>

<p>我们在上面插入 <code>jnject</code> 文件使用的 <code>chrome</code> 未定义，那我们就定义一下；</p>
<h4 id="4-修改-eslintrc-js-文件"><a href="#4-修改-eslintrc-js-文件" class="headerlink" title="4. 修改 .eslintrc.js 文件"></a>4. 修改 <code>.eslintrc.js</code> 文件</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">root</span>: <span class="literal">true</span>,</span><br><span class="line"><span class="attr">globals</span>: &#123;</span><br><span class="line">  <span class="attr">chrome</span>: <span class="literal">true</span>,</span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">env</span>: &#123;</span><br><span class="line">  <span class="attr">node</span>: <span class="literal">true</span></span><br><span class="line">&#125;,</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>增加一个 <code>globals</code> 字段，里面 <code>chrome: true</code></p>
<p>然后在进行 <code>yarn run build</code> 打包</p>
<p>然后我们可以看到 <code>dist/manifest.json</code> 文件中的 <code>content_scripts</code> 和 <code>background/scripts</code> 已经没有引入 <code>vue</code> 了，所以我们不能在 <code>dist</code> 文件夹中修改，我们要在 <code>plugins/manifest.json</code> 文件中修改</p>
<p>但是我们可以看到，我们每次打包生成的 <code>chunk-vendors.js</code> 会跟一个 <code>hash</code>，因为我们此时没有修改别的文件，所以 <code>hash</code> 后缀没有变化，但是如果我们改了内容之后在 <code>yarn run build</code> 呢？此时 <code>hash</code> 就会变化，总不能在改一次 <code>manifest.json</code> 再打一次包吧…</p>
<h3 id="6、修改-vue-config-js-文件，让打包时生成的-chunk-vendors-js-不带-hash"><a href="#6、修改-vue-config-js-文件，让打包时生成的-chunk-vendors-js-不带-hash" class="headerlink" title="6、修改 vue.config.js 文件，让打包时生成的 chunk-vendors.js 不带 hash"></a>6、修改 <code>vue.config.js</code> 文件，让打包时生成的 <code>chunk-vendors.js</code> 不带 <code>hash</code></h3><h4 id="1-配置-chainWebpack-字段"><a href="#1-配置-chainWebpack-字段" class="headerlink" title="1. 配置 chainWebpack 字段"></a>1. 配置 <code>chainWebpack</code> 字段</h4><p>配置 <code>chainWebpack</code> 字段，对 <code>config</code> 内容进行处理</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">	pages,</span><br><span class="line">	<span class="attr">productionSourceMap</span>: <span class="literal">false</span>,</span><br><span class="line">	<span class="comment">// 配置 content.js background.js</span></span><br><span class="line">	<span class="attr">configureWebpack</span>: &#123;</span><br><span class="line">		<span class="attr">entry</span>: &#123;</span><br><span class="line">			<span class="attr">content</span>: <span class="string">&quot;./src/content/main.js&quot;</span>,</span><br><span class="line">			<span class="attr">background</span>: <span class="string">&quot;./src/background/main.js&quot;</span></span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="attr">output</span>: &#123;</span><br><span class="line">			<span class="attr">filename</span>: <span class="string">&quot;js/[name].js&quot;</span></span><br><span class="line">		&#125;,</span><br><span class="line">		plugins</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="comment">// 配置 content.css</span></span><br><span class="line">	<span class="attr">css</span>: &#123;</span><br><span class="line">		<span class="attr">extract</span>: &#123;</span><br><span class="line">			<span class="attr">filename</span>: <span class="string">&quot;css/[name].css&quot;</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">chainWebpack</span>: <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;production&#x27;</span>) &#123;</span><br><span class="line">			config.<span class="property">output</span>.<span class="title function_">filename</span>(<span class="string">&#x27;js/[name].js&#x27;</span>).<span class="title function_">end</span>()</span><br><span class="line">			config.<span class="property">output</span>.<span class="title function_">chunkFilename</span>(<span class="string">&#x27;js/[name].js&#x27;</span>).<span class="title function_">end</span>()</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="2-修改-plugin-manifest-json-文件"><a href="#2-修改-plugin-manifest-json-文件" class="headerlink" title="2. 修改 plugin/manifest.json 文件"></a>2. 修改 <code>plugin/manifest.json</code> 文件</h4><p>在此文件中引入 <code>chunk-vendors.js</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">plugin/manifest.json</span><br><span class="line">&quot;background&quot;: &#123;</span><br><span class="line">	&quot;scripts&quot;: [&quot;js/chunk-vendors.js&quot;, &quot;js/background.js&quot;]</span><br><span class="line">&#125;,</span><br><span class="line">&quot;icons&quot;: &#123;</span><br><span class="line">	&quot;16&quot;: &quot;assets/images/icon16.png&quot;,</span><br><span class="line">	&quot;48&quot;: &quot;assets/images/icon48.png&quot;,</span><br><span class="line">	&quot;128&quot;: &quot;assets/images/icon128.png&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&quot;content_scripts&quot;: [</span><br><span class="line">	&#123;</span><br><span class="line">		&quot;matches&quot;: [&quot;https://*.taobao.com/*&quot;],</span><br><span class="line">		&quot;css&quot;: [&quot;css/content.css&quot;],</span><br><span class="line">		&quot;js&quot;: [&quot;js/chunk-vendors.js&quot;, &quot;js/content.js&quot;],</span><br><span class="line">		&quot;run_at&quot;: &quot;document_idle&quot;</span><br><span class="line">	&#125;</span><br><span class="line">],</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="3-yarn-run-build-打包-2"><a href="#3-yarn-run-build-打包-2" class="headerlink" title="3. yarn run build 打包"></a>3. <code>yarn run build</code> 打包</h4><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">dist</span><br><span class="line">├── assets</span><br><span class="line">│   ├── images</span><br><span class="line">│   │   ├── icon128.png</span><br><span class="line">│   │   ├── icon16.png</span><br><span class="line">│   │   └── icon48.png</span><br><span class="line">│   └── logo.png</span><br><span class="line">├── css</span><br><span class="line">│   ├── content.css</span><br><span class="line">│   └── popup.css</span><br><span class="line">├── js</span><br><span class="line">│   ├── background.js</span><br><span class="line">│   ├── chunk-vendors.js</span><br><span class="line">│   ├── content.js</span><br><span class="line">│   ├── inject.js</span><br><span class="line">│   └── popup.js</span><br><span class="line">├── manifest.json</span><br><span class="line">└── popup.html</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="4-刷新插件，刷新页面"><a href="#4-刷新插件，刷新页面" class="headerlink" title="4. 刷新插件，刷新页面"></a>4. 刷新插件，刷新页面</h4><p>属性插件，刷新页面，之后可以看到 </p>
<p>![console](15000字大章带你一步一步使用Vue3开发chrome浏览器插件  掘金年度征文.image&#x2F;7b145c39c6514f8a8e56ab5c5653e513tplv-k3u1fbpfcp-watermark.awebp) </p>
<p>![inject.js](15000字大章带你一步一步使用Vue3开发chrome浏览器插件  掘金年度征文.image&#x2F;8c87698ecb7244939db5a38fa50b5a17tplv-k3u1fbpfcp-watermark.awebp)</p>
<h2 id="五、热加载"><a href="#五、热加载" class="headerlink" title="五、热加载"></a>五、热加载</h2><p>此时我们的 <code>vue</code> 开发插件项目已经基本上可以了，剩下的就是按照需求开发插件页面，按照需求添加 <code>manifest.json</code> 字段即可，但是我们不能每一次想看样式就打个包，然后属性插件，刷新页面看下，这样也可以，但是我们是开发，这样效率比较低，我不服…</p>
<p><strong>所以我们需要添加一下热加载</strong></p>
<h3 id="1、热加载"><a href="#1、热加载" class="headerlink" title="1、热加载"></a>1、热加载</h3><p>在 <code>utils</code> 文件夹下创建 <code>hotReload.js</code> 文件</p>
<p>写入</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 加载文件</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">filesInDirectory</span> = dir =&gt;</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span></span><br><span class="line">    dir.<span class="title function_">createReader</span>().<span class="title function_">readEntries</span>(<span class="function"><span class="params">entries</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="title class_">Promise</span>.<span class="title function_">all</span>(</span><br><span class="line">          entries</span><br><span class="line">          .<span class="title function_">filter</span>(<span class="function"><span class="params">e</span> =&gt;</span> e.<span class="property">name</span>[<span class="number">0</span>] !== <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">          .<span class="title function_">map</span>(<span class="function"><span class="params">e</span> =&gt;</span></span><br><span class="line">            e.<span class="property">isDirectory</span> ? <span class="title function_">filesInDirectory</span>(e) : <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> e.<span class="title function_">file</span>(resolve))</span><br><span class="line">          )</span><br><span class="line">        )</span><br><span class="line">        .<span class="title function_">then</span>(<span class="function"><span class="params">files</span> =&gt;</span> [].<span class="title function_">concat</span>(...files))</span><br><span class="line">        .<span class="title function_">then</span>(resolve);</span><br><span class="line">    &#125;)</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遍历插件目录，读取文件信息，组合文件名称和修改时间成数据</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">timestampForFilesInDirectory</span> = dir =&gt;</span><br><span class="line">  <span class="title function_">filesInDirectory</span>(dir).<span class="title function_">then</span>(<span class="function"><span class="params">files</span> =&gt;</span></span><br><span class="line">    files.<span class="title function_">map</span>(<span class="function"><span class="params">f</span> =&gt;</span> f.<span class="property">name</span> + f.<span class="property">lastModifiedDate</span>).<span class="title function_">join</span>()</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line"><span class="comment">// 刷新当前活动页</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">reload</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">window</span>.<span class="property">chrome</span>.<span class="property">tabs</span>.<span class="title function_">query</span>(&#123;</span><br><span class="line">      <span class="attr">active</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">currentWindow</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="params">tabs</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// NB: see https://github.com/xpl/crx-hotreload/issues/5</span></span><br><span class="line">      <span class="keyword">if</span> (tabs[<span class="number">0</span>]) &#123;</span><br><span class="line">        <span class="variable language_">window</span>.<span class="property">chrome</span>.<span class="property">tabs</span>.<span class="title function_">reload</span>(tabs[<span class="number">0</span>].<span class="property">id</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 强制刷新页面</span></span><br><span class="line">      <span class="variable language_">window</span>.<span class="property">chrome</span>.<span class="property">runtime</span>.<span class="title function_">reload</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 观察文件改动</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">watchChanges</span> = (<span class="params">dir, lastTimestamp</span>) =&gt; &#123;</span><br><span class="line">  <span class="title function_">timestampForFilesInDirectory</span>(dir).<span class="title function_">then</span>(<span class="function"><span class="params">timestamp</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 文件没有改动则循环监听watchChanges方法</span></span><br><span class="line">    <span class="keyword">if</span> (!lastTimestamp || lastTimestamp === timestamp) &#123;</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">watchChanges</span>(dir, timestamp), <span class="number">1000</span>); <span class="comment">// retry after 1s</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 强制刷新页面</span></span><br><span class="line">      <span class="title function_">reload</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">hotReload</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">window</span>.<span class="property">chrome</span>.<span class="property">management</span>.<span class="title function_">getSelf</span>(<span class="function"><span class="params">self</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (self.<span class="property">installType</span> === <span class="string">&#x27;development&#x27;</span>) &#123;</span><br><span class="line">      <span class="comment">// 获取插件目录，监听文件变化</span></span><br><span class="line">      <span class="variable language_">window</span>.<span class="property">chrome</span>.<span class="property">runtime</span>.<span class="title function_">getPackageDirectoryEntry</span>(<span class="function"><span class="params">dir</span> =&gt;</span> <span class="title function_">watchChanges</span>(dir));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> hotReload;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="2、引入"><a href="#2、引入" class="headerlink" title="2、引入"></a>2、引入</h3><p>在 <code>bckground/main.js</code> 中 引入</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hotReload <span class="keyword">from</span> <span class="string">&#x27;@/utils/hotReload&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">hotReload</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;this is background main.js&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="3、修改-package-json-中的-scripts"><a href="#3、修改-package-json-中的-scripts" class="headerlink" title="3、修改 package.json 中的 scripts"></a>3、修改 <code>package.json</code> 中的 <code>scripts</code></h3><h4 id="1-增加一个-watch-用来监听打包"><a href="#1-增加一个-watch-用来监听打包" class="headerlink" title="1. 增加一个 watch 用来监听打包"></a>1. 增加一个 <code>watch</code> 用来监听打包</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;watch&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vue-cli-service build --watch&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;serve&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vue-cli-service serve&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vue-cli-service build&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;lint&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vue-cli-service lint&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="2-此时运行-yarn-run-watch"><a href="#2-此时运行-yarn-run-watch" class="headerlink" title="2. 此时运行 yarn run watch"></a>2. 此时运行 <code>yarn run watch</code></h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">yarn run v1.<span class="number">22.10</span></span><br><span class="line"><span class="variable">$</span> vue<span class="literal">-cli-service</span> build <span class="literal">--watch</span></span><br><span class="line"></span><br><span class="line">⠙  Building <span class="keyword">for</span> development...</span><br><span class="line"></span><br><span class="line"> DONE  Compiled successfully <span class="keyword">in</span> <span class="number">3956</span>ms                                           上午<span class="number">11</span>:<span class="number">39</span>:<span class="number">00</span></span><br><span class="line"></span><br><span class="line">  File                        Size                          Gzipped</span><br><span class="line"></span><br><span class="line">  dist/js/chunk<span class="literal">-vendors</span>.js    <span class="number">668.79</span> KiB                    <span class="number">122.48</span> KiB</span><br><span class="line">  dist/js/content.js          <span class="number">26.47</span> KiB                     <span class="number">3.71</span> KiB</span><br><span class="line">  dist/js/popup.js            <span class="number">26.23</span> KiB                     <span class="number">3.55</span> KiB</span><br><span class="line">  dist/js/background.js       <span class="number">15.57</span> KiB                     <span class="number">3.30</span> KiB</span><br><span class="line">  dist/js/inject.js           <span class="number">0.04</span> KiB                      <span class="number">0.05</span> KiB</span><br><span class="line">  dist/css/content.css        <span class="number">0.18</span> KiB                      <span class="number">0.14</span> KiB</span><br><span class="line">  dist/css/popup.css          <span class="number">0.11</span> KiB                      <span class="number">0.09</span> KiB</span><br><span class="line"></span><br><span class="line">  Images and other types of assets omitted.</span><br><span class="line"></span><br><span class="line"> DONE  Build complete. Watching <span class="keyword">for</span> changes...</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>可以看到一直在监听改变</p>
<h4 id="3-然后我们刷新插件和页面"><a href="#3-然后我们刷新插件和页面" class="headerlink" title="3. 然后我们刷新插件和页面"></a>3. 然后我们刷新插件和页面</h4><p>发现有一个报错</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Uncaught EvalError: Refused to evaluate a string as JavaScript because <span class="string">&#x27;unsafe-eval&#x27;</span> is not an allowed source of script <span class="keyword">in</span> the following Content Security Policy directive: <span class="string">&quot;script-src &#x27;self&#x27; blob: filesystem:&quot;</span>.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>![报错](15000字大章带你一步一步使用Vue3开发chrome浏览器插件  掘金年度征文.image&#x2F;07f43ebfa4dc4034b8d55b97b38d89edtplv-k3u1fbpfcp-watermark.awebp)</p>
<h4 id="4-按照错误解决问题："><a href="#4-按照错误解决问题：" class="headerlink" title="4. 按照错误解决问题："></a>4. 按照错误解决问题：</h4><p>在 <code>plugins/manifest.json</code> 中添加：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;content_security_policy&quot;</span><span class="punctuation">:</span> <span class="string">&quot;script-src &#x27;self&#x27; &#x27;unsafe-eval&#x27;; object-src &#x27;self&#x27;&quot;</span><span class="punctuation">,</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="5-重新运行-yarn-run-bild"><a href="#5-重新运行-yarn-run-bild" class="headerlink" title="5. 重新运行 yarn run bild"></a>5. 重新运行 <code>yarn run bild</code></h4><h4 id="6-清除插件错误、刷新插件、淘宝页面"><a href="#6-清除插件错误、刷新插件、淘宝页面" class="headerlink" title="6. 清除插件错误、刷新插件、淘宝页面"></a>6. 清除插件错误、刷新插件、淘宝页面</h4><h3 id="4、修改-content-components-app-vue-文件"><a href="#4、修改-content-components-app-vue-文件" class="headerlink" title="4、修改 content/components/app.vue 文件"></a>4、修改 <code>content/components/app.vue</code> 文件</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content_page&quot;</span>&gt;</span></span><br><span class="line">		content_page</span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content_page_main&quot;</span>&gt;</span></span><br><span class="line">			content_page_main</span><br><span class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content_page_footer&quot;</span>&gt;</span></span><br><span class="line">			content_page_footer</span><br><span class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>保存</p>
<p>然后发现插件自动刷新、浏览器页面自动刷新。</p>
<p>此时浏览器页面右下角我们新加的内容就展示在上面了。 </p>
<p>![在这里插入图片描述](15000字大章带你一步一步使用Vue3开发chrome浏览器插件  掘金年度征文.image&#x2F;5abb076de80e4444881116188bcf21f3tplv-k3u1fbpfcp-watermark.awebp)</p>
<h2 id="六、总结"><a href="#六、总结" class="headerlink" title="六、总结"></a>六、总结</h2><ol>
<li>使用 <code>vue</code> 开发插件，要先想一下我们要做成什么样</li>
<li>针对性的修改对应的文件，按照我们的需求去配置</li>
<li>遇到问题先想一下哪一步的问题，为什么出现，可以自己先想想，最后在寻求帮助</li>
<li>完结🎉🎉🎉</li>
</ol>
<h2 id="七、源码地址"><a href="#七、源码地址" class="headerlink" title="七、源码地址"></a>七、源码地址</h2><p><a href="https://link.juejin.cn/?target=https://github.com/18055975947/my-vue3-plugin">github地址：https://github.com/18055975947/my-vue3-plugin</a></p>
<p><a href="https://link.juejin.cn/?target=https://gitee.com/guoqiankun/my-vue3-plugin">码云地址：https://gitee.com/guoqiankun/my-vue3-plugin</a></p>
<h5 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h5><ul>
<li><a href="https://link.juejin.cn/?target=https://vue3js.cn/docs/zh/api/">vue3 API</a></li>
<li><a href="https://link.juejin.cn/?target=https://cli.vuejs.org/zh/config">vue-cli配置</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://mindcons.cn/2022/07/19/web/%E4%B8%93%E6%A0%8F/Chrome%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/15000%E5%AD%97%E5%A4%A7%E7%AB%A0%E5%B8%A6%E4%BD%A0%E4%B8%80%E6%AD%A5%E4%B8%80%E6%AD%A5%E4%BD%BF%E7%94%A8Vue3%E5%BC%80%E5%8F%91chrome%E6%B5%8F%E8%A7%88%E5%99%A8%E6%8F%92%E4%BB%B6%20%20%E6%8E%98%E9%87%91%E5%B9%B4%E5%BA%A6%E5%BE%81%E6%96%87/" data-id="cldolkc5m003mfgx63pdh78iz" data-title="工程化开发crx" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-web/专栏/Chrome插件开发/crx学习" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/07/19/web/%E4%B8%93%E6%A0%8F/Chrome%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/crx%E5%AD%A6%E4%B9%A0/" class="article-date">
  <time class="dt-published" datetime="2022-07-18T23:28:42.000Z" itemprop="datePublished">2022-07-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/07/19/web/%E4%B8%93%E6%A0%8F/Chrome%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/crx%E5%AD%A6%E4%B9%A0/">crx学习</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h1><p>我花了将近一个多月的时间断断续续写下这篇博文，并精心写下完整demo，所以转载务必保留 <a target="_blank" rel="noopener" href="http://blog.haoji.me/chrome-plugin-develop.html">http://blog.haoji.me/chrome-plugin-develop.html</a> 。本文所有涉及到的大部分代码均在这个demo里面：<a target="_blank" rel="noopener" href="https://github.com/sxei/chrome-plugin-demo">https://github.com/sxei/chrome-plugin-demo</a> ，大家可以直接下载下来运行。</p>
<p>另外，本文图片较多，请耐心等待加载完毕。</p>
<p>本文目录：</p>
<p><img src="/crx%E5%AD%A6%E4%B9%A0.image/20170710_222547_735_9922.png"></p>
<p>demo部分截图：</p>
<p><img src="/crx%E5%AD%A6%E4%B9%A0.image/20170710_223150_516_6129.png"></p>
<h2 id="仓库说明"><a href="#仓库说明" class="headerlink" title="仓库说明"></a>仓库说明</h2><ul>
<li><code>full-chrome-plugin-demo</code>：大部分demo代码都在这个仓库；</li>
<li><code>simple-chrome-plugin-demo</code>：最精简的Chrome仓库模板，当需要快速写一个简单仓库时可以基于这个模板；</li>
<li><code>page-action-demo</code>：关于<code>page-action</code>部分的demo代码，由于这部分代码和<code>full-chrome-plugin-demo</code>冲突，所以单独拿出来；</li>
</ul>
<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><h2 id="什么是Chrome插件"><a href="#什么是Chrome插件" class="headerlink" title="什么是Chrome插件"></a>什么是Chrome插件</h2><p>严格来讲，我们正在说的东西应该叫Chrome扩展(<code>Chrome Extension</code>)，真正意义上的Chrome插件是更底层的浏览器功能扩展，可能需要对浏览器源码有一定掌握才有能力去开发。鉴于Chrome插件的叫法已经习惯，本文也全部采用这种叫法，但读者需深知本文所描述的Chrome插件实际上指的是Chrome扩展。</p>
<p>Chrome插件是一个用Web技术开发、用来增强浏览器功能的软件，它其实就是一个由HTML、CSS、JS、图片等资源组成的一个<a target="_blank" rel="noopener" href="https://developer.chrome.com/extensions/crx">.crx</a> 后缀的压缩包.</p>
<p>个人猜测<code>crx</code>可能是<code>Chrome Extension</code>如下3个字母的简写：</p>
<p><img src="/crx%E5%AD%A6%E4%B9%A0.image/20170619_114836_364_3616.png"></p>
<p>另外，其实不只是前端技术，Chrome插件还可以配合C++编写的dll动态链接库实现一些更底层的功能(NPAPI)，比如全屏幕截图。</p>
<p><img src="/crx%E5%AD%A6%E4%B9%A0.image/20170626_112802_406_9027-16430996094425.png" alt="360抢票王插件dll截图"></p>
<blockquote>
<p>由于安全原因，Chrome浏览器42以上版本已经陆续不再支持NPAPI插件，取而代之的是更安全的PPAPI。</p>
</blockquote>
<h2 id="学习Chrome插件开发有什么意义"><a href="#学习Chrome插件开发有什么意义" class="headerlink" title="学习Chrome插件开发有什么意义"></a>学习Chrome插件开发有什么意义</h2><p>增强浏览器功能，轻松实现属于自己的“定制版”浏览器，等等。</p>
<p>Chrome插件提供了很多实用API供我们使用，包括但不限于：</p>
<ul>
<li>书签控制；</li>
<li>下载控制；</li>
<li>窗口控制；</li>
<li>标签控制；</li>
<li>网络请求控制，各类事件监听；</li>
<li>自定义原生菜单；</li>
<li>完善的通信机制；</li>
<li>等等；</li>
</ul>
<h2 id="为什么是Chrome插件而不是Firefox插件"><a href="#为什么是Chrome插件而不是Firefox插件" class="headerlink" title="为什么是Chrome插件而不是Firefox插件"></a>为什么是Chrome插件而不是Firefox插件</h2><ol>
<li>Chrome占有率更高，更多人用；</li>
<li>开发更简单；</li>
<li>应用场景更广泛，Firefox插件只能运行在Firefox上，而Chrome除了Chrome浏览器之外，还可以运行在所有webkit内核的国产浏览器，比如360极速浏览器、360安全浏览器、搜狗浏览器、QQ浏览器等等；</li>
<li>除此之外，Firefox浏览器也对Chrome插件的运行提供了一定的支持；</li>
</ol>
<h1 id="开发与调试"><a href="#开发与调试" class="headerlink" title="开发与调试"></a>开发与调试</h1><p>Chrome插件没有严格的项目结构要求，只要保证本目录有一个<code>manifest.json</code>即可，也不需要专门的IDE，普通的web开发工具即可。</p>
<p>从右上角菜单-&gt;更多工具-&gt;扩展程序可以进入 插件管理页面，也可以直接在地址栏输入 <a href="chrome://extensions/">chrome:&#x2F;&#x2F;extensions</a> 访问。</p>
<p><img src="/crx%E5%AD%A6%E4%B9%A0.image/20170620_195047_992_5668.png"></p>
<p>勾选<code>开发者模式</code>即可以文件夹的形式直接加载插件，否则只能安装<code>.crx</code>格式的文件。Chrome要求插件必须从它的Chrome应用商店安装，其它任何网站下载的都无法直接安装，所以，其实我们可以把<code>crx</code>文件解压，然后通过开发者模式直接加载。</p>
<p>开发中，代码有任何改动都必须重新加载插件，只需要在插件管理页按下<code>Ctrl+R</code>即可，以防万一最好还把页面刷新一下。</p>
<h1 id="核心介绍"><a href="#核心介绍" class="headerlink" title="核心介绍"></a>核心介绍</h1><h2 id="manifest-json"><a href="#manifest-json" class="headerlink" title="manifest.json"></a>manifest.json</h2><p>这是一个Chrome插件最重要也是必不可少的文件，用来配置所有和插件相关的配置，必须放在根目录。其中，<code>manifest_version</code>、<code>name</code>、<code>version</code>3个是必不可少的，<code>description</code>和<code>icons</code>是推荐的。</p>
<p>下面给出的是一些常见的配置项，均有中文注释，完整的配置文档请戳<a target="_blank" rel="noopener" href="https://developer.chrome.com/extensions/manifest">这里</a>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="comment">// 清单文件的版本，这个必须写，而且必须是2</span></span><br><span class="line">	<span class="string">&quot;manifest_version&quot;</span>: <span class="number">2</span>,</span><br><span class="line">	<span class="comment">// 插件的名称</span></span><br><span class="line">	<span class="string">&quot;name&quot;</span>: <span class="string">&quot;demo&quot;</span>,</span><br><span class="line">	<span class="comment">// 插件的版本</span></span><br><span class="line">	<span class="string">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">	<span class="comment">// 插件描述</span></span><br><span class="line">	<span class="string">&quot;description&quot;</span>: <span class="string">&quot;简单的Chrome扩展demo&quot;</span>,</span><br><span class="line">	<span class="comment">// 图标，一般偷懒全部用一个尺寸的也没问题</span></span><br><span class="line">	<span class="string">&quot;icons&quot;</span>:</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="string">&quot;16&quot;</span>: <span class="string">&quot;img/icon.png&quot;</span>,</span><br><span class="line">		<span class="string">&quot;48&quot;</span>: <span class="string">&quot;img/icon.png&quot;</span>,</span><br><span class="line">		<span class="string">&quot;128&quot;</span>: <span class="string">&quot;img/icon.png&quot;</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="comment">// 会一直常驻的后台JS或后台页面</span></span><br><span class="line">	<span class="string">&quot;background&quot;</span>:</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// 2种指定方式，如果指定JS，那么会自动生成一个背景页</span></span><br><span class="line">		<span class="string">&quot;page&quot;</span>: <span class="string">&quot;background.html&quot;</span></span><br><span class="line">		<span class="comment">//&quot;scripts&quot;: [&quot;js/background.js&quot;]</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="comment">// 浏览器右上角图标设置，browser_action、page_action、app必须三选一</span></span><br><span class="line">	<span class="string">&quot;browser_action&quot;</span>: </span><br><span class="line">	&#123;</span><br><span class="line">		<span class="string">&quot;default_icon&quot;</span>: <span class="string">&quot;img/icon.png&quot;</span>,</span><br><span class="line">		<span class="comment">// 图标悬停时的标题，可选</span></span><br><span class="line">		<span class="string">&quot;default_title&quot;</span>: <span class="string">&quot;这是一个示例Chrome插件&quot;</span>,</span><br><span class="line">		<span class="string">&quot;default_popup&quot;</span>: <span class="string">&quot;popup.html&quot;</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="comment">// 当某些特定页面打开才显示的图标</span></span><br><span class="line">	<span class="comment">/*&quot;page_action&quot;:</span></span><br><span class="line"><span class="comment">	&#123;</span></span><br><span class="line"><span class="comment">		&quot;default_icon&quot;: &quot;img/icon.png&quot;,</span></span><br><span class="line"><span class="comment">		&quot;default_title&quot;: &quot;我是pageAction&quot;,</span></span><br><span class="line"><span class="comment">		&quot;default_popup&quot;: &quot;popup.html&quot;</span></span><br><span class="line"><span class="comment">	&#125;,*/</span></span><br><span class="line">	<span class="comment">// 需要直接注入页面的JS</span></span><br><span class="line">	<span class="string">&quot;content_scripts&quot;</span>: </span><br><span class="line">	[</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">//&quot;matches&quot;: [&quot;http://*/*&quot;, &quot;https://*/*&quot;],</span></span><br><span class="line">			<span class="comment">// &quot;&lt;all_urls&gt;&quot; 表示匹配所有地址</span></span><br><span class="line">			<span class="string">&quot;matches&quot;</span>: [<span class="string">&quot;&lt;all_urls&gt;&quot;</span>],</span><br><span class="line">			<span class="comment">// 多个JS按顺序注入</span></span><br><span class="line">			<span class="string">&quot;js&quot;</span>: [<span class="string">&quot;js/jquery-1.8.3.js&quot;</span>, <span class="string">&quot;js/content-script.js&quot;</span>],</span><br><span class="line">			<span class="comment">// JS的注入可以随便一点，但是CSS的注意就要千万小心了，因为一不小心就可能影响全局样式</span></span><br><span class="line">			<span class="string">&quot;css&quot;</span>: [<span class="string">&quot;css/custom.css&quot;</span>],</span><br><span class="line">			<span class="comment">// 代码注入的时间，可选值： &quot;document_start&quot;, &quot;document_end&quot;, or &quot;document_idle&quot;，最后一个表示页面空闲时，默认document_idle</span></span><br><span class="line">			<span class="string">&quot;run_at&quot;</span>: <span class="string">&quot;document_start&quot;</span></span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="comment">// 这里仅仅是为了演示content-script可以配置多个规则</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;matches&quot;</span>: [<span class="string">&quot;*://*/*.png&quot;</span>, <span class="string">&quot;*://*/*.jpg&quot;</span>, <span class="string">&quot;*://*/*.gif&quot;</span>, <span class="string">&quot;*://*/*.bmp&quot;</span>],</span><br><span class="line">			<span class="string">&quot;js&quot;</span>: [<span class="string">&quot;js/show-image-content-size.js&quot;</span>]</span><br><span class="line">		&#125;</span><br><span class="line">	],</span><br><span class="line">	<span class="comment">// 权限申请</span></span><br><span class="line">	<span class="string">&quot;permissions&quot;</span>:</span><br><span class="line">	[</span><br><span class="line">		<span class="string">&quot;contextMenus&quot;</span>, <span class="comment">// 右键菜单</span></span><br><span class="line">		<span class="string">&quot;tabs&quot;</span>, <span class="comment">// 标签</span></span><br><span class="line">		<span class="string">&quot;notifications&quot;</span>, <span class="comment">// 通知</span></span><br><span class="line">		<span class="string">&quot;webRequest&quot;</span>, <span class="comment">// web请求</span></span><br><span class="line">		<span class="string">&quot;webRequestBlocking&quot;</span>,</span><br><span class="line">		<span class="string">&quot;storage&quot;</span>, <span class="comment">// 插件本地存储</span></span><br><span class="line">		<span class="string">&quot;http://*/*&quot;</span>, <span class="comment">// 可以通过executeScript或者insertCSS访问的网站</span></span><br><span class="line">		<span class="string">&quot;https://*/*&quot;</span> <span class="comment">// 可以通过executeScript或者insertCSS访问的网站</span></span><br><span class="line">	],</span><br><span class="line">	<span class="comment">// 普通页面能够直接访问的插件资源列表，如果不设置是无法直接访问的</span></span><br><span class="line">	<span class="string">&quot;web_accessible_resources&quot;</span>: [<span class="string">&quot;js/inject.js&quot;</span>],</span><br><span class="line">	<span class="comment">// 插件主页，这个很重要，不要浪费了这个免费广告位</span></span><br><span class="line">	<span class="string">&quot;homepage_url&quot;</span>: <span class="string">&quot;https://www.baidu.com&quot;</span>,</span><br><span class="line">	<span class="comment">// 覆盖浏览器默认页面</span></span><br><span class="line">	<span class="string">&quot;chrome_url_overrides&quot;</span>:</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// 覆盖浏览器默认的新标签页</span></span><br><span class="line">		<span class="string">&quot;newtab&quot;</span>: <span class="string">&quot;newtab.html&quot;</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="comment">// Chrome40以前的插件配置页写法</span></span><br><span class="line">	<span class="string">&quot;options_page&quot;</span>: <span class="string">&quot;options.html&quot;</span>,</span><br><span class="line">	<span class="comment">// Chrome40以后的插件配置页写法，如果2个都写，新版Chrome只认后面这一个</span></span><br><span class="line">	<span class="string">&quot;options_ui&quot;</span>:</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="string">&quot;page&quot;</span>: <span class="string">&quot;options.html&quot;</span>,</span><br><span class="line">		<span class="comment">// 添加一些默认的样式，推荐使用</span></span><br><span class="line">		<span class="string">&quot;chrome_style&quot;</span>: <span class="literal">true</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="comment">// 向地址栏注册一个关键字以提供搜索建议，只能设置一个关键字</span></span><br><span class="line">	<span class="string">&quot;omnibox&quot;</span>: &#123; <span class="string">&quot;keyword&quot;</span> : <span class="string">&quot;go&quot;</span> &#125;,</span><br><span class="line">	<span class="comment">// 默认语言</span></span><br><span class="line">	<span class="string">&quot;default_locale&quot;</span>: <span class="string">&quot;zh_CN&quot;</span>,</span><br><span class="line">	<span class="comment">// devtools页面入口，注意只能指向一个HTML文件，不能是JS文件</span></span><br><span class="line">	<span class="string">&quot;devtools_page&quot;</span>: <span class="string">&quot;devtools.html&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="content-scripts"><a href="#content-scripts" class="headerlink" title="content-scripts"></a>content-scripts</h2><p>所谓<a target="_blank" rel="noopener" href="https://developer.chrome.com/extensions/content_scripts">content-scripts</a>，其实就是Chrome插件中向页面注入脚本的一种形式（虽然名为script，其实还可以包括css的），借助<code>content-scripts</code>我们可以实现通过配置的方式轻松向指定页面注入JS和CSS（如果需要动态注入，可以参考下文），最常见的比如：广告屏蔽、页面CSS定制，等等。</p>
<p>示例配置：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="comment">// 需要直接注入页面的JS</span></span><br><span class="line">	<span class="string">&quot;content_scripts&quot;</span>: </span><br><span class="line">	[</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">//&quot;matches&quot;: [&quot;http://*/*&quot;, &quot;https://*/*&quot;],</span></span><br><span class="line">			<span class="comment">// &quot;&lt;all_urls&gt;&quot; 表示匹配所有地址</span></span><br><span class="line">			<span class="string">&quot;matches&quot;</span>: [<span class="string">&quot;&lt;all_urls&gt;&quot;</span>],</span><br><span class="line">			<span class="comment">// 多个JS按顺序注入</span></span><br><span class="line">			<span class="string">&quot;js&quot;</span>: [<span class="string">&quot;js/jquery-1.8.3.js&quot;</span>, <span class="string">&quot;js/content-script.js&quot;</span>],</span><br><span class="line">			<span class="comment">// JS的注入可以随便一点，但是CSS的注意就要千万小心了，因为一不小心就可能影响全局样式</span></span><br><span class="line">			<span class="string">&quot;css&quot;</span>: [<span class="string">&quot;css/custom.css&quot;</span>],</span><br><span class="line">			<span class="comment">// 代码注入的时间，可选值： &quot;document_start&quot;, &quot;document_end&quot;, or &quot;document_idle&quot;，最后一个表示页面空闲时，默认document_idle</span></span><br><span class="line">			<span class="string">&quot;run_at&quot;</span>: <span class="string">&quot;document_start&quot;</span></span><br><span class="line">		&#125;</span><br><span class="line">	],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>特别注意，如果没有主动指定<code>run_at</code>为<code>document_start</code>（默认为<code>document_idle</code>），下面这种代码是不会生效的：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;DOMContentLoaded&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;我被执行了！&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><code>content-scripts</code>和原始页面共享DOM，但是不共享JS，如要访问页面JS（例如某个JS变量），只能通过<code>injected js</code>来实现。<code>content-scripts</code>不能访问绝大部分<code>chrome.xxx.api</code>，除了下面这4种：</p>
<ul>
<li>chrome.extension(getURL , inIncognitoContext , lastError , onRequest , sendRequest)</li>
<li>chrome.i18n</li>
<li>chrome.runtime(connect , getManifest , getURL , id , onConnect , onMessage , sendMessage)</li>
<li>chrome.storage</li>
</ul>
<p>其实看到这里不要悲观，这些API绝大部分时候都够用了，非要调用其它API的话，你还可以通过通信来实现让background来帮你调用（关于通信，后文有详细介绍）。</p>
<p>好了，Chrome插件给我们提供了这么强大的JS注入功能，剩下的就是发挥你的想象力去玩弄浏览器了。</p>
<h2 id="background"><a href="#background" class="headerlink" title="background"></a>background</h2><p>后台（姑且这么翻译吧），是一个常驻的页面，它的生命周期是插件中所有类型页面中最长的，它随着浏览器的打开而打开，随着浏览器的关闭而关闭，所以通常把需要一直运行的、启动就运行的、全局的代码放在background里面。</p>
<p>background的权限非常高，几乎可以调用所有的Chrome扩展API（除了devtools），而且它可以无限制跨域，也就是可以跨域访问任何网站而无需要求对方设置<code>CORS</code>。</p>
<blockquote>
<p>经过测试，其实不止是background，所有的直接通过<code>chrome-extension://id/xx.html</code>这种方式打开的网页都可以无限制跨域。</p>
</blockquote>
<p>配置中，<code>background</code>可以通过<code>page</code>指定一张网页，也可以通过<code>scripts</code>直接指定一个JS，Chrome会自动为这个JS生成一个默认的网页：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="comment">// 会一直常驻的后台JS或后台页面</span></span><br><span class="line">	<span class="string">&quot;background&quot;</span>:</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// 2种指定方式，如果指定JS，那么会自动生成一个背景页</span></span><br><span class="line">		<span class="string">&quot;page&quot;</span>: <span class="string">&quot;background.html&quot;</span></span><br><span class="line">		<span class="comment">//&quot;scripts&quot;: [&quot;js/background.js&quot;]</span></span><br><span class="line">	&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>需要特别说明的是，虽然你可以通过<code>chrome-extension://xxx/background.html</code>直接打开后台页，但是你打开的后台页和真正一直在后台运行的那个页面不是同一个，换句话说，你可以打开无数个<code>background.html</code>，但是真正在后台常驻的只有一个，而且这个你永远看不到它的界面，只能调试它的代码。</p>
<h2 id="event-pages"><a href="#event-pages" class="headerlink" title="event-pages"></a>event-pages</h2><p>这里顺带介绍一下<a target="_blank" rel="noopener" href="https://developer.chrome.com/extensions/event_pages">event-pages</a>，它是一个什么东西呢？鉴于background生命周期太长，长时间挂载后台可能会影响性能，所以Google又弄一个<code>event-pages</code>，在配置文件上，它与background的唯一区别就是多了一个<code>persistent</code>参数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;background&quot;</span>:</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="string">&quot;scripts&quot;</span>: [<span class="string">&quot;event-page.js&quot;</span>],</span><br><span class="line">		<span class="string">&quot;persistent&quot;</span>: <span class="literal">false</span></span><br><span class="line">	&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>它的生命周期是：在被需要时加载，在空闲时被关闭，什么叫被需要时呢？比如第一次安装、插件更新、有content-script向它发送消息，等等。</p>
<p>除了配置文件的变化，代码上也有一些细微变化，个人这个简单了解一下就行了，一般情况下background也不会很消耗性能的。</p>
<h2 id="popup"><a href="#popup" class="headerlink" title="popup"></a>popup</h2><p><code>popup</code>是点击<code>browser_action</code>或者<code>page_action</code>图标时打开的一个小窗口网页，焦点离开网页就立即关闭，一般用来做一些临时性的交互。</p>
<p><img src="/crx%E5%AD%A6%E4%B9%A0.image/20170619_161102_335_9254.png" alt="博客园网摘插件popup效果"></p>
<p><code>popup</code>可以包含任意你想要的HTML内容，并且会自适应大小。可以通过<code>default_popup</code>字段来指定popup页面，也可以调用<code>setPopup()</code>方法。</p>
<p>配置方式：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;browser_action&quot;</span>:</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="string">&quot;default_icon&quot;</span>: <span class="string">&quot;img/icon.png&quot;</span>,</span><br><span class="line">		<span class="comment">// 图标悬停时的标题，可选</span></span><br><span class="line">		<span class="string">&quot;default_title&quot;</span>: <span class="string">&quot;这是一个示例Chrome插件&quot;</span>,</span><br><span class="line">		<span class="string">&quot;default_popup&quot;</span>: <span class="string">&quot;popup.html&quot;</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/crx%E5%AD%A6%E4%B9%A0.image/20170531_172243_007_2793.png"></p>
<p>需要特别注意的是，由于单击图标打开popup，焦点离开又立即关闭，所以popup页面的生命周期一般很短，需要长时间运行的代码千万不要写在popup里面。</p>
<p>在权限上，它和background非常类似，它们之间最大的不同是生命周期的不同，popup中可以直接通过<code>chrome.extension.getBackgroundPage()</code>获取background的window对象。</p>
<h2 id="injected-script"><a href="#injected-script" class="headerlink" title="injected-script"></a>injected-script</h2><p>这里的<code>injected-script</code>是我给它取的，指的是通过DOM操作的方式向页面注入的一种JS。为什么要把这种JS单独拿出来讨论呢？又或者说为什么需要通过这种方式注入JS呢？</p>
<p>这是因为<code>content-script</code>有一个很大的“缺陷”，也就是无法访问页面中的JS，虽然它可以操作DOM，但是DOM却不能调用它，也就是无法在DOM中通过绑定事件的方式调用<code>content-script</code>中的代码（包括直接写<code>onclick</code>和<code>addEventListener</code>2种方式都不行），但是，“在页面上添加一个按钮并调用插件的扩展API”是一个很常见的需求，那该怎么办呢？其实这就是本小节要讲的。</p>
<p>在<code>content-script</code>中通过DOM方式向页面注入<code>inject-script</code>代码示例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 向页面注入JS</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">injectCustomJs</span>(<span class="params">jsPath</span>)</span><br><span class="line">&#123;</span><br><span class="line">	jsPath = jsPath || <span class="string">&#x27;js/inject.js&#x27;</span>;</span><br><span class="line">	<span class="keyword">var</span> temp = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;script&#x27;</span>);</span><br><span class="line">	temp.<span class="title function_">setAttribute</span>(<span class="string">&#x27;type&#x27;</span>, <span class="string">&#x27;text/javascript&#x27;</span>);</span><br><span class="line">	<span class="comment">// 获得的地址类似：chrome-extension://ihcokhadfjfchaeagdoclpnjdiokfakg/js/inject.js</span></span><br><span class="line">	temp.<span class="property">src</span> = chrome.<span class="property">extension</span>.<span class="title function_">getURL</span>(jsPath);</span><br><span class="line">	temp.<span class="property">onload</span> = <span class="keyword">function</span>(<span class="params"></span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// 放在页面不好看，执行完后移除掉</span></span><br><span class="line">		<span class="variable language_">this</span>.<span class="property">parentNode</span>.<span class="title function_">removeChild</span>(<span class="variable language_">this</span>);</span><br><span class="line">	&#125;;</span><br><span class="line">	<span class="variable language_">document</span>.<span class="property">head</span>.<span class="title function_">appendChild</span>(temp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>你以为这样就行了？执行一下你会看到如下报错：</p>
<pre><code>Denying load of chrome-extension://efbllncjkjiijkppagepehoekjojdclc/js/inject.js. Resources must be listed in the web_accessible_resources manifest key in order to be loaded by pages outside the extension.
</code></pre>
<p>意思就是你想要在web中直接访问插件中的资源的话必须显示声明才行，配置文件中增加如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="comment">// 普通页面能够直接访问的插件资源列表，如果不设置是无法直接访问的</span></span><br><span class="line">	<span class="string">&quot;web_accessible_resources&quot;</span>: [<span class="string">&quot;js/inject.js&quot;</span>],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>至于<code>inject-script</code>如何调用<code>content-script</code>中的代码，后面我会在专门的一个消息通信章节详细介绍。</p>
<h2 id="homepage-url"><a href="#homepage-url" class="headerlink" title="homepage_url"></a>homepage_url</h2><p>开发者或者插件主页设置，一般会在如下2个地方显示：</p>
<p><img src="/crx%E5%AD%A6%E4%B9%A0.image/20170531_105821_586_0442.png"></p>
<p><img src="/crx%E5%AD%A6%E4%B9%A0.image/20170531_105907_256_9087.png"></p>
<h1 id="Chrome插件的8种展示形式"><a href="#Chrome插件的8种展示形式" class="headerlink" title="Chrome插件的8种展示形式"></a>Chrome插件的8种展示形式</h1><h2 id="browserAction-浏览器右上角"><a href="#browserAction-浏览器右上角" class="headerlink" title="browserAction(浏览器右上角)"></a>browserAction(浏览器右上角)</h2><p>通过配置<code>browser_action</code>可以在浏览器的右上角增加一个图标，一个<code>browser_action</code>可以拥有一个图标，一个<code>tooltip</code>，一个<code>badge</code>和一个<code>popup</code>。</p>
<p>示例配置如下：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;browser_action&quot;</span><span class="punctuation">:</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;default_icon&quot;</span><span class="punctuation">:</span> <span class="string">&quot;img/icon.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;default_title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;这是一个示例Chrome插件&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;default_popup&quot;</span><span class="punctuation">:</span> <span class="string">&quot;popup.html&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="图标"><a href="#图标" class="headerlink" title="图标"></a>图标</h3><p><code>browser_action</code>图标推荐使用宽高都为19像素的图片，更大的图标会被缩小，格式随意，一般推荐png，可以通过manifest中<code>default_icon</code>字段配置，也可以调用setIcon()方法。</p>
<h3 id="tooltip"><a href="#tooltip" class="headerlink" title="tooltip"></a>tooltip</h3><p>修改<code>browser_action</code>的manifest中<code>default_title</code>字段，或者调用<code>setTitle()</code>方法。</p>
<p><img src="/crx%E5%AD%A6%E4%B9%A0.image/20170531_170829_477_1329.png"></p>
<h3 id="badge"><a href="#badge" class="headerlink" title="badge"></a>badge</h3><p>所谓<code>badge</code>就是在图标上显示一些文本，可以用来更新一些小的扩展状态提示信息。因为badge空间有限，所以只支持4个以下的字符（英文4个，中文2个）。badge无法通过配置文件来指定，必须通过代码实现，设置badge文字和颜色可以分别使用<code>setBadgeText()</code>和<code>setBadgeBackgroundColor()</code>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chrome.<span class="property">browserAction</span>.<span class="title function_">setBadgeText</span>(&#123;<span class="attr">text</span>: <span class="string">&#x27;new&#x27;</span>&#125;);</span><br><span class="line">chrome.<span class="property">browserAction</span>.<span class="title function_">setBadgeBackgroundColor</span>(&#123;<span class="attr">color</span>: [<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>]&#125;);</span><br></pre></td></tr></table></figure>

<p>效果：</p>
<p><img src="/crx%E5%AD%A6%E4%B9%A0.image/20170531_171447_912_1165.png"></p>
<h2 id="pageAction-地址栏右侧"><a href="#pageAction-地址栏右侧" class="headerlink" title="pageAction(地址栏右侧)"></a>pageAction(地址栏右侧)</h2><p>所谓<code>pageAction</code>，指的是只有当某些特定页面打开才显示的图标，它和<code>browserAction</code>最大的区别是一个始终都显示，一个只在特定情况才显示。</p>
<p>需要特别说明的是早些版本的Chrome是将pageAction放在地址栏的最右边，左键单击弹出popup，右键单击则弹出相关默认的选项菜单：</p>
<p><img src="/crx%E5%AD%A6%E4%B9%A0.image/20170531_103311_849_4399.png"></p>
<p>而新版的Chrome更改了这一策略，pageAction和普通的browserAction一样也是放在浏览器右上角，只不过没有点亮时是灰色的，点亮了才是彩色的，灰色时无论左键还是右键单击都是弹出选项：</p>
<p><img src="/crx%E5%AD%A6%E4%B9%A0.image/20170531_104038_208_9352.gif"></p>
<blockquote>
<p>具体是从哪一版本开始改的没去仔细考究，反正知道v50.0的时候还是前者，v58.0的时候已改为后者。</p>
</blockquote>
<p>调整之后的<code>pageAction</code>我们可以简单地把它看成是可以置灰的<code>browserAction</code>。</p>
<ul>
<li>chrome.pageAction.show(tabId) 显示图标；</li>
<li>chrome.pageAction.hide(tabId) 隐藏图标；</li>
</ul>
<p>示例(只有打开百度才显示图标)：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// manifest.json</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;page_action&quot;</span>:</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="string">&quot;default_icon&quot;</span>: <span class="string">&quot;img/icon.png&quot;</span>,</span><br><span class="line">		<span class="string">&quot;default_title&quot;</span>: <span class="string">&quot;我是pageAction&quot;</span>,</span><br><span class="line">		<span class="string">&quot;default_popup&quot;</span>: <span class="string">&quot;popup.html&quot;</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="string">&quot;permissions&quot;</span>: [<span class="string">&quot;declarativeContent&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// background.js</span></span><br><span class="line">chrome.<span class="property">runtime</span>.<span class="property">onInstalled</span>.<span class="title function_">addListener</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">	chrome.<span class="property">declarativeContent</span>.<span class="property">onPageChanged</span>.<span class="title function_">removeRules</span>(<span class="literal">undefined</span>, <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">		chrome.<span class="property">declarativeContent</span>.<span class="property">onPageChanged</span>.<span class="title function_">addRules</span>([</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="attr">conditions</span>: [</span><br><span class="line">					<span class="comment">// 只有打开百度才显示pageAction</span></span><br><span class="line">					<span class="keyword">new</span> chrome.<span class="property">declarativeContent</span>.<span class="title class_">PageStateMatcher</span>(&#123;<span class="attr">pageUrl</span>: &#123;<span class="attr">urlContains</span>: <span class="string">&#x27;baidu.com&#x27;</span>&#125;&#125;)</span><br><span class="line">				],</span><br><span class="line">				<span class="attr">actions</span>: [<span class="keyword">new</span> chrome.<span class="property">declarativeContent</span>.<span class="title class_">ShowPageAction</span>()]</span><br><span class="line">			&#125;</span><br><span class="line">		]);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>效果图：</p>
<p><img src="/crx%E5%AD%A6%E4%B9%A0.image/20170531_174018_541_0451.gif"></p>
<h2 id="右键菜单"><a href="#右键菜单" class="headerlink" title="右键菜单"></a>右键菜单</h2><p>通过开发Chrome插件可以自定义浏览器的右键菜单，主要是通过<code>chrome.contextMenus</code>API实现，右键菜单可以出现在不同的上下文，比如普通页面、选中的文字、图片、链接，等等，如果有同一个插件里面定义了多个菜单，Chrome会自动组合放到以插件名字命名的二级菜单里，如下：</p>
<p><img src="/crx%E5%AD%A6%E4%B9%A0.image/20170531_151134_967_0243.png"></p>
<h3 id="最简单的右键菜单示例"><a href="#最简单的右键菜单示例" class="headerlink" title="最简单的右键菜单示例"></a>最简单的右键菜单示例</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// manifest.json</span></span><br><span class="line">&#123;<span class="string">&quot;permissions&quot;</span>: [<span class="string">&quot;contextMenus&quot;</span>]&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// background.js</span></span><br><span class="line">chrome.<span class="property">contextMenus</span>.<span class="title function_">create</span>(&#123;</span><br><span class="line">	<span class="attr">title</span>: <span class="string">&quot;测试右键菜单&quot;</span>,</span><br><span class="line">	<span class="attr">onclick</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="title function_">alert</span>(<span class="string">&#x27;您点击了右键菜单！&#x27;</span>);&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>效果：</p>
<p><img src="/crx%E5%AD%A6%E4%B9%A0.image/20170531_145957_183_0527.png"></p>
<h3 id="添加右键百度搜索"><a href="#添加右键百度搜索" class="headerlink" title="添加右键百度搜索"></a>添加右键百度搜索</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// manifest.json</span></span><br><span class="line">&#123;<span class="string">&quot;permissions&quot;</span>: [<span class="string">&quot;contextMenus&quot;</span>， <span class="string">&quot;tabs&quot;</span>]&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// background.js</span></span><br><span class="line">chrome.<span class="property">contextMenus</span>.<span class="title function_">create</span>(&#123;</span><br><span class="line">	<span class="attr">title</span>: <span class="string">&#x27;使用度娘搜索：%s&#x27;</span>, <span class="comment">// %s表示选中的文字</span></span><br><span class="line">	<span class="attr">contexts</span>: [<span class="string">&#x27;selection&#x27;</span>], <span class="comment">// 只有当选中文字时才会出现此右键菜单</span></span><br><span class="line">	<span class="attr">onclick</span>: <span class="keyword">function</span>(<span class="params">params</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// 注意不能使用location.href，因为location是属于background的window对象</span></span><br><span class="line">		chrome.<span class="property">tabs</span>.<span class="title function_">create</span>(&#123;<span class="attr">url</span>: <span class="string">&#x27;https://www.baidu.com/s?ie=utf-8&amp;wd=&#x27;</span> + <span class="built_in">encodeURI</span>(params.<span class="property">selectionText</span>)&#125;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>效果如下：</p>
<p><img src="/crx%E5%AD%A6%E4%B9%A0.image/20170531_160358_202_7248.png"></p>
<h3 id="语法说明"><a href="#语法说明" class="headerlink" title="语法说明"></a>语法说明</h3><p>这里只是简单列举一些常用的，完整API参见：<a target="_blank" rel="noopener" href="https://developer.chrome.com/extensions/contextMenus">https://developer.chrome.com/extensions/contextMenus</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">chrome.<span class="property">contextMenus</span>.<span class="title function_">create</span>(&#123;</span><br><span class="line">	<span class="attr">type</span>: <span class="string">&#x27;normal&#x27;</span>， <span class="comment">// 类型，可选：[&quot;normal&quot;, &quot;checkbox&quot;, &quot;radio&quot;, &quot;separator&quot;]，默认 normal</span></span><br><span class="line">	<span class="attr">title</span>: <span class="string">&#x27;菜单的名字&#x27;</span>, <span class="comment">// 显示的文字，除非为“separator”类型否则此参数必需，如果类型为“selection”，可以使用%s显示选定的文本</span></span><br><span class="line">	<span class="attr">contexts</span>: [<span class="string">&#x27;page&#x27;</span>], <span class="comment">// 上下文环境，可选：[&quot;all&quot;, &quot;page&quot;, &quot;frame&quot;, &quot;selection&quot;, &quot;link&quot;, &quot;editable&quot;, &quot;image&quot;, &quot;video&quot;, &quot;audio&quot;]，默认page</span></span><br><span class="line">	<span class="attr">onclick</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;&#125;, <span class="comment">// 单击时触发的方法</span></span><br><span class="line">	<span class="attr">parentId</span>: <span class="number">1</span>, <span class="comment">// 右键菜单项的父菜单项ID。指定父菜单项将会使此菜单项成为父菜单项的子菜单</span></span><br><span class="line">	<span class="attr">documentUrlPatterns</span>: <span class="string">&#x27;https://*.baidu.com/*&#x27;</span> <span class="comment">// 只在某些页面显示此右键菜单</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 删除某一个菜单项</span></span><br><span class="line">chrome.<span class="property">contextMenus</span>.<span class="title function_">remove</span>(menuItemId)；</span><br><span class="line"><span class="comment">// 删除所有自定义右键菜单</span></span><br><span class="line">chrome.<span class="property">contextMenus</span>.<span class="title function_">removeAll</span>();</span><br><span class="line"><span class="comment">// 更新某一个菜单项</span></span><br><span class="line">chrome.<span class="property">contextMenus</span>.<span class="title function_">update</span>(menuItemId, updateProperties);</span><br></pre></td></tr></table></figure>

<h2 id="override-覆盖特定页面"><a href="#override-覆盖特定页面" class="headerlink" title="override(覆盖特定页面)"></a>override(覆盖特定页面)</h2><p>使用<code>override</code>页可以将Chrome默认的一些特定页面替换掉，改为使用扩展提供的页面。</p>
<p>扩展可以替代如下页面：</p>
<ul>
<li>历史记录：从工具菜单上点击历史记录时访问的页面，或者从地址栏直接输入 <a href="chrome://history">chrome:&#x2F;&#x2F;history</a></li>
<li>新标签页：当创建新标签的时候访问的页面，或者从地址栏直接输入 <a href="chrome://newtab">chrome:&#x2F;&#x2F;newtab</a></li>
<li>书签：浏览器的书签，或者直接输入 <a href="chrome://bookmarks">chrome:&#x2F;&#x2F;bookmarks</a></li>
</ul>
<p>注意：</p>
<ul>
<li>一个扩展只能替代一个页面；</li>
<li>不能替代隐身窗口的新标签页；</li>
<li>网页必须设置 title，否则用户可能会看到网页的URL，造成困扰；</li>
</ul>
<p>下面的截图是默认的新标签页和被扩展替换掉的新标签页。</p>
<p><img src="/crx%E5%AD%A6%E4%B9%A0.image/20170531_180326_487_3396.png"></p>
<p>代码（注意，一个插件只能替代一个默认页，以下仅为演示）：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;chrome_url_overrides&quot;</span>:</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;newtab&quot;</span>: <span class="string">&quot;newtab.html&quot;</span>,</span><br><span class="line">	<span class="string">&quot;history&quot;</span>: <span class="string">&quot;history.html&quot;</span>,</span><br><span class="line">	<span class="string">&quot;bookmarks&quot;</span>: <span class="string">&quot;bookmarks.html&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="devtools-开发者工具"><a href="#devtools-开发者工具" class="headerlink" title="devtools(开发者工具)"></a>devtools(开发者工具)</h2><h3 id="预热"><a href="#预热" class="headerlink" title="预热"></a>预热</h3><p>使用过vue的应该见过这种类型的插件：</p>
<p><img src="/crx%E5%AD%A6%E4%B9%A0.image/20170605_181456_375_7033.png"></p>
<p>是的，Chrome允许插件在开发者工具(devtools)上动手脚，主要表现在：</p>
<ul>
<li>自定义一个和多个和<code>Elements</code>、<code>Console</code>、<code>Sources</code>等同级别的面板；</li>
<li>自定义侧边栏(sidebar)，目前只能自定义<code>Elements</code>面板的侧边栏；</li>
</ul>
<p>先来看2张简单的demo截图，自定义面板（判断当前页面是否使用了jQuery）：</p>
<p><img src="/crx%E5%AD%A6%E4%B9%A0.image/20170613_220126_669_2411.png"></p>
<p>自定义侧边栏（获取当前页面所有图片）：</p>
<p><img src="/crx%E5%AD%A6%E4%B9%A0.image/20170605_175952_228_8829.png"></p>
<h3 id="devtools扩展介绍"><a href="#devtools扩展介绍" class="headerlink" title="devtools扩展介绍"></a>devtools扩展介绍</h3><p>主页：<a target="_blank" rel="noopener" href="https://developer.chrome.com/extensions/devtools">https://developer.chrome.com/extensions/devtools</a></p>
<p>来一张官方图片：</p>
<p><img src="/crx%E5%AD%A6%E4%B9%A0.image/20170606_170623_349_6923.png"></p>
<p>每打开一个开发者工具窗口，都会创建devtools页面的实例，F12窗口关闭，页面也随着关闭，所以devtools页面的生命周期和devtools窗口是一致的。devtools页面可以访问一组特有的<code>DevTools API</code>以及有限的扩展API，这组特有的<code>DevTools API</code>只有devtools页面才可以访问，background都无权访问，这些API包括：</p>
<ul>
<li><code>chrome.devtools.panels</code>：面板相关；</li>
<li><code>chrome.devtools.inspectedWindow</code>：获取被审查窗口的有关信息；</li>
<li><code>chrome.devtools.network</code>：获取有关网络请求的信息；</li>
</ul>
<p>大部分扩展API都无法直接被<code>DevTools</code>页面调用，但它可以像<code>content-script</code>一样直接调用<code>chrome.extension</code>和<code>chrome.runtime</code>API，同时它也可以像<code>content-script</code>一样使用Message交互的方式与background页面进行通信。</p>
<h3 id="实例：创建一个devtools扩展"><a href="#实例：创建一个devtools扩展" class="headerlink" title="实例：创建一个devtools扩展"></a>实例：创建一个devtools扩展</h3><p>首先，要针对开发者工具开发插件，需要在清单文件声明如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="comment">// 只能指向一个HTML文件，不能是JS文件</span></span><br><span class="line">	<span class="string">&quot;devtools_page&quot;</span>: <span class="string">&quot;devtools.html&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个<code>devtools.html</code>里面一般什么都没有，就引入一个js：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;js/devtools.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>可以看出来，其实真正代码是<code>devtools.js</code>，html文件是“多余”的，所以这里觉得有点坑，<code>devtools_page</code>干嘛不允许直接指定JS呢？</p>
<p>再来看devtools.js的代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建自定义面板，同一个插件可以创建多个自定义面板</span></span><br><span class="line"><span class="comment">// 几个参数依次为：panel标题、图标（其实设置了也没地方显示）、要加载的页面、加载成功后的回调</span></span><br><span class="line">chrome.<span class="property">devtools</span>.<span class="property">panels</span>.<span class="title function_">create</span>(<span class="string">&#x27;MyPanel&#x27;</span>, <span class="string">&#x27;img/icon.png&#x27;</span>, <span class="string">&#x27;mypanel.html&#x27;</span>, <span class="keyword">function</span>(<span class="params">panel</span>)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;自定义面板创建成功！&#x27;</span>); <span class="comment">// 注意这个log一般看不到</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建自定义侧边栏</span></span><br><span class="line">chrome.<span class="property">devtools</span>.<span class="property">panels</span>.<span class="property">elements</span>.<span class="title function_">createSidebarPane</span>(<span class="string">&quot;Images&quot;</span>, <span class="keyword">function</span>(<span class="params">sidebar</span>)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// sidebar.setPage(&#x27;../sidebar.html&#x27;); // 指定加载某个页面</span></span><br><span class="line">	sidebar.<span class="title function_">setExpression</span>(<span class="string">&#x27;document.querySelectorAll(&quot;img&quot;)&#x27;</span>, <span class="string">&#x27;All Images&#x27;</span>); <span class="comment">// 通过表达式来指定</span></span><br><span class="line">	<span class="comment">//sidebar.setObject(&#123;aaa: 111, bbb: &#x27;Hello World!&#x27;&#125;); // 直接设置显示某个对象</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>setPage时的效果：</p>
<p><img src="/crx%E5%AD%A6%E4%B9%A0.image/20170613_194023_184_1728.png"></p>
<p>以下截图示例的代码：</p>
<p><img src="/crx%E5%AD%A6%E4%B9%A0.image/20170613_220345_133_1766.png"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 检测jQuery</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;check_jquery&#x27;</span>).<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// 访问被检查的页面DOM需要使用inspectedWindow</span></span><br><span class="line">	<span class="comment">// 简单例子：检测被检查页面是否使用了jQuery</span></span><br><span class="line">	chrome.<span class="property">devtools</span>.<span class="property">inspectedWindow</span>.<span class="built_in">eval</span>(<span class="string">&quot;jQuery.fn.jquery&quot;</span>, <span class="keyword">function</span>(<span class="params">result, isException</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">var</span> html = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">		<span class="keyword">if</span> (isException) html = <span class="string">&#x27;当前页面没有使用jQuery。&#x27;</span>;</span><br><span class="line">		<span class="keyword">else</span> html = <span class="string">&#x27;当前页面使用了jQuery，版本为：&#x27;</span>+result;</span><br><span class="line">		<span class="title function_">alert</span>(html);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 打开某个资源</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;open_resource&#x27;</span>).<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>)</span><br><span class="line">&#123;</span><br><span class="line">	chrome.<span class="property">devtools</span>.<span class="property">inspectedWindow</span>.<span class="built_in">eval</span>(<span class="string">&quot;window.location.href&quot;</span>, <span class="keyword">function</span>(<span class="params">result, isException</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		chrome.<span class="property">devtools</span>.<span class="property">panels</span>.<span class="title function_">openResource</span>(result, <span class="number">20</span>, <span class="keyword">function</span>(<span class="params"></span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;资源打开成功！&#x27;</span>);</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 审查元素</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;test_inspect&#x27;</span>).<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>)</span><br><span class="line">&#123;</span><br><span class="line">	chrome.<span class="property">devtools</span>.<span class="property">inspectedWindow</span>.<span class="built_in">eval</span>(<span class="string">&quot;inspect(document.images[0])&quot;</span>, <span class="keyword">function</span>(<span class="params">result, isException</span>)&#123;&#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取所有资源</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;get_all_resources&#x27;</span>).<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>)</span><br><span class="line">&#123;</span><br><span class="line">	chrome.<span class="property">devtools</span>.<span class="property">inspectedWindow</span>.<span class="title function_">getResources</span>(<span class="keyword">function</span>(<span class="params">resources</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="title function_">alert</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(resources));</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="调试技巧"><a href="#调试技巧" class="headerlink" title="调试技巧"></a>调试技巧</h3><p>修改了devtools页面的代码时，需要先在 chrome:&#x2F;&#x2F;extensions 页面按下<code>Ctrl+R</code>重新加载插件，然后关闭再打开开发者工具即可，无需刷新页面（而且只刷新页面不刷新开发者工具的话是不会生效的）。</p>
<p>由于devtools本身就是开发者工具页面，所以几乎没有方法可以直接调试它，直接用 <code>chrome-extension://extid/devtools.html&quot;</code>的方式打开页面肯定报错，因为不支持相关特殊API，只能先自己写一些方法屏蔽这些错误，调试通了再放开。</p>
<h2 id="option-选项页"><a href="#option-选项页" class="headerlink" title="option(选项页)"></a>option(选项页)</h2><p>所谓<code>options</code>页，就是插件的设置页面，有2个入口，一个是右键图标有一个“选项”菜单，还有一个在插件管理页面：</p>
<p><img src="/crx%E5%AD%A6%E4%B9%A0.image/20170621_170046_846_5529.png"></p>
<p><img src="/crx%E5%AD%A6%E4%B9%A0.image/20170621_115902_196_9130.png"></p>
<p>在Chrome40以前，options页面和其它普通页面没什么区别，Chrome40以后则有了一些变化。</p>
<p>我们先看老版的<a target="_blank" rel="noopener" href="https://developer.chrome.com/extensions/options">options</a>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="comment">// Chrome40以前的插件配置页写法</span></span><br><span class="line">	<span class="string">&quot;options_page&quot;</span>: <span class="string">&quot;options.html&quot;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个页面里面的内容就随你自己发挥了，配置之后在插件管理页就会看到一个<code>选项</code>按钮入口，点进去就是打开一个网页，没啥好讲的。</p>
<p>效果:</p>
<p><img src="/crx%E5%AD%A6%E4%B9%A0.image/20170621_115705_433_5886.png"></p>
<p>再来看新版的<a target="_blank" rel="noopener" href="https://developer.chrome.com/extensions/optionsV2">optionsV2</a>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;options_ui&quot;</span>:</span><br><span class="line">	&#123;</span><br><span class="line">    	<span class="string">&quot;page&quot;</span>: <span class="string">&quot;options.html&quot;</span>,</span><br><span class="line">		<span class="comment">// 添加一些默认的样式，推荐使用</span></span><br><span class="line">    	<span class="string">&quot;chrome_style&quot;</span>: <span class="literal">true</span></span><br><span class="line">	&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>options.html</code>的代码我们没有任何改动，只是配置文件改了，之后效果如下：</p>
<p><img src="/crx%E5%AD%A6%E4%B9%A0.image/20170621_115809_750_1163.png"></p>
<p>看起来是不是高大上了？</p>
<p>几点注意：</p>
<ul>
<li>为了兼容，建议2种都写，如果都写了，Chrome40以后会默认读取新版的方式；</li>
<li>新版options中不能使用alert；</li>
<li>数据存储建议用chrome.storage，因为会随用户自动同步；</li>
</ul>
<h2 id="omnibox"><a href="#omnibox" class="headerlink" title="omnibox"></a>omnibox</h2><p><code>omnibox</code>是向用户提供搜索建议的一种方式。先来看个<code>gif</code>图以便了解一下这东西到底是个什么鬼：</p>
<p><img src="/crx%E5%AD%A6%E4%B9%A0.image/20170621_155455_980_5359.gif"></p>
<p>注册某个关键字以触发插件自己的搜索建议界面，然后可以任意发挥了。</p>
<p>首先，配置文件如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="comment">// 向地址栏注册一个关键字以提供搜索建议，只能设置一个关键字</span></span><br><span class="line">	<span class="string">&quot;omnibox&quot;</span>: &#123; <span class="string">&quot;keyword&quot;</span> : <span class="string">&quot;go&quot;</span> &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后<code>background.js</code>中注册监听事件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// omnibox 演示</span></span><br><span class="line">chrome.<span class="property">omnibox</span>.<span class="property">onInputChanged</span>.<span class="title function_">addListener</span>(<span class="function">(<span class="params">text, suggest</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;inputChanged: &#x27;</span> + text);</span><br><span class="line">	<span class="keyword">if</span>(!text) <span class="keyword">return</span>;</span><br><span class="line">	<span class="keyword">if</span>(text == <span class="string">&#x27;美女&#x27;</span>) &#123;</span><br><span class="line">		<span class="title function_">suggest</span>([</span><br><span class="line">			&#123;<span class="attr">content</span>: <span class="string">&#x27;中国&#x27;</span> + text, <span class="attr">description</span>: <span class="string">&#x27;你要找“中国美女”吗？&#x27;</span>&#125;,</span><br><span class="line">			&#123;<span class="attr">content</span>: <span class="string">&#x27;日本&#x27;</span> + text, <span class="attr">description</span>: <span class="string">&#x27;你要找“日本美女”吗？&#x27;</span>&#125;,</span><br><span class="line">			&#123;<span class="attr">content</span>: <span class="string">&#x27;泰国&#x27;</span> + text, <span class="attr">description</span>: <span class="string">&#x27;你要找“泰国美女或人妖”吗？&#x27;</span>&#125;,</span><br><span class="line">			&#123;<span class="attr">content</span>: <span class="string">&#x27;韩国&#x27;</span> + text, <span class="attr">description</span>: <span class="string">&#x27;你要找“韩国美女”吗？&#x27;</span>&#125;</span><br><span class="line">		]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(text == <span class="string">&#x27;微博&#x27;</span>) &#123;</span><br><span class="line">		<span class="title function_">suggest</span>([</span><br><span class="line">			&#123;<span class="attr">content</span>: <span class="string">&#x27;新浪&#x27;</span> + text, <span class="attr">description</span>: <span class="string">&#x27;新浪&#x27;</span> + text&#125;,</span><br><span class="line">			&#123;<span class="attr">content</span>: <span class="string">&#x27;腾讯&#x27;</span> + text, <span class="attr">description</span>: <span class="string">&#x27;腾讯&#x27;</span> + text&#125;,</span><br><span class="line">			&#123;<span class="attr">content</span>: <span class="string">&#x27;搜狐&#x27;</span> + text, <span class="attr">description</span>: <span class="string">&#x27;搜索&#x27;</span> + text&#125;,</span><br><span class="line">		]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="title function_">suggest</span>([</span><br><span class="line">			&#123;<span class="attr">content</span>: <span class="string">&#x27;百度搜索 &#x27;</span> + text, <span class="attr">description</span>: <span class="string">&#x27;百度搜索 &#x27;</span> + text&#125;,</span><br><span class="line">			&#123;<span class="attr">content</span>: <span class="string">&#x27;谷歌搜索 &#x27;</span> + text, <span class="attr">description</span>: <span class="string">&#x27;谷歌搜索 &#x27;</span> + text&#125;,</span><br><span class="line">		]);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 当用户接收关键字建议时触发</span></span><br><span class="line">chrome.<span class="property">omnibox</span>.<span class="property">onInputEntered</span>.<span class="title function_">addListener</span>(<span class="function">(<span class="params">text</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;inputEntered: &#x27;</span> + text);</span><br><span class="line">	<span class="keyword">if</span>(!text) <span class="keyword">return</span>;</span><br><span class="line">	<span class="keyword">var</span> href = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span>(text.<span class="title function_">endsWith</span>(<span class="string">&#x27;美女&#x27;</span>)) href = <span class="string">&#x27;http://image.baidu.com/search/index?tn=baiduimage&amp;ie=utf-8&amp;word=&#x27;</span> + text;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(text.<span class="title function_">startsWith</span>(<span class="string">&#x27;百度搜索&#x27;</span>)) href = <span class="string">&#x27;https://www.baidu.com/s?ie=UTF-8&amp;wd=&#x27;</span> + text.<span class="title function_">replace</span>(<span class="string">&#x27;百度搜索 &#x27;</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(text.<span class="title function_">startsWith</span>(<span class="string">&#x27;谷歌搜索&#x27;</span>)) href = <span class="string">&#x27;https://www.google.com.tw/search?q=&#x27;</span> + text.<span class="title function_">replace</span>(<span class="string">&#x27;谷歌搜索 &#x27;</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">	<span class="keyword">else</span> href = <span class="string">&#x27;https://www.baidu.com/s?ie=UTF-8&amp;wd=&#x27;</span> + text;</span><br><span class="line">	<span class="title function_">openUrlCurrentTab</span>(href);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 获取当前选项卡ID</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getCurrentTabId</span>(<span class="params">callback</span>)</span><br><span class="line">&#123;</span><br><span class="line">	chrome.<span class="property">tabs</span>.<span class="title function_">query</span>(&#123;<span class="attr">active</span>: <span class="literal">true</span>, <span class="attr">currentWindow</span>: <span class="literal">true</span>&#125;, <span class="keyword">function</span>(<span class="params">tabs</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(callback) <span class="title function_">callback</span>(tabs.<span class="property">length</span> ? tabs[<span class="number">0</span>].<span class="property">id</span>: <span class="literal">null</span>);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 当前标签打开某个链接</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">openUrlCurrentTab</span>(<span class="params">url</span>)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="title function_">getCurrentTabId</span>(<span class="function"><span class="params">tabId</span> =&gt;</span> &#123;</span><br><span class="line">		chrome.<span class="property">tabs</span>.<span class="title function_">update</span>(tabId, &#123;<span class="attr">url</span>: url&#125;);</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="桌面通知"><a href="#桌面通知" class="headerlink" title="桌面通知"></a>桌面通知</h2><p>Chrome提供了一个<code>chrome.notifications</code>API以便插件推送桌面通知，暂未找到<code>chrome.notifications</code>和HTML5自带的<code>Notification</code>的显著区别及优势。</p>
<p>在后台JS中，无论是使用<code>chrome.notifications</code>还是<code>Notification</code>都不需要申请权限（HTML5方式需要申请权限），直接使用即可。</p>
<p>最简单的通知：</p>
<p><img src="/crx%E5%AD%A6%E4%B9%A0.image/20170531_193633_369_0274.png"></p>
<p>代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">chrome.<span class="property">notifications</span>.<span class="title function_">create</span>(<span class="literal">null</span>, &#123;</span><br><span class="line">	<span class="attr">type</span>: <span class="string">&#x27;basic&#x27;</span>,</span><br><span class="line">	<span class="attr">iconUrl</span>: <span class="string">&#x27;img/icon.png&#x27;</span>,</span><br><span class="line">	<span class="attr">title</span>: <span class="string">&#x27;这是标题&#x27;</span>,</span><br><span class="line">	<span class="attr">message</span>: <span class="string">&#x27;您刚才点击了自定义右键菜单！&#x27;</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>通知的样式可以很丰富：</p>
<p><img src="/crx%E5%AD%A6%E4%B9%A0.image/20170531_193836_583_4450.png"></p>
<p>这个没有深入研究，有需要的可以去看官方文档。</p>
<h1 id="5种类型的JS对比"><a href="#5种类型的JS对比" class="headerlink" title="5种类型的JS对比"></a>5种类型的JS对比</h1><p>Chrome插件的JS主要可以分为这5类：<code>injected script</code>、<code>content-script</code>、<code>popup js</code>、<code>background js</code>和<code>devtools js</code>，</p>
<h2 id="权限对比"><a href="#权限对比" class="headerlink" title="权限对比"></a>权限对比</h2><table>
<thead>
<tr>
<th>JS种类</th>
<th>可访问的API</th>
<th>DOM访问情况</th>
<th>JS访问情况</th>
<th>直接跨域</th>
</tr>
</thead>
<tbody><tr>
<td>injected script</td>
<td>和普通JS无任何差别，不能访问任何扩展API</td>
<td>可以访问</td>
<td>可以访问</td>
<td>不可以</td>
</tr>
<tr>
<td>content script</td>
<td>只能访问 extension、runtime等部分API</td>
<td>可以访问</td>
<td>不可以</td>
<td>不可以</td>
</tr>
<tr>
<td>popup js</td>
<td>可访问绝大部分API，除了devtools系列</td>
<td>不可直接访问</td>
<td>不可以</td>
<td>可以</td>
</tr>
<tr>
<td>background js</td>
<td>可访问绝大部分API，除了devtools系列</td>
<td>不可直接访问</td>
<td>不可以</td>
<td>可以</td>
</tr>
<tr>
<td>devtools js</td>
<td>只能访问 devtools、extension、runtime等部分API</td>
<td>可以</td>
<td>可以</td>
<td>不可以</td>
</tr>
</tbody></table>
<h2 id="调试方式对比"><a href="#调试方式对比" class="headerlink" title="调试方式对比"></a>调试方式对比</h2><table>
<thead>
<tr>
<th>JS类型</th>
<th>调试方式</th>
<th>图片说明</th>
</tr>
</thead>
<tbody><tr>
<td>injected script</td>
<td>直接普通的F12即可</td>
<td>懒得截图</td>
</tr>
<tr>
<td>content-script</td>
<td>打开Console,如图切换</td>
<td><img src="/crx%E5%AD%A6%E4%B9%A0.image/20161220_105526_629_8533.png"></td>
</tr>
<tr>
<td>popup-js</td>
<td>popup页面右键审查元素</td>
<td><img src="/crx%E5%AD%A6%E4%B9%A0.image/20161220_105716_178_6900.png"></td>
</tr>
<tr>
<td>background</td>
<td>插件管理页点击背景页即可</td>
<td><img src="/crx%E5%AD%A6%E4%B9%A0.image/20161220_105811_922_5621.png"></td>
</tr>
<tr>
<td>devtools-js</td>
<td>暂未找到有效方法</td>
<td>-</td>
</tr>
</tbody></table>
<h1 id="消息通信"><a href="#消息通信" class="headerlink" title="消息通信"></a>消息通信</h1><p>通信主页：<a target="_blank" rel="noopener" href="https://developer.chrome.com/extensions/messaging">https://developer.chrome.com/extensions/messaging</a></p>
<p>前面我们介绍了Chrome插件中存在的5种JS，那么它们之间如何互相通信呢？下面先来系统概况一下，然后再分类细说。需要知道的是，popup和background其实几乎可以视为一种东西，因为它们可访问的API都一样、通信机制一样、都可以跨域。</p>
<h2 id="互相通信概览"><a href="#互相通信概览" class="headerlink" title="互相通信概览"></a>互相通信概览</h2><p>注：<code>-</code>表示不存在或者无意义，或者待验证。</p>
<table>
<thead>
<tr>
<th></th>
<th>injected-script</th>
<th>content-script</th>
<th>popup-js</th>
<th>background-js</th>
</tr>
</thead>
<tbody><tr>
<td>injected-script</td>
<td>-</td>
<td>window.postMessage</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>content-script</td>
<td>window.postMessage</td>
<td>-</td>
<td>chrome.runtime.sendMessage chrome.runtime.connect</td>
<td>chrome.runtime.sendMessage chrome.runtime.connect</td>
</tr>
<tr>
<td>popup-js</td>
<td>-</td>
<td>chrome.tabs.sendMessage chrome.tabs.connect</td>
<td>-</td>
<td>chrome.extension. getBackgroundPage()</td>
</tr>
<tr>
<td>background-js</td>
<td>-</td>
<td>chrome.tabs.sendMessage chrome.tabs.connect</td>
<td>chrome.extension.getViews</td>
<td>-</td>
</tr>
<tr>
<td>devtools-js</td>
<td>chrome.devtools. inspectedWindow.eval</td>
<td>-</td>
<td>chrome.runtime.sendMessage</td>
<td>chrome.runtime.sendMessage</td>
</tr>
</tbody></table>
<h2 id="通信详细介绍"><a href="#通信详细介绍" class="headerlink" title="通信详细介绍"></a>通信详细介绍</h2><h3 id="popup和background"><a href="#popup和background" class="headerlink" title="popup和background"></a>popup和background</h3><p>popup可以直接调用background中的JS方法，也可以直接访问background的DOM：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// background.js</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">test</span>(<span class="params"></span>)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="title function_">alert</span>(<span class="string">&#x27;我是background！&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// popup.js</span></span><br><span class="line"><span class="keyword">var</span> bg = chrome.<span class="property">extension</span>.<span class="title function_">getBackgroundPage</span>();</span><br><span class="line">bg.<span class="title function_">test</span>(); <span class="comment">// 访问bg的函数</span></span><br><span class="line"><span class="title function_">alert</span>(bg.<span class="property">document</span>.<span class="property">body</span>.<span class="property">innerHTML</span>); <span class="comment">// 访问bg的DOM</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>小插曲，今天碰到一个情况，发现popup无法获取background的任何方法，找了半天才发现是因为background的js报错了，而你如果不主动查看background的js的话，是看不到错误信息的，特此提醒。</p>
</blockquote>
<p>至于<code>background</code>访问<code>popup</code>如下（前提是<code>popup</code>已经打开）：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> views = chrome.<span class="property">extension</span>.<span class="title function_">getViews</span>(&#123;<span class="attr">type</span>:<span class="string">&#x27;popup&#x27;</span>&#125;);</span><br><span class="line"><span class="keyword">if</span>(views.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(views[<span class="number">0</span>].<span class="property">location</span>.<span class="property">href</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="popup或者bg向content主动发送消息"><a href="#popup或者bg向content主动发送消息" class="headerlink" title="popup或者bg向content主动发送消息"></a>popup或者bg向content主动发送消息</h3><p>background.js或者popup.js：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">sendMessageToContentScript</span>(<span class="params">message, callback</span>)</span><br><span class="line">&#123;</span><br><span class="line">	chrome.<span class="property">tabs</span>.<span class="title function_">query</span>(&#123;<span class="attr">active</span>: <span class="literal">true</span>, <span class="attr">currentWindow</span>: <span class="literal">true</span>&#125;, <span class="keyword">function</span>(<span class="params">tabs</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		chrome.<span class="property">tabs</span>.<span class="title function_">sendMessage</span>(tabs[<span class="number">0</span>].<span class="property">id</span>, message, <span class="keyword">function</span>(<span class="params">response</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span>(callback) <span class="title function_">callback</span>(response);</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">sendMessageToContentScript</span>(&#123;<span class="attr">cmd</span>:<span class="string">&#x27;test&#x27;</span>, <span class="attr">value</span>:<span class="string">&#x27;你好，我是popup！&#x27;</span>&#125;, <span class="keyword">function</span>(<span class="params">response</span>)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;来自content的回复：&#x27;</span>+response);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><code>content-script.js</code>接收：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">chrome.<span class="property">runtime</span>.<span class="property">onMessage</span>.<span class="title function_">addListener</span>(<span class="keyword">function</span>(<span class="params">request, sender, sendResponse</span>)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// console.log(sender.tab ?&quot;from a content script:&quot; + sender.tab.url :&quot;from the extension&quot;);</span></span><br><span class="line">	<span class="keyword">if</span>(request.<span class="property">cmd</span> == <span class="string">&#x27;test&#x27;</span>) <span class="title function_">alert</span>(request.<span class="property">value</span>);</span><br><span class="line">	<span class="title function_">sendResponse</span>(<span class="string">&#x27;我收到了你的消息！&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>双方通信直接发送的都是JSON对象，不是JSON字符串，所以无需解析，很方便（当然也可以直接发送字符串）。</p>
<blockquote>
<p>网上有些老代码中用的是<code>chrome.extension.onMessage</code>，没有完全查清二者的区别(貌似是别名)，但是建议统一使用<code>chrome.runtime.onMessage</code>。</p>
</blockquote>
<h3 id="content-script主动发消息给后台"><a href="#content-script主动发消息给后台" class="headerlink" title="content-script主动发消息给后台"></a>content-script主动发消息给后台</h3><p>content-script.js：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chrome.<span class="property">runtime</span>.<span class="title function_">sendMessage</span>(&#123;<span class="attr">greeting</span>: <span class="string">&#x27;你好，我是content-script呀，我主动发消息给后台！&#x27;</span>&#125;, <span class="keyword">function</span>(<span class="params">response</span>) &#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;收到来自后台的回复：&#x27;</span> + response);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>background.js 或者 popup.js：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 监听来自content-script的消息</span></span><br><span class="line">chrome.<span class="property">runtime</span>.<span class="property">onMessage</span>.<span class="title function_">addListener</span>(<span class="keyword">function</span>(<span class="params">request, sender, sendResponse</span>)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;收到来自content-script的消息：&#x27;</span>);</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(request, sender, sendResponse);</span><br><span class="line">	<span class="title function_">sendResponse</span>(<span class="string">&#x27;我是后台，我已收到你的消息：&#x27;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(request));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>注意事项：</p>
<ul>
<li>content_scripts向<code>popup</code>主动发消息的前提是popup必须打开！否则需要利用background作中转；</li>
<li>如果background和popup同时监听，那么它们都可以同时收到消息，但是只有一个可以sendResponse，一个先发送了，那么另外一个再发送就无效；</li>
</ul>
<h3 id="injected-script和content-script"><a href="#injected-script和content-script" class="headerlink" title="injected script和content-script"></a>injected script和content-script</h3><p><code>content-script</code>和页面内的脚本（<code>injected-script</code>自然也属于页面内的脚本）之间唯一共享的东西就是页面的DOM元素，有2种方法可以实现二者通讯：</p>
<ol>
<li>可以通过<code>window.postMessage</code>和<code>window.addEventListener</code>来实现二者消息通讯；</li>
<li>通过自定义DOM事件来实现；</li>
</ol>
<p>第一种方法（推荐）：</p>
<p><code>injected-script</code>中：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">window</span>.<span class="title function_">postMessage</span>(&#123;<span class="string">&quot;test&quot;</span>: <span class="string">&#x27;你好！&#x27;</span>&#125;, <span class="string">&#x27;*&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>content script中：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;message&quot;</span>, <span class="keyword">function</span>(<span class="params">e</span>)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">data</span>);</span><br><span class="line">&#125;, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure>

<p>第二种方法：</p>
<p><code>injected-script</code>中：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> customEvent = <span class="variable language_">document</span>.<span class="title function_">createEvent</span>(<span class="string">&#x27;Event&#x27;</span>);</span><br><span class="line">customEvent.<span class="title function_">initEvent</span>(<span class="string">&#x27;myCustomEvent&#x27;</span>, <span class="literal">true</span>, <span class="literal">true</span>);</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fireCustomEvent</span>(<span class="params">data</span>) &#123;</span><br><span class="line">	hiddenDiv = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;myCustomEventDiv&#x27;</span>);</span><br><span class="line">	hiddenDiv.<span class="property">innerText</span> = data</span><br><span class="line">	hiddenDiv.<span class="title function_">dispatchEvent</span>(customEvent);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">fireCustomEvent</span>(<span class="string">&#x27;你好，我是普通JS！&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><code>content-script.js</code>中：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> hiddenDiv = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;myCustomEventDiv&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>(!hiddenDiv) &#123;</span><br><span class="line">	hiddenDiv = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line">	hiddenDiv.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;none&#x27;</span>;</span><br><span class="line">	<span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(hiddenDiv);</span><br><span class="line">&#125;</span><br><span class="line">hiddenDiv.<span class="title function_">addEventListener</span>(<span class="string">&#x27;myCustomEvent&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">	<span class="keyword">var</span> eventData = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;myCustomEventDiv&#x27;</span>).<span class="property">innerText</span>;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;收到自定义事件消息：&#x27;</span> + eventData);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="长连接和短连接"><a href="#长连接和短连接" class="headerlink" title="长连接和短连接"></a>长连接和短连接</h2><p>其实上面已经涉及到了，这里再单独说明一下。Chrome插件中有2种通信方式，一个是短连接（<code>chrome.tabs.sendMessage</code>和<code>chrome.runtime.sendMessage</code>），一个是长连接（<code>chrome.tabs.connect</code>和<code>chrome.runtime.connect</code>）。</p>
<p>短连接的话就是挤牙膏一样，我发送一下，你收到了再回复一下，如果对方不回复，你只能重新发，而长连接类似<code>WebSocket</code>会一直建立连接，双方可以随时互发消息。</p>
<p>短连接上面已经有代码示例了，这里只讲一下长连接。</p>
<p>popup.js：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">getCurrentTabId</span>(<span class="function">(<span class="params">tabId</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="keyword">var</span> port = chrome.<span class="property">tabs</span>.<span class="title function_">connect</span>(tabId, &#123;<span class="attr">name</span>: <span class="string">&#x27;test-connect&#x27;</span>&#125;);</span><br><span class="line">	port.<span class="title function_">postMessage</span>(&#123;<span class="attr">question</span>: <span class="string">&#x27;你是谁啊？&#x27;</span>&#125;);</span><br><span class="line">	port.<span class="property">onMessage</span>.<span class="title function_">addListener</span>(<span class="keyword">function</span>(<span class="params">msg</span>) &#123;</span><br><span class="line">		<span class="title function_">alert</span>(<span class="string">&#x27;收到消息：&#x27;</span>+msg.<span class="property">answer</span>);</span><br><span class="line">		<span class="keyword">if</span>(msg.<span class="property">answer</span> &amp;&amp; msg.<span class="property">answer</span>.<span class="title function_">startsWith</span>(<span class="string">&#x27;我是&#x27;</span>))</span><br><span class="line">		&#123;</span><br><span class="line">			port.<span class="title function_">postMessage</span>(&#123;<span class="attr">question</span>: <span class="string">&#x27;哦，原来是你啊！&#x27;</span>&#125;);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>content-script.js：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 监听长连接</span></span><br><span class="line">chrome.<span class="property">runtime</span>.<span class="property">onConnect</span>.<span class="title function_">addListener</span>(<span class="keyword">function</span>(<span class="params">port</span>) &#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(port);</span><br><span class="line">	<span class="keyword">if</span>(port.<span class="property">name</span> == <span class="string">&#x27;test-connect&#x27;</span>) &#123;</span><br><span class="line">		port.<span class="property">onMessage</span>.<span class="title function_">addListener</span>(<span class="keyword">function</span>(<span class="params">msg</span>) &#123;</span><br><span class="line">			<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;收到长连接消息：&#x27;</span>, msg);</span><br><span class="line">			<span class="keyword">if</span>(msg.<span class="property">question</span> == <span class="string">&#x27;你是谁啊？&#x27;</span>) port.<span class="title function_">postMessage</span>(&#123;<span class="attr">answer</span>: <span class="string">&#x27;我是你爸！&#x27;</span>&#125;);</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h1 id="其它补充"><a href="#其它补充" class="headerlink" title="其它补充"></a>其它补充</h1><h2 id="动态注入或执行JS"><a href="#动态注入或执行JS" class="headerlink" title="动态注入或执行JS"></a>动态注入或执行JS</h2><p>虽然在<code>background</code>和<code>popup</code>中无法直接访问页面DOM，但是可以通过<code>chrome.tabs.executeScript</code>来执行脚本，从而实现访问web页面的DOM（注意，这种方式也不能直接访问页面JS）。</p>
<p>示例<code>manifest.json</code>配置：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;name&quot;</span>: <span class="string">&quot;动态JS注入演示&quot;</span>,</span><br><span class="line">	...</span><br><span class="line">	<span class="string">&quot;permissions&quot;</span>: [</span><br><span class="line">		<span class="string">&quot;tabs&quot;</span>, <span class="string">&quot;http://*/*&quot;</span>, <span class="string">&quot;https://*/*&quot;</span></span><br><span class="line">	],</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>JS：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 动态执行JS代码</span></span><br><span class="line">chrome.<span class="property">tabs</span>.<span class="title function_">executeScript</span>(tabId, &#123;<span class="attr">code</span>: <span class="string">&#x27;document.body.style.backgroundColor=&quot;red&quot;&#x27;</span>&#125;);</span><br><span class="line"><span class="comment">// 动态执行JS文件</span></span><br><span class="line">chrome.<span class="property">tabs</span>.<span class="title function_">executeScript</span>(tabId, &#123;<span class="attr">file</span>: <span class="string">&#x27;some-script.js&#x27;</span>&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="动态注入CSS"><a href="#动态注入CSS" class="headerlink" title="动态注入CSS"></a>动态注入CSS</h2><p>示例<code>manifest.json</code>配置：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;name&quot;</span>: <span class="string">&quot;动态CSS注入演示&quot;</span>,</span><br><span class="line">	...</span><br><span class="line">	<span class="string">&quot;permissions&quot;</span>: [</span><br><span class="line">		<span class="string">&quot;tabs&quot;</span>, <span class="string">&quot;http://*/*&quot;</span>, <span class="string">&quot;https://*/*&quot;</span></span><br><span class="line">	],</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>JS代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 动态执行CSS代码，TODO，这里有待验证</span></span><br><span class="line">chrome.<span class="property">tabs</span>.<span class="title function_">insertCSS</span>(tabId, &#123;<span class="attr">code</span>: <span class="string">&#x27;xxx&#x27;</span>&#125;);</span><br><span class="line"><span class="comment">// 动态执行CSS文件</span></span><br><span class="line">chrome.<span class="property">tabs</span>.<span class="title function_">insertCSS</span>(tabId, &#123;<span class="attr">file</span>: <span class="string">&#x27;some-style.css&#x27;</span>&#125;);</span><br></pre></td></tr></table></figure>


<h2 id="获取当前窗口ID"><a href="#获取当前窗口ID" class="headerlink" title="获取当前窗口ID"></a>获取当前窗口ID</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">chrome.<span class="property">windows</span>.<span class="title function_">getCurrent</span>(<span class="keyword">function</span>(<span class="params">currentWindow</span>)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;当前窗口ID：&#x27;</span> + currentWindow.<span class="property">id</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="获取当前标签页ID"><a href="#获取当前标签页ID" class="headerlink" title="获取当前标签页ID"></a>获取当前标签页ID</h2><p>一般有2种方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取当前选项卡ID</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getCurrentTabId</span>(<span class="params">callback</span>)</span><br><span class="line">&#123;</span><br><span class="line">	chrome.<span class="property">tabs</span>.<span class="title function_">query</span>(&#123;<span class="attr">active</span>: <span class="literal">true</span>, <span class="attr">currentWindow</span>: <span class="literal">true</span>&#125;, <span class="keyword">function</span>(<span class="params">tabs</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(callback) <span class="title function_">callback</span>(tabs.<span class="property">length</span> ? tabs[<span class="number">0</span>].<span class="property">id</span>: <span class="literal">null</span>);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>获取当前选项卡id的另一种方法，大部分时候都类似，只有少部分时候会不一样（例如当窗口最小化时）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取当前选项卡ID</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getCurrentTabId2</span>(<span class="params"></span>)</span><br><span class="line">&#123;</span><br><span class="line">	chrome.<span class="property">windows</span>.<span class="title function_">getCurrent</span>(<span class="keyword">function</span>(<span class="params">currentWindow</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		chrome.<span class="property">tabs</span>.<span class="title function_">query</span>(&#123;<span class="attr">active</span>: <span class="literal">true</span>, <span class="attr">windowId</span>: currentWindow.<span class="property">id</span>&#125;, <span class="keyword">function</span>(<span class="params">tabs</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span>(callback) <span class="title function_">callback</span>(tabs.<span class="property">length</span> ? tabs[<span class="number">0</span>].<span class="property">id</span>: <span class="literal">null</span>);</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="本地存储"><a href="#本地存储" class="headerlink" title="本地存储"></a>本地存储</h2><p>本地存储建议用<code>chrome.storage</code>而不是普通的<code>localStorage</code>，区别有好几点，个人认为最重要的2点区别是：</p>
<ul>
<li><code>chrome.storage</code>是针对插件全局的，即使你在<code>background</code>中保存的数据，在<code>content-script</code>也能获取到；</li>
<li><code>chrome.storage.sync</code>可以跟随当前登录用户自动同步，这台电脑修改的设置会自动同步到其它电脑，很方便，如果没有登录或者未联网则先保存到本地，等登录了再同步至网络；</li>
</ul>
<p>需要声明<code>storage</code>权限，有<code>chrome.storage.sync</code>和<code>chrome.storage.local</code>2种方式可供选择，使用示例如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 读取数据，第一个参数是指定要读取的key以及设置默认值</span></span><br><span class="line">chrome.<span class="property">storage</span>.<span class="property">sync</span>.<span class="title function_">get</span>(&#123;<span class="attr">color</span>: <span class="string">&#x27;red&#x27;</span>, <span class="attr">age</span>: <span class="number">18</span>&#125;, <span class="keyword">function</span>(<span class="params">items</span>) &#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(items.<span class="property">color</span>, items.<span class="property">age</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 保存数据</span></span><br><span class="line">chrome.<span class="property">storage</span>.<span class="property">sync</span>.<span class="title function_">set</span>(&#123;<span class="attr">color</span>: <span class="string">&#x27;blue&#x27;</span>&#125;, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;保存成功！&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="webRequest"><a href="#webRequest" class="headerlink" title="webRequest"></a>webRequest</h2><p>通过webRequest系列API可以对HTTP请求进行任性地修改、定制，这里通过<code>beforeRequest</code>来简单演示一下它的冰山一角：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//manifest.json</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// 权限申请</span></span><br><span class="line">	<span class="string">&quot;permissions&quot;</span>:</span><br><span class="line">	[</span><br><span class="line">		<span class="string">&quot;webRequest&quot;</span>, <span class="comment">// web请求</span></span><br><span class="line">		<span class="string">&quot;webRequestBlocking&quot;</span>, <span class="comment">// 阻塞式web请求</span></span><br><span class="line">		<span class="string">&quot;storage&quot;</span>, <span class="comment">// 插件本地存储</span></span><br><span class="line">		<span class="string">&quot;http://*/*&quot;</span>, <span class="comment">// 可以通过executeScript或者insertCSS访问的网站</span></span><br><span class="line">		<span class="string">&quot;https://*/*&quot;</span> <span class="comment">// 可以通过executeScript或者insertCSS访问的网站</span></span><br><span class="line">	],</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// background.js</span></span><br><span class="line"><span class="comment">// 是否显示图片</span></span><br><span class="line"><span class="keyword">var</span> showImage;</span><br><span class="line">chrome.<span class="property">storage</span>.<span class="property">sync</span>.<span class="title function_">get</span>(&#123;<span class="attr">showImage</span>: <span class="literal">true</span>&#125;, <span class="keyword">function</span>(<span class="params">items</span>) &#123;</span><br><span class="line">	showImage = items.<span class="property">showImage</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// web请求监听，最后一个参数表示阻塞式，需单独声明权限：webRequestBlocking</span></span><br><span class="line">chrome.<span class="property">webRequest</span>.<span class="property">onBeforeRequest</span>.<span class="title function_">addListener</span>(<span class="function"><span class="params">details</span> =&gt;</span> &#123;</span><br><span class="line">	<span class="comment">// cancel 表示取消本次请求</span></span><br><span class="line">	<span class="keyword">if</span>(!showImage &amp;&amp; details.<span class="property">type</span> == <span class="string">&#x27;image&#x27;</span>) <span class="keyword">return</span> &#123;<span class="attr">cancel</span>: <span class="literal">true</span>&#125;;</span><br><span class="line">	<span class="comment">// 简单的音视频检测</span></span><br><span class="line">	<span class="comment">// 大部分网站视频的type并不是media，且视频做了防下载处理，所以这里仅仅是为了演示效果，无实际意义</span></span><br><span class="line">	<span class="keyword">if</span>(details.<span class="property">type</span> == <span class="string">&#x27;media&#x27;</span>) &#123;</span><br><span class="line">		chrome.<span class="property">notifications</span>.<span class="title function_">create</span>(<span class="literal">null</span>, &#123;</span><br><span class="line">			<span class="attr">type</span>: <span class="string">&#x27;basic&#x27;</span>,</span><br><span class="line">			<span class="attr">iconUrl</span>: <span class="string">&#x27;img/icon.png&#x27;</span>,</span><br><span class="line">			<span class="attr">title</span>: <span class="string">&#x27;检测到音视频&#x27;</span>,</span><br><span class="line">			<span class="attr">message</span>: <span class="string">&#x27;音视频地址：&#x27;</span> + details.<span class="property">url</span>,</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;, &#123;<span class="attr">urls</span>: [<span class="string">&quot;&lt;all_urls&gt;&quot;</span>]&#125;, [<span class="string">&quot;blocking&quot;</span>]);</span><br></pre></td></tr></table></figure>

<h2 id="国际化"><a href="#国际化" class="headerlink" title="国际化"></a>国际化</h2><p>插件根目录新建一个名为<code>_locales</code>的文件夹，再在下面新建一些语言的文件夹，如<code>en</code>、<code>zh_CN</code>、<code>zh_TW</code>，然后再在每个文件夹放入一个<code>messages.json</code>，同时必须在清单文件中设置<code>default_locale</code>。</p>
<p><code>_locales\en\messages.json</code>内容：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;pluginDesc&quot;</span>: &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;A simple chrome extension demo&quot;</span>&#125;,</span><br><span class="line">	<span class="string">&quot;helloWorld&quot;</span>: &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Hello World!&quot;</span>&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>_locales\zh_CN\messages.json</code>内容：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;pluginDesc&quot;</span>: &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;一个简单的Chrome插件demo&quot;</span>&#125;,</span><br><span class="line">	<span class="string">&quot;helloWorld&quot;</span>: &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;你好啊，世界！&quot;</span>&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在<code>manifest.json</code>和<code>CSS</code>文件中通过<code>__MSG_messagename__</code>引入，如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;description&quot;</span>: <span class="string">&quot;__MSG_pluginDesc__&quot;</span>,</span><br><span class="line">	<span class="comment">// 默认语言</span></span><br><span class="line">	<span class="string">&quot;default_locale&quot;</span>: <span class="string">&quot;zh_CN&quot;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>JS中则直接<code>chrome.i18n.getMessage(&quot;helloWorld&quot;)</code>。</p>
<p>测试时，通过给chrome建立一个不同的快捷方式<code>chrome.exe --lang=en</code>来切换语言，如：</p>
<p><img src="/crx%E5%AD%A6%E4%B9%A0.image/20170621_180606_759_2394.png"></p>
<p>英文效果：</p>
<p><img src="/crx%E5%AD%A6%E4%B9%A0.image/20170621_175733_172_5903.png"></p>
<p>中文效果：</p>
<p><img src="/crx%E5%AD%A6%E4%B9%A0.image/20170621_175621_269_0466.png"></p>
<h2 id="API总结"><a href="#API总结" class="headerlink" title="API总结"></a>API总结</h2><p>比较常用用的一些API系列：</p>
<ul>
<li>chrome.tabs</li>
<li>chrome.runtime</li>
<li>chrome.webRequest</li>
<li>chrome.window</li>
<li>chrome.storage</li>
<li>chrome.contextMenus</li>
<li>chrome.devtools</li>
<li>chrome.extension</li>
</ul>
<h1 id="经验总结"><a href="#经验总结" class="headerlink" title="经验总结"></a>经验总结</h1><h2 id="查看已安装插件路径"><a href="#查看已安装插件路径" class="headerlink" title="查看已安装插件路径"></a>查看已安装插件路径</h2><p>已安装的插件源码路径：<code>C:\Users\用户名\AppData\Local\Google\Chrome\User Data\Default\Extensions</code>，每一个插件被放在以插件ID为名的文件夹里面，想要学习某个插件的某个功能是如何实现的，看人家的源码是最好的方法了：</p>
<p><img src="/crx%E5%AD%A6%E4%B9%A0.image/20170601_100200_647_6507.png"></p>
<p>如何查看某个插件的ID？进入 chrome:&#x2F;&#x2F;extensions ，然后勾线开发者模式即可看到了。</p>
<p><img src="/crx%E5%AD%A6%E4%B9%A0.image/20170601_100408_338_3095.png"></p>
<h2 id="特别注意background的报错"><a href="#特别注意background的报错" class="headerlink" title="特别注意background的报错"></a>特别注意background的报错</h2><p>很多时候你发现你的代码会莫名其妙的失效，找来找去又找不到原因，这时打开background的控制台才发现原来某个地方写错了导致代码没生效，正式由于background报错的隐蔽性(需要主动打开对应的控制台才能看到错误)，所以特别注意这点。</p>
<h2 id="如何让popup页面不关闭"><a href="#如何让popup页面不关闭" class="headerlink" title="如何让popup页面不关闭"></a>如何让popup页面不关闭</h2><p>在对popup页面审查元素的时候popup会被强制打开无法关闭，只有控制台关闭了才可以关闭popup，原因很简单：如果popup关闭了控制台就没用了。这种方法在某些情况下很实用！</p>
<h2 id="不支持内联JavaScript的执行"><a href="#不支持内联JavaScript的执行" class="headerlink" title="不支持内联JavaScript的执行"></a>不支持内联JavaScript的执行</h2><p>也就是不支持将js直接写在html中，比如：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;btn&quot;</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;收藏&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;test()&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>报错如下：</p>
<pre><code>Refused to execute inline event handler because it violates the following Content Security Policy directive: &quot;script-src &#39;self&#39; blob: filesystem: chrome-extension-resource:&quot;. Either the &#39;unsafe-inline&#39; keyword, a hash (&#39;sha256-...&#39;), or a nonce (&#39;nonce-...&#39;) is required to enable inline execution.
</code></pre>
<p>解决方法就是用JS绑定事件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&#x27;#btn&#x27;</span>).<span class="title function_">on</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="title function_">alert</span>(<span class="string">&#x27;测试&#x27;</span>)&#125;);</span><br></pre></td></tr></table></figure>

<p>另外，对于A标签，这样写<code>href=&quot;javascript:;&quot;</code>然后用JS绑定事件虽然控制台会报错，但是不受影响，当然强迫症患者受不了的话只能写成<code>href=&quot;#&quot;</code>了。</p>
<p>如果这样写：</p>
<pre><code>&lt;a href=&quot;javascript:;&quot; id=&quot;get_secret&quot;&gt;请求secret&lt;/a&gt;
</code></pre>
<p>报错如下：</p>
<pre><code>Refused to execute JavaScript URL because it violates the following Content Security Policy directive: &quot;script-src &#39;self&#39; blob: filesystem: chrome-extension-resource:&quot;. Either the &#39;unsafe-inline&#39; keyword, a hash (&#39;sha256-...&#39;), or a nonce (&#39;nonce-...&#39;) is required to enable inline execution.
</code></pre>
<h2 id="注入CSS的时候必须小心"><a href="#注入CSS的时候必须小心" class="headerlink" title="注入CSS的时候必须小心"></a>注入CSS的时候必须小心</h2><p>由于通过<code>content_scripts</code>注入的CSS优先级非常高，几乎仅次于浏览器默认样式，稍不注意可能就会影响一些网站的展示效果，所以尽量不要写一些影响全局的样式。</p>
<p>之所以强调这个，是因为这个带来的问题非常隐蔽，不太容易找到，可能你正在写某个网页，昨天样式还是好好的，怎么今天就突然不行了？然后你辛辛苦苦找来找去，找了半天才发现竟然是因为插件里面的一个样式影响的！</p>
<p><img src="/crx%E5%AD%A6%E4%B9%A0.image/20170620_175530_598_9800.png"></p>
<h1 id="打包与发布"><a href="#打包与发布" class="headerlink" title="打包与发布"></a>打包与发布</h1><p>打包的话直接在插件管理页有一个打包按钮：</p>
<p><img src="/crx%E5%AD%A6%E4%B9%A0.image/20170621_181130_362_3360.png"></p>
<p>然后会生成一个<code>.crx</code>文件，要发布到Google应用商店的话需要先登录你的Google账号，然后花5个$注册为开发者，本人太穷，就懒得亲自验证了，有发布需求的自己去整吧。</p>
<p><img src="/crx%E5%AD%A6%E4%B9%A0.image/20170710_221653_875_3099.png"></p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><h2 id="官方资料"><a href="#官方资料" class="headerlink" title="官方资料"></a>官方资料</h2><p>推荐查看官方文档，虽然是英文，但是全且新，国内的中文资料都比较旧（注意以下全部需要翻墙）：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://developer.chrome.com/extensions">Chrome插件官方文档主页</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.chrome.com/extensions/samples">Chrome插件官方示例</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.chrome.com/extensions/manifest">manifest清单文件</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.chrome.com/extensions/permissions">permissions权限</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.chrome.com/extensions/api_index">chrome.xxx.api文档</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.chrome.com/extensions/match_patterns">模糊匹配规则语法详解</a></li>
</ul>
<h2 id="第三方资料"><a href="#第三方资料" class="headerlink" title="第三方资料"></a>第三方资料</h2><p>部分中文资料，不是特别推荐：</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://open.se.360.cn/open/extension_dev/overview.html">360安全浏览器开发文档</a></li>
<li><a target="_blank" rel="noopener" href="http://open.chrome.360.cn/extension_dev/overview.html">360极速浏览器Chrome扩展开发文档</a></li>
<li><a target="_blank" rel="noopener" href="http://www.cnblogs.com/champagne/p/">Chrome扩展开发极客系列博客</a></li>
</ul>
<h2 id="附图"><a href="#附图" class="headerlink" title="附图"></a>附图</h2><p>附图：Chrome高清png格式logo：</p>
<p><img src="/crx%E5%AD%A6%E4%B9%A0.image/20170619_113331_710_1132.png"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://mindcons.cn/2022/07/19/web/%E4%B8%93%E6%A0%8F/Chrome%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/crx%E5%AD%A6%E4%B9%A0/" data-id="cldolkc5n003rfgx639vh8n4o" data-title="crx学习" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-web/专栏/Chrome插件开发/crx实操" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/07/19/web/%E4%B8%93%E6%A0%8F/Chrome%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/crx%E5%AE%9E%E6%93%8D/" class="article-date">
  <time class="dt-published" datetime="2022-07-18T23:28:42.000Z" itemprop="datePublished">2022-07-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/07/19/web/%E4%B8%93%E6%A0%8F/Chrome%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/crx%E5%AE%9E%E6%93%8D/">crx实操</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>[toc]</p>
<p>来源：<a target="_blank" rel="noopener" href="https://juejin.cn/post/7035782439590952968">https://juejin.cn/post/7035782439590952968</a></p>
<h1 id="简单小插件"><a href="#简单小插件" class="headerlink" title="简单小插件"></a>简单小插件</h1><p>Chrome插件并没有很严格的项目结构要求，比如src、public、components等等，因此我们如果去看很多插件的源码，会发现每个插件的项目结构，甚至项目下的文件名称都大相径庭；</p>
<p>但是在根目录下我们都会找到一个<code>manifest.json</code>文件，这是插件的配置文件，说明了插件的各种信息；它的作用等同于小程序的<code>app.json</code>和前端项目的<code>package.json</code>。</p>
<p>我们在项目中创建一个最简单的manifest.json配置文件：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="comment">// 插件名称</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Hello Extensions&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">// 插件的描述</span></span><br><span class="line">    <span class="attr">&quot;description&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;Base Level Extension&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">// 插件的版本</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">// 配置插件程序的版本号，主流版本是2，最新是3</span></span><br><span class="line">    <span class="attr">&quot;manifest_version&quot;</span><span class="punctuation">:</span> <span class="number">2</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>实际导入时，要把注释都删掉。</p>
<p>我们经常会点击右上角插件图标时弹出一个小窗口的页面，焦点离开时就关闭了，一般做一些临时性的交互操作；在配置文件中新增<code>browser_action</code>字段，配置<code>popup</code>弹框：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Hello Extensions&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;description&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;Base Level Extension&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;manifest_version&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">// 新增popup弹框</span></span><br><span class="line">    <span class="attr">&quot;browser_action&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;default_popup&quot;</span><span class="punctuation">:</span> <span class="string">&quot;popup.html&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;default_icon&quot;</span><span class="punctuation">:</span> <span class="string">&quot;popup.png&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>此时目录结构如下：</p>
<p><img src="/crx%E5%AE%9E%E6%93%8D.assets/image-20220321095147393.png" alt="image-20220321095147393"></p>
<p>popup.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">content</span>=<span class="string">&quot;width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello Extensions<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>导入后效果：</p>
<p><img src="/crx%E5%AE%9E%E6%93%8D.assets/image-20220321095317286.png" alt="image-20220321095317286"></p>
<p>为了用户方便点击，我们还可以在<code>manifest.json</code>中设置一个键盘快捷键的命令，通过快捷键来弹出popup页面：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Hello Extensions&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;description&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;Base Level Extension&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;manifest_version&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;browser_action&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;default_popup&quot;</span><span class="punctuation">:</span> <span class="string">&quot;popup.html&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;default_icon&quot;</span><span class="punctuation">:</span> <span class="string">&quot;popup.png&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// 新增命令</span></span><br><span class="line">  <span class="attr">&quot;commands&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;_execute_browser_action&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;suggested_key&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;default&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Ctrl+Shift+F&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;mac&quot;</span><span class="punctuation">:</span> <span class="string">&quot;MacCtrl+Shift+F&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Opens popup.html&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>每次更新文件后，浏览器端需要重新加载下：</p>
<p><img src="/crx%E5%AE%9E%E6%93%8D.assets/image-20220321095757603.png" alt="image-20220321095757603"></p>
<p>快捷键好像不支持<code>Alt</code>：</p>
<p><img src="/crx%E5%AE%9E%E6%93%8D.assets/image-20220321095835389.png" alt="image-20220321095835389"></p>
<h2 id="后台background"><a href="#后台background" class="headerlink" title="后台background"></a>后台background</h2><p>我们的插件安装后，popup页面也运行了；但是我们也发现了，popup页面只能做临时性的交互操作，用完就关了，不能存储信息或者和其他标签页进行交互等等；</p>
<p>这时就需要用到background（后台），它是一个常驻的页面，它的生命周期是插件中所有类型页面中最长的；它随着浏览器的打开而打开，随着浏览器的关闭而关闭，所以通常把需要一直运行的、启动就运行的、全局的代码放在background里面。</p>
<p>background也是需要在<code>manifest.json</code>中进行配置，可以通过page指定一张网页，<strong>或者</strong>通过scripts直接指定一个js数组，Chrome会自动为js生成默认网页：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;background&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="comment">// &quot;page&quot;: &quot;background.html&quot;,</span></span><br><span class="line">    <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;background.js&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;persistent&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>效果如下：</p>
<p><img src="/crx%E5%AE%9E%E6%93%8D.assets/image-20220321100317840.png" alt="image-20220321100317840"></p>
<p>但是控制台，没有在当前页面打印，因为两者不是一个页面。</p>
<p>我们给background设置一个监听事件，当插件安装时打印日志：</p>
<p>background.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// background.js</span></span><br><span class="line">chrome.<span class="property">runtime</span>.<span class="property">onInstalled</span>.<span class="title function_">addListener</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;插件已被安装&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/crx%E5%AE%9E%E6%93%8D.assets/image-20220321140551498.png" alt="image-20220321140551498"></p>
<p>点击后chrome会弹出一个新的，针对background.js页面的控制台</p>
<p>拓展：</p>
<ul>
<li><p>直接打印chrome对象</p>
<p><img src="/crx%E5%AE%9E%E6%93%8D.assets/image-20220321141128109.png" alt="image-20220321141128109"></p>
<p>所调用的方法，都是在chrome对象上的</p>
</li>
</ul>
<h2 id="storage存储"><a href="#storage存储" class="headerlink" title="storage存储"></a>storage存储</h2><p>我们在插件安装时在storage中设置一个值，这将允许多个插件组件访问该值并进行更新操作：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//background.js</span></span><br><span class="line">chrome.<span class="property">runtime</span>.<span class="property">onInstalled</span>.<span class="title function_">addListener</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// storage中设置值</span></span><br><span class="line">  chrome.<span class="property">storage</span>.<span class="property">sync</span>.<span class="title function_">set</span>(&#123; <span class="attr">color</span>: <span class="string">&quot;#3aa757&quot;</span> &#125;, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;storage init color value&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">// 为特定的网址显示图标</span></span><br><span class="line">  chrome.<span class="property">declarativeContent</span>.<span class="property">onPageChanged</span>.<span class="title function_">removeRules</span>(<span class="literal">undefined</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    chrome.<span class="property">declarativeContent</span>.<span class="property">onPageChanged</span>.<span class="title function_">addRules</span>([</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">conditions</span>: [</span><br><span class="line">          <span class="keyword">new</span> chrome.<span class="property">declarativeContent</span>.<span class="title class_">PageStateMatcher</span>(&#123;</span><br><span class="line">            <span class="attr">pageUrl</span>: &#123; <span class="attr">hostEquals</span>: <span class="string">&quot;baidu.com&quot;</span> &#125;,</span><br><span class="line">          &#125;),</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">actions</span>: [<span class="keyword">new</span> chrome.<span class="property">declarativeContent</span>.<span class="title class_">ShowPageAction</span>()],</span><br><span class="line">      &#125;,</span><br><span class="line">    ]);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>chrome.declarativeContent</code>用于精确地控制什么时候显示我们的页面按钮，或者需要在用户单击它之前更改它的外观以匹配当前标签页。</p>
<p>这里调用的<code>chrome.storage</code>和我们常用的<code>localStorage</code>和<code>sessionStorage</code>不是一个东西。</p>
<p>值得注意得是，我们需要在manifest中给插件注册使用的权限，否则chrome对象中，将没有<code>storage</code>和<code>declarativeContent</code></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="comment">// 新增</span></span><br><span class="line">  <span class="attr">&quot;permissions&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;storage&quot;</span><span class="punctuation">,</span> <span class="string">&quot;declarativeContent&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;background&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;background.js&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;persistent&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>再次查看背景页的视图，我们就能看到打印的日志了；</p>
<p>既然可以存储，那也能取出来，我们在<code>popup</code>中添加事件进行获取，首先我们新增一个触发的button：</p>
<p>popup.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">content</span>=<span class="string">&quot;width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">button</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">width</span>: <span class="number">60px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">height</span>: <span class="number">30px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">outline</span>: none;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello Extensions<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;changeColor&quot;</span>&gt;</span>change<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./popup.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>我们再创建一个<code>popup.js</code>的文件，用来从storage存储中拿到颜色值，并将此颜色作为按钮的背景色：</p>
<p>popup.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> changeColor = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;changeColor&quot;</span>);</span><br><span class="line"></span><br><span class="line">changeColor.<span class="property">onclick</span> = <span class="keyword">function</span> (<span class="params">el</span>) &#123;</span><br><span class="line">    chrome.<span class="property">storage</span>.<span class="property">sync</span>.<span class="title function_">get</span>(<span class="string">&quot;color&quot;</span>, <span class="keyword">function</span> (<span class="params">data</span>) &#123;</span><br><span class="line">        changeColor.<span class="property">style</span>.<span class="property">backgroundColor</span> = data.<span class="property">color</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>效果：</p>
<p><img src="/crx%E5%AE%9E%E6%93%8D.assets/image-20220321144203403.png" alt="image-20220321144203403"></p>
<blockquote>
<p>如果需要调试popup页面，可以在弹框中右击 &#x3D;&gt; 检查，在DevTools中进行调试查看。</p>
</blockquote>
<h2 id="获取浏览器tabs"><a href="#获取浏览器tabs" class="headerlink" title="获取浏览器tabs"></a>获取浏览器tabs</h2><p>现在，我们获取到了storage中的值，需要逻辑来进一步与用户交互；更新popup.js中的交互代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// popupjs</span></span><br><span class="line">changeColor.<span class="property">onclick</span> = <span class="keyword">function</span> (<span class="params">el</span>) &#123;</span><br><span class="line">  chrome.<span class="property">storage</span>.<span class="property">sync</span>.<span class="title function_">get</span>(<span class="string">&quot;color&quot;</span>, <span class="keyword">function</span> (<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> &#123; color &#125; = data;</span><br><span class="line">    chrome.<span class="property">tabs</span>.<span class="title function_">query</span>(&#123; <span class="attr">active</span>: <span class="literal">true</span>, <span class="attr">currentWindow</span>: <span class="literal">true</span> &#125;, <span class="keyword">function</span> (<span class="params">tabs</span>) &#123;</span><br><span class="line">      chrome.<span class="property">tabs</span>.<span class="title function_">executeScript</span>(tabs[<span class="number">0</span>].<span class="property">id</span>, &#123;</span><br><span class="line">        <span class="attr">code</span>: <span class="string">&#x27;document.body.style.backgroundColor = &quot;&#x27;</span> + color + <span class="string">&#x27;&quot;;&#x27;</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>chrome.tabs</code>的API主要是和浏览器的标签页进行交互，通过query找到当前的激活中的tab，然后使用<code>executeScript</code>向标签页注入脚本内容。</p>
<p><code>manifest</code>同样需要<code>activeTab</code>的权限，来允许我们的插件使用tabs的API。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Hello Extensions&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">&quot;permissions&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;storage&quot;</span><span class="punctuation">,</span> <span class="string">&quot;declarativeContent&quot;</span><span class="punctuation">,</span> <span class="string">&quot;activeTab&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>效果如下：</p>
<p><img src="/crx%E5%AE%9E%E6%93%8D.assets/image-20220321150503262.png" alt="image-20220321150503262"></p>
<h2 id="颜色选项页面"><a href="#颜色选项页面" class="headerlink" title="颜色选项页面"></a>颜色选项页面</h2><p>现在我们的插件功能还比较单一，只能让用户选择唯一的颜色；我们可以在插件中加入选项页面，以便用户更好的自定义插件的功能。</p>
<p>在程序目录新增一个options.html文件：</p>
<p>options.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">      <span class="selector-tag">button</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">height</span>: <span class="number">30px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">width</span>: <span class="number">30px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">outline</span>: none;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">margin</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;buttonDiv&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>选择一个不同的颜色<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;options.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后添加选择页面的逻辑代码options.js：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> page = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;buttonDiv&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> kButtonColors = [<span class="string">&quot;#3aa757&quot;</span>, <span class="string">&quot;#e8453c&quot;</span>, <span class="string">&quot;#f9bb2d&quot;</span>, <span class="string">&quot;#4688f1&quot;</span>];</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">constructOptions</span>(<span class="params">kButtonColors</span>) &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> item <span class="keyword">of</span> kButtonColors) &#123;</span><br><span class="line">    <span class="keyword">let</span> button = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;button&quot;</span>);</span><br><span class="line">    button.<span class="property">style</span>.<span class="property">backgroundColor</span> = item;</span><br><span class="line">    button.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      chrome.<span class="property">storage</span>.<span class="property">sync</span>.<span class="title function_">set</span>(&#123; <span class="attr">color</span>: item &#125;, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;color is &quot;</span> + item);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">    page.<span class="title function_">appendChild</span>(button);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">constructOptions</span>(kButtonColors);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>上面代码中预设了四个颜色选项，通过onclick事件监听，生成页面上的按钮；当用户单击按钮时，将更新storage中存储的颜色值。</p>
<p>options页面完成后，我们可以将其在manifest的options_page进行注册：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Hello Extensions&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  <span class="attr">&quot;options_page&quot;</span><span class="punctuation">:</span> <span class="string">&quot;options.html&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  <span class="attr">&quot;manifest_version&quot;</span><span class="punctuation">:</span> <span class="number">2</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>重新加载我们的插件，点击详情，滚动到底部，点击<code>扩展程序选项</code>来查看选项页面。或者可以在浏览器右上角插件图标上<code>右击 =&gt; 选项</code>。</p>
<p>此时可以选择背景色，效果如下：</p>
<p><img src="/crx%E5%AE%9E%E6%93%8D.assets/image-20220321151521321.png" alt="image-20220321151521321"></p>
<p><img src="/crx%E5%AE%9E%E6%93%8D.assets/image-20220321151534275.png" alt="image-20220321151534275"></p>
<p>我的理解，options.html提供了一个，可针对插件配置的一个页面</p>
<h1 id="插件功能进阶"><a href="#插件功能进阶" class="headerlink" title="插件功能进阶"></a>插件功能进阶</h1><p>通过上面一个简单的小插件，相信大家对插件的功能和组件都有了一个大致的了解，知道了每个组件在其中发挥的作用；</p>
<p>但这还只是插件的一小部分功能，下面我们对插件每个部分的功能以及组件做一个更深入的了解。</p>
<h2 id="使用background管理事件"><a href="#使用background管理事件" class="headerlink" title="使用background管理事件"></a>使用background管理事件</h2><p>background是插件的事件处理程序，它包含对插件很重要的浏览器事件的监听器。</p>
<p>background处于休眠状态，直到触发事件，然后执行指示的逻辑；</p>
<p>一个好的background仅在需要时加载，并在空闲时卸载。</p>
<p><img src="/crx%E5%AE%9E%E6%93%8D.assets/42fadde3d4fd4ee78f8acc36082099aatplv-k3u1fbpfcp-zoom-in-crop-mark1304000.awebp" alt="background和popup交互"></p>
<p>background监听的一些浏览器事件包括：</p>
<ul>
<li>插件程序首次安装或更新为新版本。</li>
<li>后台页面正在监听事件，并且已调度该事件</li>
<li>内容脚本或其他插件发送消息</li>
<li>插件中的另一个视图（例如弹出窗口）调用runtime.getBackgroundPage</li>
</ul>
<p>加载完成后，只要触发某个事件，background就会保持运行状态；在上面manifest中，我们还指定了一个persistent属性：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;background&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;background.js&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;persistent&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>persistent属性定义了插件常驻后台的方式；</p>
<p>当其值为true时，表示插件将一直在后台运行，无论其是否正在工作；</p>
<p>当其值为false时，表示插件在后台按需运行，这就是Chrome后来提出的Event Page（非持久性后台）。</p>
<p>Event Page是基于事件驱动运行的，只有在事件发生的时候才可以访问；</p>
<p>这样做的目的是为了能够有效减小插件对内存的消耗，如非必要，请将persistent设置为false。</p>
<blockquote>
<p>persistent属性的默认值为true</p>
</blockquote>
<h3 id="alarms"><a href="#alarms" class="headerlink" title="alarms"></a>alarms</h3><p>一些基于DOM页面的计时器（例如window.setTimeout或window.setInterval），如果在非持久后台休眠时进行了触发，可能不会按照预定的时间运行：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> timeout = <span class="number">1000</span> * <span class="number">60</span> * <span class="number">3</span>;  <span class="comment">// 3 minutes in milliseconds</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">alert</span>(<span class="string">&#x27;Hello, world!&#x27;</span>);</span><br><span class="line">&#125;, timeout);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Chrome提供了另外的API，alarms：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">chrome.<span class="property">alarms</span>.<span class="title function_">create</span>(&#123;<span class="attr">delayInMinutes</span>: <span class="number">3.0</span>&#125;)</span><br><span class="line"></span><br><span class="line">chrome.<span class="property">alarms</span>.<span class="property">onAlarm</span>.<span class="title function_">addListener</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">alert</span>(<span class="string">&quot;Hello, world!&quot;</span>)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="browserAction"><a href="#browserAction" class="headerlink" title="browserAction"></a>browserAction</h2><p>我们知道了browser_action字段用来配置popup的页面，在其他的一些文档中还给出了page_action字段的配置，不过page_action并不</p>
<p>是所有的页面都能够使用；</p>
<p>不过随着Chrome的版本更新，这两者的功能也越来越相近；在Chrome 48版本之后，page_action也从原来的地址栏中移出来，和插件</p>
<p>放在一起；笔者在配置page_action的时候没有发现有什么比较大的区别，因此下面以browser_action为主。</p>
<p>在browserAction的配置中，我们可以提供多种尺寸的图标，Chrome会选择最接近的图标并将其缩放到适当的大小来填充；如果没有提</p>
<p>供确切的大小，这种缩放会导致图标丢失细节或看起来模糊。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">&quot;browser_action&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;default_icon&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>                <span class="comment">// optional</span></span><br><span class="line">      <span class="attr">&quot;16&quot;</span><span class="punctuation">:</span> <span class="string">&quot;images/icon16.png&quot;</span><span class="punctuation">,</span>     <span class="comment">// optional</span></span><br><span class="line">      <span class="attr">&quot;24&quot;</span><span class="punctuation">:</span> <span class="string">&quot;images/icon24.png&quot;</span><span class="punctuation">,</span>     <span class="comment">// optional</span></span><br><span class="line">      <span class="attr">&quot;32&quot;</span><span class="punctuation">:</span> <span class="string">&quot;images/icon32.png&quot;</span>      <span class="comment">// optional</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;default_title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;hello popup&quot;</span><span class="punctuation">,</span>  <span class="comment">// optional</span></span><br><span class="line">    <span class="attr">&quot;default_popup&quot;</span><span class="punctuation">:</span> <span class="string">&quot;popup.html&quot;</span>    <span class="comment">// optional</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>也可以通过调用<code>browserAction.setPopup</code>动态设置弹出窗口。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chrome.<span class="property">browserAction</span>.<span class="title function_">setPopup</span>(&#123;<span class="attr">popup</span>: <span class="string">&#x27;popup_new.html&#x27;</span>&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="Tooltip"><a href="#Tooltip" class="headerlink" title="Tooltip"></a>Tooltip</h3><p>要设置提示文案，使用default_title字段，或者在<code>background.js</code>中调用<code>browserAction.setTitle</code>函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chrome.<span class="property">browserAction</span>.<span class="title function_">setTitle</span>(&#123; <span class="attr">title</span>: <span class="string">&quot;New Tooltip&quot;</span> &#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>如果两者都设置了，以函数设置的显示为准。</p>
<h3 id="Badge"><a href="#Badge" class="headerlink" title="Badge"></a>Badge</h3><p>Badge（徽章）就是在图标上显示的一些文本内容，用来详细显示插件的提示信息；</p>
<p>由于Bage的空间有限，因此最多显示4个英文字符或者2个函数；</p>
<p>badge无法通过配置文件来指定，必须通过代码实现，设置badge文字和颜色可以分别使用<code>browserAction.setBadgeText()</code>和</p>
<p><code>browserAction.setBadgeBackgroundColor()</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">chrome.<span class="property">browserAction</span>.<span class="title function_">setBadgeText</span>(&#123; <span class="attr">text</span>: <span class="string">&quot;new&quot;</span> &#125;);</span><br><span class="line">chrome.<span class="property">browserAction</span>.<span class="title function_">setBadgeBackgroundColor</span>(&#123; <span class="attr">color</span>: [<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>] &#125;);</span><br><span class="line"><span class="comment">// or 颜色字符串</span></span><br><span class="line"><span class="comment">// chrome.action.setBadgeBackgroundColor(&#123;color: &#x27;#4688F1&#x27;&#125;);</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>效果如下：</p>
<p><img src="/crx%E5%AE%9E%E6%93%8D.assets/image-20220321154246814.png" alt="image-20220321154246814"></p>
<h2 id="content-scripts"><a href="#content-scripts" class="headerlink" title="content-scripts"></a>content-scripts</h2><p>content-scripts（内容脚本）是在网页上下文中运行的文件。通过使用标准的文档对象模型(DOM)，它能够读取浏览器访问的网页的详细</p>
<p>信息，对其进行更改，并将信息传递给其父级插件。内容脚本相对于background还是有一些访问API上的限制，它可以直接访问以下</p>
<p>chrome的API：</p>
<ul>
<li>i18n</li>
<li>storage</li>
<li>runtime:<ul>
<li>connect</li>
<li>getManifest</li>
<li>getURL</li>
<li>id</li>
<li>onConnect</li>
<li>onMessage</li>
<li>sendMessage</li>
</ul>
</li>
</ul>
<p>内容脚本运行于一个独立、隔离的环境，它不会和<code>主页面的脚本</code>或者<code>其他插件的内容脚本</code>发生冲突，当然也不能调用其上下文和变量。假</p>
<p>设我们在主页面中定义了变量和函数：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> a = &#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="string">&quot;2&quot;</span> &#125;;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> b = &#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="string">&quot;2&quot;</span>, <span class="attr">c</span>: [] &#125;;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">a, b</span>)&#123; <span class="keyword">return</span> a + b &#125;;</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>由于隔离的机制，在内容脚本中调用add函数会报错：<code>Uncaught ReferenceError: add is not defined</code>。</p>
<p>内容脚本分为以代码方式或声明方式注入。</p>
<h3 id="代码方式注入"><a href="#代码方式注入" class="headerlink" title="代码方式注入"></a>代码方式注入</h3><p>对于需要在特定情况下运行的代码，我们需要使用代码注入的方式；</p>
<p>在上面的popup页面中，我们就是将内容脚本以代码的方式进行注入到页面中：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">chrome.<span class="property">tabs</span>.<span class="title function_">executeScript</span>(tabs[<span class="number">0</span>].<span class="property">id</span>, &#123;</span><br><span class="line">  <span class="attr">code</span>: <span class="string">&#x27;document.body.style.backgroundColor = &quot;red&quot;;&#x27;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>或者可以注入整个文件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">chrome.<span class="property">tabs</span>.<span class="title function_">executeScript</span>(tabs[<span class="number">0</span>].<span class="property">id</span>, &#123;</span><br><span class="line">  <span class="attr">file</span>: <span class="string">&quot;contentScript.js&quot;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="声明式注入"><a href="#声明式注入" class="headerlink" title="声明式注入"></a>声明式注入</h3><p>在指定页面上自动运行的内容脚本，我们可使用声明式注入的方式；</p>
<p>以声明方式注入的脚本需注册在manifest文件的content_scripts属性下。它们可以包括JS文件或CSS文件。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;content_scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="comment">// 必需。指定此内容脚本将被注入到哪些页面。</span></span><br><span class="line">      <span class="attr">&quot;matches&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;https://*.baidu.com/*&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;css&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;myStyles.css&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;js&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;contentScript.js&quot;</span><span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>声明式注入除了matches必须外，还可以包含以下字段，来自定义指定页面匹配：</p>
<table>
<thead>
<tr>
<th><strong>Name</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody><tr>
<td>exclude_matches</td>
<td>字符串数组</td>
<td>可选。排除此内容脚本将被注入的页面。</td>
</tr>
<tr>
<td>include_globs</td>
<td>字符串数组</td>
<td>可选。 在 matches 后应用，以匹配与此 glob 匹配的URL。旨在模拟 @exclude 油猴关键字。</td>
</tr>
<tr>
<td>exclude_globs</td>
<td>字符串数组</td>
<td>可选。 在 matches 后应用，以排除与此 glob 匹配的URL。旨在模拟 @exclude 油猴关键字。</td>
</tr>
</tbody></table>
<p>声明匹配URL可以使用Glob属性，Glob属性遵循更灵活的语法。</p>
<p>可接受的Glob字符串可能包含“通配符”星号和问号的URL。星号*匹配任意长度的字符串，包括空字符串，而问号？匹配任何单个字符。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;content_scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;matches&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;https://*.xieyufei.com/*&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;exclude_matches&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;*://*/*business*&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;include_globs&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;*xieyufei.com/???s/*&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;exclude_globs&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;*science*&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;js&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;contentScript.js&quot;</span><span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>将JS文件注入网页时，还需要控制文件注入的时机，由<code>run_at</code>字段控制；</p>
<p>首选的默认字段是<code>document_idle</code>，但如果需要，也可以指定为 “document_start” 或“document_end”。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;content_scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;matches&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;https://*.xieyufei.com/*&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;run_at&quot;</span><span class="punctuation">:</span> <span class="string">&quot;document_idle&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;js&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;contentScript.js&quot;</span><span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>三个字段注入的时机区别如下：</p>
<table>
<thead>
<tr>
<th><strong>Name</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody><tr>
<td>document_idle</td>
<td>string</td>
<td>首选。 尽可能使用 “document_idle”。浏览器选择一个时间在 “document_end” 和window.onload 事件触发后立即注入脚本。 注入的确切时间取决于文档的复杂程度以及加载所需的时间，并且已针对页面加载速度进行了优化。在 “document_idle” 上运行的内容脚本不需要监听 window.onload 事件，因此可以确保它们在 DOM 完成之后运行。如果确实需要在window.onload 之后运行脚本，则扩展可以使用 document.readyState 属性检查 onload 是否已触发。</td>
</tr>
<tr>
<td>document_start</td>
<td>string</td>
<td>在 css 文件之后，但在构造其他 DOM 或运行其他脚本前注入。</td>
</tr>
<tr>
<td>document_end</td>
<td>string</td>
<td>在 DOM 创建完成后，但在加载子资源（例如 images 和 frames ）之前，立即注入脚本。</td>
</tr>
</tbody></table>
<h3 id="消息通信"><a href="#消息通信" class="headerlink" title="消息通信"></a>消息通信</h3><p>尽管内容脚本的执行环境和托管它们的页面是相互隔离的，但是它们共享对页面DOM的访问；如果内容脚本想要和插件通信，可以通过</p>
<p><code>onMessage</code>和<code>sendMessage</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// contentScript.js</span></span><br><span class="line">chrome.<span class="property">runtime</span>.<span class="property">onMessage</span>.<span class="title function_">addListener</span>(<span class="keyword">function</span> (<span class="params">message, sender, sendResponse</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;content-script收到的消息&quot;</span>, message);</span><br><span class="line">  <span class="title function_">sendResponse</span>(<span class="string">&quot;我收到了你的消息！&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">chrome.<span class="property">runtime</span>.<span class="title function_">sendMessage</span>(</span><br><span class="line">  &#123; <span class="attr">greeting</span>: <span class="string">&quot;我是content-script呀，我主动发消息给后台！&quot;</span> &#125;,</span><br><span class="line">  <span class="keyword">function</span> (<span class="params">response</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;收到来自后台的回复：&quot;</span> + response);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>更多消息通信的在后面我们会进行详细的总结。</p>
<h2 id="contextMenus"><a href="#contextMenus" class="headerlink" title="contextMenus"></a>contextMenus</h2><p><code>contextMenus</code>可以自定义浏览器的右键菜单（也有叫上下文菜单的），主要是通过<code>chrome.contextMenusAPI</code>实现；在manifest中添加权限来开启菜单权限：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">&quot;permissions&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;contextMenus&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;icons&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;16&quot;</span><span class="punctuation">:</span> <span class="string">&quot;contextMenus16.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;48&quot;</span><span class="punctuation">:</span> <span class="string">&quot;contextMenus48.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;128&quot;</span><span class="punctuation">:</span> <span class="string">&quot;contextMenus128.png&quot;</span></span><br><span class="line">   <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>通过icons字段配置<code>contextMenus</code>菜单旁边的图标</p>
<p>我们可以在background中调用<code>contextMenus.create</code>来创建菜单，这个操作应该在<code>runtime.onInstalled</code>监听回调执行：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">chrome.<span class="property">contextMenus</span>.<span class="title function_">create</span>(&#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">  <span class="attr">title</span>: <span class="string">&quot;Test Context Menu&quot;</span>,</span><br><span class="line">  <span class="attr">contexts</span>: [<span class="string">&quot;all&quot;</span>],</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//分割线</span></span><br><span class="line">chrome.<span class="property">contextMenus</span>.<span class="title function_">create</span>(&#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&quot;separator&quot;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 父级菜单</span></span><br><span class="line">chrome.<span class="property">contextMenus</span>.<span class="title function_">create</span>(&#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="string">&quot;2&quot;</span>,</span><br><span class="line">  <span class="attr">title</span>: <span class="string">&quot;Parent Context Menu&quot;</span>,</span><br><span class="line">  <span class="attr">contexts</span>: [<span class="string">&quot;all&quot;</span>],</span><br><span class="line">&#125;);</span><br><span class="line">chrome.<span class="property">contextMenus</span>.<span class="title function_">create</span>(&#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="string">&quot;21&quot;</span>,</span><br><span class="line">  <span class="attr">parentId</span>: <span class="string">&quot;2&quot;</span>,</span><br><span class="line">  <span class="attr">title</span>: <span class="string">&quot;Child Context Menu1&quot;</span>,</span><br><span class="line">  <span class="attr">contexts</span>: [<span class="string">&quot;all&quot;</span>],</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>效果如下：</p>
<p><img src="/crx%E5%AE%9E%E6%93%8D.assets/image-20220321162849861.png" alt="image-20220321162849861"></p>
<p>如果我们的插件创建多个右键菜单，则Chrome会自动将其折叠为一个父菜单。</p>
<p><code>contextMenus</code>创建对象的属性可以在附录里面找到；</p>
<p>我们看到在title属性中有一个<code>%s</code>的标识符，当<code>contexts</code>为<code>selection</code>，使用<code>%s</code>来表示选中的文字；我们通过这个功能可以实现一个</p>
<p>选中文字调用百度搜索的小功能，效果如下：</p>
<p>（没出来效果，暂时跳过）</p>
<p><code>contextMenus</code>还有一些API可以调用：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 删除某一个菜单项</span></span><br><span class="line">chrome.<span class="property">contextMenus</span>.<span class="title function_">remove</span>(menuItemId)；</span><br><span class="line"><span class="comment">// 删除所有自定义右键菜单</span></span><br><span class="line">chrome.<span class="property">contextMenus</span>.<span class="title function_">removeAll</span>();</span><br><span class="line"><span class="comment">// 更新某一个菜单项</span></span><br><span class="line">chrome.<span class="property">contextMenus</span>.<span class="title function_">update</span>(menuItemId, updateProperties);</span><br><span class="line"><span class="comment">// 监听菜单项点击事件</span></span><br><span class="line">chrome.<span class="property">contextMenus</span>.<span class="property">onClicked</span>.<span class="title function_">addListener</span>(<span class="keyword">function</span>(<span class="params">OnClickData info, tabs.Tab tab</span>) &#123;...&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="override"><a href="#override" class="headerlink" title="override"></a>override</h2><p>覆盖页面（override）是一种将Chrome默认的特定页面替换为插件程序中的HTML文件。</p>
<p>除了HTML之外，覆盖页面通常还有CSS和JS代码。</p>
<p>插件可以替换以下Chrome的页面。</p>
<ul>
<li><p>书签管理器</p>
<ul>
<li><p>当用户从 Chrome 菜单中选择书签管理器菜单项或在 Mac 上从书签菜单中选择书签管理器项时出现的页面。您也可以通过输入 </p>
<p>URL chrome:&#x2F;&#x2F;bookmarks来访问此页面。</p>
</li>
</ul>
</li>
<li><p>历史记录</p>
<ul>
<li><p>当用户从 Chrome 菜单中选择历史记录菜单项或在 Mac 上从历史记录菜单中选择显示完整历史记录项时出现的页面。您也可以</p>
<p>通过输入URL chrome:&#x2F;&#x2F;history来访问此页面。</p>
</li>
</ul>
</li>
<li><p>新标签</p>
<ul>
<li>当用户创建新标签或窗口时出现的页面。您也可以通过输入 URL chrome:&#x2F;&#x2F;newtab来访问此页面。</li>
</ul>
</li>
</ul>
<p>需要注意的是：单个插件只能覆盖某一个页面。例如，插件程序不能同时覆盖书签管理器和历史记录页面。</p>
<p>在manifest进行如下配置：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;chrome_url_overrides&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;newtab&quot;</span><span class="punctuation">:</span> <span class="string">&quot;newtab.html&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">// &quot;history&quot;: &quot;history.html&quot;,</span></span><br><span class="line">    <span class="comment">// &quot;bookmarks&quot;: &quot;bookmarks.html&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>如果我们覆盖多个特定页面，Chrome加载插件时会直接报错：</p>
<p><img src="/crx%E5%AE%9E%E6%93%8D.assets/0623e705d94e4cd3bcdd5b5b3274cfc5tplv-k3u1fbpfcp-zoom-in-crop-mark1304000.awebp" alt="覆盖多个页面报错"></p>
<h2 id="storage"><a href="#storage" class="headerlink" title="storage"></a>storage</h2><p>用户在操作时，会产生一些用户数据，插件需要在本地存储这些数据，在需要调用的时候再拿出来；</p>
<p>Chrome推荐使用<code>chrome.storage</code>的API，该API经过优化，提供和localStorage相同的存储功能；不推荐直接存在<code>localStorage</code>中，两者主要有以下区别：</p>
<ul>
<li>用户数据使用<code>chrome.storage</code>存储可以和Chrome的同步功能自动同步。</li>
<li>插件的内容脚本可以直接访问用户数据，而无需background。</li>
<li>chrome.storage可以直接存储对象，而localStorage是存储字符串，需要再次转换</li>
</ul>
<p>如果要使用storage的自动同步，我们可以使用<code>storage.sync</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">chrome.<span class="property">storage</span>.<span class="property">sync</span>.<span class="title function_">set</span>(&#123;<span class="attr">key</span>: value&#125;, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Value is set to &#x27;</span> + value);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">chrome.<span class="property">storage</span>.<span class="property">sync</span>.<span class="title function_">get</span>([<span class="string">&#x27;key&#x27;</span>], <span class="keyword">function</span>(<span class="params">result</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Value currently is &#x27;</span> + result.<span class="property">key</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>当Chrome离线时，Chrome会将数据存储在本地。</p>
<p>下次浏览器在线时，Chrome会同步数据。即使用户禁用同步，storage.sync仍将工作。</p>
<p>不需要同步的数据可以用<code>storage.local</code>进行存储：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">chrome.<span class="property">storage</span>.<span class="property">local</span>.<span class="title function_">set</span>(&#123;<span class="attr">key</span>: value&#125;, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Value is set to &#x27;</span> + value);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">chrome.<span class="property">storage</span>.<span class="property">local</span>.<span class="title function_">get</span>([<span class="string">&#x27;key&#x27;</span>], <span class="keyword">function</span>(<span class="params">result</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Value currently is &#x27;</span> + result.<span class="property">key</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>如果我们想要监听<code>storage</code>中的数据变化，可以用<code>onChanged</code>添加监听事件；</p>
<p>每当存储中的数据发生变化时，就会触发该事件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// background.js</span></span><br><span class="line"></span><br><span class="line">chrome.<span class="property">storage</span>.<span class="property">onChanged</span>.<span class="title function_">addListener</span>(<span class="keyword">function</span> (<span class="params">changes, namespace</span>) &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> [key, &#123; oldValue, newValue &#125;] <span class="keyword">of</span> <span class="title class_">Object</span>.<span class="title function_">entries</span>(changes)) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">      <span class="string">`Storage key &quot;<span class="subst">$&#123;key&#125;</span>&quot; in namespace &quot;<span class="subst">$&#123;namespace&#125;</span>&quot; changed.`</span>,</span><br><span class="line">      <span class="string">`Old value was &quot;<span class="subst">$&#123;oldValue&#125;</span>&quot;, new value is &quot;<span class="subst">$&#123;newValue&#125;</span>&quot;.`</span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="devtools"><a href="#devtools" class="headerlink" title="devtools"></a>devtools</h2><p>用过<code>Vue</code>或者<code>React</code>的<code>devtools</code>的童鞋应该见过这样新增的扩展面板：</p>
<p><img src="/crx%E5%AE%9E%E6%93%8D.assets/797d03728824441fba4ad45b3befca8atplv-k3u1fbpfcp-zoom-in-crop-mark1304000.awebp" alt="Vue Panel"></p>
<p><code>DevTools</code>可以为Chrome的<code>DevTools</code>添加功能，它可以添加新的UI面板和侧边栏，与检查的页面交互，获取有关网络请求的信息等等；</p>
<p>它可以访问以下特定的API：</p>
<ul>
<li>devtools.inspectedWindow</li>
<li>devtools.network</li>
<li>devtools.panels</li>
</ul>
<p>DevTools扩展的结构与任何其他扩展一样：它可以有一个背景页面、内容脚本和其他项目。</p>
<p>此外，每个DevTools扩展都有一个DevTools页面，可以访问DevTools的API。</p>
<p><img src="/crx%E5%AE%9E%E6%93%8D.assets/d67bddfe82b44f4cbbab0a642eb5d4catplv-k3u1fbpfcp-zoom-in-crop-mark1304000.awebp" alt="DevTools扩展"></p>
<p>配置devtools不需要权限，只要在manifest中配置一个<code>devtools.html</code>：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;devtools_page&quot;</span><span class="punctuation">:</span> <span class="string">&quot;devtools.html&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>devtools.html中只引用了devtools.js，如果写了其他内容也不会展示：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span> <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;./devtools.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>新建devtools.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// devtools.js</span></span><br><span class="line"><span class="comment">// 创建扩展面板</span></span><br><span class="line">chrome.<span class="property">devtools</span>.<span class="property">panels</span>.<span class="title function_">create</span>(</span><br><span class="line">  <span class="comment">// 扩展面板显示名称</span></span><br><span class="line">  <span class="string">&quot;DevPanel&quot;</span>,</span><br><span class="line">  <span class="comment">// 扩展面板icon，并不展示</span></span><br><span class="line">  <span class="string">&quot;panel.png&quot;</span>,</span><br><span class="line">  <span class="comment">// 扩展面板页面</span></span><br><span class="line">  <span class="string">&quot;Panel.html&quot;</span>,</span><br><span class="line">  <span class="keyword">function</span> (<span class="params">panel</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;自定义面板创建成功！&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建自定义侧边栏</span></span><br><span class="line">chrome.<span class="property">devtools</span>.<span class="property">panels</span>.<span class="property">elements</span>.<span class="title function_">createSidebarPane</span>(</span><br><span class="line">  <span class="string">&quot;Sidebar&quot;</span>,</span><br><span class="line">  <span class="keyword">function</span> (<span class="params">sidebar</span>) &#123;</span><br><span class="line">    sidebar.<span class="title function_">setPage</span>(<span class="string">&quot;sidebar.html&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这里调用create创建扩展面板，<code>createSidebarPane</code>创建侧边栏，每个扩展面板和侧边栏都是一个单独的HTML页面，其中可以包含其他资源（JavaScript、CSS、图像等）。</p>
<h3 id="DevPanel"><a href="#DevPanel" class="headerlink" title="DevPanel"></a>DevPanel</h3><p>DevPanel面板是一个顶级标签，和Element、Source、Network等是同一级，在一个devtools.js可以创建多个；在<code>Panel.html</code>中我们先</p>
<p>设置2个按钮：</p>
<p>Panel.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>dev panel<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;check_jquery&quot;</span>&gt;</span>检查jquery<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;get_all_resources&quot;</span>&gt;</span>获取所有资源<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;panel.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>panel.js</code>中我们使用<code>devtools.inspectedWindow</code>的<code>API</code>来和被检查窗口进行交互：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// panel.js</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;check_jquery&quot;</span>).<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  chrome.<span class="property">devtools</span>.<span class="property">inspectedWindow</span>.<span class="built_in">eval</span>(</span><br><span class="line">    <span class="string">&quot;jQuery.fn.jquery&quot;</span>,</span><br><span class="line">    <span class="keyword">function</span> (<span class="params">result, isException</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (isException) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;the page is not using jQuery&quot;</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;The page is using jQuery v&quot;</span> + result);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">document</span></span><br><span class="line">  .<span class="title function_">getElementById</span>(<span class="string">&quot;get_all_resources&quot;</span>)</span><br><span class="line">  .<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    chrome.<span class="property">devtools</span>.<span class="property">inspectedWindow</span>.<span class="title function_">getResources</span>(<span class="keyword">function</span> (<span class="params">resources</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(resources);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>eval</code>函数为插件提供了在被检查页面的上下文中执行JS代码的能力，而<code>getResources</code>获取页面上所有加载的资源；</p>
<p>我们找到一个页面，然后右击检查打开调试工具，发现在最右侧多了一个<code>DevPanel</code>的tab页，</p>
<p>效果如下：</p>
<p><img src="/crx%E5%AE%9E%E6%93%8D.assets/image-20220321170541211.png" alt="image-20220321170541211"></p>
<p>点击我们的调试按钮，那么日志在哪里能看到呢？</p>
<p>我们在调试工具上右击检查，再开一个调试工具，这个就是调试工具的调试工具。</p>
<p>最终两个调试工具的效果如下：</p>
<p><img src="/crx%E5%AE%9E%E6%93%8D.assets/00117c3fff474e0194622a144ce52d15tplv-k3u1fbpfcp-zoom-in-crop-mark1304000.awebp" alt="DevTools面板"></p>
<p>（实操中，在panel面板中，右击时并没有出来检查菜单栏）</p>
<h3 id="Sidebar"><a href="#Sidebar" class="headerlink" title="Sidebar"></a>Sidebar</h3><p>回到<code>devtools.js</code>，我们使用<code>createSidebarPane</code>创建了侧边栏面板，并且设置为<code>sidebar.html</code>，最终呈现在<code>Element</code>面板的最右侧：</p>
<p><img src="/crx%E5%AE%9E%E6%93%8D.assets/image-20220322095952631.png" alt="image-20220322095952631"></p>
<p>有几种方法可以在侧边栏中显示内容：</p>
<ul>
<li>HTML内容。调用setPage以指定要在窗格中显示的 HTML 页面。</li>
<li>JSON数据。将JSON对象传递给setObject.</li>
<li>JavaScript表达式。将表达式传递给setExpression</li>
</ul>
<p>通过JS表达式，我们可以很方便进行页面查询，比如，查询页面上所有的img元素：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">chrome.<span class="property">devtools</span>.<span class="property">panels</span>.<span class="property">elements</span>.<span class="title function_">createSidebarPane</span>(</span><br><span class="line">  <span class="string">&quot;All Images&quot;</span>,</span><br><span class="line">  <span class="keyword">function</span> (<span class="params">sidebar</span>) &#123;</span><br><span class="line">    sidebar.<span class="title function_">setExpression</span>(<span class="string">&#x27;document.querySelectorAll(&quot;img&quot;)&#x27;</span>, <span class="string">&quot;All Images&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>效果如下：</p>
<p><img src="/crx%E5%AE%9E%E6%93%8D.assets/image-20220322100736954.png" alt="image-20220322100736954"></p>
<p>另外，我们可以通过<code>elements.onSelectionChanged</code>监听事件，在Element面板选中元素更改后，更新侧边栏面板的状态；</p>
<p>例如，可以将我们关心的一些元素的样式进行实时展示在侧边面板，方便查看：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> page_getProperties = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> ($<span class="number">0</span> <span class="keyword">instanceof</span> <span class="title class_">HTMLElement</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">tag</span>: $<span class="number">0.</span>tagName.<span class="title function_">toLocaleLowerCase</span>(),</span><br><span class="line">      <span class="attr">class</span>: $<span class="number">0.</span>classList,</span><br><span class="line">      <span class="attr">width</span>: <span class="variable language_">window</span>.<span class="title function_">getComputedStyle</span>($<span class="number">0</span>)[<span class="string">&quot;width&quot;</span>],</span><br><span class="line">      <span class="attr">height</span>: <span class="variable language_">window</span>.<span class="title function_">getComputedStyle</span>($<span class="number">0</span>)[<span class="string">&quot;height&quot;</span>],</span><br><span class="line">      <span class="attr">margin</span>: <span class="variable language_">window</span>.<span class="title function_">getComputedStyle</span>($<span class="number">0</span>)[<span class="string">&quot;margin&quot;</span>],</span><br><span class="line">      <span class="attr">padding</span>: <span class="variable language_">window</span>.<span class="title function_">getComputedStyle</span>($<span class="number">0</span>)[<span class="string">&quot;padding&quot;</span>],</span><br><span class="line">      <span class="attr">color</span>: <span class="variable language_">window</span>.<span class="title function_">getComputedStyle</span>($<span class="number">0</span>)[<span class="string">&quot;color&quot;</span>],</span><br><span class="line">      <span class="attr">fontSize</span>: <span class="variable language_">window</span>.<span class="title function_">getComputedStyle</span>($<span class="number">0</span>)[<span class="string">&quot;fontSize&quot;</span>],</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">chrome.<span class="property">devtools</span>.<span class="property">panels</span>.<span class="property">elements</span>.<span class="title function_">createSidebarPane</span>(</span><br><span class="line">  <span class="string">&quot;Select Element&quot;</span>,</span><br><span class="line">  <span class="keyword">function</span> (<span class="params">sidebar</span>) &#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">updateElementProperties</span>(<span class="params"></span>) &#123;</span><br><span class="line">      sidebar.<span class="title function_">setExpression</span>(</span><br><span class="line">        <span class="string">&quot;(&quot;</span> + page_getProperties.<span class="title function_">toString</span>() + <span class="string">&quot;)()&quot;</span>,</span><br><span class="line">        <span class="string">&quot;select element&quot;</span></span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">updateElementProperties</span>();</span><br><span class="line">    chrome.<span class="property">devtools</span>.<span class="property">panels</span>.<span class="property">elements</span>.<span class="property">onSelectionChanged</span>.<span class="title function_">addListener</span>(</span><br><span class="line">      updateElementProperties</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/crx%E5%AE%9E%E6%93%8D.assets/1334aad0f2914a4dab90a982f9d28db9tplv-k3u1fbpfcp-zoom-in-crop-mark1304000.awebp" alt="元素样式实时展示"></p>
<p>备注：浏览器自带的devtools已经有这样的功能了</p>
<h2 id="notifications"><a href="#notifications" class="headerlink" title="notifications"></a>notifications</h2><p>Chrome提供<code>chrome.notifications</code>的API来推送桌面通知；同样也需要现在<code>manifest</code>中注册权限：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;permissions&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;notifications&quot;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在background调用创建即可</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// background.js</span></span><br><span class="line">chrome.<span class="property">notifications</span>.<span class="title function_">create</span>(<span class="literal">null</span>, &#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&quot;basic&quot;</span>,</span><br><span class="line">  <span class="attr">iconUrl</span>: <span class="string">&quot;drink.png&quot;</span>,</span><br><span class="line">  <span class="attr">title</span>: <span class="string">&quot;喝水小助手&quot;</span>,</span><br><span class="line">  <span class="attr">message</span>: <span class="string">&quot;看到此消息的人可以和我一起来喝一杯水&quot;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="webRequest"><a href="#webRequest" class="headerlink" title="webRequest"></a>webRequest</h2><p>通过<code>webRequest</code>的<code>API</code>可以对浏览器发出的任何HTTP请求进行拦截、组织或者修改；</p>
<p>可以拦截的请求还包括脚本、样式的GET请求以及图片的链接；</p>
<p>我们也需要在manifest中配置权限才能使用API：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  <span class="attr">&quot;permissions&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;webRequest&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;webRequestBlocking&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;*://*.xieyufei.com/&quot;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>权限中还需要声明拦截请求的URL，如果你想拦截所有的URL，可以使用<code>*://*/*</code>（不过不推荐这么做，数据会非常多），如果我们想以</p>
<p>阻塞方式使用Web请求API，则需要用到<code>webRequestBlocking</code>权限。</p>
<p>比如我们可以对拦截的请求进行取消：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">chrome.<span class="property">webRequest</span>.<span class="property">onBeforeRequest</span>.<span class="title function_">addListener</span>(</span><br><span class="line">  <span class="keyword">function</span> (<span class="params">detail</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="attr">cancel</span>: details.<span class="property">url</span>.<span class="title function_">indexOf</span>(<span class="string">&quot;example.com&quot;</span>) != -<span class="number">1</span>&#125;;;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; <span class="attr">urls</span>: [<span class="string">&quot;&lt;all_urls&gt;&quot;</span>] &#125;,</span><br><span class="line">  [<span class="string">&quot;blocking&quot;</span>]</span><br><span class="line">);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="组件消息通信"><a href="#组件消息通信" class="headerlink" title="组件消息通信"></a>组件消息通信</h1><p>不同组件之间经常需要进行消息通信来进行数据的传递，我们来看下他们之间是如何进行通信的：</p>
<h2 id="background和popup通信"><a href="#background和popup通信" class="headerlink" title="background和popup通信"></a>background和popup通信</h2><p><code>background</code>和<code>popup</code>之间的通信比较简单，在<code>popup</code>中，我们可以通过<code>extension.getBackgroundPage</code>直接获取到<code>background</code>对</p>
<p>象，直接调用对象上的方法即可：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// popup.js</span></span><br><span class="line"><span class="keyword">var</span> bg = chrome.<span class="property">extension</span>.<span class="title function_">getBackgroundPage</span>();</span><br><span class="line">bg.<span class="title function_">someMethods</span>()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>而<code>background</code>访问<code>popup</code>上则通过<code>extension.getViews</code>来访问，不过前提是<code>popup</code>弹框已经展示，否则获取到的<code>views</code>是空数组：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//background.js</span></span><br><span class="line"><span class="keyword">var</span> views = chrome.<span class="property">extension</span>.<span class="title function_">getViews</span>(&#123;<span class="attr">type</span>:<span class="string">&#x27;popup&#x27;</span>&#125;);</span><br><span class="line"><span class="keyword">if</span>(views.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">  <span class="comment">// 相当于popup的windows对象</span></span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(views[<span class="number">0</span>].<span class="property">location</span>.<span class="property">href</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="background和内容脚本通信"><a href="#background和内容脚本通信" class="headerlink" title="background和内容脚本通信"></a>background和内容脚本通信</h2><p>在<code>background</code>和<code>内容脚本</code>通信，我们可以使用简单直接的<code>runtime.sendMessage</code>或者<code>tabs.sendMessage</code>发送消息，消息内容可以是</p>
<p>JSON数据</p>
<p>从内容脚本发送消息如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// content-script.js</span></span><br><span class="line">chrome.<span class="property">runtime</span>.<span class="title function_">sendMessage</span>(</span><br><span class="line">  &#123; <span class="attr">greeting</span>: <span class="string">&quot;hello，我是content-script，主动发消息给后台！&quot;</span> &#125;,</span><br><span class="line">  <span class="keyword">function</span> (<span class="params">response</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;收到来自后台的回复：&quot;</span> + response);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>而从后台发送消息到内容脚本时，由于有多个标签页，我们需要指定发送到某个标签页：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// background.js</span></span><br><span class="line">chrome.<span class="property">tabs</span>.<span class="title function_">query</span>(&#123; <span class="attr">active</span>: <span class="literal">true</span>, <span class="attr">currentWindow</span>: <span class="literal">true</span> &#125;, <span class="keyword">function</span> (<span class="params">tabs</span>) &#123;</span><br><span class="line">  chrome.<span class="property">tabs</span>.<span class="title function_">sendMessage</span>(</span><br><span class="line">    tabs[<span class="number">0</span>].<span class="property">id</span>,</span><br><span class="line">    &#123; <span class="attr">greeting</span>: <span class="string">&quot;hello，我是后台，主动发消息给content-script&quot;</span> &#125;,</span><br><span class="line">    <span class="keyword">function</span> (<span class="params">response</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(response.<span class="property">farewell</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>而不管是在后台，还是在内容脚本中，我们都使用<code>runtime.onMessage</code>监听消息的接收事件，不同的是回调函数中的<code>sender</code>，标识不同的发送方：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">chrome.<span class="property">runtime</span>.<span class="property">onMessage</span>.<span class="title function_">addListener</span>(</span><br><span class="line">  <span class="keyword">function</span>(<span class="params">request, sender, sendResponse</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(sender.<span class="property">tab</span> ?</span><br><span class="line">      <span class="string">&quot;from a content script:&quot;</span> + sender.<span class="property">tab</span>.<span class="property">url</span> :</span><br><span class="line">      <span class="string">&quot;from the extension&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (request.<span class="property">greeting</span>.<span class="title function_">indexOf</span>(<span class="string">&quot;hello&quot;</span>) !== -<span class="number">1</span>)&#123;</span><br><span class="line">      <span class="title function_">sendResponse</span>(&#123;<span class="attr">farewell</span>: <span class="string">&quot;goodbye&quot;</span>&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="长链接"><a href="#长链接" class="headerlink" title="长链接"></a>长链接</h2><p>上面的<code>runtime.sendMessage</code>和<code>tabs.sendMessage</code>都属于短链接，所谓的短连接，就是类似于<code>HTTP</code>请求，如果接收方不在线，就会</p>
<p>出现请求失败的情况；但有些情况下，需要持续对话，这时候就需要用到长链接，类似于<code>websocket</code>，可以在通信双方之间进行持久链</p>
<p>接。</p>
<p>长链接使用<code>runtime.connect</code>或<code>tabs.connect</code>来打开长生命周期通道，通道可以有一个名称，以便区分不同类型的连接。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// content-script.js</span></span><br><span class="line"><span class="comment">// 设置通道名称</span></span><br><span class="line"><span class="keyword">var</span> port = chrome.<span class="property">runtime</span>.<span class="title function_">connect</span>(&#123;<span class="attr">name</span>: <span class="string">&quot;knockknock&quot;</span>&#125;);</span><br><span class="line">port.<span class="title function_">postMessage</span>(&#123;<span class="attr">joke</span>: <span class="string">&quot;Knock knock&quot;</span>&#125;);</span><br><span class="line">port.<span class="property">onMessage</span>.<span class="title function_">addListener</span>(<span class="keyword">function</span>(<span class="params">msg</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (msg.<span class="property">question</span> == <span class="string">&quot;Who&#x27;s there?&quot;</span>)</span><br><span class="line">    port.<span class="title function_">postMessage</span>(&#123;<span class="attr">answer</span>: <span class="string">&quot;Madame&quot;</span>&#125;);</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (msg.<span class="property">question</span> == <span class="string">&quot;Madame who?&quot;</span>)</span><br><span class="line">    port.<span class="title function_">postMessage</span>(&#123;<span class="attr">answer</span>: <span class="string">&quot;Madame... Bovary&quot;</span>&#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>从background向内容脚本发送消息也类似，不同之处在于需要指定连接的tab页，将<code>runtime.connect</code>改为<code>tabs.connect</code>。</p>
<p>　　在接收端，我们需要设置<code>onConnect</code>的事件监听器，当发送端调用<code>connect</code>进行连接时触发该事件，以及通过连接发送和接收消息的<code>port</code>对象：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//background.js</span></span><br><span class="line">chrome.<span class="property">runtime</span>.<span class="property">onConnect</span>.<span class="title function_">addListener</span>(<span class="keyword">function</span>(<span class="params">port</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">assert</span>(port.<span class="property">name</span> == <span class="string">&quot;knockknock&quot;</span>);</span><br><span class="line">  port.<span class="property">onMessage</span>.<span class="title function_">addListener</span>(<span class="keyword">function</span>(<span class="params">msg</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (msg.<span class="property">joke</span> == <span class="string">&quot;Knock knock&quot;</span>)</span><br><span class="line">      port.<span class="title function_">postMessage</span>(&#123;<span class="attr">question</span>: <span class="string">&quot;Who&#x27;s there?&quot;</span>&#125;);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (msg.<span class="property">answer</span> == <span class="string">&quot;Madame&quot;</span>)</span><br><span class="line">      port.<span class="title function_">postMessage</span>(&#123;<span class="attr">question</span>: <span class="string">&quot;Madame who?&quot;</span>&#125;);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (msg.<span class="property">answer</span> == <span class="string">&quot;Madame... Bovary&quot;</span>)</span><br><span class="line">      port.<span class="title function_">postMessage</span>(&#123;<span class="attr">question</span>: <span class="string">&quot;I don&#x27;t get it.&quot;</span>&#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>






































































      
    </div>
    <footer class="article-footer">
      <a data-url="https://mindcons.cn/2022/07/19/web/%E4%B8%93%E6%A0%8F/Chrome%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/crx%E5%AE%9E%E6%93%8D/" data-id="cldolkc5p003ufgx6675qbr1o" data-title="crx实操" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-web/专栏/Chrome插件开发/crx问题记录" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/07/19/web/%E4%B8%93%E6%A0%8F/Chrome%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/crx%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/" class="article-date">
  <time class="dt-published" datetime="2022-07-18T23:28:42.000Z" itemprop="datePublished">2022-07-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/07/19/web/%E4%B8%93%E6%A0%8F/Chrome%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/crx%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/">crx问题记录</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>记录crx开发中，遇到的问题</p>
<h1 id="unsafe-eval"><a href="#unsafe-eval" class="headerlink" title="unsafe-eval"></a>unsafe-eval</h1><p>使用的vue开发的页面，用到了eval方法，在插件中不通过</p>
<p>需要在manifest.json中配置安全策略</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">,</span><span class="attr">&quot;content_security_policy&quot;</span><span class="punctuation">:</span> <span class="string">&quot;script-src &#x27;self&#x27; &#x27;unsafe-eval&#x27;; object-src &#x27;self&#x27;&quot;</span></span><br></pre></td></tr></table></figure>

<p>参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_35606400/article/details/114986532">(3条消息) CHROME扩展笔记之拒绝unsafe-eval求值_slongzhang_的博客-CSDN博客</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://mindcons.cn/2022/07/19/web/%E4%B8%93%E6%A0%8F/Chrome%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/crx%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/" data-id="cldolkc5q003yfgx6gvl2a0oi" data-title="crx问题记录" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-web/专栏/软技能/6.001" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/07/19/web/%E4%B8%93%E6%A0%8F/%E8%BD%AF%E6%8A%80%E8%83%BD/6.001/" class="article-date">
  <time class="dt-published" datetime="2022-07-18T23:28:42.000Z" itemprop="datePublished">2022-07-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/07/19/web/%E4%B8%93%E6%A0%8F/%E8%BD%AF%E6%8A%80%E8%83%BD/6.001/">6.001</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="1"><a href="#1" class="headerlink" title="1"></a>1</h1><p>17:00 </p>
<p>competition</p>
<p>what is konwledge?</p>
<ul>
<li>declaretive kownledge<ul>
<li>satement of fact</li>
<li>defination</li>
<li>act</li>
</ul>
</li>
<li>imperative kownledge<ul>
<li>It tells you how you might test something,but it doesn’t tell you how to</li>
<li>is a description of how to deduce something</li>
</ul>
</li>
</ul>
<p>fixed-program computer</p>
<p>program is a recipe</p>
<ul>
<li>Given a fixed set of primitives ,a good programmer can program anything</li>
</ul>
<p>with six primitives,i can rule the world</p>
<p>with six primitives, i can program anything</p>
<p>we need to know not only what are the primitives,but how do we make things meaningful in that language</p>
<p>three dimension</p>
<p>syntax: what are legal expressions</p>
<p>static semantics : what programs are meaningful</p>
<p>full semantics : </p>
<p>style</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://mindcons.cn/2022/07/19/web/%E4%B8%93%E6%A0%8F/%E8%BD%AF%E6%8A%80%E8%83%BD/6.001/" data-id="cldolkc5x004bfgx697m55u3m" data-title="6.001" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%BD%AF%E6%8A%80%E8%83%BD/" rel="tag">软技能</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-web/专栏/软技能/leetcode" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/07/19/web/%E4%B8%93%E6%A0%8F/%E8%BD%AF%E6%8A%80%E8%83%BD/leetcode/" class="article-date">
  <time class="dt-published" datetime="2022-07-18T23:28:42.000Z" itemprop="datePublished">2022-07-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/07/19/web/%E4%B8%93%E6%A0%8F/%E8%BD%AF%E6%8A%80%E8%83%BD/leetcode/">leetcode</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        
      
    </div>
    <footer class="article-footer">
      <a data-url="https://mindcons.cn/2022/07/19/web/%E4%B8%93%E6%A0%8F/%E8%BD%AF%E6%8A%80%E8%83%BD/leetcode/" data-id="cldolkc5z004ffgx67m2y3u8n" data-title="leetcode" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%BD%AF%E6%8A%80%E8%83%BD/" rel="tag">软技能</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/9/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="page-number" href="/page/9/">9</a><span class="page-number current">10</span><a class="page-number" href="/page/11/">11</a><a class="page-number" href="/page/12/">12</a><span class="space">&hellip;</span><a class="page-number" href="/page/14/">14</a><a class="extend next" rel="next" href="/page/11/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/CSS/">CSS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CSS%E9%A2%84%E5%A4%84%E7%90%86%E5%99%A8/">CSS预处理器</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/English/">English</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Express/">Express</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/HTML/">HTML</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Koa/">Koa</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Node-js/">Node.js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/React/">React</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Vue/">Vue</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/books/">books</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/docker/">docker</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/electron/">electron</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/jQuery/">jQuery</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/javascript/">javascript</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/lua/">lua</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/webpack/">webpack</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B9%A6%E7%B1%8D/">书籍</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%BD%8E%E4%BB%A3%E7%A0%81/">低代码</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%8F%AF%E8%A7%86%E5%8C%96/">可视化</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%AD%A6%E4%B9%A0%E6%96%B9%E5%BC%8F/">学习方式</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%AD%A6%E4%B9%A0%E8%B7%AF%E7%BA%BF/">学习路线</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%B0%8F%E7%A8%8B%E5%BA%8F/">小程序</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/">数据结构与算法</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%A1%88%E4%BE%8B%E5%AE%9E%E6%88%98/">案例实战</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%88%AC%E8%99%AB/">爬虫</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%A7%BB%E5%8A%A8%E7%AB%AF%E5%BC%80%E5%8F%91/">移动端开发</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BB%84%E4%BB%B6%E5%BA%93/">组件库</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS/" rel="tag">CSS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS%E5%8A%A8%E7%94%BB/" rel="tag">CSS动画</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS%E5%B8%83%E5%B1%80/" rel="tag">CSS布局</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS%E9%80%89%E6%8B%A9%E5%99%A8/" rel="tag">CSS选择器</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS%E9%A2%84%E5%A4%84%E7%90%86%E5%99%A8/" rel="tag">CSS预处理器</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ElementPlus/" rel="tag">ElementPlus</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ElementUI/" rel="tag">ElementUI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/English/" rel="tag">English</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Express/" rel="tag">Express</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTML/" rel="tag">HTML</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Koa/" rel="tag">Koa</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/" rel="tag">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Node-js/" rel="tag">Node.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React/" rel="tag">React</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TypeScript/" rel="tag">TypeScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vant/" rel="tag">Vant</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vue/" rel="tag">Vue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vue2/" rel="tag">Vue2</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vue3/" rel="tag">Vue3</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/books/" rel="tag">books</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/electron/" rel="tag">electron</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jQuery/" rel="tag">jQuery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lua/" rel="tag">lua</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/" rel="tag">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue-cli/" rel="tag">vue-cli</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webpack/" rel="tag">webpack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%B9%A6%E7%B1%8D/" rel="tag">书籍</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BD%8E%E4%BB%A3%E7%A0%81/" rel="tag">低代码</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8F%AF%E8%A7%86%E5%8C%96/" rel="tag">可视化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AD%A6%E4%B9%A0%E6%96%B9%E5%BC%8F/" rel="tag">学习方式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AD%A6%E4%B9%A0%E8%B7%AF%E7%BA%BF/" rel="tag">学习路线</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B0%8F%E7%A8%8B%E5%BA%8F/" rel="tag">小程序</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag">数据库</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/" rel="tag">数据结构与算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%A1%88%E4%BE%8B%E5%AE%9E%E6%88%98/" rel="tag">案例实战</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%BA%90%E7%A0%81/" rel="tag">源码</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%88%AC%E8%99%AB/" rel="tag">爬虫</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%A7%BB%E5%8A%A8%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="tag">移动端开发</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BB%84%E4%BB%B6%E5%BA%93/" rel="tag">组件库</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%87%AA%E5%AE%9A%E4%B9%89%E5%B7%A5%E5%85%B7%E5%BA%93/" rel="tag">自定义工具库</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%A4%E7%9F%A5/" rel="tag">认知</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BD%AF%E6%8A%80%E8%83%BD/" rel="tag">软技能</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BF%90%E7%BB%B4/" rel="tag">运维</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/CSS/" style="font-size: 18.33px;">CSS</a> <a href="/tags/CSS%E5%8A%A8%E7%94%BB/" style="font-size: 10px;">CSS动画</a> <a href="/tags/CSS%E5%B8%83%E5%B1%80/" style="font-size: 13.33px;">CSS布局</a> <a href="/tags/CSS%E9%80%89%E6%8B%A9%E5%99%A8/" style="font-size: 10px;">CSS选择器</a> <a href="/tags/CSS%E9%A2%84%E5%A4%84%E7%90%86%E5%99%A8/" style="font-size: 15px;">CSS预处理器</a> <a href="/tags/ElementPlus/" style="font-size: 10px;">ElementPlus</a> <a href="/tags/ElementUI/" style="font-size: 10px;">ElementUI</a> <a href="/tags/English/" style="font-size: 10px;">English</a> <a href="/tags/Express/" style="font-size: 10px;">Express</a> <a href="/tags/HTML/" style="font-size: 11.67px;">HTML</a> <a href="/tags/Koa/" style="font-size: 13.33px;">Koa</a> <a href="/tags/Linux/" style="font-size: 11.67px;">Linux</a> <a href="/tags/Node-js/" style="font-size: 11.67px;">Node.js</a> <a href="/tags/React/" style="font-size: 10px;">React</a> <a href="/tags/TypeScript/" style="font-size: 10px;">TypeScript</a> <a href="/tags/Vant/" style="font-size: 11.67px;">Vant</a> <a href="/tags/Vue/" style="font-size: 13.33px;">Vue</a> <a href="/tags/Vue2/" style="font-size: 10px;">Vue2</a> <a href="/tags/Vue3/" style="font-size: 10px;">Vue3</a> <a href="/tags/books/" style="font-size: 10px;">books</a> <a href="/tags/docker/" style="font-size: 10px;">docker</a> <a href="/tags/electron/" style="font-size: 10px;">electron</a> <a href="/tags/jQuery/" style="font-size: 10px;">jQuery</a> <a href="/tags/javascript/" style="font-size: 11.67px;">javascript</a> <a href="/tags/lua/" style="font-size: 10px;">lua</a> <a href="/tags/python/" style="font-size: 10px;">python</a> <a href="/tags/vue-cli/" style="font-size: 10px;">vue-cli</a> <a href="/tags/webpack/" style="font-size: 10px;">webpack</a> <a href="/tags/%E4%B9%A6%E7%B1%8D/" style="font-size: 16.67px;">书籍</a> <a href="/tags/%E4%BD%8E%E4%BB%A3%E7%A0%81/" style="font-size: 10px;">低代码</a> <a href="/tags/%E5%8F%AF%E8%A7%86%E5%8C%96/" style="font-size: 10px;">可视化</a> <a href="/tags/%E5%AD%A6%E4%B9%A0%E6%96%B9%E5%BC%8F/" style="font-size: 10px;">学习方式</a> <a href="/tags/%E5%AD%A6%E4%B9%A0%E8%B7%AF%E7%BA%BF/" style="font-size: 10px;">学习路线</a> <a href="/tags/%E5%B0%8F%E7%A8%8B%E5%BA%8F/" style="font-size: 10px;">小程序</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 10px;">数据库</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/" style="font-size: 10px;">数据结构与算法</a> <a href="/tags/%E6%A1%88%E4%BE%8B%E5%AE%9E%E6%88%98/" style="font-size: 20px;">案例实战</a> <a href="/tags/%E6%BA%90%E7%A0%81/" style="font-size: 10px;">源码</a> <a href="/tags/%E7%88%AC%E8%99%AB/" style="font-size: 10px;">爬虫</a> <a href="/tags/%E7%A7%BB%E5%8A%A8%E7%AB%AF%E5%BC%80%E5%8F%91/" style="font-size: 10px;">移动端开发</a> <a href="/tags/%E7%BB%84%E4%BB%B6%E5%BA%93/" style="font-size: 11.67px;">组件库</a> <a href="/tags/%E8%87%AA%E5%AE%9A%E4%B9%89%E5%B7%A5%E5%85%B7%E5%BA%93/" style="font-size: 10px;">自定义工具库</a> <a href="/tags/%E8%AE%A4%E7%9F%A5/" style="font-size: 10px;">认知</a> <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 10px;">设计模式</a> <a href="/tags/%E8%BD%AF%E6%8A%80%E8%83%BD/" style="font-size: 20px;">软技能</a> <a href="/tags/%E8%BF%90%E7%BB%B4/" style="font-size: 10px;">运维</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">January 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/12/">December 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/11/">November 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/10/">October 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">September 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">August 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">July 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">June 2022</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/01/20/web/%E5%85%B6%E4%BB%96/lua/lua%E5%9F%BA%E7%A1%80/">lua基础</a>
          </li>
        
          <li>
            <a href="/2023/01/17/web/%E5%85%B6%E4%BB%96/python/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80/">爬虫基础</a>
          </li>
        
          <li>
            <a href="/2023/01/13/web/%E8%BF%9B%E9%98%B6/%E6%95%B0%E6%8D%AE%E5%BA%93/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E7%A1%80/">数据库基础</a>
          </li>
        
          <li>
            <a href="/2023/01/12/web/%E6%A1%86%E6%9E%B6/React/React%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E5%92%8C%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/React%E5%9F%BA%E7%A1%80/">React基本使用</a>
          </li>
        
          <li>
            <a href="/2023/01/09/web/%E5%85%B6%E4%BB%96/%E6%A0%87%E6%B3%A8/labelStudio%E5%AE%89%E8%A3%85%E5%8F%8A%E4%BD%BF%E7%94%A8/">labelStudio安装及使用</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2023 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>