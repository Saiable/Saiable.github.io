<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>前端工程化（Vue） | 吕小布の博客</title><meta name="keywords" content="吕小布的博客"><meta name="author" content="Sai"><meta name="copyright" content="Sai"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="环境相关node环境搭建单独安装nodejslinux环境下载压缩包，若是tar.xz，以tar -xf filename.tar.xz命令解压 配置环境变量： 12345vim &#x2F;etc&#x2F;profile在最下面Ins添加两行(注意安装路径)export NODEJS&#x3D;&#x2F;opt&#x2F;node&#x2F;node-v10.15.3-linux-x64export PATH&#x3D;$NODEJS&#x2F;bin:$PATH  w">
<meta property="og:type" content="article">
<meta property="og:title" content="前端工程化（Vue）">
<meta property="og:url" content="http://mindcons.cn/2022/08/08/web/JavaScript/Engineering/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96%EF%BC%88Vue%EF%BC%89/index.html">
<meta property="og:site_name" content="吕小布の博客">
<meta property="og:description" content="环境相关node环境搭建单独安装nodejslinux环境下载压缩包，若是tar.xz，以tar -xf filename.tar.xz命令解压 配置环境变量： 12345vim &#x2F;etc&#x2F;profile在最下面Ins添加两行(注意安装路径)export NODEJS&#x3D;&#x2F;opt&#x2F;node&#x2F;node-v10.15.3-linux-x64export PATH&#x3D;$NODEJS&#x2F;bin:$PATH  w">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s2.loli.net/2022/07/02/xjocPR8fnLu64KU.png">
<meta property="article:published_time" content="2022-08-07T23:15:24.000Z">
<meta property="article:modified_time" content="2022-08-10T13:52:26.476Z">
<meta property="article:author" content="Sai">
<meta property="article:tag" content="吕小布的博客">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2022/07/02/xjocPR8fnLu64KU.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://mindcons.cn/2022/08/08/web/JavaScript/Engineering/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96%EF%BC%88Vue%EF%BC%89/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":350},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '前端工程化（Vue）',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-08-10 21:52:26'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css"><meta name="generator" content="Hexo 6.2.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://s2.loli.net/2022/07/02/xjocPR8fnLu64KU.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">93</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">14</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/search/"><i class="fa-fw fas fa-search"></i><span> 搜索</span></a></div><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fas fa-search"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 娱乐</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page child" href="/comics/"><i class="fa-fw fas fa-video"></i><span> 番剧</span></a></li></ul></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 互动</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/sponsorWall/"><i class="fa-fw fas fa-money-check-alt"></i><span> 赞助墙</span></a></li><li><a class="site-page child" href="/comments/"><i class="fa-fw fas fa-comments"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fas fa-coffee"></i><span> 其他</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/course/"><i class="fa-fw fas fa-book"></i><span> 搭建教程</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">吕小布の博客</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/search/"><i class="fa-fw fas fa-search"></i><span> 搜索</span></a></div><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fas fa-search"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 娱乐</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page child" href="/comics/"><i class="fa-fw fas fa-video"></i><span> 番剧</span></a></li></ul></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 互动</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/sponsorWall/"><i class="fa-fw fas fa-money-check-alt"></i><span> 赞助墙</span></a></li><li><a class="site-page child" href="/comments/"><i class="fa-fw fas fa-comments"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fas fa-coffee"></i><span> 其他</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/course/"><i class="fa-fw fas fa-book"></i><span> 搭建教程</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">前端工程化（Vue）</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-08-07T23:15:24.000Z" title="发表于 2022-08-08 07:15:24">2022-08-08</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-08-10T13:52:26.476Z" title="更新于 2022-08-10 21:52:26">2022-08-10</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="前端工程化（Vue）"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="环境相关"><a href="#环境相关" class="headerlink" title="环境相关"></a>环境相关</h1><h2 id="node环境搭建"><a href="#node环境搭建" class="headerlink" title="node环境搭建"></a><code>node</code>环境搭建</h2><h3 id="单独安装nodejs"><a href="#单独安装nodejs" class="headerlink" title="单独安装nodejs"></a>单独安装<code>nodejs</code></h3><h4 id="linux环境"><a href="#linux环境" class="headerlink" title="linux环境"></a><code>linux</code>环境</h4><p>下载压缩包，若是<code>tar.xz</code>，以<code>tar -xf filename.tar.xz</code>命令解压</p>
<p>配置环境变量：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/profile</span><br><span class="line"></span><br><span class="line">在最下面Ins添加两行(注意安装路径)</span><br><span class="line"><span class="built_in">export</span> NODEJS=/opt/node/node-v10.15.3-linux-x64</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$NODEJS</span>/bin:<span class="variable">$PATH</span></span><br></pre></td></tr></table></figure>

<h4 id="windows环境"><a href="#windows环境" class="headerlink" title="windows环境"></a><code>windows</code>环境</h4><ul>
<li><code>win8</code>及以上<ul>
<li>直接去官网上下载安装：<a target="_blank" rel="noopener" href="https://nodejs.org/en/">https://nodejs.org/en/</a></li>
</ul>
</li>
<li><code>win7</code><ul>
<li>有的<code>nodejs</code>版本不支持<code>win7</code>，在<code>win7</code>系统中执行<code>npm -v</code>时会有以下提示<code>This application is only supported on Windows 8.1, Windows Server 2012 R2, or higher.</code><br>下载<code>v12.16.2</code>及之前的版本即可：<a target="_blank" rel="noopener" href="https://nodejs.org/dist/v12.16.2/">https://nodejs.org/dist/v12.16.2/</a></li>
<li>建议升级系统</li>
</ul>
</li>
</ul>
<h3 id="nvm管理node"><a href="#nvm管理node" class="headerlink" title="nvm管理node"></a><code>nvm</code>管理<code>node</code></h3><p><code>NVM</code>是一个非常方便的<code>node</code>包管理工具，可以实现在<code>NodeJS</code> 各个不同版本之间自由的进行切换。</p>
<p>下面，介绍用<code>root</code>权限安装<code>NVM</code>工具。到2022年6月，<code>nvm</code>的最新版本为<code>v0.39</code>。</p>
<p><code>vite</code>依赖的<code>node</code>版本 <code>&gt;=</code> <code>12.0.0</code></p>
<p><code>nuxt3</code>依赖的<code>node</code>版本<code>&gt;=</code> <code>14.16.0</code></p>
<h4 id="安装nvm"><a href="#安装nvm" class="headerlink" title="安装nvm"></a>安装<code>nvm</code></h4><p>下载，可以打开链接查看</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/nvm-sh/nvm/archive/refs/tags/v0.39.1.tar.gz</span><br></pre></td></tr></table></figure>

<p>解压</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /root/.nvm</span><br><span class="line">tar -zxvf v0.39.1.tar.gz -C /root/.nvm</span><br></pre></td></tr></table></figure>

<p>配置环境，打开<code>~/.bashrc</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bashrc</span><br></pre></td></tr></table></figure>

<p>在末尾添加</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nvm path env</span></span><br><span class="line"><span class="built_in">export</span> NVM_DIR=<span class="string">&quot;<span class="variable">$HOME</span>/.nvm/nvm-0.39.1&quot;</span></span><br><span class="line">[ -s <span class="string">&quot;<span class="variable">$NVM_DIR</span>/nvm.sh&quot;</span> ] &amp;&amp; \. <span class="string">&quot;<span class="variable">$NVM_DIR</span>/nvm.sh&quot;</span>  <span class="comment"># This loads nvm</span></span><br><span class="line">[ -s <span class="string">&quot;<span class="variable">$NVM_DIR</span>/bash_completion&quot;</span> ] &amp;&amp; \. <span class="string">&quot;<span class="variable">$NVM_DIR</span>/bash_completion&quot;</span>  <span class="comment"># This loads nvm bash_completion</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>保存退出并使配置生效</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure>

<h4 id="使用nvm管理node"><a href="#使用nvm管理node" class="headerlink" title="使用nvm管理node"></a>使用<code>nvm</code>管理<code>node</code></h4><p> 列出已经安装的版本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvm <span class="built_in">ls</span></span><br></pre></td></tr></table></figure>

<p>安装指定版本<code>nodejs</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvm install 16.14.0</span><br></pre></td></tr></table></figure>

<p>卸载指定版本<code>nodejs</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvm uninstall 16.14.0</span><br></pre></td></tr></table></figure>

<p>切换到其他版本<code>nodejs</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvm use 14.17.3</span><br></pre></td></tr></table></figure>

<p>切换到<code>iojs</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvm use iojs-v3.2.0</span><br></pre></td></tr></table></figure>

<h2 id="Vue-cli脚手架"><a href="#Vue-cli脚手架" class="headerlink" title="Vue/cli脚手架"></a><code>Vue/cli</code>脚手架</h2><h3 id="创建新项目"><a href="#创建新项目" class="headerlink" title="创建新项目"></a>创建新项目</h3><p>使用<code>nvm</code>装完<code>node</code>环境后，单独新建<code>project</code>文件夹安装<code>@vue/cli</code>包，然后在这文件夹下，使用<code>npx vue create project-name</code>进行每个项目的开发</p>
<ul>
<li>接口文档和<code>UI</code>设计稿</li>
<li>前端项目搭建<ul>
<li><code>nodejs</code></li>
<li>创建新目录并进入，习惯性的<code>npm init -y</code>一下，创建一个空的<code>package.json</code><ul>
<li>安装<code>vue-cli</code>：<code>npm i @vue/cli</code></li>
<li><code>20220511</code>默认安装的脚手架版本为<code>5.0.4</code></li>
<li>这个默认是安装在本地的，调用指令时需要使用<code>npx</code>前缀，如果是全局安装的则不需要</li>
</ul>
</li>
<li>创建<code>vue</code>项目：<code>npx vue create project-name</code>或<code>vue create project-name</code><ul>
<li>然后选择是<code>vue2</code>还是<code>vue3</code>的项目</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="接手老项目"><a href="#接手老项目" class="headerlink" title="接手老项目"></a>接手老项目</h3><p>接手其他项目时，如果自己的npm版本，和创建package-lock.json的版本不一致，<code>npm i </code>可能会有问题。</p>
<p>最好是先安装npx，在了解接手的项目的node版本（node和npm绑定）是多少后，切换到一致的node版本，或者再尝试安装。</p>
<p>当然也存在node版本一致，但npm版本不一致的情况，可以新建<code>node</code>分支，在新建<code>node</code>分支上升级或降级<code>npm</code>版本，所以两者都要先了解清楚。</p>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><h3 id="配置代理"><a href="#配置代理" class="headerlink" title="配置代理"></a>配置代理</h3><h4 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h4><p>使用<code>ajax</code>技术，发送请求可能会存在跨域问题</p>
<p>本机的浏览器是8080，直接向服务器5000请求数据是不行的，可以通过本机的服务器8080这个代理服务器发请求</p>
<p>服务器和服务器之间，发送请求是不存在跨域问题的，跨域问题只存在于浏览器端</p>
<p>那么怎么开启代理服务器呢？</p>
<ul>
<li><p>通过<code>nginx</code>配置代理服务器</p>
</li>
<li><p>通过<code>vue-cli</code>的配置项</p>
<ul>
<li><p>方式一：</p>
<p><code>vue.config.js</code></p>
<p>新增配置项<code>devServer</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="attr">proxy</span>: <span class="string">&quot;http://localhost:5000&quot;</span> <span class="comment">//配置成最终要请求的服务器</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>填写该配置项后，<code>vue-cli</code>会生成一个8080的服务器（和浏览器当前页面的端口一直），并且开发的<code>public</code>目录，对应着该服务器的资源目录，<code>ajax</code>的请求路径，要修改成代理服务的</p>
<p>优点：</p>
<ul>
<li>配置简单，请求资源直接发给前端即可</li>
</ul>
<p>存在的问题：</p>
<ul>
<li>不能配置多个代理服务器，不能灵活的控制请求是否走代理</li>
<li>如果请求路径和<code>public</code>目录资源存在重复，则会返回代理服务的的资源，请求不会转发</li>
</ul>
</li>
<li><p>方式二：</p>
<p><code>vue.config.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="attr">proxy</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;/api&#x27;</span>: &#123; <span class="comment">// 表示请求前缀，发送`ajax`请求时，在端口号后添加该前缀，表示要通过代理服务器进行转发，并且该前缀，会作为请求路径发送给目标服务器</span></span><br><span class="line">            <span class="attr">target</span>: <span class="string">&#x27;&lt;url&gt;&#x27;</span>, <span class="comment">// 代理服务器的路径</span></span><br><span class="line">            <span class="attr">pathRewrite</span>: &#123;</span><br><span class="line">                <span class="string">&#x27;^/api&#x27;</span>: <span class="string">&#x27;&#x27;</span> <span class="comment">// 对路径进行匹配替换，将前缀替换为空字符串，如果真实的服务器有这个路径头，就不需要重写</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">ws</span>: <span class="literal">true</span>, <span class="comment">// 用于支持websocket</span></span><br><span class="line">            <span class="attr">changeOrigin</span>: <span class="literal">true</span> <span class="comment">// true配置项，会伪装代理服务的主机端口号，是localhost:5000。false配置项，代理服务器会如实告诉目标服务器自己的主机端口号，是localhost:8080</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&#x27;/foo&#x27;</span>: &#123;</span><br><span class="line">            <span class="attr">target</span>: <span class="string">&#x27;&lt;other_url&gt;&#x27;</span>,</span><br><span class="line">            <span class="attr">pathRewrite</span>: &#123;</span><br><span class="line">                <span class="string">&#x27;^/foo&#x27;</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>优点：</p>
<ul>
<li>可以配置多个代理，且可以灵活的控制请求是否走代理</li>
</ul>
<p>缺点：</p>
<ul>
<li>配置略微繁琐，请求资源时必须加前缀</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="实际应用"><a href="#实际应用" class="headerlink" title="实际应用"></a>实际应用</h4><p>前端的页面是：<code>http://218.94.82.249:8091/#/analysisfiles</code></p>
<p>后台接口是：<code>http://218.94.82.249:8093/file_handing/upload</code></p>
<p>直接请求会报错跨域：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">$axios</span></span><br><span class="line">    .<span class="title function_">post</span>(<span class="string">&quot;http://218.94.82.249:8093/file_handing/upload&quot;</span>, formData, &#123;</span><br><span class="line">      <span class="string">&quot;Content-type&quot;</span>: <span class="string">&quot;multipart/form-data&quot;</span>,</span><br><span class="line">    &#125;).<span class="title function_">then</span>()</span><br></pre></td></tr></table></figure>

<p><code>vue.config.js</code>配置<code>proxy</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; defineConfig &#125; = <span class="built_in">require</span>(<span class="string">&#x27;@vue/cli-service&#x27;</span>)</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">transpileDependencies</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="attr">host</span>: <span class="string">&#x27;0.0.0.0&#x27;</span>,</span><br><span class="line">    <span class="attr">port</span>: <span class="number">8091</span>,</span><br><span class="line">    <span class="attr">proxy</span>: <span class="string">&#x27;http://218.94.82.249:8093&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后将请求的接口改成<code>8091</code>（也可以直接只加路径）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">$axios</span></span><br><span class="line">    .<span class="title function_">post</span>(<span class="string">&quot;http://218.94.82.249:8091/file_handing/upload&quot;</span>, formData, &#123;</span><br><span class="line">      <span class="string">&quot;Content-type&quot;</span>: <span class="string">&quot;multipart/form-data&quot;</span>,</span><br><span class="line">    &#125;).<span class="title function_">then</span>()</span><br></pre></td></tr></table></figure>

<h3 id="配置eslint"><a href="#配置eslint" class="headerlink" title="配置eslint"></a>配置<code>eslint</code></h3><h1 id="前端项目目录结构"><a href="#前端项目目录结构" class="headerlink" title="前端项目目录结构"></a>前端项目目录结构</h1><p>参照：<a target="_blank" rel="noopener" href="https://juejin.cn/post/6930533407441027079">前端项目目录结构演变 - 掘金 (juejin.cn)</a></p>
<h2 id="目录结构一"><a href="#目录结构一" class="headerlink" title="目录结构一"></a>目录结构一</h2><h3 id="概览"><a href="#概览" class="headerlink" title="概览"></a>概览</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">root</span><br><span class="line">	src</span><br><span class="line">		main.js</span><br><span class="line">		router</span><br><span class="line">			router.js</span><br><span class="line">			hooks.js</span><br><span class="line">			permission.js</span><br><span class="line">		store</span><br><span class="line">			modules</span><br><span class="line">				moduleA</span><br><span class="line">				moduleB</span><br><span class="line">					state.js</span><br><span class="line">					actions.js</span><br><span class="line">					mutations.js</span><br><span class="line">					getters.js</span><br><span class="line">				index.js</span><br><span class="line">			index.js</span><br><span class="line">			action-types.js</span><br><span class="line">			mutation-types.js</span><br><span class="line">		utils</span><br><span class="line">	</span><br></pre></td></tr></table></figure>

<h3 id="src-main-js结构"><a href="#src-main-js结构" class="headerlink" title="src/main.js结构"></a><code>src/main.js</code>结构</h3><h4 id="vue相关依赖"><a href="#vue相关依赖" class="headerlink" title="vue相关依赖"></a><code>vue</code>相关依赖</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span> <span class="comment">// 引入的是node_moudules下的vue.runtime.js，去除了模板解析功能模块的（）</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App&#x27;</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;./store&#x27;</span></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;./router&#x27;</span></span><br></pre></td></tr></table></figure>

<p>其他依赖</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// serviceworker的配置文件，pwa 离线缓存，会生成manifes + sw.js</span></span><br><span class="line"><span class="comment">// 生产环境做缓存用的，该文件中暴露了一些钩子，也可以自定义</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./registerServiceWorker&#x27;</span> </span><br></pre></td></tr></table></figure>



<h3 id="src-utils"><a href="#src-utils" class="headerlink" title="src/utils"></a><code>src/utils</code></h3><h4 id="loadable-js"><a href="#loadable-js" class="headerlink" title="loadable.js"></a><code>loadable.js</code></h4><p><a target="_blank" rel="noopener" href="https://cn.vuejs.org/v2/guide/components-dynamic-async.html">动态组件 &amp; 异步组件</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">LoadingComponent</span> <span class="keyword">from</span> <span class="string">&#x27;@/components/loading.vue&#x27;</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">loadable</span> = (<span class="params">asyncFunc</span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 最终切换的时候，会采用这个组件</span></span><br><span class="line">    <span class="keyword">let</span> <span class="title function_">component</span> = (<span class="params"></span>) =&gt; (&#123;</span><br><span class="line">      <span class="comment">// 需要加载的组件 (应该是一个 `Promise` 对象)</span></span><br><span class="line">      <span class="attr">component</span>: <span class="title function_">asyncFunc</span>(),</span><br><span class="line">      <span class="comment">// 异步组件加载时使用的组件，只是为了增加loading效果</span></span><br><span class="line">      <span class="attr">loading</span>: <span class="title class_">LoadingComponent</span>,</span><br><span class="line">      <span class="comment">// 加载失败时使用的组件，可选</span></span><br><span class="line">      <span class="attr">error</span>: <span class="title class_">ErrorComponent</span>,</span><br><span class="line">      <span class="comment">// 展示加载时组件的延时时间。默认值是 200 (毫秒)，可选</span></span><br><span class="line">      <span class="attr">delay</span>: <span class="number">200</span>,</span><br><span class="line">      <span class="comment">// 如果提供了超时时间且组件加载也超时了，</span></span><br><span class="line">      <span class="comment">// 则使用加载失败时使用的组件。默认值是：`Infinity`，可选</span></span><br><span class="line">      <span class="attr">timeout</span>: <span class="number">3000</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// loadable执行完毕后，返回一个组件</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="title function_">render</span>(<span class="params">h</span>) &#123; <span class="comment">// createElement(App)</span></span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">h</span>(component)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 路由切换，异步加载的loading</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> loadable</span><br></pre></td></tr></table></figure>

<p>使用第三库的<code>loading</code>，并封装成一个公共组件</p>
<p><code>component/loading.vue</code></p>
<p>异步组件加载处理</p>
<h4 id="debounce-js、-throttles-js"><a href="#debounce-js、-throttles-js" class="headerlink" title="_debounce.js、_throttles.js"></a><code>_debounce.js</code>、<code>_throttles.js</code></h4><p>防抖节流处理</p>
<h5 id="什么是防抖节流"><a href="#什么是防抖节流" class="headerlink" title="什么是防抖节流"></a>什么是防抖节流</h5><p>函数防抖（debounce） 是指在一定时间内，在动作被连续频繁触发的情况下，动作只会被执行一次，也就是说当调用动作过n毫秒后，才会执行该动作，若在这n毫秒内又调用此动作则将重新计算执行时间，所以短时间内的连续动作永远只会触发一次。</p>
<p>函数节流 是指一定时间内执行的操作只执行一次，也就是说即预先设定一个执行周期，当调用动作的时刻大于等于执行周期则执行该动作，然后进入下一个新周期，一个比较形象的例子是如果将水龙头拧紧直到水是以水滴的形式流出，那你会发现每隔一段时间，就会有一滴水流出。</p>
<p>函数节流（throttle）与 函数防抖（debounce）都是为了限制函数的执行频次，以优化函数触发频率过高导致的响应速度跟不上触发频率，出现延迟，假死或卡顿的现象。</p>
<p><strong>区别：</strong></p>
<p>防抖是将多次执行变成最后一次执行；而节流是将多次执行变为每隔一段时间执行一次。</p>
<p>那么它们各自的使用场景有哪些呢？<br><strong>防抖</strong></p>
<ul>
<li>短信验证码</li>
<li>提交表单</li>
<li>resize 事件</li>
<li>input 事件（当然也可以用节流，实现实时关键字查找）</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">  请输入搜索的内容：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">_debounce</span>(<span class="params">fn, delay</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> customDelay = delay || <span class="number">200</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> timer;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">let</span> _this = <span class="variable language_">this</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">let</span> args = <span class="variable language_">arguments</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (timer) <span class="built_in">clearTimeout</span>(timer);</span></span><br><span class="line"><span class="language-javascript">            timer = <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                timer = <span class="literal">null</span>;</span></span><br><span class="line"><span class="language-javascript">                fn.<span class="title function_">apply</span>(_this, args);</span></span><br><span class="line"><span class="language-javascript">            &#125;, customDelay);</span></span><br><span class="line"><span class="language-javascript">        &#125;;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> myinput = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;input&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">    myinput.<span class="property">oninput</span> = <span class="title function_">_debounce</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;发送ajax请求&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">    &#125;,<span class="number">1000</span>)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>结果：输入很多次，在结束输入后，1秒钟打印（发起<code>ajax</code>请求）</p>
<p><img src="/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96%EF%BC%88Vue%EF%BC%89.assets/image-20220623145039201.png" alt="image-20220623145039201"></p>
<p><strong>节流</strong></p>
<ul>
<li>scroll 事件，单位时间后计算一次滚动位置</li>
<li>input 事件（上面提到过）</li>
<li>播放事件，计算进度条</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span>我是计数器<span class="tag">&lt;<span class="name">span</span>&gt;</span>0<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span>&gt;</span>点我+1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">_throttle</span>(<span class="params">fn, interval</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> last;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> timer;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> custormInterval = interval || <span class="number">200</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">let</span> _this = <span class="variable language_">this</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">let</span> args = <span class="variable language_">arguments</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">let</span> now = +<span class="keyword">new</span> <span class="title class_">Date</span>()</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (last &amp;&amp; now - last &lt; custormInterval) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="built_in">clearTimeout</span>(timer)</span></span><br><span class="line"><span class="language-javascript">                timer = <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                    last = now</span></span><br><span class="line"><span class="language-javascript">                    fn.<span class="title function_">apply</span>(_this, args)</span></span><br><span class="line"><span class="language-javascript">                &#125;, custormInterval)</span></span><br><span class="line"><span class="language-javascript">            &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                last = now</span></span><br><span class="line"><span class="language-javascript">                fn.<span class="title function_">apply</span>(_this, args)</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> span = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;span&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> button = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;button&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> count = <span class="number">0</span></span></span><br><span class="line"><span class="language-javascript">    button.<span class="property">onclick</span> = <span class="title function_">_throttle</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        count++</span></span><br><span class="line"><span class="language-javascript">        span.<span class="property">innerHTML</span> = count</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;执行&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">    &#125;, <span class="number">1000</span>)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>点的再快，也只会1秒执行一次</p>
<p><img src="/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96%EF%BC%88Vue%EF%BC%89.assets/image-20220623162439774.png" alt="image-20220623162439774"></p>
<p>如果要自定义封装，需要了解闭包和定时器</p>
<h5 id="vue中自定义防抖节流"><a href="#vue中自定义防抖节流" class="headerlink" title="vue中自定义防抖节流"></a>vue中自定义防抖节流</h5><h6 id="函数封装"><a href="#函数封装" class="headerlink" title="函数封装"></a>函数封装</h6><p>写在utils文件夹下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 防抖</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">_debounce</span>(<span class="params">fn, delay</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> customDelay = delay || <span class="number">200</span></span><br><span class="line">    <span class="keyword">let</span> timer</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> _this = <span class="variable language_">this</span></span><br><span class="line">        <span class="keyword">let</span> args = <span class="variable language_">arguments</span></span><br><span class="line">        <span class="keyword">if</span> (timer) <span class="built_in">clearTimeout</span>(timer)</span><br><span class="line">        timer = <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            timer = <span class="literal">null</span></span><br><span class="line">            fn.<span class="title function_">apply</span>(_this, args)</span><br><span class="line">        &#125;, customDelay)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 节流</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">_throttle</span>(<span class="params">fn, interval</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> last;</span><br><span class="line">    <span class="keyword">let</span> timer;</span><br><span class="line">    <span class="keyword">let</span> custormInterval = interval || <span class="number">200</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> _this = <span class="variable language_">this</span></span><br><span class="line">        <span class="keyword">let</span> args = <span class="variable language_">arguments</span></span><br><span class="line">        <span class="keyword">let</span> now = +<span class="keyword">new</span> <span class="title class_">Date</span>()</span><br><span class="line">        <span class="keyword">if</span> (last &amp;&amp; now - last &lt; custormInterval) &#123;</span><br><span class="line">            <span class="built_in">clearTimeout</span>(timer)</span><br><span class="line">            timer = <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                last = now</span><br><span class="line">                fn.<span class="title function_">apply</span>(_this, args)</span><br><span class="line">            &#125;, custormInterval)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            last = now</span><br><span class="line">            fn.<span class="title function_">apply</span>(_this, args)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="在需要使用的组件中引用"><a href="#在需要使用的组件中引用" class="headerlink" title="在需要使用的组件中引用"></a>在需要使用的组件中引用</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import &#123; _debounce &#125; from &quot;...&quot;</span><br></pre></td></tr></table></figure>

<h6 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">   // 改变场数</span><br><span class="line">   changefield: _debounce(function(_type, index, item) &#123;</span><br><span class="line">       // do something ...</span><br><span class="line">   &#125;, 200)</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h5 id="防抖节流的第三方库"><a href="#防抖节流的第三方库" class="headerlink" title="防抖节流的第三方库"></a>防抖节流的第三方库</h5><ul>
<li><p><code>lodash</code></p>
<ul>
<li>防抖：<a target="_blank" rel="noopener" href="https://www.lodashjs.com/docs/lodash.debounce">https://www.lodashjs.com/docs/lodash.debounce</a></li>
<li>节流：<a target="_blank" rel="noopener" href="https://www.lodashjs.com/docs/lodash.throttle">https://www.lodashjs.com/docs/lodash.throttle</a></li>
</ul>
</li>
<li><p>注意：使用的时候不用再安装了，因为<code>vue-cli</code>等一些库都依赖<code>lodash</code>，之前都装过了，可以使用<code>npm ls lodash</code>查看，在 <code>pnpm </code>中使用方法是 <code>pnpm why lodash</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-4-12-centos atguigu_gmall_frontend]# npm ls lodash</span><br><span class="line">atguigu_gmall_frontend@0.1.0 /root/hh_git/code/atguigu_gmall/atguigu_gmall_frontend</span><br><span class="line">├─┬ @vue/cli-service@5.0.6</span><br><span class="line">│ ├─┬ html-webpack-plugin@5.5.0</span><br><span class="line">│ │ ├── lodash@4.17.21 deduped</span><br><span class="line">│ │ └─┬ pretty-error@4.0.0</span><br><span class="line">│ │   ├── lodash@4.17.21 deduped</span><br><span class="line">│ │   └─┬ renderkid@3.0.0</span><br><span class="line">│ │     └── lodash@4.17.21 deduped</span><br><span class="line">│ ├─┬ portfinder@1.0.28</span><br><span class="line">│ │ └─┬ async@2.6.4</span><br><span class="line">│ │   └── lodash@4.17.21 deduped</span><br><span class="line">│ └─┬ webpack-bundle-analyzer@4.5.0</span><br><span class="line">│   └── lodash@4.17.21 deduped</span><br><span class="line">├─┬ eslint-plugin-vue@8.7.1</span><br><span class="line">│ └─┬ vue-eslint-parser@8.3.0</span><br><span class="line">│   └── lodash@4.17.21 deduped</span><br><span class="line">└─┬ json-server@0.17.0</span><br><span class="line">  ├── lodash@4.17.21</span><br><span class="line">  └─┬ lowdb@1.0.0</span><br><span class="line">    └── lodash@4.17.21 deduped</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用</p>
<p>全量导入：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> _ <span class="keyword">from</span> <span class="string">&#x27;lodash&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="attr">changeIndex</span>: _.<span class="title function_">throttle</span>(<span class="keyword">function</span> (<span class="params">index</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">currentIndex</span> = index</span><br><span class="line">    &#125;, <span class="number">50</span>)</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure>

<p>按需导入：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> throttle <span class="keyword">from</span> <span class="string">&#x27;lodash/throttle&#x27;</span> <span class="comment">// 底层是module.exports默认暴露的，就不用加小括号了（咋不是require咧）</span></span><br></pre></td></tr></table></figure>

<p>注意点：查看<code>node_modules</code>，<code>throttle.js</code>文件用到了<code>debounce.js</code></p>
<p>里面是有保存上下文<code>this</code>的，在使用的时候不能用箭头函数</p>
<p><code>debounce.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">debounced</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> time = <span class="title function_">now</span>(),</span><br><span class="line">        isInvoking = <span class="title function_">shouldInvoke</span>(time);</span><br><span class="line"></span><br><span class="line">    lastArgs = <span class="variable language_">arguments</span>;</span><br><span class="line">    lastThis = <span class="variable language_">this</span>; <span class="comment">// 注意throttle在使用时，不能用箭头函数，否则this指向会出问题</span></span><br><span class="line">    lastCallTime = time;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isInvoking) &#123;</span><br><span class="line">      <span class="keyword">if</span> (timerId === <span class="literal">undefined</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">leadingEdge</span>(lastCallTime);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (maxing) &#123;</span><br><span class="line">        <span class="comment">// Handle invocations in a tight loop.</span></span><br><span class="line">        <span class="built_in">clearTimeout</span>(timerId);</span><br><span class="line">        timerId = <span class="built_in">setTimeout</span>(timerExpired, wait);</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">invokeFunc</span>(lastCallTime);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (timerId === <span class="literal">undefined</span>) &#123;</span><br><span class="line">      timerId = <span class="built_in">setTimeout</span>(timerExpired, wait);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="src-styles"><a href="#src-styles" class="headerlink" title="src/styles"></a><code>src/styles</code></h3><p><code>/deep</code>的用法</p>
<h3 id="src-router"><a href="#src-router" class="headerlink" title="src/router"></a><code>src/router</code></h3><h4 id="router-js"><a href="#router-js" class="headerlink" title="router.js"></a><code>router.js</code></h4><h4 id="hooks-js"><a href="#hooks-js" class="headerlink" title="hooks.js"></a><code>hooks.js</code></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">impor store <span class="keyword">from</span> <span class="string">&#x27;@/store&#x27;</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="title class_">Types</span> <span class="keyword">from</span> <span class="string">&#x27;@/store/action-types&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="string">&#x27;clear_token&#x27;</span>: <span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// whiteList</span></span><br><span class="line">        store.<span class="title function_">commit</span>(<span class="title class_">Types</span>.<span class="property">CLEAR_TOKEN</span>) <span class="comment">// 清空取消请求的token，如果只希望某个页面切换时取消请求，单独放在组件卸载的生命周期钩子里即可</span></span><br><span class="line">        <span class="title function_">next</span>() <span class="comment">// vue3中支持await的写法</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&#x27;login_permission&#x27;</span>: <span class="keyword">async</span> (to, <span class="keyword">from</span>, next) =&gt; &#123;</span><br><span class="line">        <span class="keyword">let</span> needLogin = to.<span class="property">matched</span>.<span class="title function_">some</span>(<span class="function"><span class="params">item</span> =&gt;</span> item.<span class="property">meta</span>.<span class="property">needLogin</span>)</span><br><span class="line">        <span class="keyword">if</span>(!store.<span class="property">state</span>.<span class="property">user</span>.<span class="property">hasPermission</span>) &#123;</span><br><span class="line">        	<span class="keyword">let</span> isLogin = <span class="keyword">await</span> store.<span class="title function_">dispatch</span>(<span class="string">`user/<span class="subst">$&#123;Types.VALIDATE&#125;</span>`</span>) <span class="comment">// 登录校验</span></span><br><span class="line">            <span class="keyword">if</span>(needLogin) &#123;</span><br><span class="line">                <span class="keyword">if</span>(!isLogin) &#123;</span><br><span class="line">                    <span class="title function_">next</span>(<span class="string">&#x27;/login&#x27;</span>) <span class="comment">// 需要登录，但没登录</span></span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                	<span class="title function_">next</span>() <span class="comment">// 需要登录，的确也登录了，正常走</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123; <span class="comment">// 不需要登录</span></span><br><span class="line">                <span class="keyword">if</span>(to.<span class="property">name</span> == <span class="string">&#x27;login&#x27;</span>) &#123; <span class="comment">// 访问的是登录页</span></span><br><span class="line">                	<span class="keyword">if</span>(!isLogin) &#123;</span><br><span class="line">                        <span class="title function_">next</span>() <span class="comment">// 如果没登录，正常访问登录页</span></span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="title function_">next</span>(<span class="string">&#x27;/profile&#x27;</span>) <span class="comment">// 如果已经登录了，访问跳转到个人中心页</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="title function_">next</span>() <span class="comment">// 不需要登录，访问的是非登录页，正常放行</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">// 如果有权限</span></span><br><span class="line">            <span class="keyword">if</span> (to.<span class="property">name</span> = <span class="string">&#x27;/login&#x27;</span>) &#123;</span><br><span class="line">                <span class="title function_">next</span>(<span class="string">&#x27;/profile&#x27;</span>) <span class="comment">// 访问了登录页，跳转到个人中心</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="title function_">next</span>() <span class="comment">// 有权限，访问的是非登录页，正常放行</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 写在路由权限下面</span></span><br><span class="line">    <span class="string">&#x27;menu-permission&#x27;</span>: <span class="keyword">async</span> (to, <span class="keyword">from</span>, next) =&gt; &#123;</span><br><span class="line">        <span class="comment">// 这里需要对菜单权限进行处理，动态的添加路由</span></span><br><span class="line">        <span class="keyword">if</span>(store.<span class="property">state</span>.<span class="property">user</span>.<span class="property">hasPermission</span>) &#123; <span class="comment">// 要求用户登录才能拿取菜单的权限</span></span><br><span class="line">            <span class="keyword">if</span>(!store.<span class="property">state</span>.<span class="property">user</span>.<span class="property">menuPermission</span>) &#123; <span class="comment">// 没有菜单权限</span></span><br><span class="line">                <span class="keyword">await</span> store.<span class="title function_">dispatch</span>(<span class="string">`user/<span class="subst">$&#123;Types.ADD_ROUTE&#125;</span>`</span>) <span class="comment">// 路由动态加载，此时组件是异步的</span></span><br><span class="line">                <span class="comment">// 我希望等待组件加载完毕后，再跳转过去</span></span><br><span class="line">                <span class="title function_">next</span>(&#123;...to, <span class="attr">replace</span>: <span class="literal">true</span>&#125;) <span class="comment">//让其再重新跳转一次（组件也ok了） hack 再跳一次的时候，菜单权限是有了的</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="title function_">next</span>()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">// 用户没登录</span></span><br><span class="line">            <span class="title function_">next</span>()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="permission-js"><a href="#permission-js" class="headerlink" title="permission.js"></a><code>permission.js</code></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> [ <span class="comment">// 权限管理，要和后台一一对应</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;lesson-manager&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;@/views/others/lesson-manager&#x27;</span>),</span><br><span class="line">        <span class="attr">meta</span>: &#123;</span><br><span class="line">            <span class="attr">auth</span>: <span class="string">&#x27;lesson&#x27;</span> <span class="comment">// 存放的值要和后端约定好</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;student-manager&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;@/views/others/student-manager&#x27;</span>),</span><br><span class="line">        <span class="attr">meta</span>: &#123;</span><br><span class="line">            <span class="attr">auth</span>: <span class="string">&#x27;student&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;points&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;@/views/others/points&#x27;</span>),</span><br><span class="line">        <span class="attr">meta</span>: &#123;</span><br><span class="line">            <span class="attr">auth</span>: <span class="string">&#x27;points&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;collect&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;@/views/others/collect&#x27;</span>),</span><br><span class="line">        <span class="attr">meta</span>: &#123;</span><br><span class="line">            <span class="attr">auth</span>: <span class="string">&#x27;collect&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>



<h1 id="资源导入"><a href="#资源导入" class="headerlink" title="资源导入"></a>资源导入</h1><h2 id="导入静态资源"><a href="#导入静态资源" class="headerlink" title="导入静态资源"></a>导入静态资源</h2><h3 id="导入第三方UI库"><a href="#导入第三方UI库" class="headerlink" title="导入第三方UI库"></a>导入第三方<code>UI</code>库</h3><h4 id="elementUI"><a href="#elementUI" class="headerlink" title="elementUI"></a><code>elementUI</code></h4><ul>
<li><code>vue2</code>项目</li>
</ul>
<h4 id="elementPlus"><a href="#elementPlus" class="headerlink" title="elementPlus"></a><code>elementPlus</code></h4><ul>
<li><code>vue3</code>项目</li>
</ul>
<h4 id="vantUI"><a href="#vantUI" class="headerlink" title="vantUI"></a><code>vantUI</code></h4><ul>
<li><p>官网：<a target="_blank" rel="noopener" href="https://gitee.com/vant-contrib/vant/">https://gitee.com/vant-contrib/vant/</a></p>
</li>
<li><p>目前 Vant 官方提供了 <a target="_blank" rel="noopener" href="https://vant-contrib.gitee.io/vant/v2">Vue 2 版本</a>、<a target="_blank" rel="noopener" href="https://vant-contrib.gitee.io/vant">Vue 3 版本</a>和<a target="_blank" rel="noopener" href="http://vant-contrib.gitee.io/vant-weapp">微信小程序版本</a>，并由社区团队维护 <a href="https://gitee.com/link?target=https://github.com/3lang3/react-vant">React 版本</a>和<a href="https://gitee.com/link?target=https://github.com/ant-move/Vant-Aliapp">支付宝小程序版本</a>。</p>
</li>
<li><p>安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Vue 3 项目，安装最新版 Vant：</span></span><br><span class="line">npm i vant -S</span><br><span class="line"></span><br><span class="line"><span class="comment"># Vue 2 项目，安装 Vant 2：</span></span><br><span class="line">npm i vant@latest-v2 -S</span><br></pre></td></tr></table></figure>
</li>
<li><p>引入</p>
<ul>
<li><p>自动按需引入（推荐）</p>
<p><a target="_blank" rel="noopener" href="https://github.com/ant-design/babel-plugin-import">babel-plugin-import</a> 是一款 babel 插件，它会在编译过程中将 import 的写法自动转换为按需引入的方式。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"># 安装插件</span><br><span class="line">npm i babel-plugin-<span class="keyword">import</span> -D</span><br><span class="line"><span class="comment">// 在.babelrc 中添加配置</span></span><br><span class="line"><span class="comment">// 注意：webpack 1 无需设置 libraryDirectory</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;plugins&quot;</span>: [</span><br><span class="line">    [<span class="string">&quot;import&quot;</span>, &#123;</span><br><span class="line">      <span class="string">&quot;libraryName&quot;</span>: <span class="string">&quot;vant&quot;</span>,</span><br><span class="line">      <span class="string">&quot;libraryDirectory&quot;</span>: <span class="string">&quot;es&quot;</span>,</span><br><span class="line">      <span class="string">&quot;style&quot;</span>: <span class="literal">true</span></span><br><span class="line">    &#125;]</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对于使用 babel7 的用户，可以在 babel.config.js 中配置</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    [<span class="string">&#x27;import&#x27;</span>, &#123;</span><br><span class="line">      <span class="attr">libraryName</span>: <span class="string">&#x27;vant&#x27;</span>,</span><br><span class="line">      <span class="attr">libraryDirectory</span>: <span class="string">&#x27;es&#x27;</span>,</span><br><span class="line">      <span class="attr">style</span>: <span class="literal">true</span></span><br><span class="line">    &#125;, <span class="string">&#x27;vant&#x27;</span>]</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 接着你可以在代码中直接引入 Vant 组件</span></span><br><span class="line"><span class="comment">// 插件会自动将代码转化为方式二中的按需引入形式</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Button</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vant&#x27;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Tips: 如果你在使用 TypeScript，可以使用 ts-import-plugin 实现按需引入。</p>
</blockquote>
</li>
<li><p>在不使用插件的情况下，可以手动引入需要的组件。</p>
<p><code>main.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Button</span> <span class="keyword">from</span> <span class="string">&#x27;vant/lib/button&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;vant/lib/button/style&#x27;</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>导入所有组件（不推荐）</p>
<p>Vant 支持一次性导入所有组件，引入所有组件会增加代码包体积，因此不推荐这种做法。</p>
<p><code>main.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vant</span> <span class="keyword">from</span> <span class="string">&#x27;vant&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;vant/lib/index.css&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Vant</span>);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Tips: 配置按需引入后，将不允许直接导入所有组件。</p>
</blockquote>
</li>
</ul>
</li>
<li><p>可以在<code>App.vue</code>的<code>#app</code>中覆盖<code>vant</code>的样式，也可以单独写个覆盖样式的文件在<code>main.js</code>中引入</p>
</li>
</ul>
<h3 id="导入第三方图标库"><a href="#导入第三方图标库" class="headerlink" title="导入第三方图标库"></a>导入第三方图标库</h3><h3 id="导入自定义工具库"><a href="#导入自定义工具库" class="headerlink" title="导入自定义工具库"></a>导入自定义工具库</h3><h3 id="第三方库的自定义封装"><a href="#第三方库的自定义封装" class="headerlink" title="第三方库的自定义封装"></a>第三方库的自定义封装</h3><h2 id="导入动态资源"><a href="#导入动态资源" class="headerlink" title="导入动态资源"></a>导入动态资源</h2><h3 id="导入scss变量"><a href="#导入scss变量" class="headerlink" title="导入scss变量"></a>导入<code>scss</code>变量</h3><p><code>src/assets/common.scss</code></p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$color</span>: <span class="number">#fff</span>;</span><br><span class="line"><span class="variable">$background</span>: <span class="number">#2a3a3a</span>;</span><br></pre></td></tr></table></figure>

<p>无法在<code>main.js</code>入口文件中导入动态资源，如<code>src/assets/common.scss</code>中的<code>scss</code>变量，需要使用插件动态注入</p>
<p><code>vue.config.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">pluginOptions</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;style-resources-loader&#x27;</span>: &#123;</span><br><span class="line">            <span class="attr">preProcessor</span>: <span class="string">&#x27;scss&#x27;</span></span><br><span class="line">            <span class="attr">pattern</span>: [path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;src/assets/common.scss&#x27;</span>)]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="Vuex最佳实践"><a href="#Vuex最佳实践" class="headerlink" title="Vuex最佳实践"></a><code>Vuex</code>最佳实践</h1><p>目录：<code>root/src/store</code></p>
<h2 id="vuex模块化编码最佳实践"><a href="#vuex模块化编码最佳实践" class="headerlink" title="vuex模块化编码最佳实践"></a><code>vuex</code>模块化编码最佳实践</h2><h3 id="定义模块"><a href="#定义模块" class="headerlink" title="定义模块"></a>定义模块</h3><ul>
<li><p>不同模块都放在<code>store/modules</code>文件夹下</p>
<p><img src="/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96%EF%BC%88Vue%EF%BC%89.assets/image-20220622110840708.png" alt="image-20220622110840708"></p>
</li>
<li><p>不同的模块每个<code>state</code>、<code>action</code>、<code>getters</code>和<code>mutation</code>都单独抽成一个<code>js</code>文件（放在一起代码太多时不好维护）</p>
<ul>
<li><p>为了便于识别，每个<code>state</code>或其它，命名前可以加模块名，如<code>homeState</code></p>
<p>如下形式，分别定义4个</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> homeState = &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> homeState</span><br></pre></td></tr></table></figure>

<p>后面使用<code>.default</code>属性获取文件导出内容时时，并不会用到<code>homeState</code>这个名字，也可以这样写</p>
<p><code>home/state.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这时只能根据文件名和路径名，才能判断这个文件是干嘛的了</p>
</li>
<li><p>在<code>modules</code>同级目录，定义<code>index.js</code>整合所有的模块</p>
<ul>
<li><p>利用<code>webpack</code>中<code>require.context()</code>方法获取文件路径、利用<code>default</code>属性获取模块导出内容</p>
<p><code>moudles/index.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// require.context()方法时webpack内置方法，直接用</span></span><br><span class="line"><span class="keyword">const</span> files = <span class="built_in">require</span>.<span class="title function_">context</span>(<span class="string">&#x27;.&#x27;</span>, <span class="literal">true</span>, <span class="regexp">/\.js$/</span>) <span class="comment">// 搜索当前文件夹，及子文件夹中，以.js结尾的文件</span></span><br><span class="line"><span class="keyword">const</span> modules = &#123;&#125;</span><br><span class="line"><span class="comment">// keys()方法返回匹配的每个文件的相对路径，是个数组</span></span><br><span class="line">files.<span class="title function_">keys</span>().<span class="title function_">forEach</span>(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> path = key.<span class="title function_">replace</span>(<span class="regexp">/\.\/|\.js/g</span>, <span class="string">&#x27;&#x27;</span>) <span class="comment">// 使用正则，把每个相对路径的 ./ 和.js 都替换成空字符串</span></span><br><span class="line">    <span class="comment">// path只剩下 home/state 这种和自身 index 了</span></span><br><span class="line">    <span class="keyword">if</span> (path == <span class="string">&#x27;index&#x27;</span>) <span class="keyword">return</span> <span class="comment">// 路径是自己则不做任何处理</span></span><br><span class="line">    <span class="keyword">let</span> [moduleName, type] = path.<span class="title function_">split</span>(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> (!modules[moduleName]) &#123;</span><br><span class="line">        modules[moduleName] = &#123;<span class="comment">// 开始构造导出对象</span></span><br><span class="line">            <span class="attr">namespaced</span>: <span class="literal">true</span> <span class="comment">// 构建命名空间配置 &#123;namespaced: true&#125;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 构建state/getters/actions/mutations配置项</span></span><br><span class="line">    <span class="comment">// files()方法的返回值一个Module类型的对象，其default属性值，就是每个文件导出的结果值</span></span><br><span class="line">    modules[moduleName][type] = <span class="title function_">files</span>(key).<span class="property">default</span> <span class="comment">//最终的modules对象，就是包含了每个配置项的模块对象</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(modules)</span><br><span class="line">    <span class="comment">// moudles的打印结果 = &#123;</span></span><br><span class="line">    <span class="comment">//     home: &#123;</span></span><br><span class="line">    <span class="comment">//         namespaced: true,</span></span><br><span class="line">    <span class="comment">//         state:&#123;&#125;,</span></span><br><span class="line">    <span class="comment">//         getters:&#123;&#125;,</span></span><br><span class="line">    <span class="comment">//         actions:&#123;&#125;,</span></span><br><span class="line">    <span class="comment">//         mutations:&#123;&#125;</span></span><br><span class="line">    <span class="comment">//     &#125;,</span></span><br><span class="line">    <span class="comment">//     search: &#123;</span></span><br><span class="line">    <span class="comment">//         namespaced: true,</span></span><br><span class="line">    <span class="comment">//         state:&#123;&#125;,</span></span><br><span class="line">    <span class="comment">//         getters:&#123;&#125;,</span></span><br><span class="line">    <span class="comment">//         actions:&#123;&#125;,</span></span><br><span class="line">    <span class="comment">//         mutations:&#123;&#125;</span></span><br><span class="line">    <span class="comment">//     &#125;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 这个结果，和我们一开始学vuex模块化编码是一致的</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> modules;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>在公共的<code>index.js</code>中，解构赋值上面的<code>modules</code>对象，这样就不用一个一个导入一大堆模块了</p>
<ul>
<li>另外，<code>vue-router</code>中不建议使用使用批量导入的方式，因为没有一个明确的规范</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vuex</span> <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"><span class="keyword">import</span> modules <span class="keyword">from</span> <span class="string">&#x27;./modules/index.js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Vuex</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">    <span class="attr">modules</span>: &#123;</span><br><span class="line">        ...modules</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>公共的状态在<code>store/index.js</code>中维护，如<code>websocket</code>等</p>
</li>
</ul>
<h3 id="使用createNamespacedHelpers简化map-写法"><a href="#使用createNamespacedHelpers简化map-写法" class="headerlink" title="使用createNamespacedHelpers简化map*写法"></a>使用<code>createNamespacedHelpers</code>简化<code>map*</code>写法</h3><p>取数的数量越多，这种写法越清爽，提交<code>actions</code>和<code>mutations</code>同理</p>
<p><code>test.vue</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">import &#123;createNamespacedHelpers&#125; from &#x27;vuex&#x27;;</span><br><span class="line"></span><br><span class="line">let mapsObj = createNamespacedHelpers(&#x27;home&#x27;) // 返回值是home模块对应的，mapState/mapGetters/mapActions/mapMutaions的一个对象</span><br><span class="line">let &#123;mapState: mapHomeState, mapActions: mapHomeActions&#125; = createNamespacedHelpers(&#x27;home&#x27;) // 取mapState，并重命名避免多个模块命名冲突</span><br><span class="line">let &#123;mapState: mapSearchState&#125; = createNamespacedHelpers(&#x27;search&#x27;)</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;TypeNav&quot;,</span><br><span class="line">  mounted() &#123;</span><br><span class="line">    // this.$store.dispatch(&#x27;home/categoryList&#x27;)</span><br><span class="line">    console.log(mapHomeState([&#x27;message&#x27;]))</span><br><span class="line">    this.categoryList()</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;</span><br><span class="line">    ...mapHomeState([&#x27;message&#x27;]) // 此时取值不用再指定第一个参数home模块名了，模板中可以直接使用&#123;&#123;message&#125;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    ...mapHomeActions([&#x27;categoryList&#x27;])</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p><code>store/modules/home/actions.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;reqCategoryList&#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/home.js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> homeActions = &#123;</span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">categoryList</span>(<span class="params">&#123;commit&#125;</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> res = <span class="keyword">await</span> <span class="title function_">reqCategoryList</span>()</span><br><span class="line">        <span class="keyword">if</span>(res.<span class="property">code</span> == <span class="number">200</span>) &#123;</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> homeActions</span><br></pre></td></tr></table></figure>

<h3 id="actions和mutaions的types的统一管理"><a href="#actions和mutaions的types的统一管理" class="headerlink" title="actions和mutaions的types的统一管理"></a><code>actions</code>和<code>mutaion</code>s的<code>types</code>的统一管理</h3><p>上一小节我们是直接提交的<code>action</code>，如果数据太多的话，不太好管理命名</p>
<p>-根据需求创建<code>action-types.js</code>和<code>mutation-types.js</code></p>
<p>数据少的的话，都放在<code>mutation-types.js</code>里也不是不行</p>
<p><code>store/mutation-types.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 所有的名字都列在这里</span></span><br><span class="line"><span class="comment">// actions</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">ACTION_CATEGORYLIST</span> = <span class="string">&#x27;ACTION_CATEGORYLIST&#x27;</span> <span class="comment">// 常量都大写</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// mutations</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">MUTATION_CATEGORYLIST</span> = <span class="string">&#x27;MUTATION_CATEGORYLIST&#x27;</span></span><br></pre></td></tr></table></figure>

<p>然后在用到的子模块的<code>action.js</code>或<code>mutation.js</code>中导入</p>
<p><code>home/action.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;reqCategoryList&#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/home.js&#x27;</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="title class_">Types</span> <span class="keyword">from</span> <span class="string">&#x27;@/store/action-types.js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> homeActions = &#123;</span><br><span class="line">    <span class="keyword">async</span> [<span class="title class_">Types</span>.<span class="property">ACTION_CATEGORYLIST</span>](&#123;commit&#125;) &#123;</span><br><span class="line">        <span class="keyword">let</span> result = <span class="keyword">await</span> <span class="title function_">reqCategoryList</span>()</span><br><span class="line">        <span class="keyword">if</span>(result.<span class="property">code</span> == <span class="number">200</span>) &#123;</span><br><span class="line">            <span class="title function_">commit</span>(<span class="title class_">Types</span>.<span class="property">MUTATION_CATEGORYLIST</span>, result.<span class="property">data</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(result)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> homeActions</span><br></pre></td></tr></table></figure>

<p><code>home/mutation.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="title class_">Types</span> <span class="keyword">from</span> <span class="string">&#x27;@/store/action-types&#x27;</span></span><br><span class="line"><span class="keyword">const</span> homeMutations = &#123;</span><br><span class="line">    [<span class="title class_">Types</span>.<span class="property">MUTATION_CATEGORYLIST</span>](state, categoryList) &#123;</span><br><span class="line">        state.<span class="property">categoryList</span> = categoryList</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> homeMutations</span><br></pre></td></tr></table></figure>

<p><code>home/state.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> homeState = &#123;</span><br><span class="line">    <span class="attr">categoryList</span>: [] <span class="comment">// 定义的数据类型，要和实际返回的数据类型保持一致</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> homeState</span><br></pre></td></tr></table></figure>



<p>在组件中使用</p>
<p><code>test.vue</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div&gt;</span><br><span class="line">		&lt;h2&gt;</span><br><span class="line">            &#123;&#123;categoryList&#125;&#125;</span><br><span class="line">    	&lt;/h2&gt;        </span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123;createNamespacedHelpers, mapState&#125; from &#x27;vuex&#x27;;</span><br><span class="line">import * as Types from &#x27;@/store/action-types.js&#x27;</span><br><span class="line">let mapsObj = createNamespacedHelpers(&#x27;home&#x27;)</span><br><span class="line">let &#123;mapState: mapHomeState, mapActions: mapHomeActions&#125; = createNamespacedHelpers(&#x27;home&#x27;) </span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;TypeNav&quot;,</span><br><span class="line">  mounted() &#123;</span><br><span class="line">    console.log(mapHomeState([&#x27;message&#x27;]))</span><br><span class="line">    // this[Types.ACTION_CATEGORYLIST]() // 注意写法</span><br><span class="line">    // 加一层判断，避免每次切换路由组件时都请求一遍接口</span><br><span class="line">    if(this.categoryList.length == 0) &#123; // 如果vuex中没有数据，再去重新请求（用户刷新页面会重新请求）</span><br><span class="line">        this[Types.ACTION_CATEGORYLIST]()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;</span><br><span class="line">    ...mapHomeState([&#x27;categoryList&#x27;])</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    ...mapHomeActions([Types.ACTION_CATEGORYLIST])</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>看另外一个案例</p>
<p><code>index.vue</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div&gt;</span><br><span class="line">        &lt;HomeHeader v-model=&quot;currentCategory&quot;&gt;&lt;/HomeHeader&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    import HomeHeader from &#x27;./home-header.vue&#x27;</span><br><span class="line">    import &#123;createNamespacedHelpers&#125; from &#x27;vuex&#x27;</span><br><span class="line">    import * as Types from &#x27;@/store/action-tpes&#x27;</span><br><span class="line">    // 这里拿到的都是home模块下的</span><br><span class="line">    let &#123;mapState,mapMutations&#125; = createNamespacedHelpers(&#x27;home&#x27;)</span><br><span class="line">    export default &#123;</span><br><span class="line">        methods: &#123;</span><br><span class="line">            ...mapMutations([Type.SET_CATEGORY])</span><br><span class="line">        &#125;,</span><br><span class="line">        computed: &#123;</span><br><span class="line">            ...mapState([&#x27;category&#x27;]),</span><br><span class="line">            currentCategory: &#123;</span><br><span class="line">                get() &#123; // 取值</span><br><span class="line">                    return this.category</span><br><span class="line">                &#125;,</span><br><span class="line">                set(value) &#123; // 修改状态</span><br><span class="line">                    this[Types.SET_CATEGORY](value)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>



<h1 id="VueRouter最佳实践"><a href="#VueRouter最佳实践" class="headerlink" title="VueRouter最佳实践"></a><code>VueRouter</code>最佳实践</h1><p>路由不建议自动生成，但可配置性太低（如批注、钩子）</p>
<h2 id="异步组件"><a href="#异步组件" class="headerlink" title="异步组件"></a>异步组件</h2><p>除了首页用到的组件，其他组件都可以按需加载</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;/lesson&#x27;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;lesson&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;@/views/lesson/index.vue&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>异步组件未加载时，会出现空白页</p>
<p>虽然可以使用<code>prefetch</code>让后续页面用到的先加载，但还是不太好，一般会加个<code>loading</code></p>
<p>在<code>router/index.js</code>中使用<code>src/utils/loadable.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">import</span> loadable <span class="keyword">from</span> <span class="string">&#x27;@/utils/loadable&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;/lesson&#x27;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;lesson&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="title function_">loadable</span>(<span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;@/views/lesson/index.vue&#x27;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h2 id="路由权限"><a href="#路由权限" class="headerlink" title="路由权限"></a>路由权限</h2><p><code>src/api/user.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;@/utils/axios&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 登录接口</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">toLogin</span> = (<span class="params">data</span>) =&gt; axios.<span class="title function_">get</span>(<span class="string">&#x27;/usrer/login&#x27;</span>, data)</span><br><span class="line"><span class="comment">// 验证是否通过</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">validate</span> = (<span class="params"></span>) =&gt; axios.<span class="title function_">get</span>(<span class="string">&#x27;/user/validate&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><code>src/store/modules/user/state.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> userState = &#123;</span><br><span class="line">    <span class="attr">username</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="attr">token</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// jwt的方式</span></span><br><span class="line">    <span class="attr">hasPermission</span>: <span class="literal">false</span>, <span class="comment">// 权限有无</span></span><br><span class="line">    </span><br><span class="line">    <span class="attr">authList</span>: [], <span class="comment">// 菜单权限列表</span></span><br><span class="line">    <span class="attr">menuPermission</span>: <span class="literal">false</span>,</span><br><span class="line">    </span><br><span class="line">    <span class="attr">btnPermission</span>: [<span class="string">&#x27;edit&#x27;</span>, <span class="string">&#x27;delete&#x27;</span>] <span class="comment">// 按钮权限列表</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> userState</span><br></pre></td></tr></table></figure>

<p><code>src/store/action-types.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置用户信息 登录需要的</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">SET_LOGIN</span> = <span class="string">&#x27;SET_TOKEN&#x27;</span> <span class="comment">// 默认点击登录时，会调用一个action</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">SET_USER</span> = <span class="string">&#x27;SET_USER&#x27;</span> <span class="comment">// 更改存储状态的用户信息 mutation</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">SET_PERMISSION</span> = <span class="string">&#x27;SET_PERMISSION&#x27;</span> <span class="comment">// 更改权限的 mutation</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">VALIDATE</span> = <span class="string">&#x27;VALIDATE&#x27;</span> <span class="comment">// 页面一刷新，校验权限的，会调用一个action</span></span><br></pre></td></tr></table></figure>

<p><code>src/store/modules/user/actions.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="title class_">Types</span> <span class="keyword">from</span> <span class="string">&#x27;@/store/action-types.js&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;toLogin, validate&#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/user.js&#x27;</span></span><br><span class="line"><span class="keyword">const</span> userActions = &#123;</span><br><span class="line">    <span class="keyword">async</span> [<span class="title class_">Types</span>.<span class="property">SET_USER</span>](&#123;commit&#125;, &#123;userInfo, has&#125;) &#123;</span><br><span class="line">        <span class="title function_">commit</span>(<span class="title class_">Types</span>.<span class="property">SET_USER</span>, userInfo)</span><br><span class="line">        <span class="title function_">commit</span>(<span class="title class_">Types</span>.<span class="property">SET_PERMISSION</span>, has) <span class="comment">// 标识登陆过了</span></span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> [<span class="title class_">Types</span>.<span class="property">SET_LOGIN</span>](&#123;dispatch&#125;, payload) &#123;</span><br><span class="line">        <span class="keyword">let</span> userInfo = <span class="keyword">await</span> <span class="title function_">toLogin</span>(payload) <span class="comment">// 假设后端返回的字段有username(String)/token(String)/authList(Array)[&#123;auth:&quot;points&quot;,name:&quot;积分查看&quot;,path:&quot;/profile/points&quot;&#125;,...]</span></span><br><span class="line">		<span class="title function_">dispatch</span>(<span class="title class_">Types</span>.<span class="property">SET_USER</span>, &#123;userInfo, <span class="attr">has</span>: <span class="literal">true</span>&#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">async</span> [<span class="title class_">Types</span>.<span class="property">VALIDATE</span>](&#123;commit&#125;, payload) &#123;</span><br><span class="line">        <span class="comment">// 此时需要看一下 用户是否登录过</span></span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;key&#x27;</span>)) <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// axios中增加token，传到后端，让后端验证去</span></span><br><span class="line">            <span class="comment">// 通过接口持久化vuex</span></span><br><span class="line">            <span class="keyword">let</span> userInfo = <span class="keyword">await</span> <span class="title function_">validate</span>() <span class="comment">// 校验是否登录过</span></span><br><span class="line">			<span class="title function_">dispatch</span>(<span class="title class_">Types</span>.<span class="property">SET_USER</span>, &#123;userInfo, <span class="attr">has</span>: <span class="literal">true</span>&#125;)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span> <span class="comment">// 返回给路由钩子</span></span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span>(e) &#123;</span><br><span class="line">			<span class="title function_">dispatch</span>(<span class="title class_">Types</span>.<span class="property">SET_USER</span>, &#123;<span class="attr">userInfo</span>: &#123;&#125;, <span class="attr">has</span>: <span class="literal">false</span>&#125;)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> userActions</span><br></pre></td></tr></table></figure>

<p><code>src/store/modules/user/mutations.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="title class_">Types</span> <span class="keyword">from</span> <span class="string">&#x27;@/store/action-types.js&#x27;</span></span><br><span class="line"><span class="keyword">const</span> userMutations = &#123;</span><br><span class="line">    [<span class="title class_">Types</span>.<span class="property">SET_USER</span>](state, payload) &#123;</span><br><span class="line">        state.<span class="property">token</span> = payload.<span class="property">token</span></span><br><span class="line">        state.<span class="property">username</span> = payload.<span class="property">username</span></span><br><span class="line">        state.<span class="property">authList</span> = payload.<span class="property">authList</span></span><br><span class="line">        <span class="comment">// 也可以用解构赋值的写法</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// cookie / localStorage</span></span><br><span class="line">        <span class="keyword">if</span>(payload.<span class="property">token</span>) &#123; <span class="comment">// 登录完之后，存token到localStorage中</span></span><br><span class="line">            <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&#x27;token&#x27;</span>, payload.<span class="property">token</span>) <span class="comment">// 也可以用封装过的方法</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    [<span class="title class_">Types</span>.<span class="property">SET_PERMISSION</span>](state, payload) &#123;</span><br><span class="line">        state.<span class="property">hasPermission</span> = payload</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> userActions</span><br></pre></td></tr></table></figure>

<p><code>src/router/hooks.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">impor store <span class="keyword">from</span> <span class="string">&#x27;@/store&#x27;</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="title class_">Types</span> <span class="keyword">from</span> <span class="string">&#x27;@/store/action-types&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="string">&#x27;login_permission&#x27;</span>: <span class="keyword">async</span> (to, <span class="keyword">from</span>, next) =&gt; &#123;</span><br><span class="line">        <span class="comment">// 用户是否需要登录才能访问的标识</span></span><br><span class="line">        <span class="keyword">let</span> needLogin = to.<span class="property">matched</span>.<span class="title function_">some</span>(<span class="function"><span class="params">item</span> =&gt;</span> item.<span class="property">meta</span>.<span class="property">needLogin</span>)</span><br><span class="line">        <span class="comment">// 如果vuex中有值，我就认为你当前登录了</span></span><br><span class="line">        <span class="keyword">if</span>(!store.<span class="property">state</span>.<span class="property">user</span>.<span class="property">hasPermission</span>) &#123;</span><br><span class="line">            <span class="comment">// 返回了一个isLogin字段，表示用户是否登陆过了</span></span><br><span class="line">            <span class="comment">// loginWhiteList 可以做一个白名单</span></span><br><span class="line">        	<span class="keyword">let</span> isLogin = <span class="keyword">await</span> store.<span class="title function_">dispatch</span>(<span class="string">`user/<span class="subst">$&#123;Types.VALIDATE&#125;</span>`</span>) <span class="comment">// 登录校验</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span>(needLogin) &#123;</span><br><span class="line">                <span class="keyword">if</span>(!isLogin) &#123;</span><br><span class="line">                    <span class="title function_">next</span>(<span class="string">&#x27;/login&#x27;</span>) <span class="comment">// 需要登录，但没登录</span></span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                	<span class="title function_">next</span>() <span class="comment">// 需要登录，的确也登录了，正常走</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123; <span class="comment">// 不需要登录</span></span><br><span class="line">                <span class="keyword">if</span>(to.<span class="property">name</span> == <span class="string">&#x27;login&#x27;</span>) &#123; <span class="comment">// 访问的是登录页</span></span><br><span class="line">                	<span class="keyword">if</span>(!isLogin) &#123;</span><br><span class="line">                        <span class="title function_">next</span>() <span class="comment">// 如果没登录，正常访问登录页</span></span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="title function_">next</span>(<span class="string">&#x27;/profile&#x27;</span>) <span class="comment">// 如果已经登录了，访问跳转到个人中心页</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="title function_">next</span>() <span class="comment">// 不需要登录，访问的是非登录页，正常放行</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">// 如果有权限</span></span><br><span class="line">            <span class="keyword">if</span> (to.<span class="property">name</span> = <span class="string">&#x27;/login&#x27;</span>) &#123;</span><br><span class="line">                <span class="title function_">next</span>(<span class="string">&#x27;/profile&#x27;</span>) <span class="comment">// 访问了登录页，跳转到个人中心</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="title function_">next</span>() <span class="comment">// 有权限，访问的是非登录页，正常放行</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>有些页面不用登录也能访问，有些页面必须需要登录</p>
<p><code>src/router/index.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;lesson&#x27;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;lesson&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="title function_">loadable</span>(<span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;@/views/lesson/index.vue&#x27;</span>)),</span><br><span class="line">        <span class="attr">meta</span>: &#123;</span><br><span class="line">            <span class="attr">needLogin</span>: <span class="literal">true</span> <span class="comment">// 必须要登录</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>登录页面</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    import * as Types from &#x27;@/store/action-types.js&#x27;</span><br><span class="line">    import FormSubmit from &#x27;@/components/form-submit&#x27;</span><br><span class="line">    import &#123;Dialog&#125; from &#x27;vant&#x27; // 全局引入的只能在template使用，如果要在script中使用，需要额外引入</span><br><span class="line">    import &#123;createNamespacedHelpers&#125; from &#x27;vuex&#x27;</span><br><span class="line">    let &#123;mapAcitons&#125; = createNamespacedHelpers(&#x27;user&#x27;)</span><br><span class="line">    export default &#123;</span><br><span class="line">        components: &#123;</span><br><span class="line">            FormSubmit</span><br><span class="line">        &#125;,</span><br><span class="line">        methods: &#123;</span><br><span class="line">            ...mapAcitons([Types.SET_LOGIN]),</span><br><span class="line">            async submit(values) &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">	                await this[Types.SET_LOGIN](values)</span><br><span class="line">                    this.$router.push(&#x27;profile&#x27;)</span><br><span class="line">                &#125; catch(e) &#123;</span><br><span class="line">                    Dialog.alert(&#123;</span><br><span class="line">                        title: &#x27;登录失败&#x27;,</span><br><span class="line">                        messgae: e.data</span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p><code>views/profile/index.vue</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div class=&quot;profile&quot;&gt;</span><br><span class="line">        &lt;vant-nav-bar title=&quot;个人中心&quot;&gt;&lt;/vant-nav-bar&gt;</span><br><span class="line">        &lt;div class=&quot;profil-info&quot;&gt;</span><br><span class="line">            &lt;!-- 如果功能很多，记得用mapState --&gt;</span><br><span class="line">            &lt;template v-if=&quot;!$store.state.user.hasPermission&quot;&gt;</span><br><span class="line">                &lt;img src=&quot;@/assets/logo.png&quot;&gt;</span><br><span class="line">                &lt;van-button size=&quot;small&quot;&gt;登录&lt;/van-button&gt;</span><br><span class="line">			&lt;/template&gt;</span><br><span class="line">			&lt;template v-else&gt;</span><br><span class="line">				&lt;!-- 头像上传 --&gt;</span><br><span class="line">				&lt;img src=&quot;@/assets/logo.png&quot;&gt;</span><br><span class="line">				&lt;span&gt;&#123;&#123;$store.state.user.username&#125;&#125;&lt;/span&gt;</span><br><span class="line">			&lt;/template&gt;</span><br><span class="line">    	&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>



<h2 id="菜单权限"><a href="#菜单权限" class="headerlink" title="菜单权限"></a>菜单权限</h2><p>后端有一个根据<code>username</code>返回不同<code>path</code>的接口</p>
<p>后台返回权限信息的接口：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">validate</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;ctx, app&#125; = <span class="variable language_">this</span></span><br><span class="line">    <span class="keyword">const</span> token = ctx.<span class="property">headers</span>.<span class="property">authorization</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> decoded = jwt.<span class="title function_">verify</span>(token, app.<span class="property">config</span>.<span class="property">privateKey</span>)</span><br><span class="line">        <span class="keyword">let</span> authList</span><br><span class="line">        <span class="keyword">if</span>(decoded.<span class="property">username</span> = <span class="string">&#x27;admin&#x27;</span>) &#123;</span><br><span class="line">            authList = [</span><br><span class="line">                &#123;<span class="attr">auth</span>: <span class="string">&#x27;lesson&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;课程管理&#x27;</span>, <span class="attr">path</span>: <span class="string">&#x27;/profile/lesson-manager&#x27;</span>&#125;,</span><br><span class="line">                &#123;<span class="attr">auth</span>: <span class="string">&#x27;student&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;学员管理&#x27;</span>, <span class="attr">path</span>: <span class="string">&#x27;/profile/student-manager&#x27;</span>&#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            authList = [</span><br><span class="line">                &#123;<span class="attr">auth</span>: <span class="string">&#x27;points&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;积分查看&#x27;</span>, <span class="attr">path</span>: <span class="string">&#x27;/profile/points&#x27;</span>&#125;,</span><br><span class="line">                &#123;<span class="attr">auth</span>: <span class="string">&#x27;collect&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;收藏列表&#x27;</span>, <span class="attr">path</span>: <span class="string">&#x27;/profile/collect&#x27;</span>&#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">        ctx.<span class="property">body</span> = &#123;</span><br><span class="line">            <span class="attr">err</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">data</span>: &#123;</span><br><span class="line">                <span class="attr">username</span>: decoded.<span class="property">username</span></span><br><span class="line">                <span class="comment">// ....</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span>(e) &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上述返回的<code>path</code>对应前台的动态路由</p>
<p>我们在<code>views/others</code>文件夹中创建这四个<code>vue</code>文件：<code>lesson-manager.vue</code>、<code>student-manager.vue</code>、<code>points.vue</code>、<code>collect.vue</code></p>
<p>由于是动态添加的，我们不能直接写到<code>router/index.js</code>中</p>
<p>新建<code>src/rotuer/permission.js</code>，该文件中专门放一些权限相关的路由</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> [ <span class="comment">// 权限管理，要和后台一一对应</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;lesson-manager&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;@/views/others/lesson-manager&#x27;</span>),</span><br><span class="line">        <span class="attr">meta</span>: &#123;</span><br><span class="line">            <span class="attr">auth</span>: <span class="string">&#x27;lesson&#x27;</span> <span class="comment">// 存放的值要和后端约定好</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;student-manager&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;@/views/others/student-manager&#x27;</span>),</span><br><span class="line">        <span class="attr">meta</span>: &#123;</span><br><span class="line">            <span class="attr">auth</span>: <span class="string">&#x27;student&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;points&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;@/views/others/points&#x27;</span>),</span><br><span class="line">        <span class="attr">meta</span>: &#123;</span><br><span class="line">            <span class="attr">auth</span>: <span class="string">&#x27;points&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;collect&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;@/views/others/collect&#x27;</span>),</span><br><span class="line">        <span class="attr">meta</span>: &#123;</span><br><span class="line">            <span class="attr">auth</span>: <span class="string">&#x27;collect&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>在路由前置钩子里，还需要做一件事：根据菜单权限显示不同的动态组件</p>
<p><code>src/router/hooks.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">impor store <span class="keyword">from</span> <span class="string">&#x27;@/store&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// 写在路由权限下面</span></span><br><span class="line">    <span class="string">&#x27;menu-permission&#x27;</span>: <span class="keyword">async</span> (to, <span class="keyword">from</span>, next) =&gt; &#123;</span><br><span class="line">        <span class="comment">// 这里需要对菜单权限进行处理，动态的添加路由</span></span><br><span class="line">        <span class="keyword">if</span>(store.<span class="property">state</span>.<span class="property">user</span>.<span class="property">hasPermission</span>) &#123; <span class="comment">// 要求用户登录才能拿取菜单的权限</span></span><br><span class="line">            <span class="keyword">if</span>(!store.<span class="property">state</span>.<span class="property">user</span>.<span class="property">menuPermission</span>) &#123; <span class="comment">// 没有菜单权限</span></span><br><span class="line">                <span class="keyword">await</span> store.<span class="title function_">dispatch</span>(<span class="string">`user/<span class="subst">$&#123;Types.ADD_ROUTE&#125;</span>`</span>) <span class="comment">// 路由动态加载，此时组件是异步的</span></span><br><span class="line">                <span class="comment">// 我希望等待组件加载完毕后，再跳转过去</span></span><br><span class="line">                <span class="title function_">next</span>(&#123;...to, <span class="attr">replace</span>: <span class="literal">true</span>&#125;) <span class="comment">//让其再重新跳转一次（组件也ok了） hack 再跳一次的时候，菜单权限是有了的</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="title function_">next</span>()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">// 用户没登录</span></span><br><span class="line">            <span class="title function_">next</span>()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>src/store/action-types.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">ADD_ROUTE</span> = <span class="string">&#x27;ADD_ROUTE&#x27;</span> <span class="comment">// 动态添加路由 action</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">SET_MENU_PERMISSION</span> = <span class="string">&#x27;SET_MENU_PERMISSION&#x27;</span> <span class="comment">// mutation</span></span><br></pre></td></tr></table></figure>

<p><code>src/store/modules/user/mutations.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="title class_">Types</span> <span class="keyword">from</span> <span class="string">&#x27;@/store/action-types.js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> userMutations = &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    [<span class="title class_">Types</span>.<span class="property">SET_MENU_PERMISSION</span>](state, payload) &#123;</span><br><span class="line">        state.<span class="property">menuPermission</span> = payload</span><br><span class="line">    &#125;</span><br><span class="line">&#125;	</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> userMutations</span><br></pre></td></tr></table></figure>

<p><code>src/store/modules/user/actions.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="title class_">Types</span> <span class="keyword">from</span> <span class="string">&#x27;@/store/action-types.js&#x27;</span></span><br><span class="line"><span class="keyword">import</span> per <span class="keyword">from</span> <span class="string">&#x27;@/router/permission.js&#x27;</span></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;@/router&#x27;</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">filterRouter</span> = (<span class="params">authList</span>) =&gt; &#123; <span class="comment">// 拿每个路由，看在不在权限列表中</span></span><br><span class="line">    <span class="comment">// 有很多种过滤的方式</span></span><br><span class="line">    <span class="comment">// 扁平化过滤，把tree展开，然后一层层过滤，性能更高一点</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 递归过滤</span></span><br><span class="line">    authList = authList.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> item.<span class="property">auth</span>)</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">filter</span>(<span class="params">per</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> result = per.<span class="title function_">filter</span>(<span class="function"><span class="params">route</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(authList.<span class="title function_">includes</span>(route.<span class="property">meta</span>.<span class="property">auth</span>)) &#123;</span><br><span class="line">                <span class="keyword">if</span>(router.<span class="property">children</span>) &#123; <span class="comment">// 嵌套路由，一般不会超过三层</span></span><br><span class="line">                    route.<span class="property">children</span> = <span class="title function_">filter</span>(route.<span class="property">children</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> route</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">filter</span>(per)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> userActions = &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">async</span> [<span class="title class_">Types</span>.<span class="property">ADD_ROUTE</span>](&#123;commit, dispatch, state&#125;, payload) &#123;</span><br><span class="line">        <span class="comment">// 添加路由（菜单）</span></span><br><span class="line">        <span class="comment">// 拿到路由（菜单）的权限再去添加路由</span></span><br><span class="line">        <span class="comment">// 路由（菜单）的权限在vuex中</span></span><br><span class="line">        <span class="keyword">let</span> authList = state.<span class="property">authList</span> <span class="comment">// 服务端返回的权限</span></span><br><span class="line">        <span class="comment">// 根据后台提供的权限，在前台自定义的权限中，进行过滤（复杂的话可能需要递归）</span></span><br><span class="line">        <span class="keyword">let</span> routes = <span class="title function_">filterRouter</span>(authList)</span><br><span class="line">        <span class="comment">// 拿到不同权限对应的动态路由路径后，将路由组件添加到`profile`中</span></span><br><span class="line">        <span class="keyword">let</span> route = router.<span class="property">options</span>.<span class="property">routes</span>.<span class="title function_">find</span>(<span class="function"><span class="params">item</span> =&gt;</span> item.<span class="property">path</span> == <span class="string">&#x27;/profile&#x27;</span>) <span class="comment">// 可以打印router对象，它有一个options属性</span></span><br><span class="line">        route.<span class="property">children</span> = routes <span class="comment">// 动态添加子组件</span></span><br><span class="line">        router.<span class="title function_">addRouter</span>([route]) <span class="comment">// 该方法接收一个数组，动态的再向router中添加</span></span><br><span class="line">        </span><br><span class="line">        <span class="title function_">commit</span>(<span class="title class_">Types</span>.<span class="property">SET_MENUPERMISSION</span>, <span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> userActions</span><br></pre></td></tr></table></figure>

<p><code>profile.vue</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div class=&quot;profile&quot;&gt;</span><br><span class="line">        &lt;vant-nav-bar title=&quot;个人中心&quot;&gt;&lt;/vant-nav-bar&gt;</span><br><span class="line">        &lt;div class=&quot;profil-info&quot;&gt;</span><br><span class="line">            &lt;!-- 如果功能很多，记得用mapState --&gt;</span><br><span class="line">            &lt;template v-if=&quot;!$store.state.user.hasPermission&quot;&gt;</span><br><span class="line">                &lt;img src=&quot;@/assets/logo.png&quot;&gt;</span><br><span class="line">                &lt;van-button size=&quot;small&quot;&gt;登录&lt;/van-button&gt;</span><br><span class="line">			&lt;/template&gt;</span><br><span class="line">			&lt;template v-else&gt;</span><br><span class="line">				&lt;!-- 头像上传 --&gt;</span><br><span class="line">				&lt;img src=&quot;@/assets/logo.png&quot;&gt;</span><br><span class="line">				&lt;span&gt;&#123;&#123;$store.state.user.username&#125;&#125;&lt;/span&gt;</span><br><span class="line">			&lt;/template&gt;</span><br><span class="line">    	&lt;/div&gt;</span><br><span class="line">		</span><br><span class="line">		&lt;template  v-if=&quot;$store.state.user.menuPermission&quot;&gt;</span><br><span class="line">            &lt;vant-tabs types=&quot;card&quot;&gt;</span><br><span class="line">                &lt;vant-tab </span><br><span class="line">                          :title=&quot;item.name&quot;</span><br><span class="line">                          v-for=&quot;(item, index) in $store.state.user.authList&quot;</span><br><span class="line">                          :to=&quot;item.path&quot;</span><br><span class="line">                          :key=&quot;index&quot;</span><br><span class="line">                          &gt;</span><br><span class="line">                    &lt;!-- item.path中的path，是后端返回的字段 --&gt;</span><br><span class="line">                &lt;/vant-tab&gt;            </span><br><span class="line">            &lt;/vant-tabs&gt;</span><br><span class="line"> 			&lt;!-- 可以再配置个redirect字段，让其默认展示 --&gt;</span><br><span class="line">			&lt;router-view&gt;&lt;/router-view&gt;</span><br><span class="line">		&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>



<h2 id="按钮权限"><a href="#按钮权限" class="headerlink" title="按钮权限"></a>按钮权限</h2><p>一般也是用户登录的一瞬间，把按钮权限字段，放在<code>vuex</code>中</p>
<p>页面中使用指令控制</p>
<p><code>src/store/modules/user/state.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> userState = &#123;</span><br><span class="line">    <span class="attr">username</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="attr">token</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// jwt的方式</span></span><br><span class="line">    <span class="attr">hasPermission</span>: <span class="literal">false</span>, <span class="comment">// 权限有无</span></span><br><span class="line">    <span class="attr">authList</span>: [], <span class="comment">// 菜单权限列表</span></span><br><span class="line">    <span class="attr">menuPermission</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">btnPermission</span>: [<span class="string">&#x27;edit&#x27;</span>, <span class="string">&#x27;delete&#x27;</span>] <span class="comment">// 按钮权限列表，值是根据后台返回的值动态添加</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> userState</span><br></pre></td></tr></table></figure>

<p><code>profile.vue</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div class=&quot;profile&quot;&gt;</span><br><span class="line">        &lt;vant-nav-bar title=&quot;个人中心&quot;&gt;&lt;/vant-nav-bar&gt;</span><br><span class="line">        &lt;div class=&quot;profil-info&quot;&gt;</span><br><span class="line">            &lt;template v-if=&quot;!$store.state.user.hasPermission&quot;&gt;</span><br><span class="line">                &lt;img src=&quot;@/assets/logo.png&quot;&gt;</span><br><span class="line">                &lt;van-button size=&quot;small&quot;&gt;登录&lt;/van-button&gt;</span><br><span class="line">			&lt;/template&gt;</span><br><span class="line">			&lt;template v-else&gt;</span><br><span class="line">				&lt;img src=&quot;@/assets/logo.png&quot;&gt;</span><br><span class="line">				&lt;span&gt;&#123;&#123;$store.state.user.username&#125;&#125;&lt;/span&gt;</span><br><span class="line">			&lt;/template&gt;</span><br><span class="line">    	&lt;/div&gt;</span><br><span class="line">		</span><br><span class="line">		&lt;template  v-if=&quot;$store.state.user.menuPermission&quot;&gt;</span><br><span class="line">            &lt;vant-tabs types=&quot;card&quot;&gt;</span><br><span class="line">                &lt;vant-tab </span><br><span class="line">                          :title=&quot;item.name&quot;</span><br><span class="line">                          v-for=&quot;(item, index) in $store.state.user.authList&quot;</span><br><span class="line">                          :to=&quot;item.path&quot;</span><br><span class="line">                          :key=&quot;index&quot;</span><br><span class="line">                          &gt;</span><br><span class="line">                &lt;/vant-tab&gt;            </span><br><span class="line">            &lt;/vant-tabs&gt;</span><br><span class="line">			&lt;router-view&gt;&lt;/router-view&gt;</span><br><span class="line">		&lt;/template&gt;</span><br><span class="line">		</span><br><span class="line">		&lt;template&gt;</span><br><span class="line">			&lt;vant-button v-has=&quot;edit&quot;&gt;编辑&lt;/vant-button&gt;</span><br><span class="line">			&lt;vant-button v-has=&#x27;delete&#x27;&gt;删除&lt;/vant-button&gt;</span><br><span class="line">		&lt;/template&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<p><code>src/utils/directives.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="string">&#x27;has&#x27;</span>: &#123;</span><br><span class="line">        <span class="title function_">inserted</span>(<span class="params">el, bindings, vnode</span>) &#123;</span><br><span class="line">            <span class="keyword">let</span> value = bindings.<span class="property">value</span> <span class="comment">// 用户写的values值 v-has=&quot;vlaue&quot;</span></span><br><span class="line">            <span class="keyword">let</span> permission = vnode.<span class="property">context</span>. $store.<span class="property">state</span>.<span class="property">user</span>.<span class="property">btnPermission</span> <span class="comment">// 在上下文里找，上下文是当前指令所在组件的组件实例</span></span><br><span class="line">            <span class="keyword">if</span>(!permission.<span class="title function_">includes</span>(value)) &#123;</span><br><span class="line">                el.<span class="property">parentNode</span>.<span class="title function_">removeChild</span>(el)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>main.js</code>中引入指令</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 指令</span></span><br><span class="line"><span class="keyword">import</span> directives <span class="keyword">from</span> <span class="string">&#x27;@/utils/directives&#x27;</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">entries</span>(directives).<span class="title function_">forEach</span>(<span class="function">(<span class="params">[id, define]</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title class_">Vue</span>.<span class="title function_">directives</span>(id, define)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 备注：全局组件、过滤器也可以这样封装</span></span><br></pre></td></tr></table></figure>



<h1 id="axios最佳实践"><a href="#axios最佳实践" class="headerlink" title="axios最佳实践"></a><code>axios</code>最佳实践</h1><h2 id="函数封装-1"><a href="#函数封装-1" class="headerlink" title="函数封装"></a>函数封装</h2><h2 id="类封装"><a href="#类封装" class="headerlink" title="类封装"></a>类封装</h2><h3 id="封装"><a href="#封装" class="headerlink" title="封装"></a>封装</h3><p><code>utils/axios.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;@/store&#x27;</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="title class_">Types</span> <span class="keyword">from</span> <span class="string">&#x27;@/store/actions-types.js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HttpRequest</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">baseURL</span> = process.<span class="property">env</span>.<span class="property">NODE_ENV</span> == <span class="string">&#x27;production&#x27;</span> ? <span class="string">&#x27;/&#x27;</span> : <span class="string">&#x27;http://localhost:7001&#x27;</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">timeout</span> = <span class="number">3000</span></span><br><span class="line">        <span class="comment">// 需要加loading（一般很少加了，但要知道）</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">queue</span> = &#123;&#125; <span class="comment">// 专门用来维护请求队列，页面切换用来取消请求</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 全局拦截器</span></span><br><span class="line">    <span class="title function_">setInterceptor</span>(<span class="params">instance, url</span>) &#123; <span class="comment">// 设置全局拦截器</span></span><br><span class="line">        instance.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(<span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 开启loading，自己找个地方显示</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="title class_">Object</span>.<span class="title function_">keys</span>(<span class="variable language_">this</span>.<span class="property">queue</span>).<span class="property">length</span> == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">// 开loading </span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">let</span> token = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;token&#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span>(token) &#123;</span><br><span class="line">                <span class="comment">// 每次请求都会携带一个权限访问服务器</span></span><br><span class="line">                config.<span class="property">headers</span>.<span class="property">authorization</span> = token</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 可以记录请求的取消函数</span></span><br><span class="line">            <span class="keyword">let</span> <span class="title class_">CancelToken</span> = axios.<span class="property">CancelToken</span></span><br><span class="line">            config.<span class="property">cacelToken</span> = <span class="keyword">new</span> <span class="title class_">CancelToken</span>(<span class="function">(<span class="params">c</span>) =&gt;</span> &#123; <span class="comment">// 绑定在config上</span></span><br><span class="line">                <span class="comment">// c就是当前取消请求的token</span></span><br><span class="line">                <span class="comment">// 可以存到vuex中，页面切换的时候，组件销毁时执行</span></span><br><span class="line">                <span class="comment">// 涉及到vuex三连环</span></span><br><span class="line">                store.<span class="title function_">commit</span>(<span class="title class_">Types</span>.<span class="property">SET_TOKEN</span>, c) <span class="comment">// 同步，将取消方法存入到vuex</span></span><br><span class="line">                <span class="comment">// 那么什么时候清除这些取消请求的token呢？ 在路由切换的时候（放在路由守卫中，只要你一切换路由，就认为请求跳一半了，就取消请求）</span></span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">queue</span>[url] = <span class="literal">true</span></span><br><span class="line">            <span class="keyword">return</span> config</span><br><span class="line">        &#125;)</span><br><span class="line">        </span><br><span class="line">        instance.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">delete</span> <span class="variable language_">this</span>.<span class="property">queue</span>[url] <span class="comment">// 一旦响应成功了，就删除</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="title class_">Object</span>.<span class="title function_">keys</span>(<span class="variable language_">this</span>.<span class="property">queue</span>).<span class="property">length</span> == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">// close loading</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span>(res.<span class="property">data</span>.<span class="property">err</span> == <span class="number">0</span>) &#123; <span class="comment">//所有的响应体都有这个字段</span></span><br><span class="line">            	<span class="keyword">return</span> res.<span class="property">data</span>.<span class="property">data</span><span class="comment">// 这里要结合接口具体字段，可以配合switchCase状态</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">delete</span> <span class="variable language_">this</span>.<span class="property">queue</span>[url]</span><br><span class="line">            <span class="keyword">if</span>(<span class="title class_">Object</span>.<span class="title function_">keys</span>(<span class="variable language_">this</span>.<span class="property">queue</span>).<span class="property">length</span> == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">// close loading</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(err) <span class="comment">// 把报错抛给用户，让用户处理</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">request</span>(<span class="params">options</span>) &#123; <span class="comment">// 通过request方法来进行请求操作</span></span><br><span class="line">        <span class="comment">// 每次请求可以创建一个新的实例，如果业务不复杂可以不创建实例，直接使用`axios`</span></span><br><span class="line">        <span class="comment">// 复杂场景下ab用的是同一个实例的话，要各自加拦截器就不好加，所以需要单独创建实例加拦截器</span></span><br><span class="line">        <span class="keyword">let</span> instance = axios.<span class="title function_">create</span>()</span><br><span class="line">        <span class="keyword">let</span> config = &#123;</span><br><span class="line">            <span class="attr">baseURL</span>: <span class="variable language_">this</span>.<span class="property">baseURL</span>,</span><br><span class="line">            <span class="attr">timeout</span>: <span class="variable language_">this</span>.<span class="property">timeout</span>,</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">            ...options</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setInterceptor</span>(instance, config.<span class="property">url</span>)</span><br><span class="line">		<span class="keyword">return</span> <span class="title function_">instance</span>(config) <span class="comment">// 产生的是一个`Promise`</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">get</span>(<span class="params">url, data=&#123;&#125;</span>) &#123; <span class="comment">// axios.get(&#x27;/xxx&#x27;,&#123;params: xxx&#125;)</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">request</span>(&#123;</span><br><span class="line">            url,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">            ...data</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">post</span>(<span class="params">url, data=&#123;&#125;</span>) &#123; <span class="comment">// axios.post(&#x27;/xxx&#x27;, &#123;data&#125;)</span></span><br><span class="line">		<span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">request</span>(&#123;</span><br><span class="line">        	url,</span><br><span class="line">        	<span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">            data</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">HttpRequest</span></span><br></pre></td></tr></table></figure>

<p><code>src/store/action-types.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置token</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">SET_TOKEN</span> = <span class="string">&#x27;SET_TOKEN&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">CLEAR_TOKEN</span> = <span class="string">&#x27;CLEAR_TOKEN&#x27;</span></span><br></pre></td></tr></table></figure>

<p><code>src/store/index.js</code></p>
<p>这个功能是所有路由组件都需要的，可以放在根文件，当然也可以单独抽成一个模块</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vuex</span> <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"><span class="keyword">import</span> modules <span class="keyword">from</span> <span class="string">&#x27;./modules/index.js&#x27;</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="title class_">Types</span> <span class="keyword">from</span> <span class="string">&#x27;@/store/actions-types&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Vuex</span>)</span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">    <span class="attr">state</span>: &#123; <span class="comment">// 公共的状态</span></span><br><span class="line">        <span class="attr">tokens</span>: []</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">mutations</span>: &#123;</span><br><span class="line">        [<span class="title class_">Types</span>.<span class="property">SET_TOKEN</span>](state, token) &#123;</span><br><span class="line">            <span class="comment">// 我们希望状态可以被追踪，但一般不会用push方法来更新，而是会用新的数组赋值（内存地址会变化）</span></span><br><span class="line">    		<span class="comment">// state.tokens.push(token) </span></span><br><span class="line">            state.<span class="property">tokens</span> = [...state.<span class="property">tokens</span>, token] <span class="comment">// 存储token，后续页面切换可以让token一次执行</span></span><br><span class="line">		&#125;,</span><br><span class="line">        [<span class="title class_">Types</span>.<span class="property">CLEAR_TOKEN</span>](state) &#123; <span class="comment">// 一般这一步，放在actions里</span></span><br><span class="line">            state.<span class="property">tokens</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">token</span> =&gt;</span> <span class="title function_">token</span>()) <span class="comment">// 执行所有的取消方法，都调用一下</span></span><br><span class="line">            state.<span class="property">tokens</span> = [] <span class="comment">// 清空列表</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">modules</span>: &#123;</span><br><span class="line">        ...modules</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>src/router/hooks.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;@/store&#x27;</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="title class_">Types</span> <span class="keyword">from</span> <span class="string">&#x27;@/store/action-types.js&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="comment">// 此字段只是给自己看的</span></span><br><span class="line">    <span class="string">&#x27;clear_token&#x27;</span>: <span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 这里也可以做一些白名单，不管咋样都允许请求</span></span><br><span class="line">        <span class="comment">// whiteList</span></span><br><span class="line">        store.<span class="title function_">commit</span>(<span class="title class_">Types</span>.<span class="property">CLEAR_TOKEN</span>) <span class="comment">// 清空取消请求的token，如果只希望某个页面切换时取消请求，单独放在组件卸载的生命周期钩子里即可</span></span><br><span class="line">        <span class="title function_">next</span>() <span class="comment">// vue3中支持await的写法</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>src/router/index.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VueRouter</span> <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> hooks <span class="keyword">from</span> <span class="string">&#x27;./hooks.js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">VueRouter</span>)</span><br><span class="line"><span class="keyword">const</span> routes =[</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> <span class="title class_">VueRouter</span>(&#123;</span><br><span class="line">    <span class="attr">mode</span>: <span class="string">&#x27;history&#x27;</span>,</span><br><span class="line">    <span class="attr">base</span>: process.<span class="property">env</span>.<span class="property">BASE_URL</span>,</span><br><span class="line">    routes</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 循环的是hooks对象的value</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">values</span>(hooks).<span class="title function_">forEach</span>(<span class="function"><span class="params">hook</span> =&gt;</span> &#123;</span><br><span class="line">    router.<span class="title function_">beforeEach</span>(hook)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br></pre></td></tr></table></figure>



<h3 id="使用-1"><a href="#使用-1" class="headerlink" title="使用"></a>使用</h3><p>新建<code>src/api/home.js</code>文件，对应每个页面的接口文件</p>
<p>如果一个页面的接口有很多，可以新建<code>src/api/config/config.js</code>，该文件单独维护各个路径</p>
<p><code>home/js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axois <span class="keyword">from</span> <span class="string">&#x27;@/utils/axios&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">fetchSliders</span> = (<span class="params"></span>) =&gt; axios.<span class="title function_">get</span>(<span class="string">&#x27;/api/slider&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><code>vue</code>的走<code>vuex</code>的开发流程：<code>state -&gt; action-types -&gt; api -&gt; actions -&gt; mutations</code></p>
<p>发请求的页面</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">	export default &#123;</span><br><span class="line">        //...</span><br><span class="line">        async mounted() &#123;</span><br><span class="line">            // 页面一开始就加载数据</span><br><span class="line">            if(this.slides.length == 0 )&#123; // 如果vuex中没有数据，获取数据</span><br><span class="line">                try &#123;</span><br><span class="line">                    await this[Types.SET_SLIDES]()</span><br><span class="line">                &#125; catch(e) &#123; // 错误处理、或者异常处理</span><br><span class="line">                    console.log(e) // 这里的异常是处理取消请求token时的报错，应该是用户用的时候自己处理，不能在封装库的时候处理</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h3 id="注意点"><a href="#注意点" class="headerlink" title="注意点"></a>注意点</h3><ul>
<li><p>避免路由组件一切换就发请求，可以加一层判断</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// this[Types.ACTION_CATEGORYLIST]() // 注意写法</span></span><br><span class="line">  <span class="comment">// 加一层判断，避免每次切换路由组件时都请求一遍接口</span></span><br><span class="line">  <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">categoryList</span>.<span class="property">length</span> == <span class="number">0</span>) &#123; <span class="comment">// 如果vuex中没有数据，再去重新请求（用户刷新页面会重新请求）</span></span><br><span class="line">      <span class="variable language_">this</span>[<span class="title class_">Types</span>.<span class="property">ACTION_CATEGORYLIST</span>]()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
</li>
<li><p>刷新页面，立刻切换到其他路由组件时，之前的请求应该取消掉</p>
<p>之前我们在全局的请求拦截器中，加了<code>cancelToken</code>，相当于<code>xhr.abort()</code></p>
</li>
</ul>
<h1 id="持久化最佳实践"><a href="#持久化最佳实践" class="headerlink" title="持久化最佳实践"></a>持久化最佳实践</h1><h2 id="登录持久化"><a href="#登录持久化" class="headerlink" title="登录持久化"></a>登录持久化</h2><h3 id="localStorage"><a href="#localStorage" class="headerlink" title="localStorage"></a><code>localStorage</code></h3><h3 id="cookie"><a href="#cookie" class="headerlink" title="cookie"></a><code>cookie</code></h3><h3 id="sessionStorage"><a href="#sessionStorage" class="headerlink" title="sessionStorage"></a><code>sessionStorage</code></h3><p>记录滚动条位置</p>
<h3 id="indexDB"><a href="#indexDB" class="headerlink" title="indexDB"></a><code>indexDB</code></h3><h1 id="移动端最佳实践"><a href="#移动端最佳实践" class="headerlink" title="移动端最佳实践"></a>移动端最佳实践</h1><h2 id="em适配"><a href="#em适配" class="headerlink" title="em适配"></a><code>em</code>适配</h2><h2 id="rem适配"><a href="#rem适配" class="headerlink" title="rem适配"></a><code>rem</code>适配</h2><p><code>postcss-plugin-px2rem</code></p>
<p>- </p>
<p><code>lib-flexible</code></p>
<ul>
<li>在页面中注入一段脚本，可获取设备<code>DPR</code>和屏幕宽度，自动计算<code>font-size</code>并添加至<code>html</code>节点属性上</li>
</ul>
<p>安装：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i postcss-plugin-px2rem lib-flexible</span><br></pre></td></tr></table></figure>

<p><code>main.js</code>中引入</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;lib/flexible&#x27;</span> <span class="comment">// 对应设置根的字体（这个插件也可以自己手写）</span></span><br></pre></td></tr></table></figure>

<p><code>vue.config.js</code>新增配置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">css</span>: &#123;</span><br><span class="line">        <span class="attr">loaderOptions</span>: &#123;</span><br><span class="line">            <span class="attr">postcss</span>: &#123;</span><br><span class="line">                <span class="attr">plugins</span>: [</span><br><span class="line">                    <span class="built_in">require</span>(<span class="string">&quot;postcss-plugin-px2rem&quot;</span>)(&#123;</span><br><span class="line">                        <span class="attr">rootValue</span>: <span class="number">37.5</span>, <span class="comment">// 表示设计稿大小 375 1rem = 37.5 ,vant里设计稿的大小是375px，可以根据实际修改</span></span><br><span class="line">                        <span class="attr">exclude</span>: <span class="regexp">/node_module/</span></span><br><span class="line">                    &#125;)</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="控制台警告"><a href="#控制台警告" class="headerlink" title="控制台警告"></a>控制台警告</h1><h2 id="Added-non-passive-event-listener"><a href="#Added-non-passive-event-listener" class="headerlink" title="Added non-passive event listener..."></a><code>Added non-passive event listener...</code></h2><p>在使用第三方库时，可能控制台报错如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="title class_">Violation</span>] <span class="title class_">Added</span> non-passive event listener to a [scroll](<span class="attr">https</span>:<span class="comment">//so.csdn.net/so/search?q=scroll&amp;spm=1001.2101.3001.7020)-blocking &#x27;mousewheel&#x27; event. Consider marking event handler as &#x27;passive&#x27; to make the page more responsive.</span></span><br></pre></td></tr></table></figure>

<p><img src="/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96%EF%BC%88Vue%EF%BC%89.assets/40af32c14abc42c090960d33d2b6b508.png" alt="img"></p>
<p><img src="/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96%EF%BC%88Vue%EF%BC%89.assets/image-20220706104041328.png" alt="image-20220706104041328"></p>
<p>[违规]添加非被动事件<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E7%9B%91%E5%90%AC%E5%99%A8&spm=1001.2101.3001.7020">监听器</a>到滚动阻塞’鼠标滚轮’事件。 考虑将事件处理程序标记为“被动”，以使页面响应更快。</p>
<p><strong>解决方案：</strong></p>
<p><strong>1、</strong>npm i default-passive-events -S</p>
<p>2、main.js中加入：import ‘default-passive-events’</p>
<p>原因是 Chrome51 版本以后，Chrome 增加了新的事件捕获机制－Passive Event Listeners；</p>
<p>Passive Event Listeners：就是告诉前页面内的事件监听器内部是否会调用preventDefault函数来阻止事件的默认行为，以便浏览器根据这个信息更好地做出决策来优化页面性能。当属性passive的值为true的时候，代表该监听器内部不会调用preventDefault函数来阻止默认滑动行为，Chrome浏览器称这类型的监听器为被动（passive）监听器。目前Chrome主要利用该特性来优化页面的滑动性能，所以Passive Event Listeners特性当前仅支持mousewheel&#x2F;touch相关事件。</p>
<p>来源：<a target="_blank" rel="noopener" href="https://blog.csdn.net/Wildness_/article/details/123190078">https://blog.csdn.net/Wildness_/article/details/123190078</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="https://github.com/Saiable">Sai</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://mindcons.cn/2022/08/08/web/JavaScript/Engineering/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96%EF%BC%88Vue%EF%BC%89/">http://mindcons.cn/2022/08/08/web/JavaScript/Engineering/前端工程化（Vue）/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://mindcons.cn" target="_blank">吕小布の博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://s2.loli.net/2022/07/02/xjocPR8fnLu64KU.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://s2.loli.net/2022/07/02/ZYspTWmDdytfLXa.png" target="_blank"><img class="post-qr-code-img" src="https://s2.loli.net/2022/07/02/ZYspTWmDdytfLXa.png" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="https://s2.loli.net/2022/07/02/3zcRHPK5m6C8sE2.png" target="_blank"><img class="post-qr-code-img" src="https://s2.loli.net/2022/07/02/3zcRHPK5m6C8sE2.png" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/08/08/web/JavaScript/Engineering/JS%E6%A8%A1%E5%9D%97%E5%8C%96/"><img class="prev-cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">JS模块化</div></div></a></div><div class="next-post pull-right"><a href="/2022/08/07/web/%E4%B8%93%E6%A0%8F/%E7%A7%AF%E7%B4%AF/%E4%B9%A6%E7%B1%8D%E7%AC%94%E8%AE%B0/"><img class="next-cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">书籍笔记</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://s2.loli.net/2022/07/02/xjocPR8fnLu64KU.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Sai</div><div class="author-info__description">无来无去,不悔不怨</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">93</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">14</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Saiable"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/xxxxx" target="_blank" title="QQ"><i class="fa-brands fa-qq"></i></a><a class="social-icon" href="https://github.com/xxxxx" target="_blank" title="WeChat"><i class="fa-brands fa-weixin"></i></a><a class="social-icon" href="https://github.com/Saiable" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:xxxxxx@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="mailto:xxxxxx@gmail.com" target="_blank" title="Email"><i class="fa-solid fa-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">时间再多一点的愿望无法满足，那就多清醒一会儿</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E7%9B%B8%E5%85%B3"><span class="toc-number">1.</span> <span class="toc-text">环境相关</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#node%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">1.1.</span> <span class="toc-text">node环境搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E7%8B%AC%E5%AE%89%E8%A3%85nodejs"><span class="toc-number">1.1.1.</span> <span class="toc-text">单独安装nodejs</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#linux%E7%8E%AF%E5%A2%83"><span class="toc-number">1.1.1.1.</span> <span class="toc-text">linux环境</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#windows%E7%8E%AF%E5%A2%83"><span class="toc-number">1.1.1.2.</span> <span class="toc-text">windows环境</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nvm%E7%AE%A1%E7%90%86node"><span class="toc-number">1.1.2.</span> <span class="toc-text">nvm管理node</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85nvm"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">安装nvm</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8nvm%E7%AE%A1%E7%90%86node"><span class="toc-number">1.1.2.2.</span> <span class="toc-text">使用nvm管理node</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Vue-cli%E8%84%9A%E6%89%8B%E6%9E%B6"><span class="toc-number">1.2.</span> <span class="toc-text">Vue&#x2F;cli脚手架</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%96%B0%E9%A1%B9%E7%9B%AE"><span class="toc-number">1.2.1.</span> <span class="toc-text">创建新项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E6%89%8B%E8%80%81%E9%A1%B9%E7%9B%AE"><span class="toc-number">1.2.2.</span> <span class="toc-text">接手老项目</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE"><span class="toc-number">1.3.</span> <span class="toc-text">配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E4%BB%A3%E7%90%86"><span class="toc-number">1.3.1.</span> <span class="toc-text">配置代理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E6%8F%8F%E8%BF%B0"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">问题描述</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8"><span class="toc-number">1.3.1.2.</span> <span class="toc-text">实际应用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEeslint"><span class="toc-number">1.3.2.</span> <span class="toc-text">配置eslint</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E9%A1%B9%E7%9B%AE%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="toc-number">2.</span> <span class="toc-text">前端项目目录结构</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84%E4%B8%80"><span class="toc-number">2.1.</span> <span class="toc-text">目录结构一</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E8%A7%88"><span class="toc-number">2.1.1.</span> <span class="toc-text">概览</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#src-main-js%E7%BB%93%E6%9E%84"><span class="toc-number">2.1.2.</span> <span class="toc-text">src&#x2F;main.js结构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#vue%E7%9B%B8%E5%85%B3%E4%BE%9D%E8%B5%96"><span class="toc-number">2.1.2.1.</span> <span class="toc-text">vue相关依赖</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#src-utils"><span class="toc-number">2.1.3.</span> <span class="toc-text">src&#x2F;utils</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#loadable-js"><span class="toc-number">2.1.3.1.</span> <span class="toc-text">loadable.js</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#debounce-js%E3%80%81-throttles-js"><span class="toc-number">2.1.3.2.</span> <span class="toc-text">_debounce.js、_throttles.js</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E9%98%B2%E6%8A%96%E8%8A%82%E6%B5%81"><span class="toc-number">2.1.3.2.1.</span> <span class="toc-text">什么是防抖节流</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#vue%E4%B8%AD%E8%87%AA%E5%AE%9A%E4%B9%89%E9%98%B2%E6%8A%96%E8%8A%82%E6%B5%81"><span class="toc-number">2.1.3.2.2.</span> <span class="toc-text">vue中自定义防抖节流</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E5%B0%81%E8%A3%85"><span class="toc-number">2.1.3.2.2.1.</span> <span class="toc-text">函数封装</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%9C%A8%E9%9C%80%E8%A6%81%E4%BD%BF%E7%94%A8%E7%9A%84%E7%BB%84%E4%BB%B6%E4%B8%AD%E5%BC%95%E7%94%A8"><span class="toc-number">2.1.3.2.2.2.</span> <span class="toc-text">在需要使用的组件中引用</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-number">2.1.3.2.2.3.</span> <span class="toc-text">使用</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%98%B2%E6%8A%96%E8%8A%82%E6%B5%81%E7%9A%84%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93"><span class="toc-number">2.1.3.2.3.</span> <span class="toc-text">防抖节流的第三方库</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#src-styles"><span class="toc-number">2.1.4.</span> <span class="toc-text">src&#x2F;styles</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#src-router"><span class="toc-number">2.1.5.</span> <span class="toc-text">src&#x2F;router</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#router-js"><span class="toc-number">2.1.5.1.</span> <span class="toc-text">router.js</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#hooks-js"><span class="toc-number">2.1.5.2.</span> <span class="toc-text">hooks.js</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#permission-js"><span class="toc-number">2.1.5.3.</span> <span class="toc-text">permission.js</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%B5%84%E6%BA%90%E5%AF%BC%E5%85%A5"><span class="toc-number">3.</span> <span class="toc-text">资源导入</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90"><span class="toc-number">3.1.</span> <span class="toc-text">导入静态资源</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E7%AC%AC%E4%B8%89%E6%96%B9UI%E5%BA%93"><span class="toc-number">3.1.1.</span> <span class="toc-text">导入第三方UI库</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#elementUI"><span class="toc-number">3.1.1.1.</span> <span class="toc-text">elementUI</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#elementPlus"><span class="toc-number">3.1.1.2.</span> <span class="toc-text">elementPlus</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#vantUI"><span class="toc-number">3.1.1.3.</span> <span class="toc-text">vantUI</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E7%AC%AC%E4%B8%89%E6%96%B9%E5%9B%BE%E6%A0%87%E5%BA%93"><span class="toc-number">3.1.2.</span> <span class="toc-text">导入第三方图标库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E8%87%AA%E5%AE%9A%E4%B9%89%E5%B7%A5%E5%85%B7%E5%BA%93"><span class="toc-number">3.1.3.</span> <span class="toc-text">导入自定义工具库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E7%9A%84%E8%87%AA%E5%AE%9A%E4%B9%89%E5%B0%81%E8%A3%85"><span class="toc-number">3.1.4.</span> <span class="toc-text">第三方库的自定义封装</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E5%8A%A8%E6%80%81%E8%B5%84%E6%BA%90"><span class="toc-number">3.2.</span> <span class="toc-text">导入动态资源</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5scss%E5%8F%98%E9%87%8F"><span class="toc-number">3.2.1.</span> <span class="toc-text">导入scss变量</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Vuex%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="toc-number">4.</span> <span class="toc-text">Vuex最佳实践</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#vuex%E6%A8%A1%E5%9D%97%E5%8C%96%E7%BC%96%E7%A0%81%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="toc-number">4.1.</span> <span class="toc-text">vuex模块化编码最佳实践</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89%E6%A8%A1%E5%9D%97"><span class="toc-number">4.1.1.</span> <span class="toc-text">定义模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8createNamespacedHelpers%E7%AE%80%E5%8C%96map-%E5%86%99%E6%B3%95"><span class="toc-number">4.1.2.</span> <span class="toc-text">使用createNamespacedHelpers简化map*写法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#actions%E5%92%8Cmutaions%E7%9A%84types%E7%9A%84%E7%BB%9F%E4%B8%80%E7%AE%A1%E7%90%86"><span class="toc-number">4.1.3.</span> <span class="toc-text">actions和mutaions的types的统一管理</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#VueRouter%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="toc-number">5.</span> <span class="toc-text">VueRouter最佳实践</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%82%E6%AD%A5%E7%BB%84%E4%BB%B6"><span class="toc-number">5.1.</span> <span class="toc-text">异步组件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E6%9D%83%E9%99%90"><span class="toc-number">5.2.</span> <span class="toc-text">路由权限</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8F%9C%E5%8D%95%E6%9D%83%E9%99%90"><span class="toc-number">5.3.</span> <span class="toc-text">菜单权限</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8C%89%E9%92%AE%E6%9D%83%E9%99%90"><span class="toc-number">5.4.</span> <span class="toc-text">按钮权限</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#axios%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="toc-number">6.</span> <span class="toc-text">axios最佳实践</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E5%B0%81%E8%A3%85-1"><span class="toc-number">6.1.</span> <span class="toc-text">函数封装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B1%BB%E5%B0%81%E8%A3%85"><span class="toc-number">6.2.</span> <span class="toc-text">类封装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%81%E8%A3%85"><span class="toc-number">6.2.1.</span> <span class="toc-text">封装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-1"><span class="toc-number">6.2.2.</span> <span class="toc-text">使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%E7%82%B9"><span class="toc-number">6.2.3.</span> <span class="toc-text">注意点</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8C%81%E4%B9%85%E5%8C%96%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="toc-number">7.</span> <span class="toc-text">持久化最佳实践</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">7.1.</span> <span class="toc-text">登录持久化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#localStorage"><span class="toc-number">7.1.1.</span> <span class="toc-text">localStorage</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cookie"><span class="toc-number">7.1.2.</span> <span class="toc-text">cookie</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sessionStorage"><span class="toc-number">7.1.3.</span> <span class="toc-text">sessionStorage</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#indexDB"><span class="toc-number">7.1.4.</span> <span class="toc-text">indexDB</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%A7%BB%E5%8A%A8%E7%AB%AF%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="toc-number">8.</span> <span class="toc-text">移动端最佳实践</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#em%E9%80%82%E9%85%8D"><span class="toc-number">8.1.</span> <span class="toc-text">em适配</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#rem%E9%80%82%E9%85%8D"><span class="toc-number">8.2.</span> <span class="toc-text">rem适配</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8E%A7%E5%88%B6%E5%8F%B0%E8%AD%A6%E5%91%8A"><span class="toc-number">9.</span> <span class="toc-text">控制台警告</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Added-non-passive-event-listener"><span class="toc-number">9.1.</span> <span class="toc-text">Added non-passive event listener...</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/08/10/web/HTML/HTML%E6%A0%B8%E5%BF%83/" title="HTML核心">HTML核心</a><time datetime="2022-08-10T01:03:02.000Z" title="发表于 2022-08-10 09:03:02">2022-08-10</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/08/10/web/%E6%A1%88%E4%BE%8B%E5%AE%9E%E6%88%98/%E8%8B%B1%E9%9B%84%E8%81%94%E7%9B%9F%E5%AE%98%E7%BD%91%E9%A6%96%E9%A1%B5/" title="英雄联盟官网案例">英雄联盟官网案例</a><time datetime="2022-08-10T01:03:02.000Z" title="发表于 2022-08-10 09:03:02">2022-08-10</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/08/09/web/readme/" title="回顾记录">回顾记录</a><time datetime="2022-08-09T01:03:02.000Z" title="发表于 2022-08-09 09:03:02">2022-08-09</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/08/09/web/web%E5%9F%BA%E7%A1%80%E5%8F%8A%E8%BF%9B%E9%98%B6%E8%B7%AF%E7%BA%BF/" title="web基础及进阶路线">web基础及进阶路线</a><time datetime="2022-08-09T01:03:02.000Z" title="发表于 2022-08-09 09:03:02">2022-08-09</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/08/09/web/%E5%AD%A6%E4%B9%A0%E6%96%B9%E5%BC%8F/" title="学习方式">学习方式</a><time datetime="2022-08-09T01:03:02.000Z" title="发表于 2022-08-09 09:03:02">2022-08-09</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022  <i id="heartbeat" class="fa fas fa-heartbeat"></i> Sai</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hi, welcome to my <a target="_blank" rel="noopener" href="https://saiable.github.io/">blog</a>!</div></div><link rel="stylesheet" href="https://fastly.jsdelivr.net/gh/HCLonely/images@master/others/heartbeat.min.css"></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>